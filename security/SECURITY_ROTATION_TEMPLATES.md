# Security rotation templates

This file contains provider-specific rotation steps and message templates to notify teams and rotate compromised keys.

## 1) Supabase (Service Role key)

Steps:

1. Go to your Supabase project dashboard.
2. Settings -> API.
3. Regenerate the service_role key (rotate it).
4. Replace the old key wherever it was used (server envs, CI secrets, deploy providers).
5. Revoke sessions if necessary (Auth -> Settings -> Revoke all sessions) if you suspect tokens were minted.

Notification template:

Subject: [SECURITY] Supabase service_role key rotation required

Body: "During a repository audit we discovered a Supabase service_role key in the commit history. The key has been removed from the repo history, but you MUST rotate the key in Supabase immediately and update all environments and CI secrets that used the key. The backup branch is `backup-before-secrets-clean`. If you used this key in staging/production, rotate it now and rotate any tokens or secrets that were minted."

## 2) Stripe (secret keys)

Steps:

1. Sign in to the Stripe Dashboard.
2. Developers -> API keys.
3. Rotate the secret key(s) (create a new key and replace usages).
4. Revoke or delete old keys when safe.

Notification template:

Subject: [SECURITY] Stripe secret key rotation required

Body: "A secret API key was found in the repository. Rotate the key in Stripe immediately and update all server environments, CI, and integrations that use it."

## 3) Amadeus / Hotelbeds (or other travel APIs)

Steps:

1. Login to provider console.
2. Regenerate API credentials or create new ones and swap out usages.
3. Revoke older credentials as applicable.

Notification template:

Subject: [SECURITY] Third-party API credential rotation required

Body: "A credential for the provider was detected in the repository. Rotate the credential in the provider console and update the project's secrets store and CI."

## 4) General guidance for rotation and communication

- Prioritize rotating keys used by production services first.
- Use the backing-up branch `backup-before-secrets-clean` for audit only; do not reintroduce secrets.
- After rotation, confirm new keys are stored only in the environment provider (CI secrets, hosting envs) and not committed to the repo.
- Update docs and `env.example` with placeholders only (no real keys).

## 5) Suggested notice to send to the team

Short message (Slack/Email):

"We found a committed secret in the repo history and have removed it from history. Please rotate any keys you were responsible for and update your local envs. See branch `security/incident-report` for details. If you need help, ping @devops."

## 6) Contact & escalation

- Add the security owner / on-call to the notification and record the incident in your tracking system.

---
Generated by incident automation for `maku-travel-verse`.
