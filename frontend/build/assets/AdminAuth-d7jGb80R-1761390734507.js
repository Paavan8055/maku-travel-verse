import{u as w,h as A,r as l,j as e,d as S,f as L,g as E,i as C,e as k,B as D,s as m,l as x,m as I,N as v}from"./index-Ds3Fyqjq-1761390734507.js";import{I as j}from"./input-c5Lp-zZl-1761390734507.js";import{L as y}from"./label-DMJPoe02-1761390734507.js";import{S as P}from"./shield-B3chqNe1-1761390734507.js";import{M as R}from"./mail-CPLbNPmR-1761390734507.js";import{L as B}from"./lock-DNJcSegN-1761390734507.js";import{L as F}from"./LoginForm-C6uX4gW0-1761390734507.js";import"./separator-Bs5ZZTHa-1761390734507.js";import"./github-D3nNSuGG-1761390734507.js";const T=({onSwitchToRegular:n})=>{const{signIn:u}=w(),{toast:r}=A(),[c,o]=l.useState(!1),[s,p]=l.useState({email:"",password:""}),h=async t=>{t.preventDefault(),o(!0);try{const{error:a}=await u(s.email,s.password);if(a){r({title:"Admin Sign In Error",description:a.message,variant:"destructive"});return}const{data:d,error:i}=await m.rpc("get_admin_status");if(i){x.error("Admin status check failed:",i),await m.auth.signOut(),r({title:"Security Error",description:"Unable to verify admin status. Please try again.",variant:"destructive"});return}if(!d){await m.auth.signOut(),r({title:"Access Denied",description:"You don't have admin privileges.",variant:"destructive"});return}r({title:"Admin Access Granted",description:"Welcome to the admin dashboard."})}catch{r({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}finally{o(!1)}};return e.jsxs(S,{className:"w-full max-w-md mx-auto border-none shadow-2xl bg-card/80 backdrop-blur-sm",children:[e.jsxs(L,{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-primary"})}),e.jsx(E,{className:"text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Admin Access"}),e.jsx(C,{className:"text-muted-foreground",children:"Sign in to the administrative dashboard"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"admin-email",children:"Admin Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(j,{id:"admin-email",type:"email",placeholder:"admin@maku.travel",value:s.email,onChange:t=>p(a=>({...a,email:t.target.value})),className:"pl-10",required:!0,"aria-label":"Admin email address"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"admin-password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(j,{id:"admin-password",type:"password",placeholder:"••••••••",value:s.password,onChange:t=>p(a=>({...a,password:t.target.value})),className:"pl-10",required:!0,"aria-label":"Password"})]})]}),e.jsx(D,{type:"submit",className:"w-full h-11 bg-gradient-to-r from-primary to-secondary hover:opacity-90 transition-all duration-200",disabled:c,children:c?"Signing In...":"Access Admin Dashboard"})]}),e.jsxs("div",{className:"text-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Not an admin? "}),e.jsx("button",{type:"button",className:"text-primary hover:underline font-medium",onClick:n,children:"Regular sign in"})]})]})]})},J=()=>{var f,g;const{user:n,loading:u}=w(),[r,c]=l.useState(!0),[o,s]=l.useState(null),h=((g=(f=I().state)==null?void 0:f.from)==null?void 0:g.pathname)||"/admin/dashboard",t=new URLSearchParams(window.location.search),a=t.get("dev")==="true"||t.get("bypass")==="admin",d=window.location.hostname.includes("preview.emergentagent.com"),i=a&&(d||window.location.hostname==="localhost");return l.useEffect(()=>{(async()=>{if(i){x.info("Admin bypass enabled for preview environment"),s(!0);return}if(n){const{data:N,error:b}=await m.rpc("get_admin_status");b?(x.error("Admin status check failed:",b),s(!1)):s(!!N)}else s(null)})()},[n,i]),u?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 to-secondary/5",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):n&&o||i?e.jsx(v,{to:h,replace:!0}):n&&o===!1?e.jsx(v,{to:"/auth",replace:!0}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 to-secondary/5 p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[d&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-100 border border-blue-300 rounded-lg text-sm",children:[e.jsxs("p",{className:"text-blue-800",children:[e.jsx("strong",{children:"Preview Environment:"})," Add ",e.jsx("code",{children:"?bypass=admin"})," to URL for admin access"]}),e.jsxs("p",{className:"text-blue-600 mt-1",children:["Example: ",e.jsx("code",{children:"/admin?bypass=admin"})]})]}),d&&i&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 border border-green-300 rounded-lg text-sm",children:e.jsxs("p",{className:"text-green-800",children:[e.jsx("strong",{children:"Admin Bypass Active:"})," Redirecting to admin dashboard..."]})}),r?e.jsx(T,{onSwitchToRegular:()=>c(!1)}):e.jsx(F,{onSwitchToSignUp:()=>{}})]})})};export{J as default};
