import{r as u,y as V,a7 as l,j as e,i as v,k as f,l as N,t as y,B as h,n as w,a3 as Y,I as o,g as I,N as U,D as A}from"./index-BuFvfeSJ-1758786228561.js";import{T as H,a as R,b as P,c as _}from"./tabs-DEiRDxHt-1758786228561.js";import{L as c}from"./label-DYU-yWis-1758786228561.js";import{S,a as k,b as D,c as T,d}from"./select-D-JCiAP4-1758786228561.js";import{S as q}from"./switch-N83iNywX-1758786228561.js";import{B as p}from"./bell-IPtjUSk3-1758786228561.js";import{P as O}from"./plus-B7iO6Lyy-1758786228561.js";import{T as G}from"./trash-2-u1VfyGEF-1758786228561.js";import{T as J}from"./trending-down-CzvLo6Xj-1758786228561.js";import{C as K}from"./chevron-left-Ciz90jCt-1758786228561.js";import"./index-BdQq_4o_-1758786228561.js";import"./index-CJWzJC_R-1758786228561.js";const Q=()=>{const[x,F]=u.useState([]),[$,b]=u.useState(!0),[E,g]=u.useState(!1),[t,n]=u.useState({type:"hotel",destination:"",origin:"",startDate:"",endDate:"",passengers:2,rooms:1,targetPrice:0,threshold:10,notificationMethod:"email"}),{toast:i}=V();u.useEffect(()=>{j()},[]);const j=async()=>{try{b(!0);const{data:{session:s}}=await l.auth.getSession();if(!s){i({title:"Authentication Required",description:"Please log in to manage price alerts",variant:"destructive"});return}const{data:r,error:a}=await l.functions.invoke("price-alert-manager",{body:{action:"get_alerts"},headers:{Authorization:`Bearer ${s.access_token}`}});a?(console.error("Failed to load alerts:",a),i({title:"Error",description:"Failed to load your price alerts",variant:"destructive"})):F(r.alerts||[])}catch(s){console.error("Price alert loading error:",s),i({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}finally{b(!1)}},B=async()=>{try{const{data:{session:s}}=await l.auth.getSession();if(!s)return;const r={search_criteria:{type:t.type,destination:t.destination,origin:t.origin||void 0,dates:{start:t.startDate,end:t.endDate||void 0},passengers:t.passengers,rooms:t.rooms},target_price:t.targetPrice,current_price:t.targetPrice,threshold_percentage:t.threshold,notification_method:t.notificationMethod},{data:a,error:m}=await l.functions.invoke("price-alert-manager",{body:{action:"create_alert",...r},headers:{Authorization:`Bearer ${s.access_token}`}});m?(console.error("Failed to create alert:",m),i({title:"Error",description:"Failed to create price alert",variant:"destructive"})):(i({title:"Alert Created",description:"Your price alert has been set up successfully"}),g(!1),j(),C())}catch(s){console.error("Alert creation error:",s),i({title:"Error",description:"An unexpected error occurred",variant:"destructive"})}},M=async(s,r)=>{try{const{data:{session:a}}=await l.auth.getSession();if(!a)return;const{error:m}=await l.functions.invoke("price-alert-manager",{body:{action:"update_alert",alert_id:s,updates:{is_active:r}},headers:{Authorization:`Bearer ${a.access_token}`}});m?(console.error("Failed to update alert:",m),i({title:"Error",description:"Failed to update alert status",variant:"destructive"})):(i({title:r?"Alert Activated":"Alert Paused",description:`Price monitoring has been ${r?"enabled":"disabled"}`}),j())}catch(a){console.error("Alert toggle error:",a)}},L=async s=>{try{const{data:{session:r}}=await l.auth.getSession();if(!r)return;const{error:a}=await l.functions.invoke("price-alert-manager",{body:{action:"delete_alert",alert_id:s},headers:{Authorization:`Bearer ${r.access_token}`}});a?(console.error("Failed to delete alert:",a),i({title:"Error",description:"Failed to delete price alert",variant:"destructive"})):(i({title:"Alert Deleted",description:"Price alert has been removed"}),j())}catch(r){console.error("Alert deletion error:",r)}},C=()=>{n({type:"hotel",destination:"",origin:"",startDate:"",endDate:"",passengers:2,rooms:1,targetPrice:0,threshold:10,notificationMethod:"email"})},z=s=>{const r=[];return s.origin&&r.push(`${s.origin} →`),r.push(s.destination),s.dates.end?r.push(`${s.dates.start} to ${s.dates.end}`):r.push(s.dates.start),s.passengers&&r.push(`${s.passengers} passengers`),s.rooms&&r.push(`${s.rooms} rooms`),r.join(" • ")};return $?e.jsxs(v,{children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5"}),"Price Alerts"]})}),e.jsx(y,{children:e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(3)].map((s,r)=>e.jsx("div",{className:"h-20 bg-muted rounded-lg"},r))})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5"}),"Price Alerts (",x.length,")"]}),e.jsxs(h,{onClick:()=>g(!0),size:"sm",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Create Alert"]})]})}),e.jsx(y,{children:x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(p,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Price Alerts"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Set up alerts to get notified when prices drop for your searches"}),e.jsx(h,{onClick:()=>g(!0),children:"Create Your First Alert"})]}):e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{variant:"outline",className:"capitalize",children:s.search_criteria.type}),e.jsx(w,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Paused"})]}),e.jsx("p",{className:"text-sm font-medium",children:z(s.search_criteria)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{checked:s.is_active,onCheckedChange:r=>M(s.id,r)}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>L(s.id),children:e.jsx(G,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{children:["Target: $",s.target_price]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{children:["Current: $",s.current_price]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("span",{children:["±",s.threshold_percentage,"% threshold"]})]})]}),s.last_checked&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Last checked: ",new Date(s.last_checked).toLocaleString()]})]},s.id))})})]}),E&&e.jsxs(v,{children:[e.jsx(f,{children:e.jsx(N,{children:"Create New Price Alert"})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Travel Type"}),e.jsxs(S,{value:t.type,onValueChange:s=>n({...t,type:s}),children:[e.jsx(k,{children:e.jsx(D,{})}),e.jsxs(T,{children:[e.jsx(d,{value:"hotel",children:"Hotel"}),e.jsx(d,{value:"flight",children:"Flight"}),e.jsx(d,{value:"activity",children:"Activity"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Destination"}),e.jsx(o,{placeholder:"e.g., Sydney, Melbourne, Paris",value:t.destination,onChange:s=>n({...t,destination:s.target.value})})]}),t.type==="flight"&&e.jsxs("div",{children:[e.jsx(c,{children:"Origin"}),e.jsx(o,{placeholder:"e.g., SYD, MEL, NYC",value:t.origin,onChange:s=>n({...t,origin:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Start Date"}),e.jsx(o,{type:"date",value:t.startDate,onChange:s=>n({...t,startDate:s.target.value})})]}),(t.type==="hotel"||t.type==="activity")&&e.jsxs("div",{children:[e.jsx(c,{children:"End Date"}),e.jsx(o,{type:"date",value:t.endDate,onChange:s=>n({...t,endDate:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Target Price ($)"}),e.jsx(o,{type:"number",placeholder:"200",value:t.targetPrice||"",onChange:s=>n({...t,targetPrice:Number(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Alert Threshold (%)"}),e.jsx(o,{type:"number",placeholder:"10",value:t.threshold,onChange:s=>n({...t,threshold:Number(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Notification Method"}),e.jsxs(S,{value:t.notificationMethod,onValueChange:s=>n({...t,notificationMethod:s}),children:[e.jsx(k,{children:e.jsx(D,{})}),e.jsxs(T,{children:[e.jsx(d,{value:"email",children:"Email"}),e.jsx(d,{value:"push",children:"Push Notification"}),e.jsx(d,{value:"both",children:"Both"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(h,{onClick:B,disabled:!t.destination||!t.targetPrice,children:"Create Alert"}),e.jsx(h,{variant:"outline",onClick:()=>{g(!1),C()},children:"Cancel"})]})]})]})]})},oe=()=>{const x=I();return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(U,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8 pt-24",children:[e.jsxs(h,{variant:"ghost",onClick:()=>x(-1),className:"mb-4",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("h1",{className:"text-3xl font-bold mb-8 flex items-center",children:[e.jsx(A,{className:"h-8 w-8 mr-3"}),"Profile"]}),e.jsxs(H,{defaultValue:"alerts",className:"w-full",children:[e.jsxs(R,{className:"grid w-full grid-cols-2",children:[e.jsxs(P,{value:"alerts",className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4"}),"Price Alerts"]}),e.jsxs(P,{value:"profile",className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Profile Settings"]})]}),e.jsx(_,{value:"alerts",className:"mt-6",children:e.jsx(Q,{})}),e.jsx(_,{value:"profile",className:"mt-6",children:e.jsxs(v,{children:[e.jsx(f,{children:e.jsx(N,{children:"Profile Settings"})}),e.jsx(y,{children:e.jsx("p",{className:"text-muted-foreground",children:"Profile settings coming soon..."})})]})})]})]})]})};export{oe as default};
