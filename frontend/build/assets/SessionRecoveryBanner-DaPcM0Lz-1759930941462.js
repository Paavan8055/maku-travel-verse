import{c as J,r as i,j as r,t as y,a as q,b as Y,f as K,B as R,X}from"./index-7HSUJgza-1759930941462.js";import{C as z}from"./circle-alert-CjpE5fBF-1759930941462.js";import{C as G}from"./clock-DzGQmIyr-1759930941462.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=J("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),re=({src:t,alt:u,width:o,height:a,className:h,containerClassName:p,lazy:d=!0,priority:n=!1,quality:c=80,placeholder:m,fallback:g="/placeholder.svg",blurDataURL:f,aspectRatio:b,sizes:j="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",fetchPriority:_="auto",enablePerformanceTracking:x=!0,onLoad:w,onError:I})=>{const[N,E]=i.useState(!0),[O,W]=i.useState(!1),[$,A]=i.useState(!d||n),[L,V]=i.useState(f||g),P=i.useRef(null),k=i.useRef(null),C=i.useRef(0),v=i.useCallback(s=>{if(s.includes("-")&&/[a-f0-9]{8}/.test(s)&&s.startsWith("/assets/"))return s;if(s.includes("cloudinary.com")){const e=s.split("/upload/");if(e.length===2){const l=[];return o&&l.push(`w_${Math.round(o)}`),a&&l.push(`h_${Math.round(a)}`),l.push("c_fill"),l.push(`q_${c}`),l.push("f_auto"),`${e[0]}/upload/${l.join(",")}/${e[1]}`}}if(s.includes("unsplash.com")){const e=new URL(s);return o&&e.searchParams.set("w",Math.round(o).toString()),a&&e.searchParams.set("h",Math.round(a).toString()),e.searchParams.set("q","65"),e.searchParams.set("fm","webp"),e.searchParams.set("fit","crop"),e.searchParams.set("auto","format,compress"),e.searchParams.set("cs","tinysrgb"),e.searchParams.delete("dpr"),e.toString()}if(s.startsWith("/")||s.includes(window.location.origin))return s;try{const e=new URL(s);return o&&e.searchParams.set("w",Math.round(o).toString()),a&&e.searchParams.set("h",Math.round(a).toString()),e.searchParams.set("q",c.toString()),e.toString()}catch{return s}},[o,a,c]),F=i.useCallback(s=>{if(s.includes("-")&&/[a-f0-9]{8}/.test(s)&&s.startsWith("/assets/"))return s;if(s.includes("unsplash.com")){const e=new URL(s);return o&&e.searchParams.set("w",Math.round(o).toString()),a&&e.searchParams.set("h",Math.round(a).toString()),e.searchParams.set("q","65"),e.searchParams.set("fm","webp"),e.searchParams.set("fit","crop"),e.searchParams.set("auto","format,compress"),e.searchParams.set("cs","tinysrgb"),e.searchParams.delete("dpr"),e.toString()}if(s.includes("cloudinary.com")){const e=s.split("/upload/");if(e.length===2){const l=[];return o&&l.push(`w_${Math.round(o)}`),a&&l.push(`h_${Math.round(a)}`),l.push("c_fill"),l.push(`q_${c}`),l.push("f_webp"),`${e[0]}/upload/${l.join(",")}/${e[1]}`}}if(s.startsWith("/")||s.includes(window.location.origin))return s;try{const e=new URL(s);return o&&e.searchParams.set("w",Math.round(o).toString()),a&&e.searchParams.set("h",Math.round(a).toString()),e.searchParams.set("q",c.toString()),e.searchParams.set("format","webp"),e.toString()}catch{return v(s)}},[o,a,c,v]);i.useEffect(()=>{if(!d||n){A(!0);return}if(!$)return k.current=new IntersectionObserver(s=>{var e;const[M]=s;M.isIntersecting&&(A(!0),C.current=performance.now(),x&&console.log(`Image loading started: ${t}`),(e=k.current)==null||e.disconnect())},{threshold:.1,rootMargin:"100px"}),P.current&&k.current.observe(P.current),()=>{var s;return(s=k.current)==null?void 0:s.disconnect()}},[d,n,$,t,x]);const D=i.useCallback(()=>{if(V(v(t)),E(!1),x&&C.current){const s=performance.now()-C.current;console.log(`Image loaded in ${s.toFixed(2)}ms: ${t}`),s>1e3&&console.warn(`Slow image load detected: ${t} (${s.toFixed(2)}ms)`)}w==null||w()},[w,t,x,v]),U=i.useCallback(()=>{W(!0),V(g),E(!1),I==null||I()},[I,g]),B=b?{square:"aspect-square",video:"aspect-video",wide:"aspect-[16/9]",portrait:"aspect-[3/4]"}[b]:"";v(t);const H=F(t);return n||!d?r.jsx("div",{className:y("relative overflow-hidden",B,p),style:b?void 0:{width:o,height:a},children:r.jsxs("picture",{children:[r.jsx("source",{srcSet:H,type:"image/webp",sizes:j}),r.jsx("img",{src:L,alt:u,width:o,height:a,sizes:j,loading:"eager",fetchPriority:_,decoding:"sync",className:y("w-full h-full object-cover transition-opacity duration-300",N?"opacity-0":"opacity-100",h),onLoad:D,onError:U})]})}):r.jsxs("div",{ref:P,className:y("relative overflow-hidden bg-muted",B,p),style:b?void 0:{width:o,height:a},children:[f&&N&&r.jsx("img",{src:f,alt:"",className:"absolute inset-0 w-full h-full object-cover filter blur-sm scale-110","aria-hidden":"true"}),$&&!O?r.jsxs("picture",{children:[r.jsx("source",{srcSet:H,type:"image/webp",sizes:j}),r.jsx("img",{src:L,alt:u,width:o,height:a,sizes:j,loading:"lazy",fetchPriority:_,decoding:"async",className:y("w-full h-full object-cover transition-all duration-500",N?"opacity-0 scale-105":"opacity-100 scale-100",h),onLoad:D,onError:U})]}):O?r.jsx("div",{className:"absolute inset-0 bg-muted/90 flex items-center justify-center",children:r.jsxs("div",{className:"text-center text-muted-foreground p-4",children:[r.jsx(Q,{className:"h-8 w-8 mx-auto mb-2"}),r.jsx("div",{className:"text-sm",children:"Failed to load image"})]})}):r.jsx("div",{className:"absolute inset-0 bg-muted animate-pulse",role:"img","aria-label":`Loading ${u}`,children:m&&r.jsx("img",{src:m,alt:"",className:"w-full h-full object-cover opacity-50 blur-sm"})}),x&&!N&&!O&&!1]})},S="hotel_booking_session",T=30*60*1e3,Z=()=>{const[t,u]=i.useState(null),[o,a]=i.useState(!1);return i.useEffect(()=>{const n=localStorage.getItem(S);if(n)try{const c=JSON.parse(n);!(Date.now()-(c.timestamp||0)>T)&&c.hotelId?(u(c),a(!0)):localStorage.removeItem(S)}catch(c){console.error("Error parsing saved session:",c),localStorage.removeItem(S)}},[]),{session:t,hasRecoverableSession:o,saveSession:n=>{const c={...t,...n,timestamp:Date.now()};u(c),localStorage.setItem(S,JSON.stringify(c))},clearSession:()=>{u(null),a(!1),localStorage.removeItem(S),sessionStorage.removeItem("selectedHotelOffer"),sessionStorage.removeItem("selectedHotelData"),sessionStorage.removeItem("selectedAddOns"),sessionStorage.removeItem("addOnsTotal")},recoverSession:()=>{if(!t)return null;const n=new URLSearchParams;return t.hotelId&&n.set("hotelId",t.hotelId),t.hotelName&&n.set("hotelName",t.hotelName),t.checkIn&&n.set("checkIn",t.checkIn),t.checkOut&&n.set("checkOut",t.checkOut),t.adults&&n.set("adults",t.adults.toString()),t.children&&n.set("children",t.children.toString()),t.rooms&&n.set("rooms",t.rooms.toString()),t.selectedOffer&&sessionStorage.setItem("selectedHotelOffer",JSON.stringify(t.selectedOffer)),t.selectedAddOns&&sessionStorage.setItem("selectedAddOns",JSON.stringify(t.selectedAddOns)),{searchUrl:`/search/hotels?${n.toString()}`,bookingUrl:t.step==="checkout"||t.step==="payment"?`/hotel-checkout?${n.toString()}`:`/booking/select?${n.toString()}`,step:t.step||"search"}}}},ae=()=>{const[t,u]=i.useState(!0),{hasRecoverableSession:o,session:a,recoverSession:h,clearSession:p}=Z();if(!o||!t||!a)return null;const d=()=>{const m=h();m&&(window.location.href=m.bookingUrl)},n=m=>{switch(m){case"room-selection":return"Room Selection";case"checkout":return"Checkout";case"payment":return"Payment";default:return"Hotel Search"}},c=()=>{if(!a.timestamp)return"";const m=Date.now()-a.timestamp,g=30*60*1e3-m,f=Math.floor(g/(60*1e3));return f>0?`${f} min left`:"Expiring soon"};return r.jsx(q,{className:"mx-4 my-2 border-orange-200 bg-orange-50 dark:bg-orange-950 dark:border-orange-800",children:r.jsx(Y,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(z,{className:"h-5 w-5 text-orange-500 mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("h4",{className:"font-medium text-orange-900 dark:text-orange-100",children:"Continue Your Booking"}),r.jsxs(K,{variant:"secondary",className:"text-xs",children:[r.jsx(G,{className:"h-3 w-3 mr-1"}),c()]})]}),r.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-200 mb-3",children:["You have an unfinished booking for ",r.jsx("strong",{children:a.hotelName}),a.checkIn&&a.checkOut&&r.jsxs("span",{children:[" from ",new Date(a.checkIn).toLocaleDateString()," to ",new Date(a.checkOut).toLocaleDateString()]}),". Last step: ",n(a.step),"."]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(R,{size:"sm",onClick:d,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Continue Booking"}),r.jsx(R,{size:"sm",variant:"outline",onClick:()=>{p(),u(!1)},className:"border-orange-300 text-orange-700 hover:bg-orange-100",children:"Start Fresh"})]})]}),r.jsx(R,{size:"sm",variant:"ghost",onClick:()=>u(!1),className:"text-orange-500 hover:text-orange-700 hover:bg-orange-100 dark:hover:bg-orange-900 p-1 h-auto",children:r.jsx(X,{className:"h-4 w-4"})})]})})})};export{re as I,ae as S,Z as u};
