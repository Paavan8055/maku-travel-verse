import{r as l,s as M,l as R,j as e,a as c,b as n,A as O,T as g,q as H,B as T,R as z,d as h,e as j,f as N}from"./index-DCRQEUcE-1760115652904.js";import{T as B,a as I,b as v,c as b}from"./tabs-LSycJ_P_-1760115652904.js";import{A as P}from"./activity-WCbq80ca-1760115652904.js";import{C as $}from"./clock-d4DfbCUF-1760115652904.js";import{T as U}from"./trending-up-CuNjAAey-1760115652904.js";import{T as V}from"./trending-down-Dh-XLGk1-1760115652904.js";import{E as F}from"./eye-DVaT_nzT-1760115652904.js";import{C as G}from"./circle-check-big-CbK-34Yn-1760115652904.js";const te=()=>{const[a,E]=l.useState({total:0,critical:0,bySection:{},recentErrors:[]}),[i,_]=l.useState({avgResponseTime:0,errorRate:0,totalRequests:0,slowestEndpoints:[]}),[C,S]=l.useState([]),[y,w]=l.useState(!0),[k,D]=l.useState(new Date);l.useEffect(()=>{u();const s=setInterval(u,3e4);return()=>clearInterval(s)},[]);const u=async()=>{try{w(!0);const{data:s,error:o}=await M.from("correlation_tracking").select("*").order("created_at",{ascending:!1}).limit(100);if(o)throw o;S(s||[]);const d=(s||[]).filter(t=>{var r;return t.status==="error"||((r=t.request_type)==null?void 0:r.includes("error"))}),f={};d.forEach(t=>{const r=t.request_data,m=(r==null?void 0:r.section)||"unknown";f[m]=(f[m]||0)+1}),E({total:d.length,critical:d.filter(t=>{var r;return((r=t.request_data)==null?void 0:r.severity)==="critical"}).length,bySection:f,recentErrors:d.slice(0,10).map(t=>{var r,m;return{id:t.id,message:((r=t.request_data)==null?void 0:r.error)||"Unknown error",section:((m=t.request_data)==null?void 0:m.section)||"unknown",timestamp:t.created_at,correlation_id:t.correlation_id}})});const p=(s||[]).filter(t=>t.status==="completed"&&t.duration_ms),L=p.length>0?p.reduce((t,r)=>t+r.duration_ms,0)/p.length:0,q=(s==null?void 0:s.length)>0?d.length/s.length*100:0;_({avgResponseTime:Math.round(L),errorRate:Math.round(q*100)/100,totalRequests:(s==null?void 0:s.length)||0,slowestEndpoints:[]}),D(new Date),R.info("Observability data refreshed")}catch(s){R.error("Error fetching observability data:",s)}finally{w(!1)}},x=a.critical>0?{status:"critical",color:"text-red-600",icon:g}:i.errorRate>5?{status:"warning",color:"text-orange-600",icon:g}:{status:"healthy",color:"text-green-600",icon:G},A=x.icon;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"System Health"}),e.jsx("p",{className:`text-lg font-bold ${x.color} capitalize`,children:x.status})]}),e.jsx(A,{className:`h-6 w-6 ${x.color}`})]})})}),e.jsx(c,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Requests"}),e.jsx("p",{className:"text-2xl font-bold",children:i.totalRequests})]}),e.jsx(P,{className:"h-6 w-6 text-blue-600"})]})})}),e.jsx(c,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Response"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.avgResponseTime,"ms"]})]}),e.jsx($,{className:"h-6 w-6 text-purple-600"})]})})}),e.jsx(c,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Error Rate"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.errorRate,"%"]})]}),i.errorRate>5?e.jsx(U,{className:"h-6 w-6 text-red-600"}):e.jsx(V,{className:"h-6 w-6 text-green-600"})]})})})]}),a.critical>0&&e.jsxs(O,{className:"border-red-200 bg-red-50",children:[e.jsx(g,{className:"h-4 w-4 text-red-600"}),e.jsxs(H,{className:"text-red-800",children:[e.jsxs("strong",{children:[a.critical," critical error",a.critical>1?"s":""]})," detected. Immediate attention required."]})]}),e.jsxs(B,{defaultValue:"errors",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(I,{children:[e.jsx(v,{value:"errors",children:"Errors"}),e.jsx(v,{value:"performance",children:"Performance"}),e.jsx(v,{value:"correlation",children:"Request Tracking"})]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:u,disabled:y,children:[e.jsx(z,{className:`h-4 w-4 mr-2 ${y?"animate-spin":""}`}),"Refresh"]})]}),e.jsx(b,{value:"errors",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(j,{children:"Errors by Section"})}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-3",children:[Object.entries(a.bySection).map(([s,o])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"capitalize",children:s}),e.jsx(N,{variant:o>5?"destructive":"secondary",children:o})]},s)),Object.keys(a.bySection).length===0&&e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No errors detected"})]})})]}),e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(j,{children:"Recent Errors"})}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[a.recentErrors.map(s=>e.jsxs("div",{className:"border-l-4 border-red-500 pl-3 py-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.message}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(N,{variant:"outline",className:"text-xs",children:s.section}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.timestamp).toLocaleString()})]})]}),e.jsx(T,{size:"sm",variant:"ghost",children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsx("code",{className:"text-xs text-muted-foreground block mt-1",children:s.correlation_id})]},s.id)),a.recentErrors.length===0&&e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No recent errors"})]})})]})]})}),e.jsx(b,{value:"performance",children:e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(j,{children:"Performance Overview"})}),e.jsx(n,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"Performance metrics dashboard coming soon..."}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Current average response time: ",i.avgResponseTime,"ms"]})]})})]})}),e.jsx(b,{value:"correlation",children:e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(j,{children:"Request Correlation Tracking"})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:C.slice(0,20).map(s=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:s.status==="completed"?"default":s.status==="error"?"destructive":"secondary",children:s.status}),e.jsx("span",{className:"font-medium",children:s.request_type})]}),s.duration_ms&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.duration_ms,"ms"]})]}),e.jsx("code",{className:"text-xs text-muted-foreground",children:s.correlation_id}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(s.created_at).toLocaleString()})]},s.id))})})]})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-center",children:["Last updated: ",k.toLocaleString()]})]})};export{te as ObservabilityDashboard,te as default};
