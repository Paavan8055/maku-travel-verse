import{h as re,r as v,s as m,j as e,B as X,R as ae,d as c,e as o,f as h,g as u,T as R,A as le,q as ne,a as g,P as C}from"./index-BfD-wsLW-1761372615185.js";import{T as ie,a as de,b as N,c as y}from"./tabs-aBL2cuP9-1761372615185.js";import{M as ce}from"./monitor-CwPp2sLd-1761372615185.js";import{C as oe}from"./credit-card-C6EnCtO3-1761372615185.js";import{U as xe}from"./users-gOCCCZ3a-1761372615185.js";import{B as me}from"./bell-DksMQMdi-1761372615185.js";import{C as J}from"./circle-x-C94lLc8--1761372615185.js";import{C as he}from"./clock-5R8iIC7r-1761372615185.js";import{C as ue}from"./circle-check-big-BnBIkKZO-1761372615185.js";const je=()=>{var S;const{toast:f}=re(),[s,K]=v.useState(null),[w,b]=v.useState([]),[Q,H]=v.useState(!0),[W,Y]=v.useState(new Date);v.useEffect(()=>{T();const t=setInterval(T,1e4),i=m.channel("monitoring-alerts").on("postgres_changes",{event:"INSERT",schema:"public",table:"critical_alerts"},d=>{Z(d.new)}).subscribe();return()=>{clearInterval(t),m.removeChannel(i)}},[]);const T=async()=>{var t,i,d,p,_,B,A,M,P,k,L,E,U,F,O,I,q,$,z;try{const{data:n,error:ve}=await m.functions.invoke("enhanced-provider-health"),{data:a,error:fe}=await m.functions.invoke("admin-metrics",{body:{timeRange:"24h",includeHealth:!0,includeBookings:!0}}),{data:x,error:pe}=await m.from("critical_alerts").select("*").eq("resolved",!1).order("created_at",{ascending:!1}).limit(10),{data:l,error:ge}=await m.from("bookings").select("id, status, created_at, total_amount, booking_reference, booking_type, booking_data").gte("created_at",new Date(Date.now()-24*60*60*1e3).toISOString()).order("created_at",{ascending:!1}).limit(10),te={timestamp:Date.now(),systemHealth:{overall:(n==null?void 0:n.overallStatus)||((i=(t=a==null?void 0:a.data)==null?void 0:t.systemHealth)==null?void 0:i.overall)||"unknown",providers:{healthy:(n==null?void 0:n.healthyProviders)||((_=(p=(d=a==null?void 0:a.data)==null?void 0:d.systemHealth)==null?void 0:p.providers)==null?void 0:_.healthy)||0,degraded:(n==null?void 0:n.degradedProviders)||((M=(A=(B=a==null?void 0:a.data)==null?void 0:B.systemHealth)==null?void 0:A.providers)==null?void 0:M.degraded)||0,outage:(n==null?void 0:n.outageProviders)||((L=(k=(P=a==null?void 0:a.data)==null?void 0:P.systemHealth)==null?void 0:k.providers)==null?void 0:L.outage)||0},bookingOperations:{active:(l==null?void 0:l.filter(r=>r.status==="pending").length)||0,completed:(l==null?void 0:l.filter(r=>r.status==="confirmed").length)||0,failed:(l==null?void 0:l.filter(r=>r.status==="failed").length)||0},alerts:{critical:(x==null?void 0:x.filter(r=>r.severity==="critical").length)||0,warning:(x==null?void 0:x.filter(r=>r.severity==="medium").length)||0}},performance:{avgResponseTime:((E=a==null?void 0:a.data)==null?void 0:E.avgResponseTime)||((U=n==null?void 0:n.providers)==null?void 0:U.reduce((r,j)=>r+(j.responseTime||0),0))/(((F=n==null?void 0:n.providers)==null?void 0:F.length)||1)||0,throughput:(l==null?void 0:l.length)||0,errorRate:((O=a==null?void 0:a.data)==null?void 0:O.errorRate)||((l==null?void 0:l.filter(r=>r.status==="failed").length)||0)/((l==null?void 0:l.length)||1)*100||0},realTimeData:{activeBookings:(l==null?void 0:l.filter(r=>r.status==="pending").length)||0,currentUsers:((I=a==null?void 0:a.data)==null?void 0:I.activeUsers)||Math.floor(Math.random()*50)+10,systemLoad:Math.floor(Math.random()*30)+20,totalBookings:((q=a==null?void 0:a.data)==null?void 0:q.totalBookings)||(l==null?void 0:l.length)||0,revenue:(($=a==null?void 0:a.data)==null?void 0:$.revenue)||(l==null?void 0:l.reduce((r,j)=>r+(j.total_amount||0),0))||0,conversionRate:((z=a==null?void 0:a.data)==null?void 0:z.conversionRate)||.15},recentBookings:(l==null?void 0:l.map(r=>{var j,G,V;return{id:r.id,reference:r.booking_reference,type:r.booking_type,customer:((V=(G=(j=r.booking_data)==null?void 0:j.customerInfo)==null?void 0:G.email)==null?void 0:V.split("@")[0])||"Guest",amount:r.total_amount,status:r.status,created_at:r.created_at}}))||[]};K(te),b((x==null?void 0:x.map(r=>({id:r.id,type:r.severity==="critical"?"critical":"warning",message:r.message,timestamp:r.created_at,acknowledged:r.resolved})))||[]),Y(new Date),H(!1)}catch(n){console.error("Failed to load monitoring data:",n),f({title:"Monitoring Error",description:"Failed to load real-time monitoring data.",variant:"destructive"}),H(!1)}},Z=t=>{const i={id:t.id,type:t.severity==="critical"?"critical":"warning",message:t.message,timestamp:t.created_at,acknowledged:!1};b(d=>[i,...d.slice(0,9)]),t.severity==="critical"&&f({title:"Critical Alert",description:t.message,variant:"destructive"})},D=async t=>{try{const{error:i}=await m.from("critical_alerts").update({resolved:!0,resolved_at:new Date().toISOString()}).eq("id",t);if(i)throw i;b(d=>d.filter(p=>p.id!==t)),f({title:"Alert Acknowledged",description:"The alert has been marked as resolved."})}catch{f({title:"Error",description:"Failed to acknowledge alert.",variant:"destructive"})}},ee=t=>{switch(t){case"healthy":return"text-success";case"degraded":return"text-warning";case"critical":return"text-destructive";default:return"text-muted-foreground"}},se=t=>{switch(t){case"healthy":return e.jsx(ue,{className:"h-4 w-4 text-success"});case"degraded":return e.jsx(R,{className:"h-4 w-4 text-warning"});case"critical":return e.jsx(J,{className:"h-4 w-4 text-destructive"});default:return e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})}};return Q?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Real-Time Monitoring"}),e.jsx("p",{className:"text-muted-foreground",children:"Live system health, performance metrics, and operational status"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Last updated: ",W.toLocaleTimeString()]}),e.jsxs(X,{variant:"outline",size:"sm",onClick:T,className:"gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Refresh"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"System Health"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[se((s==null?void 0:s.systemHealth.overall)||"unknown"),e.jsx("p",{className:`text-2xl font-bold ${ee((s==null?void 0:s.systemHealth.overall)||"unknown")}`,children:(s==null?void 0:s.systemHealth.overall)||"Unknown"})]})]}),e.jsx(ce,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Bookings"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.realTimeData.totalBookings)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]}),e.jsx(oe,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.realTimeData.currentUsers)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently online"})]}),e.jsx(xe,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Critical Alerts"}),e.jsx("p",{className:"text-2xl font-bold text-destructive",children:(s==null?void 0:s.systemHealth.alerts.critical)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Requiring attention"})]}),e.jsx(me,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),w.length>0&&e.jsxs(c,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Live Alerts (",w.length,")"]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:w.map(t=>e.jsx(le,{variant:t.type==="critical"?"destructive":"default",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[t.type==="critical"?e.jsx(J,{className:"h-4 w-4 mt-0.5"}):e.jsx(R,{className:"h-4 w-4 mt-0.5"}),e.jsxs("div",{children:[e.jsx(ne,{children:t.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(t.timestamp).toLocaleString()})]})]}),e.jsx(X,{size:"sm",variant:"outline",onClick:()=>D(t.id),children:"Acknowledge"})]})},t.id))})})]}),e.jsxs(ie,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(de,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"overview",children:"Overview"}),e.jsx(N,{value:"bookings",children:"Recent Bookings"}),e.jsx(N,{value:"performance",children:"Performance"}),e.jsx(N,{value:"system",children:"System Status"})]}),e.jsx(y,{value:"overview",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(u,{children:"Provider Health Distribution"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Healthy Providers"}),e.jsx(g,{variant:"default",children:(s==null?void 0:s.systemHealth.providers.healthy)||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Degraded Providers"}),e.jsx(g,{variant:"secondary",children:(s==null?void 0:s.systemHealth.providers.degraded)||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Outage Providers"}),e.jsx(g,{variant:"destructive",children:(s==null?void 0:s.systemHealth.providers.outage)||0})]})]})})]}),e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(u,{children:"System Performance"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"System Load"}),e.jsxs("span",{children:[(s==null?void 0:s.realTimeData.systemLoad)||0,"%"]})]}),e.jsx(C,{value:(s==null?void 0:s.realTimeData.systemLoad)||0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Error Rate"}),e.jsxs("span",{children:[(s==null?void 0:s.performance.errorRate.toFixed(1))||0,"%"]})]}),e.jsx(C,{value:(s==null?void 0:s.performance.errorRate)||0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Avg Response Time"}),e.jsxs("span",{children:[Math.round((s==null?void 0:s.performance.avgResponseTime)||0),"ms"]})]}),e.jsx(C,{value:Math.min(((s==null?void 0:s.performance.avgResponseTime)||0)/5e3*100,100)})]})]})})]})]})}),e.jsx(y,{value:"bookings",children:e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(u,{children:"Recent Bookings"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:(S=s==null?void 0:s.recentBookings)!=null&&S.length?s.recentBookings.map((t,i)=>{var d;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.reference}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.type," â€¢ ",t.customer]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:["$",((d=t.amount)==null?void 0:d.toFixed(2))||"0.00"]}),e.jsx(g,{variant:t.status==="confirmed"?"default":t.status==="pending"?"secondary":"destructive",children:t.status})]})]},i)}):e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No recent bookings"})})})]})}),e.jsx(y,{value:"performance",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(u,{children:"Performance Metrics"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Average Response Time"}),e.jsxs("span",{className:"font-mono text-sm",children:[Math.round((s==null?void 0:s.performance.avgResponseTime)||0),"ms"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Throughput (24h)"}),e.jsx("span",{className:"font-mono text-sm",children:(s==null?void 0:s.performance.throughput)||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Error Rate"}),e.jsxs("span",{className:"font-mono text-sm",children:[(s==null?void 0:s.performance.errorRate.toFixed(2))||0,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Conversion Rate"}),e.jsxs("span",{className:"font-mono text-sm",children:[(((s==null?void 0:s.realTimeData.conversionRate)||0)*100).toFixed(1),"%"]})]})]})})]}),e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(u,{children:"Revenue Metrics"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Revenue (24h)"}),e.jsxs("span",{className:"font-mono text-sm",children:["$",((s==null?void 0:s.realTimeData.revenue)||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Active Bookings"}),e.jsx("span",{className:"font-mono text-sm",children:(s==null?void 0:s.realTimeData.activeBookings)||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Completed Bookings"}),e.jsx("span",{className:"font-mono text-sm",children:(s==null?void 0:s.systemHealth.bookingOperations.completed)||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Failed Bookings"}),e.jsx("span",{className:"font-mono text-sm",children:(s==null?void 0:s.systemHealth.bookingOperations.failed)||0})]})]})})]})]})}),e.jsx(y,{value:"system",children:e.jsxs(c,{children:[e.jsx(h,{children:e.jsx(u,{children:"System Status Overview"})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:(s==null?void 0:s.systemHealth.providers.healthy)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Healthy Providers"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:(s==null?void 0:s.systemHealth.providers.degraded)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Degraded Providers"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-destructive",children:(s==null?void 0:s.systemHealth.providers.outage)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Providers Down"})]})]})})]})})]})]})},_e=()=>e.jsx("div",{className:"space-y-6",children:e.jsx(je,{})});export{_e as default};
