import{r as x,i as M,h as U,j as e,a as q,B as N,u as z,m as G,e as B,f as L,g as _}from"./index-CCJXHVND-1758529089024.js";import{S as R}from"./separator-BOEwzwDA-1758529089024.js";import{u as Y,b as H,t as J}from"./zod-CDxmDf2g-1758529089024.js";import{I as v}from"./input-DSa5q-99-1758529089024.js";import{S as K,a as Q,b as W,c as X,d as T}from"./select-BMoSzZYL-1758529089024.js";import{T as Z}from"./textarea-Ckby79J7-1758529089024.js";import{C as ee}from"./checkbox-DvICsrly-1758529089024.js";import{F as se,a as l,b as c,c as o,d,e as m}from"./form-CwGxkJG_-1758529089024.js";import{a as I}from"./autofillService-SoaXT3vg-1758529089024.js";import{U as te}from"./users-DvBL6lt--1758529089024.js";import{S as ae}from"./sparkles-upX4POGN-1758529089024.js";import{T as ie}from"./trash-2-mQ1HDKQn-1758529089024.js";import{P as re}from"./plus-BrcB786P-1758529089024.js";import{o as $,s as p,b as ne,a as le}from"./types-BekIk3NQ-1758529089024.js";import{C as ce}from"./chevron-left-i0V4E_fV-1758529089024.js";import{S as E}from"./shield-Bp_urqIn-1758529089024.js";import{C as oe}from"./calendar-fiPr5SYR-1758529089024.js";import{C as de}from"./clock-CrxJXQgr-1758529089024.js";import{M as me}from"./map-pin-CV0D8R5G-1758529089024.js";import"./index-BdQq_4o_-1758529089024.js";import"./index-RYiNfBS7-1758529089024.js";import"./chevron-down-CYivkmQh-1758529089024.js";import"./label-DLNxSQaf-1758529089024.js";const pe=$({title:p().min(1,"Title is required"),firstName:p().min(1,"First name is required"),lastName:p().min(1,"Last name is required"),dateOfBirth:p().min(1,"Date of birth is required"),email:p().email("Valid email is required"),phone:p().min(10,"Valid phone number is required"),dietaryRestrictions:p().optional(),emergencyContact:p().optional()}),he=$({participants:le(pe).min(1,"At least one participant is required"),specialRequests:p().optional(),acknowledgment:ne().refine(n=>n===!0,{message:"You must acknowledge the terms and conditions"})});function xe({onChange:n,initial:A,participantCount:u=1}){const[S,h]=x.useState(!1),{toast:j}=M(),{user:f}=U(),s=Y({resolver:J(he),mode:"onBlur",defaultValues:{participants:Array.from({length:u},()=>({title:"",firstName:"",lastName:"",dateOfBirth:"",email:"",phone:"",dietaryRestrictions:"",emergencyContact:""})),specialRequests:"",acknowledgment:!1,...A}}),{fields:g,append:a,remove:P}=H({control:s.control,name:"participants"}),{formState:{isValid:w}}=s,b=x.useCallback(()=>{if(n){const i=s.getValues();n(w,i)}},[n,w,s]);x.useEffect(()=>{const i=s.watch(()=>{b()});return b(),()=>i.unsubscribe()},[s,b]);const F=i=>i.toUpperCase(),C=()=>{j({title:"Demo data not available",description:"Please enter participant information manually",variant:"destructive"})},k=async()=>{var i;if(!(f!=null&&f.id)){j({title:"Please log in",description:"You need to be logged in to use saved information",variant:"destructive"});return}h(!0);try{const r=await I.loadUserStoredData(f.id);if(!r.hasStoredData){j({title:"No saved data found",description:"Please save your preferences and passport info first",variant:"destructive"});return}const t=g.map((D,V)=>{if(V===0){const y=I.userDataToPersonalForm(r);return{title:y.title==="MR"?"Mr":"Mrs",firstName:y.firstName,lastName:y.lastName,dateOfBirth:y.dateOfBirth,email:y.email,phone:y.phone,dietaryRestrictions:"",emergencyContact:y.phone}}else return{title:"",firstName:"",lastName:"",dateOfBirth:"",email:"",phone:"",dietaryRestrictions:"",emergencyContact:""}});s.setValue("participants",t),s.setValue("specialRequests",((i=r.preferences)==null?void 0:i.special_requests)||""),j({title:"Information loaded",description:"Form filled with your saved information"})}catch{j({title:"Error loading data",description:"Could not load your saved information",variant:"destructive"})}finally{setTimeout(()=>h(!1),500)}},O=()=>{a({title:"",firstName:"",lastName:"",dateOfBirth:"",email:"",phone:"",dietaryRestrictions:"",emergencyContact:""})};return e.jsxs(q,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Participant Details"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:C,disabled:S,className:"text-xs",children:[e.jsx(ae,{className:"h-3 w-3 mr-1"}),"Fill Demo Data"]}),e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:k,disabled:S,className:"text-xs",children:"Use My Info"})]})]}),e.jsx(se,{...s,children:e.jsxs("form",{className:"space-y-6",children:[g.map((i,r)=>e.jsxs(q,{className:"p-4 bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-medium",children:["Participant ",r+1]}),g.length>1&&e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>P(r),className:"text-destructive hover:text-destructive",children:e.jsx(ie,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx(l,{control:s.control,name:`participants.${r}.title`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(o,{children:"Title"}),e.jsxs(K,{onValueChange:t.onChange,value:t.value,children:[e.jsx(d,{children:e.jsx(Q,{children:e.jsx(W,{placeholder:"Select title"})})}),e.jsxs(X,{children:[e.jsx(T,{value:"Mr",children:"Mr"}),e.jsx(T,{value:"Mrs",children:"Mrs"}),e.jsx(T,{value:"Ms",children:"Ms"}),e.jsx(T,{value:"Dr",children:"Dr"})]})]}),e.jsx(m,{})]})}),e.jsx(l,{control:s.control,name:`participants.${r}.firstName`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(o,{children:"First Name"}),e.jsx(d,{children:e.jsx(v,{...t,onChange:D=>t.onChange(F(D.target.value)),placeholder:"Enter first name"})}),e.jsx(m,{})]})}),e.jsx(l,{control:s.control,name:`participants.${r}.lastName`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(o,{children:"Last Name"}),e.jsx(d,{children:e.jsx(v,{...t,onChange:D=>t.onChange(F(D.target.value)),placeholder:"Enter last name"})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(l,{control:s.control,name:`participants.${r}.dateOfBirth`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(o,{children:"Date of Birth"}),e.jsx(d,{children:e.jsx(v,{...t,type:"date"})}),e.jsx(m,{})]})}),e.jsx(l,{control:s.control,name:`participants.${r}.email`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(o,{children:"Email"}),e.jsx(d,{children:e.jsx(v,{...t,type:"email",placeholder:"Enter email address"})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:s.control,name:`participants.${r}.phone`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(o,{children:"Phone Number"}),e.jsx(d,{children:e.jsx(v,{...t,placeholder:"Enter phone number"})}),e.jsx(m,{})]})}),e.jsx(l,{control:s.control,name:`participants.${r}.emergencyContact`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(o,{children:"Emergency Contact (Optional)"}),e.jsx(d,{children:e.jsx(v,{...t,placeholder:"Emergency contact number"})}),e.jsx(m,{})]})})]}),e.jsx(l,{control:s.control,name:`participants.${r}.dietaryRestrictions`,render:({field:t})=>e.jsxs(c,{className:"mt-4",children:[e.jsx(o,{children:"Dietary Restrictions (Optional)"}),e.jsx(d,{children:e.jsx(v,{...t,placeholder:"e.g., Vegetarian, Gluten-free, No nuts"})}),e.jsx(m,{})]})})]},i.id)),e.jsxs(N,{type:"button",variant:"outline",onClick:O,className:"w-full",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add Another Participant"]}),e.jsx(l,{control:s.control,name:"specialRequests",render:({field:i})=>e.jsxs(c,{children:[e.jsx(o,{children:"Special Requests (Optional)"}),e.jsx(d,{children:e.jsx(Z,{...i,placeholder:"Enter any special requests for the activity",className:"min-h-[80px]"})}),e.jsx(m,{})]})}),e.jsx(l,{control:s.control,name:"acknowledgment",render:({field:i})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(d,{children:e.jsx(ee,{checked:i.value,onCheckedChange:i.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(o,{children:"I acknowledge that I have read and agree to the activity booking terms, cancellation policy, and safety requirements."}),e.jsx(m,{})]})]})})]})})]})}const $e=()=>{const[n,A]=x.useState(!1),[u,S]=x.useState(null),[h,j]=x.useState(!1),f=z(),[s]=G(),{toast:g}=M(),a={type:s.get("type")||"activity",activityId:s.get("activityId")||"",title:s.get("title")||"Activity Booking",date:s.get("date")||"",time:s.get("time")||"",participants:parseInt(s.get("participants")||"1"),total:parseFloat(s.get("total")||"0")},P=()=>{const C={...Object.fromEntries(s),booking_type:"activity",activity_id:a.activityId,guest_data:JSON.stringify(u)},k=new URLSearchParams(C).toString();f(`/booking/payment?${k}`)},w=x.useCallback(()=>{if(!h){if(console.log("Continue button clicked for activity",{guestValid:n,guest:!!u,bookingDetails:a}),!n){g({title:"Please complete participant details",description:"All participant information is required to continue",variant:"destructive"});return}if(!u){g({title:"Participant information missing",description:"Please fill in the participant details",variant:"destructive"});return}j(!0),console.log("Activity booking - validation passed, proceeding to payment"),P()}},[h,n,u,a,g,P]),b=!n||!u||h,F=x.useCallback((C,k)=>{console.log("Guest form change:",{valid:C,data:k}),S(k),A(C)},[]);return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"bg-card border-b sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>f(-1),children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Activity Checkout"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Complete your activity booking"})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{id:"guest-details",children:e.jsx(xe,{onChange:F,participantCount:a.participants})}),e.jsx(q,{className:"lg:hidden",children:e.jsx(B,{className:"p-6",children:e.jsx(N,{onClick:w,className:"w-full btn-primary h-12",size:"lg",disabled:b,children:h?"Processing...":"Continue to Payment"})})})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(q,{className:"sticky top-24",children:[e.jsx(L,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-green-600"}),"Activity Summary"]})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:a.title}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:a.date})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{children:a.time})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"Downtown Historic District"})]})]})]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Booking Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Participants:"}),e.jsxs("span",{children:[a.participants," adult",a.participants>1?"s":""]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Price per person:"}),e.jsxs("span",{children:["$",(a.total/a.participants).toFixed(2)]})]})]})]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",a.total.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Taxes & fees:"}),e.jsx("span",{children:"$0.00"})]}),e.jsx(R,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",a.total.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm mb-1",children:"Cancellation Policy"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Free cancellation up to 24 hours before the activity starts. Cancellations within 24 hours are non-refundable."})]}),e.jsx(N,{onClick:w,className:"w-full btn-primary h-12 mt-6",size:"lg",disabled:b,children:h?"Processing...":"Continue to Payment"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(E,{className:"h-3 w-3"}),e.jsx("span",{children:"Your personal information is secure and encrypted"})]})]})]})})]})})]})};export{$e as default};
