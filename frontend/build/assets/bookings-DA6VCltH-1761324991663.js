import{c as je,r as l,s as $,l as xe,j as e,d as x,f as S,g as _,e as u,a as h,B as d,w as f,R as ge,X as Te,F as Ae,L as ie,T as le}from"./index-CmnXGmSR-1761324991663.js";import{T as oe,a as de,b as R,c as B}from"./tabs-DdZtRR2V-1761324991663.js";import{I as M}from"./input-DuoUWz5u-1761324991663.js";import{T as fe,a as pe,b as ce,c as k,d as ve,e as C}from"./table-tsNBZNTx-1761324991663.js";import{S as Y,a as K,b as X,c as J,d as n}from"./select-BSl65-33-1761324991663.js";import{C as ne}from"./calendar-Chp3S92P-1761324991663.js";import{D as Re}from"./download-BwQU0ClH-1761324991663.js";import{F as Be}from"./filter-DbrpDTg7-1761324991663.js";import{S as Ie}from"./search-Q6EvFPtU-1761324991663.js";import{E as Ne}from"./eye-DqUpJyRC-1761324991663.js";import{T as ye}from"./textarea-KIlUOPgp-1761324991663.js";import{C as ue}from"./checkbox-CX9qApGx-1761324991663.js";import{c as E}from"./correlationId-10vhnYYQ-1761324991663.js";import{R as Ee}from"./rotate-ccw-D7OIvBIK-1761324991663.js";import{D as De}from"./dollar-sign-eVp-RoVw-1761324991663.js";import{M as be}from"./mail-B_pk5hKy-1761324991663.js";import{S as Fe}from"./send-CmRyQceM-1761324991663.js";import{C as we}from"./clock-m741sTIw-1761324991663.js";import{C as ke}from"./circle-check-big-Dm6-6eRM-1761324991663.js";import{S as Le}from"./switch-BpMaTev9-1761324991663.js";import{B as re}from"./bell-p92r-Q5o-1761324991663.js";import{V as $e,a as Pe}from"./volume-x-Dvq5nYdn-1761324991663.js";import{S as Ve}from"./settings-CjWD3Xqt-1761324991663.js";import{T as Me}from"./trash-2-BI63Cmyw-1761324991663.js";import{M as ze}from"./message-square-Dm5cmUzP-1761324991663.js";import"./index-BdQq_4o_-1761324991663.js";import"./index-O-8XG9Cn-1761324991663.js";import"./chevron-down-C3nyfvlR-1761324991663.js";import"./v4-BToUZ8VQ-1761324991663.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=je("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=je("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]),Oe=()=>{const[z,Q]=l.useState([]),[o,p]=l.useState(!0),[U,W]=l.useState(""),[D,H]=l.useState("all"),[N,q]=l.useState("all");l.useEffect(()=>{F()},[]);const F=async()=>{try{p(!0);const{data:r,error:v}=await $.from("bookings").select(`
          id,
          booking_reference,
          booking_type,
          status,
          total_amount,
          currency,
          created_at,
          user_id,
          booking_data
        `).order("created_at",{ascending:!1}).limit(100);if(v)throw v;Q(r||[]),xe.info("Bookings loaded successfully")}catch(r){xe.error("Error fetching bookings:",r)}finally{p(!1)}},P=z.filter(r=>{const v=!U||r.booking_reference.toLowerCase().includes(U.toLowerCase())||r.id.includes(U),y=D==="all"||r.status===D,b=N==="all"||r.booking_type===N;return v&&y&&b}),O=r=>{switch(r){case"confirmed":return e.jsx(h,{className:"bg-success/10 text-success border-success/20",children:"Confirmed"});case"pending":return e.jsx(h,{variant:"secondary",children:"Pending"});case"cancelled":return e.jsx(h,{variant:"destructive",children:"Cancelled"});case"completed":return e.jsx(h,{className:"bg-primary/10 text-primary border-primary/20",children:"Completed"});default:return e.jsx(h,{variant:"outline",children:r})}},Z=r=>{switch(r){case"hotel":return e.jsx(h,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Hotel"});case"flight":return e.jsx(h,{variant:"outline",className:"bg-green-50 text-green-700",children:"Flight"});case"activity":return e.jsx(h,{variant:"outline",className:"bg-purple-50 text-purple-700",children:"Activity"});default:return e.jsx(h,{variant:"outline",children:r})}};return o?e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Booking Management"]})}),e.jsx(u,{children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(_,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Booking Management",e.jsxs(h,{variant:"outline",children:[P.length," bookings"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",variant:"outline",className:"gap-2",onClick:()=>{const r=[["Reference","Type","Status","Amount","Currency","Date","Customer"],...P.map(j=>{var I,a;return[j.booking_reference,j.booking_type,j.status,j.total_amount||0,j.currency,new Date(j.created_at).toLocaleDateString(),((a=(I=j.booking_data)==null?void 0:I.customerInfo)==null?void 0:a.email)||"Guest"]})].map(j=>j.join(",")).join(`
`),v=new Blob([r],{type:"text/csv"}),y=URL.createObjectURL(v),b=document.createElement("a");b.href=y,b.download=`bookings-${new Date().toISOString().split("T")[0]}.csv`,b.click(),URL.revokeObjectURL(y)},children:[e.jsx(Re,{className:"h-4 w-4"}),"Export"]}),e.jsxs(d,{size:"sm",variant:"outline",className:"gap-2",onClick:()=>{console.log("Advanced filter clicked")},children:[e.jsx(Be,{className:"h-4 w-4"}),"Advanced Filter"]})]})]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search by booking reference or ID...",value:U,onChange:r=>W(r.target.value),className:"pl-10"})]}),e.jsxs(Y,{value:D,onValueChange:H,children:[e.jsx(K,{className:"w-40",children:e.jsx(X,{placeholder:"Status"})}),e.jsxs(J,{children:[e.jsx(n,{value:"all",children:"All Status"}),e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"confirmed",children:"Confirmed"}),e.jsx(n,{value:"completed",children:"Completed"}),e.jsx(n,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(Y,{value:N,onValueChange:q,children:[e.jsx(K,{className:"w-40",children:e.jsx(X,{placeholder:"Type"})}),e.jsxs(J,{children:[e.jsx(n,{value:"all",children:"All Types"}),e.jsx(n,{value:"hotel",children:"Hotel"}),e.jsx(n,{value:"flight",children:"Flight"}),e.jsx(n,{value:"activity",children:"Activity"})]})]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(fe,{children:[e.jsx(pe,{children:e.jsxs(ce,{children:[e.jsx(k,{children:"Reference"}),e.jsx(k,{children:"Type"}),e.jsx(k,{children:"Status"}),e.jsx(k,{children:"Amount"}),e.jsx(k,{children:"Date"}),e.jsx(k,{children:"Customer"}),e.jsx(k,{children:"Actions"})]})}),e.jsx(ve,{children:P.map(r=>{var v,y,b;return e.jsxs(ce,{children:[e.jsxs(C,{children:[e.jsx("div",{className:"font-mono text-sm",children:r.booking_reference}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r.id.substring(0,8),"..."]})]}),e.jsx(C,{children:Z(r.booking_type)}),e.jsx(C,{children:O(r.status)}),e.jsx(C,{children:e.jsxs("div",{className:"font-medium",children:[r.currency," ",((v=r.total_amount)==null?void 0:v.toLocaleString())||"0"]})}),e.jsx(C,{className:"text-muted-foreground",children:new Date(r.created_at).toLocaleDateString()}),e.jsx(C,{className:"text-muted-foreground",children:((b=(y=r.booking_data)==null?void 0:y.customerInfo)==null?void 0:b.email)||"Guest"}),e.jsx(C,{children:e.jsxs(d,{size:"sm",variant:"outline",className:"gap-2",onClick:()=>{window.open(`/admin/bookings/${r.id}`,"_blank")},children:[e.jsx(Ne,{className:"h-4 w-4"}),"View"]})})]},r.id)})})]})})]})]})},We=()=>{const[z,Q]=l.useState("operations"),[o,p]=l.useState([]),[U,W]=l.useState([]),[D,H]=l.useState(!1),[N,q]=l.useState(""),[F,P]=l.useState(""),[O,Z]=l.useState([]),[r,v]=l.useState(!1),[y,b]=l.useState(null),[j,I]=l.useState(null),[a,T]=l.useState(!1),g=[{id:"delay-notification",name:"Flight Delay Notification",subject:"Important Update: Flight Delay for Booking {bookingRef}",body:`Dear {customerName},

We regret to inform you that your flight {flightNumber} scheduled for {departureDate} has been delayed. New departure time is {newDepartureTime}.

We apologize for any inconvenience caused.`,type:"delay"},{id:"cancellation-notice",name:"Booking Cancellation Notice",subject:"Booking Cancellation Confirmation - {bookingRef}",body:`Dear {customerName},

Your booking {bookingRef} has been successfully cancelled as requested. Refund will be processed within 5-7 business days.

Thank you for choosing MAKU.Travel.`,type:"cancellation"},{id:"refund-processed",name:"Refund Processed",subject:"Refund Processed for Booking {bookingRef}",body:`Dear {customerName},

Your refund of {refundAmount} for booking {bookingRef} has been processed successfully. You should see the amount in your account within 3-5 business days.`,type:"refund"}],[G,ee]=l.useState([]),V=l.useCallback(async()=>{v(!0),b(null);try{const{data:s,error:t}=await $.functions.invoke("critical-booking-alerts",{body:{action:"get_active_alerts",correlationId:E.getCurrentId()},headers:E.getHeaders()});if(t)throw t;Z((s==null?void 0:s.active_alerts)||[])}catch(s){console.error("Failed to fetch alerts:",s),b("Failed to load alerts"),f.error("Failed to load alerts")}finally{v(!1)}},[]);l.useEffect(()=>{(async()=>{try{const{data:t,error:m}=await $.from("bookings").select(`
            id,
            booking_reference,
            booking_type,
            status,
            total_amount,
            currency,
            booking_data,
            created_at,
            updated_at
          `).order("created_at",{ascending:!1}).limit(50);if(m)throw m;const L=(t||[]).map(w=>{var A;const i=((A=w.booking_data)==null?void 0:A.customerInfo)||{};return{id:w.id,bookingReference:w.booking_reference,type:w.booking_type,status:w.status,customerName:i.firstName&&i.lastName?`${i.firstName} ${i.lastName}`:"Guest User",customerEmail:i.email||"no-email@example.com",amount:w.total_amount||0,currency:w.currency||"AUD",createdAt:new Date(w.created_at),lifecycle:[{stage:"Search",status:"completed"},{stage:"Selection",status:"completed"},{stage:"Payment",status:w.status==="confirmed"?"completed":"current"},{stage:"Provider Booking",status:w.status==="confirmed"?"completed":"pending"},{stage:"Confirmation",status:w.status==="confirmed"?"completed":"pending"},{stage:"Travel",status:"pending"}]}});ee(L)}catch(t){console.error("Failed to fetch bookings:",t),ee([])}})()},[]),l.useEffect(()=>{z==="alerts"&&V()},[z,V]);const ae=l.useCallback(async s=>{if(o.length===0){f.error("Please select bookings to perform operation");return}H(!0);try{const{data:t,error:m}=await $.functions.invoke("bulk-booking-operations",{body:{operation:"bulk_operation",operationType:s,bookingIds:o,correlationId:E.getCurrentId()},headers:E.getHeaders()});if(m)throw m;const L=(t==null?void 0:t.results)||[];L.forEach(i=>{const A=i.booking_reference||i.booking_id;i.status==="success"?f.success(`${s} succeeded for booking ${A}`):i.status==="failed"?f.error(`${s} failed for booking ${A}: ${i.error||i.message}`):f(`${s} skipped for booking ${A}: ${i.message}`)}),ee(i=>i.map(A=>{if(!L.find(he=>he.booking_id===A.id&&he.status==="success"))return A;let te=A.status;return s==="retry"&&(te="pending"),s==="cancel"&&(te="cancelled"),s==="refund"&&(te="refunded"),{...A,status:te}}));const w=L.map(i=>({id:`op-${Date.now()}-${i.booking_id}`,bookingId:i.booking_id,operationType:s,status:i.status==="failed"?"failed":"completed",requestedBy:"admin",requestedAt:new Date,completedAt:new Date,notes:i.message||i.error}));W(i=>[...w,...i]),p([])}catch(t){console.error("Bulk operation failed:",t),f.error("Bulk operation failed")}finally{H(!1)}},[o]),c=l.useCallback(async()=>{if(o.length===0||!N.trim()){f.error("Please select bookings and enter message");return}H(!0);try{const s=g.find(L=>L.id===F),{data:t,error:m}=await $.functions.invoke("bulk-booking-operations",{body:{operation:"bulk_communication",bookingIds:o,message:N,template:s||null,correlationId:E.getCurrentId()},headers:E.getHeaders()});if(m)throw m;f.success(`Communication sent to ${o.length} customers`),q(""),P(""),p([])}catch(s){console.error("Communication failed:",s),f.error("Failed to send communication")}finally{H(!1)}},[o,N,F,g]),se=l.useCallback(async s=>{I(s);try{const{data:t,error:m}=await $.functions.invoke("critical-booking-alerts",{body:{action:"resolve_alert",booking_id:s,correlationId:E.getCurrentId()},headers:E.getHeaders()});if(m)throw m;f.success("Alert resolved"),V()}catch(t){console.error("Failed to resolve alert:",t),f.error("Failed to resolve alert")}finally{I(null)}},[V]),Ce=l.useCallback(async()=>{T(!0);try{const{data:s,error:t}=await $.functions.invoke("critical-booking-alerts",{body:{action:"check_triggers",correlationId:E.getCurrentId()},headers:E.getHeaders()});if(t)throw t;const m=(s==null?void 0:s.alerts_triggered)||0;f.success(m>0?`${m} alerts triggered`:"No new alerts"),V()}catch(s){console.error("Failed to check triggers:",s),f.error("Failed to check alerts")}finally{T(!1)}},[V]),Se=s=>{switch(s){case"completed":return e.jsx(ke,{className:"h-4 w-4 text-green-500"});case"current":return e.jsx(we,{className:"h-4 w-4 text-blue-500"});case"failed":return e.jsx(le,{className:"h-4 w-4 text-red-500"});default:return e.jsx("div",{className:"h-4 w-4 border-2 border-muted rounded-full"})}},me=s=>{switch(s){case"confirmed":return e.jsx(h,{className:"bg-green-500/10 text-green-500",children:"Confirmed"});case"stuck":return e.jsx(h,{variant:"destructive",children:"Stuck"});case"cancelled":return e.jsx(h,{variant:"outline",children:"Cancelled"});default:return e.jsx(h,{variant:"secondary",children:s})}},_e=s=>{switch(s){case"critical":return{container:"bg-red-50 border-red-200",icon:"text-red-500",title:"text-red-700",sub:"text-red-600"};case"high":return{container:"bg-yellow-50 border-yellow-200",icon:"text-yellow-500",title:"text-yellow-700",sub:"text-yellow-600"};default:return{container:"bg-blue-50 border-blue-200",icon:"text-blue-500",title:"text-blue-700",sub:"text-blue-600"}}};return e.jsx("div",{className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-primary"}),"Enhanced Booking Operations"]})}),e.jsx(u,{children:e.jsxs(oe,{value:z,onValueChange:Q,className:"space-y-4",children:[e.jsxs(de,{className:"grid w-full grid-cols-4",children:[e.jsx(R,{value:"operations",children:"Bulk Operations"}),e.jsx(R,{value:"communication",children:"Customer Communication"}),e.jsx(R,{value:"lifecycle",children:"Lifecycle Tracking"}),e.jsx(R,{value:"alerts",children:"Critical Alerts"})]}),e.jsx(B,{value:"operations",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(S,{children:e.jsx(_,{className:"text-lg",children:"Bulk Booking Operations"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(d,{variant:"outline",onClick:()=>ae("retry"),disabled:D||o.length===0,className:"gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Retry Selected (",o.length,")"]}),e.jsxs(d,{variant:"outline",onClick:()=>ae("cancel"),disabled:D||o.length===0,className:"gap-2",children:[e.jsx(Te,{className:"h-4 w-4"}),"Cancel Selected"]}),e.jsxs(d,{variant:"outline",onClick:()=>ae("refund"),disabled:D||o.length===0,className:"gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Refund Selected"]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(fe,{children:[e.jsx(pe,{children:e.jsxs(ce,{children:[e.jsx(k,{className:"w-12",children:e.jsx(ue,{checked:o.length===G.length,onCheckedChange:s=>{p(s?G.map(t=>t.id):[])}})}),e.jsx(k,{children:"Booking"}),e.jsx(k,{children:"Customer"}),e.jsx(k,{children:"Status"}),e.jsx(k,{children:"Amount"}),e.jsx(k,{children:"Actions"})]})}),e.jsx(ve,{children:G.map(s=>e.jsxs(ce,{children:[e.jsx(C,{children:e.jsx(ue,{checked:o.includes(s.id),onCheckedChange:t=>{p(t?m=>[...m,s.id]:m=>m.filter(L=>L!==s.id))}})}),e.jsx(C,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-mono text-sm",children:s.bookingReference}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.type})]})}),e.jsx(C,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerName}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.customerEmail})]})}),e.jsx(C,{children:me(s.status)}),e.jsxs(C,{children:[s.currency," ",s.amount]}),e.jsx(C,{children:e.jsxs(d,{size:"sm",variant:"outline",className:"gap-2",children:[e.jsx(Ne,{className:"h-3 w-3"}),"View"]})})]},s.id))})]})})]})]})}),e.jsx(B,{value:"communication",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(S,{children:e.jsx(_,{className:"text-lg",children:"Customer Communication"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Communication Template"}),e.jsxs(Y,{value:F,onValueChange:P,children:[e.jsx(K,{children:e.jsx(X,{placeholder:"Select template or write custom message"})}),e.jsx(J,{children:g.map(s=>e.jsx(n,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Message"}),e.jsx(ye,{placeholder:"Enter your message to customers...",value:N,onChange:s=>q(s.target.value),rows:6})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:[o.length," customers selected for communication"]})]}),e.jsxs(d,{onClick:c,disabled:D||o.length===0||!N.trim(),className:"w-full gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Send Communication"]})]})]})}),e.jsx(B,{value:"lifecycle",className:"space-y-4",children:e.jsx("div",{className:"grid gap-4",children:G.map(s=>e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(_,{className:"flex items-center justify-between text-lg",children:[e.jsxs("span",{children:[s.bookingReference," - ",s.customerName]}),me(s.status)]})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center space-x-4",children:s.lifecycle.map((t,m)=>e.jsxs(Ae.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[Se(t.status),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium",children:t.stage}),t.timestamp&&e.jsx("div",{className:"text-xs text-muted-foreground",children:t.timestamp.toLocaleTimeString()}),t.details&&e.jsx("div",{className:"text-xs text-red-500 max-w-20 truncate",title:t.details,children:t.details})]})]}),m<s.lifecycle.length-1&&e.jsx("div",{className:"flex-1 h-px bg-border"})]},t.stage))})})})]},s.id))})}),e.jsx(B,{value:"alerts",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(S,{children:e.jsx(_,{className:"text-lg",children:"Critical Booking Alerts"})}),e.jsx(u,{children:r?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(ie,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):y?e.jsx("div",{className:"text-sm text-red-500",children:y}):O.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No active alerts"}):e.jsx("div",{className:"space-y-4",children:O.map(s=>{const t=_e(s.severity);return e.jsxs("div",{className:`flex items-center gap-2 p-3 border rounded-lg ${t.container}`,children:[e.jsx(le,{className:`h-5 w-5 ${t.icon}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${t.title}`,children:s.message}),s.booking_id&&e.jsxs("div",{className:`text-sm ${t.sub}`,children:["Booking ",s.booking_id]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>se(s.id),disabled:j===s.id,className:"gap-2",children:[j===s.id&&e.jsx(ie,{className:"h-3 w-3 animate-spin"}),"Resolve"]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:Ce,disabled:a,className:"gap-2",children:[a&&e.jsx(ie,{className:"h-3 w-3 animate-spin"}),"Check Status"]})]})]},s.id)})})})]})})]})})]})})},qe=()=>{const[z,Q]=l.useState("notifications"),[o,p]=l.useState([]),[U,W]=l.useState([]),[D,H]=l.useState([]),[N,q]=l.useState("all"),[F,P]=l.useState("all"),[O,Z]=l.useState(!0);l.useEffect(()=>{(async()=>{try{const{data:T}=await $.from("critical_alerts").select("*").order("created_at",{ascending:!1}).limit(20),{data:g}=await $.from("system_logs").select("*").in("log_level",["error","warn"]).order("created_at",{ascending:!1}).limit(10),G=(T||[]).map(c=>({id:c.id,title:c.alert_type.replace(/_/g," ").replace(/\b\w/g,se=>se.toUpperCase()),message:c.message,type:c.severity==="critical"?"error":c.severity==="high"?"warning":"info",priority:c.severity,source:"Alert System",timestamp:new Date(c.created_at),acknowledged:c.resolved,resolved:c.resolved,escalated:c.requires_manual_action,metadata:{alertType:c.alert_type}})),ee=(g||[]).map(c=>({id:`log-${c.id}`,title:`${c.service_name} ${c.log_level.toUpperCase()}`,message:c.message,type:c.log_level==="error"?"error":"warning",priority:c.log_level==="error"?"high":"medium",source:c.service_name,timestamp:new Date(c.created_at),acknowledged:!1,resolved:!1,escalated:!1,metadata:{correlationId:c.correlation_id}})),V=[...G,...ee].sort((c,se)=>se.timestamp.getTime()-c.timestamp.getTime());p(V),W([{id:"rule-1",name:"Provider Response Time Alert",condition:"response_time > 3000ms",priority:"high",enabled:!0,channels:["email"],escalationTime:15,recipients:["admin@maku.travel"]},{id:"rule-2",name:"Payment Failure Alert",condition:"payment_failure_rate > 5%",priority:"critical",enabled:!0,channels:["email"],escalationTime:5,recipients:["admin@maku.travel"]}])}catch(T){console.error("Failed to fetch notifications:",T),p([]),W([])}})()},[]);const r=async a=>{p(T=>T.map(g=>g.id===a?{...g,acknowledged:!0}:g)),f.success("Notification acknowledged")},v=async a=>{p(T=>T.map(g=>g.id===a?{...g,resolved:!0}:g)),f.success("Notification resolved")},y=a=>{switch(a){case"critical":return"text-red-500 bg-red-50 border-red-200";case"high":return"text-orange-500 bg-orange-50 border-orange-200";case"medium":return"text-yellow-500 bg-yellow-50 border-yellow-200";case"low":return"text-blue-500 bg-blue-50 border-blue-200";default:return"text-gray-500 bg-gray-50 border-gray-200"}},b=a=>{switch(a){case"error":return e.jsx(le,{className:"h-4 w-4 text-red-500"});case"warning":return e.jsx(le,{className:"h-4 w-4 text-yellow-500"});case"success":return e.jsx(ke,{className:"h-4 w-4 text-green-500"});default:return e.jsx(re,{className:"h-4 w-4 text-blue-500"})}},j=o.filter(a=>{const T=N==="all"||a.priority===N,g=F==="all"||a.type===F;return T&&g}),I=o.filter(a=>!a.acknowledged).length;return o.filter(a=>a.priority==="critical"&&!a.resolved).length,e.jsx("div",{className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(_,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),"Notification & Alert Center",I>0&&e.jsxs(h,{variant:"destructive",children:[I," unread"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Z(!O),children:O?e.jsx($e,{className:"h-4 w-4"}):e.jsx(Pe,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"outline",children:e.jsx(Ve,{className:"h-4 w-4"})})]})]})}),e.jsx(u,{children:e.jsxs(oe,{value:z,onValueChange:Q,className:"space-y-4",children:[e.jsxs(de,{className:"grid w-full grid-cols-4",children:[e.jsxs(R,{value:"notifications",children:["Notifications",I>0&&e.jsx(h,{variant:"secondary",className:"ml-2",children:I})]}),e.jsx(R,{value:"rules",children:"Alert Rules"}),e.jsx(R,{value:"escalation",children:"Escalation"}),e.jsx(R,{value:"integrations",children:"Integrations"})]}),e.jsxs(B,{value:"notifications",className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(Y,{value:N,onValueChange:q,children:[e.jsx(K,{className:"w-40",children:e.jsx(X,{placeholder:"Priority"})}),e.jsxs(J,{children:[e.jsx(n,{value:"all",children:"All Priorities"}),e.jsx(n,{value:"critical",children:"Critical"}),e.jsx(n,{value:"high",children:"High"}),e.jsx(n,{value:"medium",children:"Medium"}),e.jsx(n,{value:"low",children:"Low"})]})]}),e.jsxs(Y,{value:F,onValueChange:P,children:[e.jsx(K,{className:"w-40",children:e.jsx(X,{placeholder:"Type"})}),e.jsxs(J,{children:[e.jsx(n,{value:"all",children:"All Types"}),e.jsx(n,{value:"error",children:"Error"}),e.jsx(n,{value:"warning",children:"Warning"}),e.jsx(n,{value:"success",children:"Success"}),e.jsx(n,{value:"info",children:"Info"})]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs(d,{size:"sm",variant:"outline",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Archive All"]})]}),e.jsxs("div",{className:"space-y-3",children:[j.map(a=>e.jsx(x,{className:`border ${a.acknowledged?"opacity-60":""}`,children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[b(a.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold",children:a.title}),e.jsx(h,{className:y(a.priority),children:a.priority}),a.escalated&&e.jsx(h,{variant:"destructive",children:"Escalated"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:a.message}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Source: ",a.source]}),e.jsxs("span",{children:[e.jsx(we,{className:"h-3 w-3 inline mr-1"}),a.timestamp.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!a.acknowledged&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>r(a.id),children:"Acknowledge"}),!a.resolved&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>v(a.id),children:"Resolve"}),e.jsx(d,{size:"sm",variant:"outline",children:e.jsx(Me,{className:"h-3 w-3"})})]})]})})},a.id)),j.length===0&&e.jsx(x,{children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx(re,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No notifications match your filters"})]})})]})]}),e.jsx(B,{value:"rules",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(_,{className:"flex items-center justify-between text-lg",children:["Alert Rules Configuration",e.jsx(d,{size:"sm",children:"Add New Rule"})]})}),e.jsx(u,{className:"space-y-4",children:U.map(a=>e.jsx(x,{className:"border",children:e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.condition})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:y(a.priority),children:a.priority}),e.jsx(Le,{checked:a.enabled})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Channels: "}),e.jsx("span",{children:a.channels.join(", ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Escalation: "}),e.jsxs("span",{children:[a.escalationTime,"min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Recipients: "}),e.jsx("span",{children:a.recipients.length})]})]})]})},a.id))})]})}),e.jsx(B,{value:"escalation",className:"space-y-4",children:e.jsxs(x,{children:[e.jsx(S,{children:e.jsx(_,{className:"text-lg",children:"Escalation Rules"})}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Escalation Time (minutes)"}),e.jsx(M,{type:"number",defaultValue:"15"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Escalate To"}),e.jsx(ye,{placeholder:"manager@maku.travel, cto@maku.travel"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"On-Call Schedule"}),e.jsxs(Y,{children:[e.jsx(K,{children:e.jsx(X,{placeholder:"Select on-call rotation"})}),e.jsxs(J,{children:[e.jsx(n,{value:"primary",children:"Primary Team"}),e.jsx(n,{value:"secondary",children:"Secondary Team"}),e.jsx(n,{value:"executive",children:"Executive Team"})]})]})]}),e.jsx(d,{children:"Save Escalation Rules"})]})})]})}),e.jsx(B,{value:"integrations",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(_,{className:"flex items-center gap-2 text-lg",children:[e.jsx(be,{className:"h-5 w-5"}),"Email Integration"]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"SMTP Server"}),e.jsx(M,{defaultValue:"smtp.maku.travel"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"From Address"}),e.jsx(M,{defaultValue:"alerts@maku.travel"})]}),e.jsx(d,{children:"Test Connection"})]})]}),e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(_,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ze,{className:"h-5 w-5"}),"Slack Integration"]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Webhook URL"}),e.jsx(M,{placeholder:"https://hooks.slack.com/..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Channel"}),e.jsx(M,{defaultValue:"#alerts"})]}),e.jsx(d,{children:"Test Connection"})]})]}),e.jsxs(x,{children:[e.jsx(S,{children:e.jsxs(_,{className:"flex items-center gap-2 text-lg",children:[e.jsx(He,{className:"h-5 w-5"}),"Webhook Integration"]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Webhook URL"}),e.jsx(M,{placeholder:"https://api.example.com/webhooks/alerts"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Secret Key"}),e.jsx(M,{type:"password",placeholder:"Enter webhook secret"})]}),e.jsx(d,{children:"Test Connection"})]})]})]})})]})})]})})},ws=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Booking Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Enhanced booking operations with bulk actions, customer communication, and lifecycle tracking"})]}),e.jsxs(oe,{defaultValue:"management",className:"space-y-6",children:[e.jsxs(de,{className:"grid w-full grid-cols-3",children:[e.jsxs(R,{value:"management",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Booking Management"]}),e.jsxs(R,{value:"operations",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Enhanced Operations"]}),e.jsxs(R,{value:"notifications",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Notifications & Alerts"]})]}),e.jsx(B,{value:"management",children:e.jsx(Oe,{})}),e.jsx(B,{value:"operations",children:e.jsx(We,{})}),e.jsx(B,{value:"notifications",children:e.jsx(qe,{})})]})]});export{ws as default};
