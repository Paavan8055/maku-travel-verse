import{r as x,s as E,l as j,j as e,d as i,f as u,g as v,e as c,T as o,A as S,q as C,a}from"./index-WZ5873Kb-1761320647954.js";import{T as A,a as R,b as f,c as l,d as B,e as d}from"./table-HPWYxDGw-1761320647954.js";import{S as g}from"./shield-CFtTHNb0-1761320647954.js";import{A as H}from"./activity-DQo-IJ1R-1761320647954.js";import{C as y}from"./circle-check-big-BfnbplvO-1761320647954.js";import{C as L}from"./clock-Cchxu6X8-1761320647954.js";const z=()=>{const[p,N]=x.useState([]),[r,w]=x.useState({totalEvents:0,criticalEvents:0,resolvedEvents:0,activeThreats:0}),[b,m]=x.useState(!0);x.useEffect(()=>{_()},[]);const _=async()=>{try{m(!0);const{data:s,error:h}=await E.from("user_activity_logs").select(`
          id,
          activity_type,
          item_type,
          item_data,
          created_at,
          user_id
        `).order("created_at",{ascending:!1}).limit(50);if(h)throw h;const n=(s||[]).map(t=>({id:t.id,event_type:t.activity_type,severity:t.activity_type.includes("admin")?"high":"low",message:`${t.activity_type}: ${t.item_type}`,user_id:t.user_id,created_at:t.created_at,resolved:!0}));N(n),w({totalEvents:n.length,criticalEvents:n.filter(t=>t.severity==="critical").length,resolvedEvents:n.filter(t=>t.resolved).length,activeThreats:n.filter(t=>!t.resolved&&t.severity==="high").length}),j.info("Security data loaded successfully")}catch(s){j.error("Error fetching security data:",s)}finally{m(!1)}},T=s=>{switch(s){case"critical":return e.jsx(a,{variant:"destructive",children:"Critical"});case"high":return e.jsx(a,{className:"bg-orange-100 text-orange-800 border-orange-200",children:"High"});case"medium":return e.jsx(a,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"Medium"});case"low":return e.jsx(a,{variant:"outline",children:"Low"});default:return e.jsx(a,{variant:"outline",children:s})}};return b?e.jsxs(i,{children:[e.jsx(u,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),"Security Monitoring"]})}),e.jsx(c,{children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Events"}),e.jsx("p",{className:"text-2xl font-bold",children:r.totalEvents})]}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Critical Events"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:r.criticalEvents})]}),e.jsx(o,{className:"h-4 w-4 text-red-600"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Resolved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.resolvedEvents})]}),e.jsx(y,{className:"h-4 w-4 text-green-600"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Threats"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r.activeThreats})]}),e.jsx(g,{className:"h-4 w-4 text-orange-600"})]})})})]}),r.activeThreats>0&&e.jsxs(S,{children:[e.jsx(o,{className:"h-4 w-4"}),e.jsxs(C,{children:[r.activeThreats," active security threat",r.activeThreats>1?"s":""," detected. Review and address immediately."]})]}),e.jsxs(i,{children:[e.jsx(u,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Recent Security Events"]})}),e.jsx(c,{children:e.jsx("div",{className:"border rounded-lg",children:e.jsxs(A,{children:[e.jsx(R,{children:e.jsxs(f,{children:[e.jsx(l,{children:"Event Type"}),e.jsx(l,{children:"Severity"}),e.jsx(l,{children:"Message"}),e.jsx(l,{children:"User"}),e.jsx(l,{children:"Time"}),e.jsx(l,{children:"Status"})]})}),e.jsx(B,{children:p.map(s=>e.jsxs(f,{children:[e.jsx(d,{className:"font-medium",children:s.event_type}),e.jsx(d,{children:T(s.severity)}),e.jsx(d,{children:s.message}),e.jsx(d,{className:"text-muted-foreground",children:s.user_id?s.user_id.substring(0,8)+"...":"System"}),e.jsx(d,{className:"text-muted-foreground",children:new Date(s.created_at).toLocaleString()}),e.jsx(d,{children:s.resolved?e.jsxs(a,{variant:"outline",className:"text-green-600",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Resolved"]}):e.jsxs(a,{variant:"destructive",children:[e.jsx(o,{className:"w-3 h-3 mr-1"}),"Active"]})})]},s.id))})]})})})]})]})};export{z as SecurityMonitoring,z as default};
