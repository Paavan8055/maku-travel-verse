import{F as h,r as y,h as Ue,g as Ct,j as e,a as z,B as q,n as wt,t as Ze,d as ve,e as ye,b as J,f as Qe,A as Oe,q as Be,k as kt,u as Pt,s as Ie,l as ne}from"./index-DRJveHKC-1760108260056.js";import{P as N}from"./index-6lQ2uKj3-1760108260056.js";import{N as Te}from"./Navbar-DRlWPTn3-1760108260056.js";import{u as Et,t as At}from"./zod-B2H4KgMF-1760108260056.js";import{I as D}from"./input-PiVAKr_4-1760108260056.js";import{S as Ft,a as Ot,b as Bt,c as It,d as xe}from"./select-CuwYQE_f-1760108260056.js";import{T as Tt}from"./textarea-Bf8l_0pA-1760108260056.js";import{C as Ee}from"./checkbox-BXYEV5mc-1760108260056.js";import{F as Rt,a as U,b as M,c as $,d as _,e as Y}from"./form-ClJEy2s9-1760108260056.js";import{a as et}from"./autofillService-CueomwAq-1760108260056.js";import{u as tt}from"./bookingStore-EeuOpun6-1760108260056.js";import{S as lt}from"./sparkles-CDuu1Gby-1760108260056.js";import{U as Lt}from"./user-CqeV8DYh-1760108260056.js";import{o as Ut,b as Ae,s as K}from"./types-BekIk3NQ-1760108260056.js";import{C as Mt}from"./circle-check-CaXH2kYd-1760108260056.js";import{E as $t}from"./ErrorBoundary-C7izU6N_-1760108260056.js";import{L as _t}from"./label-BuOvFxyP-1760108260056.js";import{S as qt}from"./separator-BSnIsHvA-1760108260056.js";import{D as Wt,a as zt,b as Vt,c as Gt}from"./dialog-B3M8SOBN-1760108260056.js";import{u as Ht}from"./useTravelFunds-DmS4JwgZ-1760108260056.js";import{W as be}from"./wallet-DTtn9qtp-1760108260056.js";import{B as Yt}from"./brain-Cj_H7BQQ-1760108260056.js";import{Z as fe}from"./zap-CaPT9ksa-1760108260056.js";import{T as Jt}from"./trending-up-CKL3TzE0-1760108260056.js";import{C as Kt}from"./clock-DZQ-9oZN-1760108260056.js";import{C as Dt}from"./credit-card-B5rwrvl9-1760108260056.js";import{C as Se}from"./circle-alert-C5WU0_du-1760108260056.js";import{u as Xt}from"./useEnhancedTravelFunds-BEzdB5Iu-1760108260056.js";import{C as Zt}from"./chevron-left-CmtZZeaw-1760108260056.js";import{S as Qt}from"./shield-4OwO_gW--1760108260056.js";import"./useApiHealth-BMRU1TiE-1760108260056.js";import"./avatar-Byh_Lppj-1760108260056.js";import"./index-Dj4MAUuC-1760108260056.js";import"./globe-9QyFWcUP-1760108260056.js";import"./useHealthMonitor-QWs4VQyI-1760108260056.js";import"./useAIIntelligence-B-KnrtCr-1760108260056.js";import"./plane-C6RUP4Yb-1760108260056.js";import"./map-pin-8k7ERFHT-1760108260056.js";import"./chevron-down-BGb-CIm0-1760108260056.js";import"./calendar-h91uvI4a-1760108260056.js";import"./trophy-BERJqnk5-1760108260056.js";import"./rocket-kgxrzAFR-1760108260056.js";import"./users-D8Vl9vuH-1760108260056.js";import"./settings-FIlhn2br-1760108260056.js";import"./index-BdQq_4o_-1760108260056.js";import"./index-DYI31_Fs-1760108260056.js";import"./index-0rk4UjkX-1760108260056.js";import"./travelFundClient-f-ChN1M3-1760108260056.js";var ct="https://js.stripe.com/v3",es=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var ts=function(){for(var t=document.querySelectorAll('script[src^="'.concat(ct,'"]')),r=0;r<t.length;r++){var n=t[r];if(es.test(n.src))return n}return null},st=function(t){var r="",n=document.createElement("script");n.src="".concat(ct).concat(r);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(n),n},ss=function(t,r){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"3.4.1",startTime:r})},de=null,ge=null,je=null,rs=function(t){return function(){t(new Error("Failed to load Stripe.js"))}},ns=function(t,r){return function(){window.Stripe?t(window.Stripe):r(new Error("Stripe.js not available"))}},as=function(t){return de!==null?de:(de=new Promise(function(r,n){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var i=ts();if(!(i&&t)){if(!i)i=st(t);else if(i&&je!==null&&ge!==null){var l;i.removeEventListener("load",je),i.removeEventListener("error",ge),(l=i.parentNode)===null||l===void 0||l.removeChild(i),i=st(t)}}je=ns(r,n),ge=rs(n),i.addEventListener("load",je),i.addEventListener("error",ge)}catch(u){n(u);return}}),de.catch(function(r){return de=null,Promise.reject(r)}))},is=function(t,r,n){if(t===null)return null;var i=t.apply(void 0,r);return ss(i,n),i},ue,dt=!1,ut=function(){return ue||(ue=as(null).catch(function(t){return ue=null,Promise.reject(t)}),ue)};Promise.resolve().then(function(){return ut()}).catch(function(s){dt||console.warn(s)});var os=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];dt=!0;var i=Date.now();return ut().then(function(l){return is(l,r,i)})};function rt(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),r.push.apply(r,n)}return r}function nt(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rt(Object(r),!0).forEach(function(n){mt(s,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):rt(Object(r)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(r,n))})}return s}function Ne(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ne=function(t){return typeof t}:Ne=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ne(s)}function mt(s,t,r){return t in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function pt(s,t){return ls(s)||cs(s,t)||ds(s,t)||us()}function ls(s){if(Array.isArray(s))return s}function cs(s,t){var r=s&&(typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"]);if(r!=null){var n=[],i=!0,l=!1,u,o;try{for(r=r.call(s);!(i=(u=r.next()).done)&&(n.push(u.value),!(t&&n.length===t));i=!0);}catch(c){l=!0,o=c}finally{try{!i&&r.return!=null&&r.return()}finally{if(l)throw o}}return n}}function ds(s,t){if(s){if(typeof s=="string")return at(s,t);var r=Object.prototype.toString.call(s).slice(8,-1);if(r==="Object"&&s.constructor&&(r=s.constructor.name),r==="Map"||r==="Set")return Array.from(s);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return at(s,t)}}function at(s,t){(t==null||t>s.length)&&(t=s.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=s[r];return n}function us(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var R=function(t,r,n){var i=!!n,l=h.useRef(n);h.useEffect(function(){l.current=n},[n]),h.useEffect(function(){if(!i||!t)return function(){};var u=function(){l.current&&l.current.apply(l,arguments)};return t.on(r,u),function(){t.off(r,u)}},[i,r,t,l])},Re=function(t){var r=h.useRef(t);return h.useEffect(function(){r.current=t},[t]),r.current},ae=function(t){return t!==null&&Ne(t)==="object"},ms=function(t){return ae(t)&&typeof t.then=="function"},ps=function(t){return ae(t)&&typeof t.elements=="function"&&typeof t.createToken=="function"&&typeof t.createPaymentMethod=="function"&&typeof t.confirmCardPayment=="function"},it="[object Object]",hs=function s(t,r){if(!ae(t)||!ae(r))return t===r;var n=Array.isArray(t),i=Array.isArray(r);if(n!==i)return!1;var l=Object.prototype.toString.call(t)===it,u=Object.prototype.toString.call(r)===it;if(l!==u)return!1;if(!l&&!n)return t===r;var o=Object.keys(t),c=Object.keys(r);if(o.length!==c.length)return!1;for(var m={},S=0;S<o.length;S+=1)m[o[S]]=!0;for(var x=0;x<c.length;x+=1)m[c[x]]=!0;var C=Object.keys(m);if(C.length!==o.length)return!1;var p=t,a=r,g=function(W){return s(p[W],a[W])};return C.every(g)},ht=function(t,r,n){return ae(t)?Object.keys(t).reduce(function(i,l){var u=!ae(r)||!hs(t[l],r[l]);return n.includes(l)?(u&&console.warn("Unsupported prop change: options.".concat(l," is not a mutable property.")),i):u?nt(nt({},i||{}),{},mt({},l,t[l])):i},null):null},xt="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ot=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xt;if(t===null||ps(t))return t;throw new Error(r)},xs=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xt;if(ms(t))return{tag:"async",stripePromise:Promise.resolve(t).then(function(i){return ot(i,r)})};var n=ot(t,r);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},fs=function(t){!t||!t._registerWrapper||!t.registerAppInfo||(t._registerWrapper({name:"react-stripe-js",version:"2.8.1"}),t.registerAppInfo({name:"react-stripe-js",version:"2.8.1",url:"https://stripe.com/docs/stripe-js/react"}))},Ce=h.createContext(null);Ce.displayName="ElementsContext";var ft=function(t,r){if(!t)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(r," in an <Elements> provider."));return t},gt=function(t){var r=t.stripe,n=t.options,i=t.children,l=h.useMemo(function(){return xs(r)},[r]),u=h.useState(function(){return{stripe:l.tag==="sync"?l.stripe:null,elements:l.tag==="sync"?l.stripe.elements(n):null}}),o=pt(u,2),c=o[0],m=o[1];h.useEffect(function(){var C=!0,p=function(g){m(function(f){return f.stripe?f:{stripe:g,elements:g.elements(n)}})};return l.tag==="async"&&!c.stripe?l.stripePromise.then(function(a){a&&C&&p(a)}):l.tag==="sync"&&!c.stripe&&p(l.stripe),function(){C=!1}},[l,c,n]);var S=Re(r);h.useEffect(function(){S!==null&&S!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[S,r]);var x=Re(n);return h.useEffect(function(){if(c.elements){var C=ht(n,x,["clientSecret","fonts"]);C&&c.elements.update(C)}},[n,x,c.elements]),h.useEffect(function(){fs(c.stripe)},[c.stripe]),h.createElement(Ce.Provider,{value:c},i)};gt.propTypes={stripe:N.any,options:N.object};var gs=function(t){var r=h.useContext(Ce);return ft(r,t)},js=function(){var t=gs("calls useElements()"),r=t.elements;return r};N.func.isRequired;var jt=h.createContext(null);jt.displayName="CustomCheckoutSdkContext";var vs=function(t,r){if(!t)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(r," in an <CustomCheckoutProvider> provider."));return t},ys=h.createContext(null);ys.displayName="CustomCheckoutContext";N.any,N.shape({clientSecret:N.string.isRequired,elementsOptions:N.object}).isRequired;var Le=function(t){var r=h.useContext(jt),n=h.useContext(Ce);if(r&&n)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CustomCheckoutProvider> and <Elements> providers."));return r?vs(r,t):ft(n,t)},bs=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},k=function(t,r){var n="".concat(bs(t),"Element"),i=function(c){var m=c.id,S=c.className,x=c.options,C=x===void 0?{}:x,p=c.onBlur,a=c.onFocus,g=c.onReady,f=c.onChange,W=c.onEscape,X=c.onClick,Z=c.onLoadError,Q=c.onLoaderStart,me=c.onNetworksChange,ie=c.onConfirm,d=c.onCancel,j=c.onShippingAddressChange,E=c.onShippingRateChange,w=Le("mounts <".concat(n,">")),O="elements"in w?w.elements:null,B="customCheckoutSdk"in w?w.customCheckoutSdk:null,se=h.useState(null),ee=pt(se,2),A=ee[0],oe=ee[1],F=h.useRef(null),V=h.useRef(null);R(A,"blur",p),R(A,"focus",a),R(A,"escape",W),R(A,"click",X),R(A,"loaderror",Z),R(A,"loaderstart",Q),R(A,"networkschange",me),R(A,"confirm",ie),R(A,"cancel",d),R(A,"shippingaddresschange",j),R(A,"shippingratechange",E),R(A,"change",f);var G;g&&(t==="expressCheckout"?G=g:G=function(){g(A)}),R(A,"ready",G),h.useLayoutEffect(function(){if(F.current===null&&V.current!==null&&(O||B)){var b=null;B?b=B.createElement(t,C):O&&(b=O.create(t,C)),F.current=b,oe(b),b&&b.mount(V.current)}},[O,B,C]);var le=Re(C);return h.useEffect(function(){if(F.current){var b=ht(C,le,["paymentRequest"]);b&&"update"in F.current&&F.current.update(b)}},[C,le]),h.useLayoutEffect(function(){return function(){if(F.current&&typeof F.current.destroy=="function")try{F.current.destroy(),F.current=null}catch{}}},[]),h.createElement("div",{id:m,className:S,ref:V})},l=function(c){Le("mounts <".concat(n,">"));var m=c.id,S=c.className;return h.createElement("div",{id:m,className:S})},u=r?l:i;return u.propTypes={id:N.string,className:N.string,onChange:N.func,onBlur:N.func,onFocus:N.func,onReady:N.func,onEscape:N.func,onClick:N.func,onLoadError:N.func,onLoaderStart:N.func,onNetworksChange:N.func,onConfirm:N.func,onCancel:N.func,onShippingAddressChange:N.func,onShippingRateChange:N.func,options:N.object},u.displayName=n,u.__elementType=t,u},P=typeof window>"u",Ns=h.createContext(null);Ns.displayName="EmbeddedCheckoutProviderContext";var Ss=function(){var t=Le("calls useStripe()"),r=t.stripe;return r};k("auBankAccount",P);k("card",P);k("cardNumber",P);k("cardExpiry",P);k("cardCvc",P);k("fpxBank",P);k("iban",P);k("idealBank",P);k("p24Bank",P);k("epsBank",P);var Cs=k("payment",P);k("expressCheckout",P);k("currencySelector",P);k("paymentRequestButton",P);k("linkAuthentication",P);k("address",P);k("shippingAddress",P);k("paymentMethodMessaging",P);k("affirmMessage",P);k("afterpayClearpayMessage",P);const ws=Ut({title:K().min(1,"Title is required"),firstName:K().min(1,"First name is required"),lastName:K().min(1,"Last name is required"),email:K().email("Valid email is required"),phone:K().min(10,"Valid phone number is required"),arrivalTime:K().optional(),specialRequests:K().optional(),smsNotifications:Ae().default(!1),emailUpdates:Ae().default(!0),roomPreferences:K().optional(),acknowledgment:Ae().refine(s=>s===!0,{message:"You must acknowledge the terms and conditions"})});function ks({onChange:s,initial:t}){const[r,n]=y.useState(!1),{toast:i}=Ue(),{user:l}=Ct(),u=()=>{const{guestInfo:a}=tt.getState();return{title:"",firstName:"",lastName:"",email:"",phone:"",arrivalTime:"",specialRequests:"",smsNotifications:!1,emailUpdates:!0,roomPreferences:"",acknowledgment:!1,...a,...t}},o=Et({resolver:At(ws),mode:"onBlur",defaultValues:u()}),{watch:c,formState:{isValid:m}}=o,S=y.useCallback(()=>{if(s){const a=o.getValues();m&&a.firstName&&a.lastName&&a.email&&tt.getState().setGuestInfo({firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone||"",title:a.title,arrivalTime:a.arrivalTime,specialRequests:a.specialRequests,roomPreferences:a.roomPreferences,smsNotifications:a.smsNotifications,emailUpdates:a.emailUpdates}),s(a,m)}},[s,m,o]);y.useEffect(()=>{const a=o.watch(()=>{S()});return S(),()=>a.unsubscribe()},[o,S]);const x=a=>a.toUpperCase(),C=()=>{i({title:"Demo data not available",description:"Please enter guest information manually",variant:"destructive"})},p=async()=>{if(!(l!=null&&l.id)){i({title:"Please log in",description:"You need to be logged in to use saved information",variant:"destructive"});return}n(!0);try{const a=await et.loadUserStoredData(l.id);if(!a.hasStoredData){i({title:"No saved data found",description:"Please save your preferences and passport info first",variant:"destructive"});return}const g=et.userDataToHotelForm(a);o.reset(g),i({title:"Information loaded",description:"Form filled with your saved information"})}catch{i({title:"Error loading data",description:"Could not load your saved information",variant:"destructive"})}finally{setTimeout(()=>n(!1),500)}};return e.jsxs(z,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Guest Details"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{type:"button",variant:"outline",size:"sm",onClick:C,disabled:r,className:"text-xs",children:[e.jsx(lt,{className:"h-3 w-3 mr-1"}),"Fill Demo Data"]}),e.jsxs(q,{type:"button",variant:"outline",size:"sm",onClick:p,disabled:r,className:"text-xs",children:[e.jsx(Lt,{className:"h-3 w-3 mr-1"}),"Use My Info"]})]})]}),e.jsx(Rt,{...o,children:e.jsxs("form",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(U,{control:o.control,name:"title",render:({field:a})=>e.jsxs(M,{children:[e.jsx($,{children:"Title"}),e.jsxs(Ft,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(_,{children:e.jsx(Ot,{children:e.jsx(Bt,{placeholder:"Select title"})})}),e.jsxs(It,{children:[e.jsx(xe,{value:"Mr",children:"Mr"}),e.jsx(xe,{value:"Mrs",children:"Mrs"}),e.jsx(xe,{value:"Ms",children:"Ms"}),e.jsx(xe,{value:"Dr",children:"Dr"})]})]}),e.jsx(Y,{})]})}),e.jsx(U,{control:o.control,name:"firstName",render:({field:a})=>e.jsxs(M,{children:[e.jsx($,{children:"First Name"}),e.jsx(_,{children:e.jsx(D,{...a,onChange:g=>a.onChange(x(g.target.value)),placeholder:"Enter first name"})}),e.jsx(Y,{})]})}),e.jsx(U,{control:o.control,name:"lastName",render:({field:a})=>e.jsxs(M,{children:[e.jsx($,{children:"Last Name"}),e.jsx(_,{children:e.jsx(D,{...a,onChange:g=>a.onChange(x(g.target.value)),placeholder:"Enter last name"})}),e.jsx(Y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(U,{control:o.control,name:"email",render:({field:a})=>e.jsxs(M,{children:[e.jsx($,{children:"Email"}),e.jsx(_,{children:e.jsx(D,{...a,type:"email",placeholder:"Enter email address"})}),e.jsx(Y,{})]})}),e.jsx(U,{control:o.control,name:"phone",render:({field:a})=>e.jsxs(M,{children:[e.jsx($,{children:"Phone Number"}),e.jsx(_,{children:e.jsx(D,{...a,placeholder:"Enter phone number"})}),e.jsx(Y,{})]})})]}),e.jsx(U,{control:o.control,name:"arrivalTime",render:({field:a})=>e.jsxs(M,{children:[e.jsx($,{children:"Estimated Arrival Time (Optional)"}),e.jsx(_,{children:e.jsx(D,{...a,placeholder:"e.g., 3:00 PM or After 6:00 PM"})}),e.jsx(Y,{})]})}),e.jsx(U,{control:o.control,name:"roomPreferences",render:({field:a})=>e.jsxs(M,{children:[e.jsx($,{children:"Room Preferences (Optional)"}),e.jsx(_,{children:e.jsx(D,{...a,placeholder:"e.g., High floor, Quiet room, Near elevator"})}),e.jsx(Y,{})]})}),e.jsx(U,{control:o.control,name:"specialRequests",render:({field:a})=>e.jsxs(M,{children:[e.jsx($,{children:"Special Requests (Optional)"}),e.jsx(_,{children:e.jsx(Tt,{...a,placeholder:"Enter any special requests or accessibility needs",className:"min-h-[80px]"})}),e.jsx(Y,{})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(U,{control:o.control,name:"smsNotifications",render:({field:a})=>e.jsxs(M,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(_,{children:e.jsx(Ee,{checked:a.value,onCheckedChange:a.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx($,{children:"Receive SMS notifications about booking updates"})})]})}),e.jsx(U,{control:o.control,name:"emailUpdates",render:({field:a})=>e.jsxs(M,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(_,{children:e.jsx(Ee,{checked:a.value,onCheckedChange:a.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx($,{children:"Receive email updates about your stay"})})]})}),e.jsx(U,{control:o.control,name:"acknowledgment",render:({field:a})=>e.jsxs(M,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(_,{children:e.jsx(Ee,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx($,{children:"I acknowledge that I have read and agree to the hotel's booking terms, cancellation policy, and privacy policy."}),e.jsx(Y,{})]})]})})]})]})})]})}const Ps=({currentStep:s,totalSteps:t=3,steps:r=["Search","Room Selection","Checkout","Payment"]})=>{const n=t||r.length,i=s/n*100;return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Step ",s," of ",n]}),e.jsxs("span",{children:[Math.round(i),"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-primary-hover transition-all duration-500 ease-out",style:{width:`${i}%`}})})]}),e.jsx("div",{className:"flex items-center justify-center space-x-4",children:r.slice(0,n).map((l,u)=>{const o=u+1,c=o<s,m=o===s;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[c?e.jsx(Mt,{className:"h-5 w-5 text-green-600"}):e.jsx(wt,{className:Ze("h-5 w-5",m?"text-primary fill-primary":"text-muted-foreground")}),e.jsx("span",{className:Ze("text-sm font-medium",m?"text-primary":c?"text-green-600":"text-muted-foreground"),children:l})]}),u<n-1&&e.jsx("div",{className:"w-8 h-0.5 bg-border ml-2"})]},l)})})]})},Es=({bookingData:s,biddingData:t,open:r,onOpenChange:n,onPaymentMethodSelected:i})=>{const{toast:l}=Ue(),{funds:u}=Ht(),[o,c]=y.useState("funds"),[m,S]=y.useState({}),[x,C]=y.useState((t==null?void 0:t.minimumBid)||0),[p,a]=y.useState(!1),g=u.reduce((d,j)=>d+j.balance,0),f=Object.values(m).reduce((d,j)=>d+j,0),W=Math.max(0,s.amount-f),Z=u.filter(d=>{var j;return((j=d.destination)==null?void 0:j.toLowerCase().includes(s.destination.toLowerCase()))||d.balance>=s.amount*.25}).sort((d,j)=>j.balance-d.balance).slice(0,3),Q=g>=s.amount,me=()=>{let d=s.amount;const j={};for(const E of Z){if(d<=0)break;const w=Math.min(E.balance,d);w>0&&(j[E.id]=w,d-=w)}S(j),l({title:"Smart allocation applied",description:`Optimized fund usage for your ${s.destination} booking`})},ie=()=>{const j={fundUsage:Object.entries(m).filter(([E,w])=>w>0).map(([E,w])=>({fundId:E,amount:w})),cardPayment:W,biddingAmount:o==="bidding"?x:void 0,totalCovered:f+(o==="bidding"?x:0)};i(j)};return e.jsx(Wt,{open:r,onOpenChange:n,children:e.jsxs(zt,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Vt,{children:e.jsxs(Gt,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-6 w-6 text-orange-500"}),"Enhanced Payment Options"]})}),e.jsxs("div",{className:"space-y-6",children:[Z.length>0&&e.jsxs(z,{className:"bg-gradient-to-r from-orange-50 to-green-50 border-orange-200",children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Yt,{className:"h-5 w-5 text-orange-600"}),"Smart Fund Recommendations"]})}),e.jsx(J,{children:e.jsxs("div",{className:"space-y-3",children:[Z.map(d=>{var j;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["$",d.balance," available ",d.destination&&`• ${d.destination}`]})]}),e.jsx(Qe,{className:"bg-orange-100 text-orange-600",children:(j=d.destination)!=null&&j.toLowerCase().includes(s.destination.toLowerCase())?"Perfect Match":"Good Option"})]},d.id)}),e.jsxs(q,{onClick:me,className:"w-full bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Apply Smart Allocation"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(z,{className:`cursor-pointer transition-all ${o==="funds"?"ring-2 ring-orange-500 bg-orange-50":"hover:bg-gray-50"}`,onClick:()=>c("funds"),children:e.jsxs(J,{className:"p-4 text-center",children:[e.jsx(be,{className:"h-8 w-8 mx-auto mb-2 text-orange-500"}),e.jsx("h3",{className:"font-medium",children:"Travel Funds"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use saved money"})]})}),(t==null?void 0:t.enabled)&&e.jsx(z,{className:`cursor-pointer transition-all ${o==="bidding"?"ring-2 ring-blue-500 bg-blue-50":"hover:bg-gray-50"}`,onClick:()=>c("bidding"),children:e.jsxs(J,{className:"p-4 text-center",children:[e.jsx(fe,{className:"h-8 w-8 mx-auto mb-2 text-blue-500"}),e.jsx("h3",{className:"font-medium",children:"Smart Bidding"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Lock deal with bid"})]})}),e.jsx(z,{className:`cursor-pointer transition-all ${o==="hybrid"?"ring-2 ring-purple-500 bg-purple-50":"hover:bg-gray-50"}`,onClick:()=>c("hybrid"),children:e.jsxs(J,{className:"p-4 text-center",children:[e.jsx(Jt,{className:"h-8 w-8 mx-auto mb-2 text-purple-500"}),e.jsx("h3",{className:"font-medium",children:"Hybrid"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Funds + Bidding"})]})})]}),o==="bidding"&&t&&e.jsxs(z,{className:"bg-gradient-to-r from-blue-50 to-cyan-50 border-blue-200",children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-blue-600"}),"Smart Bidding with Funds"]})}),e.jsxs(J,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Original Price"}),e.jsxs("p",{className:"text-xl font-bold line-through text-gray-400",children:["$",t.originalPrice.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Current Bid"}),e.jsxs("p",{className:"text-xl font-bold text-blue-600",children:["$",t.currentBid.toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_t,{children:"Your Bid Amount"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{type:"number",value:x,onChange:d=>C(Number(d.target.value)),min:t.minimumBid,max:g}),e.jsx(q,{variant:"outline",onClick:()=>C(Math.min(g,t.currentBid+100)),children:"Competitive"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-100 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Fund Coverage"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:g>=x?"100%":`${Math.round(g/x*100)}%`})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-700",children:[e.jsx(Kt,{className:"h-4 w-4"}),e.jsxs("span",{children:[Math.round(t.timeRemaining/60)," minutes remaining"]})]})]})]}),(o==="funds"||o==="hybrid")&&e.jsxs(z,{children:[e.jsx(ve,{children:e.jsx(ye,{children:"Select Travel Funds"})}),e.jsx(J,{className:"space-y-4",children:u.map(d=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Available: $",d.balance," ",d.destination&&`• ${d.destination}`]})]}),e.jsx(Qe,{variant:"secondary",children:d.fund_type})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{type:"number",placeholder:"Amount to use",value:m[d.id]||"",onChange:j=>{const E=Number(j.target.value)||0;E<=d.balance&&S(w=>({...w,[d.id]:E}))},max:d.balance}),e.jsx(q,{variant:"outline",size:"sm",onClick:()=>{const j=Math.min(d.balance,s.amount-f+(m[d.id]||0));S(E=>({...E,[d.id]:j}))},children:"Max"})]})]},d.id))})]}),e.jsx(z,{className:"bg-gray-50",children:e.jsx(J,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Booking Amount:"}),e.jsxs("span",{className:"font-medium",children:["$",s.amount.toLocaleString()]})]}),f>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3 text-green-500"}),"Fund Payment:"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["-$",f.toFixed(2)]})]}),o==="bidding"&&x>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-3 w-3 text-blue-500"}),"Bid Amount:"]}),e.jsxs("span",{className:"font-medium text-blue-600",children:["$",x.toLocaleString()]})]}),W>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Dt,{className:"h-3 w-3 text-gray-500"}),"Card Payment:"]}),e.jsxs("span",{className:"font-medium",children:["$",W.toFixed(2)]})]}),e.jsx(qt,{}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",s.amount.toFixed(2)]})]})]})})}),!Q&&o==="funds"&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(Se,{className:"h-4 w-4 text-amber-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-800",children:"Partial Fund Coverage"}),e.jsxs("p",{className:"text-amber-700",children:["Your funds can cover $",f.toFixed(2),". Consider creating a fund for future ",s.destination," trips!"]})]})]}),(t==null?void 0:t.enabled)&&o==="bidding"&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(fe,{className:"h-4 w-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Smart Bidding Active"}),e.jsxs("p",{className:"text-blue-700",children:["Save $",(t.originalPrice-x).toLocaleString()," with strategic bidding. Your funds will be temporarily locked during the bid."]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(q,{onClick:ie,disabled:o==="funds"&&f===0,className:"flex-1 bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:o==="bidding"?`Place Bid: $${x.toLocaleString()}`:`Confirm Payment: $${(f||s.amount).toFixed(2)}`}),e.jsx(q,{variant:"outline",onClick:()=>n(!1),children:"Cancel"})]})]})]})})};let Fe=null;const As=async()=>(Fe||(Fe=(async()=>{try{const{data:s,error:t}=await Ie.functions.invoke("get-stripe-publishable-key");if(t||!(s!=null&&s.publishable_key))throw ne.error("Failed to get Stripe publishable key:",t),new Error("Failed to load payment system");console.log("✅ Loading Stripe with key:",s.publishable_key.substring(0,20)+"...");const r=await os(s.publishable_key);return console.log("✅ Stripe loaded successfully:",!!r),r}catch(s){return ne.error("Stripe initialization error:",s),null}})()),Fe);function Fs(){var qe,We,ze;const[s]=kt();Pt();const t=Ss(),r=js(),{toast:n}=Ue(),{funds:i}=Xt(),[l,u]=y.useState(!1),[o,c]=y.useState(null),[m,S]=y.useState(!1),[x,C]=y.useState(null),[p,a]=y.useState(null),[g,f]=y.useState(null),[W,X]=y.useState(!0),[Z,Q]=y.useState(!1),[me,ie]=y.useState([]),[d,j]=y.useState(0),E=s.get("hotelId"),w=s.get("offerId"),O=s.get("checkIn"),B=s.get("checkOut"),se=parseInt(s.get("adults")||"2"),ee=parseInt(s.get("children")||"0"),A=parseInt(s.get("rooms")||"1"),oe=(s.get("addons")||"").split(",").filter(Boolean),F=s.get("bedPref")||"",V=s.get("note")||"";y.useEffect(()=>{(async()=>{var I,re,Ve,Ge,He,Ye,Je,Ke;if(!E||!w||!O||!B){console.log("❌ Missing required parameters:",{hotelId:E,offerId:w,checkIn:O,checkOut:B}),f("Missing booking parameters. Please return to hotel search."),X(!1);return}try{f(null),console.log("🔍 Creating hotel booking with parameters:",{hotelId:E,offerId:w,checkIn:O,checkOut:B,adults:se,children:ee,rooms:A,addons:oe,bedPref:F,note:V}),console.log("🔍 Testing Stripe publishable key...");const{data:te,error:ce}=await Ie.functions.invoke("get-stripe-publishable-key");if(ce){console.log("❌ Stripe key retrieval failed:",ce),f("Payment system configuration error. Please contact support."),X(!1);return}if(!(te!=null&&te.publishable_key)){console.log("❌ No publishable key returned:",te),f("Payment system not configured. Please contact support."),X(!1);return}console.log("✅ Stripe key retrieved successfully");const H=JSON.parse(sessionStorage.getItem("selectedOffer")||"{}"),De=JSON.parse(sessionStorage.getItem("selectedAddOns")||"[]"),Nt=Math.ceil((new Date(B).getTime()-new Date(O).getTime())/(1e3*60*60*24)),we=parseFloat(((I=H==null?void 0:H.price)==null?void 0:I.total)||"299.99"),ke=De.reduce((he,Pe)=>{const St=Pe.perNight?Pe.price*Nt:Pe.price;return he+St},0),Xe=we+ke;console.log("💰 Pricing breakdown:",{baseAmount:we,addOnsAmount:ke,totalAmount:Xe,currency:((re=H==null?void 0:H.price)==null?void 0:re.currency)||"USD"});const{data:T,error:L}=await Ie.functions.invoke("create-booking-payment",{body:{booking_type:"hotel",amount:Xe,currency:((Ve=H==null?void 0:H.price)==null?void 0:Ve.currency)||"USD",metadata:{hotelId:E,offerId:w,checkIn:O,checkOut:B,adults:se,children:ee,rooms:A,addons:oe,bedPref:F,note:V,baseAmount:we,addOnsAmount:ke,selectedAddOns:De}}});if(console.log("📋 Booking creation response:",{data:T,error:L}),L)throw ne.error("Booking creation error:",L),(Ge=L.message)!=null&&Ge.includes("STRIPE_SECRET_KEY")?f("Payment system configuration error. Our technical team has been notified. Please try again in a few minutes or contact support."):(He=L.message)!=null&&He.includes("Authentication")?f("Session expired. Please refresh the page and try again."):(Ye=L.message)!=null&&Ye.includes("network")||(Je=L.message)!=null&&Je.includes("fetch")?f("Network connectivity issue. Please check your internet connection and try again."):(Ke=L.message)!=null&&Ke.includes("rate limit")?f("Too many requests. Please wait a moment before trying again."):f(`Booking preparation failed: ${L.message||L}. Please refresh the page or try a different payment method.`),L;if(T!=null&&T.success&&T.clientSecret)console.log("✅ Booking created successfully with client secret"),C(T.clientSecret),a({booking_id:T.booking_id,total_amount:T.total_amount,currency:T.currency,amount_cents:T.amount_cents}),n({title:"Booking prepared",description:"Ready for payment"});else{const he=(T==null?void 0:T.error)||"Failed to create booking - no client secret received";throw console.log("❌ Booking creation failed:",T),f(he),new Error(he)}}catch(te){ne.error("Error creating booking:",te);const ce=te.message||"Failed to prepare booking";f(ce),n({title:"Booking error",description:ce,variant:"destructive"})}finally{X(!1)}})()},[E,w,O,B,se,ee,A,oe,F,V,n]);const G=Math.ceil((new Date(B).getTime()-new Date(O).getTime())/(1e3*60*60*24)),le=se+ee,b=JSON.parse(sessionStorage.getItem("selectedOffer")||"{}"),pe=JSON.parse(sessionStorage.getItem("selectedAddOns")||"[]"),vt=new Date(O).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),yt=new Date(B).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Me=async()=>{if(!(!t||!r||!x)){S(!0);try{o&&sessionStorage.setItem("guestInfo",JSON.stringify(o));const{error:v}=await t.confirmPayment({elements:r,confirmParams:{return_url:`${window.location.origin}/booking-success?booking_id=${p==null?void 0:p.booking_id}&type=hotel`}});v&&(ne.error("Payment error:",v),n({title:"Payment failed",description:v.message,variant:"destructive"}))}catch(v){ne.error("Payment processing error:",v),n({title:"Payment error",description:"Failed to process payment",variant:"destructive"})}finally{S(!1)}}},$e=y.useCallback(()=>{if(!(m||!t||!r)){if(!o||!l){n({title:"Complete guest details",description:"Please fill all required fields before continuing.",variant:"destructive"});const v=document.getElementById("guest-details");v&&typeof v.scrollIntoView=="function"&&v.scrollIntoView({behavior:"smooth",block:"start"});return}Me()}},[m,l,o,t,r,Me,n]),_e=!l||!o||m||!x||!!g,bt=y.useCallback((v,I)=>{c(v),u(I)},[]);return e.jsx($t,{children:e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Te,{}),e.jsx("div",{className:"pt-24 pb-6 px-6 bg-gradient-to-b from-muted/30 to-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs(q,{variant:"ghost",size:"sm",onClick:()=>window.history.back(),className:"mb-4",children:[e.jsx(Zt,{className:"h-4 w-4 mr-1"}),"Back to Room Selection"]}),e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Complete your ",e.jsx("span",{className:"hero-text",children:"Hotel Booking"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Enter guest details and confirm your reservation"}),e.jsx("div",{className:"mt-6",children:e.jsx(Ps,{currentStep:3,totalSteps:4})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 pb-20",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{id:"guest-details",children:e.jsx(ks,{onChange:bt})}),e.jsxs(z,{className:"travel-card",children:[e.jsx(ve,{children:e.jsx(ye,{children:"Payment Details"})}),e.jsxs(J,{className:"space-y-4",children:[g?e.jsxs(Oe,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(Be,{children:g})]}):x?e.jsx(Cs,{}):W?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Preparing payment..."})]}):e.jsxs(Oe,{children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(Be,{children:"Payment system not ready. Please refresh the page."})]}),p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total Amount:"}),e.jsxs("span",{className:"font-bold text-lg",children:[p.currency," ",((p.total_amount||0)-d).toFixed(2)]})]}),d>0&&e.jsxs("div",{className:"flex justify-between items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Travel Fund Payment:"}),e.jsxs("span",{className:"text-green-600 font-medium",children:["-",p.currency," ",d.toFixed(2)]})]})]}),i.length>0&&e.jsxs(q,{onClick:()=>Q(!0),variant:"outline",className:"w-full border-orange-500 text-orange-600 hover:bg-orange-50",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Use Travel Funds"]})]}),e.jsx(q,{onClick:$e,className:"btn-primary h-12 w-full",size:"lg",disabled:_e,children:m?"Processing Payment...":"Pay Now"})]})]})]}),e.jsx("div",{children:e.jsx(z,{className:"travel-card sticky top-24",children:e.jsxs(J,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Hotel Booking Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Hotel Booking"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Offer ID: ",w]}),F&&F!=="any"&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Bed preference: ",F]}),V&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Special requests: ",V]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Check-in"}),e.jsx("p",{className:"font-medium",children:vt})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Check-out"}),e.jsx("p",{className:"font-medium",children:yt})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Duration"}),e.jsxs("p",{className:"font-medium",children:[G," nights"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Guests"}),e.jsxs("p",{className:"font-medium",children:[le," ",le===1?"guest":"guests"]})]})]}),pe.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Selected Add-ons"}),pe.map(v=>{var I;return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[v.name," ",v.perNight?`(${G} nights)`:""]}),e.jsxs("span",{children:[((I=b==null?void 0:b.price)==null?void 0:I.currency)||"USD"," ",(v.price*(v.perNight?G:1)).toFixed(2)]})]},v.id)})]}),p&&e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[((qe=b==null?void 0:b.price)==null?void 0:qe.total)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Room Rate (",G," nights)"]}),e.jsxs("span",{children:[b.price.currency," ",parseFloat(b.price.total).toFixed(2)]})]}),pe.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Add-ons"}),e.jsxs("span",{children:[((We=b==null?void 0:b.price)==null?void 0:We.currency)||p.currency," ",pe.reduce((v,I)=>v+I.price*(I.perNight?G:1),0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[p.currency," ",(ze=p.total_amount)==null?void 0:ze.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg flex items-center space-x-2",children:[e.jsx(Qt,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Secure Payment"}),e.jsx("p",{className:"text-xs text-green-600",children:"256-bit SSL encryption"})]})]})]}),e.jsx(q,{onClick:$e,className:"w-full mt-6 btn-primary h-12",disabled:_e,children:m?"Processing Payment...":"Pay Now"})]})})})]})}),e.jsx(Es,{bookingData:{destination:hotelName||"Hotel Booking",amount:(p==null?void 0:p.total_amount)||0,type:"hotel",dates:{checkIn:O,checkOut:B}},biddingData:{enabled:!1,currentBid:0,minimumBid:0,originalPrice:(p==null?void 0:p.total_amount)||0,timeRemaining:0,dealType:"negotiation"},open:Z,onOpenChange:Q,onPaymentMethodSelected:v=>{ie(v.fundUsage),j(v.fundUsage.reduce((I,re)=>I+re.amount,0)),Q(!1),n({title:"Payment method updated",description:`Using $${v.fundUsage.reduce((I,re)=>I+re.amount,0)} from travel funds`})}})]})})}function wr(){const[s,t]=y.useState(null),[r,n]=y.useState(null);y.useEffect(()=>{(async()=>{try{const u=await As();u?(t(u),console.log("✅ Stripe initialized successfully")):n("Failed to initialize payment system")}catch(u){console.error("Stripe initialization error:",u),n("Failed to load payment system")}})()},[]);const i=y.useMemo(()=>({appearance:{theme:"stripe"}}),[]);return r?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Te,{}),e.jsx("div",{className:"pt-24 px-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(Oe,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsxs(Be,{children:[r,". Please refresh the page or contact support."]})]})})})]}):s?e.jsx(gt,{stripe:s,options:i,children:e.jsx(Fs,{})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Te,{}),e.jsx("div",{className:"pt-24 px-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading payment system..."})]})})]})}export{wr as default};
