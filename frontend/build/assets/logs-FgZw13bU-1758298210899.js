import{i as oe,r as h,s as z,j as e,b as S,T as P,B as V,R as de,A as me,q as ue,a as C,f as he,g as fe,e as I}from"./index-BienadRX-1758298210899.js";import{T as xe,a as ge,b as B,c as F}from"./tabs-BBw4EJLg-1758298210899.js";import{I as je}from"./input-D_CWKZY2-1758298210899.js";import{S as Y,a as q,b as Q,c as W,d as y}from"./select-D-m7PsEk-1758298210899.js";import{T as $,a as G,b as D,c as b,d as J,e as w}from"./table-DUw4_fim-1758298210899.js";import{u as ve}from"./useAgentOrchestration-wr4PPdYj-1758298210899.js";import{u as Ne,a as we}from"./useEnhancedLogging-DxgfKrqq-1758298210899.js";import{u as ye}from"./usePerformanceOptimizer-DRSqKzTG-1758298210899.js";import{B as k}from"./bot-BC7GijWS-1758298210899.js";import{A as be}from"./activity-DPtdwIj4-1758298210899.js";import{S as pe}from"./search-BoRXgKtz-1758298210899.js";import{t as p,c as _e,n as te,g as Se,e as De,b as K,h as Z,i as E}from"./en-US-CC7XSppg-1758298210899.js";import{e as Me,d as Le}from"./endOfMonth-DBbRN5JJ-1758298210899.js";import{I as ee}from"./info-Bx4NWSBC-1758298210899.js";import{C as Ae}from"./circle-check-big-BWRs1JvC-1758298210899.js";import{C as Te}from"./circle-x-CB9vzqgT-1758298210899.js";import"./index-BdQq_4o_-1758298210899.js";import"./index-CW9EEh3p-1758298210899.js";import"./chevron-down-DAyp9beB-1758298210899.js";import"./types-BekIk3NQ-1758298210899.js";import"./correlationId-kmTlDCHl-1758298210899.js";function O(l,t){const r=+p(l)-+p(t);return r<0?-1:r>0?1:r}function Ce(l){return _e(l,Date.now())}function Ie(l){return t=>{const d=(l?Math[l]:Math.trunc)(t);return d===0?0:d}}function Ee(l,t){return+p(l)-+p(t)}function Oe(l,t){const r=p(l,t==null?void 0:t.in);return r.setHours(23,59,59,999),r}function Re(l,t){const r=p(l,t==null?void 0:t.in);return+Oe(r,t)==+Me(r,t)}function Xe(l,t,r){const[d,a,u]=te(r==null?void 0:r.in,l,l,t),g=O(a,u),i=Math.abs(Le(a,u));if(i<1)return 0;a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-g*i);let j=O(a,u)===-g;Re(d)&&i===1&&O(d,u)===1&&(j=!1);const f=g*(i-+j);return f===0?0:f}function ze(l,t,r){const d=Ee(l,t)/1e3;return Ie(r==null?void 0:r.roundingMethod)(d)}function Be(l,t,r){var _,M;const d=Se(),a=(M=(_=r==null?void 0:r.locale)!=null?_:d.locale)!=null?M:De,u=2520,g=O(l,t);if(isNaN(g))throw new RangeError("Invalid time value");const i=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:g}),[j,f]=te(r==null?void 0:r.in,...g>0?[t,l]:[l,t]),v=ze(f,j),R=(K(f)-K(j))/1e3,c=Math.round((v-R)/60);let N;if(c<2)return r!=null&&r.includeSeconds?v<5?a.formatDistance("lessThanXSeconds",5,i):v<10?a.formatDistance("lessThanXSeconds",10,i):v<20?a.formatDistance("lessThanXSeconds",20,i):v<40?a.formatDistance("halfAMinute",0,i):v<60?a.formatDistance("lessThanXMinutes",1,i):a.formatDistance("xMinutes",1,i):c===0?a.formatDistance("lessThanXMinutes",1,i):a.formatDistance("xMinutes",c,i);if(c<45)return a.formatDistance("xMinutes",c,i);if(c<90)return a.formatDistance("aboutXHours",1,i);if(c<Z){const m=Math.round(c/60);return a.formatDistance("aboutXHours",m,i)}else{if(c<u)return a.formatDistance("xDays",1,i);if(c<E){const m=Math.round(c/Z);return a.formatDistance("xDays",m,i)}else if(c<E*2)return N=Math.round(c/E),a.formatDistance("aboutXMonths",N,i)}if(N=Xe(f,j),N<12){const m=Math.round(c/E);return a.formatDistance("xMonths",m,i)}else{const m=N%12,x=Math.trunc(N/12);return m<3?a.formatDistance("aboutXYears",x,i):m<9?a.formatDistance("overXYears",x,i):a.formatDistance("almostXYears",x+1,i)}}function se(l,t){return Be(l,Ce(l),t)}const ls=()=>{const{toast:l}=oe(),[t,r]=h.useState([]),[d,a]=h.useState(!0),[u,g]=h.useState(""),[i,j]=h.useState("all"),[f,v]=h.useState("all"),[R,c]=h.useState("recent"),[N,_]=h.useState(new Date),{isInitialized:M}=ve(),{isAnalyzing:m,latestAnalysis:x,requestAnalysis:H}=Ne(),{logApiCall:U}=we(),{metrics:L,isHighMemoryUsage:re}=ye({componentName:"AdminLogsPage",enableMonitoring:!0,reportToAnalytics:!0}),A=h.useCallback(async()=>{try{a(!0);const{data:s,error:o}=await z.from("system_logs").select("*").order("created_at",{ascending:!1}).limit(200);if(o){console.error("Error loading logs:",o);const n=[{id:"log-1",timestamp:new Date().toISOString(),level:"info",source:"enhanced_logging",message:"Real-time logging system active",metadata:{component:"system_health"}}];r(n)}else s&&r(s.map(n=>({id:n.id,timestamp:n.created_at,level:n.log_level||n.level,source:n.service_name||"system",message:n.message,metadata:n.metadata||{},correlation_id:n.correlation_id,user_id:n.user_id,duration_ms:n.duration_ms,status_code:n.status_code,error_details:n.error_details})));_(new Date)}catch(s){console.error("Failed to load system logs:",s),l({title:"Log Loading Error",description:"Failed to load system logs. Using cached data.",variant:"destructive"})}finally{a(!1)}},[l]);h.useEffect(()=>{A();const s=z.channel("system-logs-updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"system_logs"},n=>{const X={id:n.new.id,timestamp:n.new.created_at,level:n.new.log_level||n.new.level,source:n.new.service_name||"system",message:n.new.message,metadata:n.new.metadata||{},correlation_id:n.new.correlation_id,user_id:n.new.user_id,duration_ms:n.new.duration_ms,status_code:n.new.status_code,error_details:n.new.error_details};r(ce=>[X,...ce.slice(0,199)]),_(new Date)}).subscribe(),o=setInterval(A,3e4);return()=>{clearInterval(o),z.removeChannel(s)}},[A]),h.useEffect(()=>{t.length>0&&U("admin_logs_page","page_view",Date.now()-1e3,!0,200,void 0,{totalLogs:t.length,errorCount:t.filter(s=>s.level==="error").length,performanceMetrics:L})},[t.length,U,L]);const ae=h.useCallback(async()=>{if(t.length===0)return;const s={totalLogs:t.length,errorLogs:t.filter(o=>o.level==="error"),warningLogs:t.filter(o=>o.level==="warning"),performanceMetrics:L,recentErrors:t.filter(o=>o.level==="error").slice(0,10)};await H("performance",s,"Analyze system logs for performance bottlenecks, error patterns, and optimization opportunities. Provide actionable recommendations.")},[t,L,H]),ne=s=>{switch(s){case"error":return e.jsx(Te,{className:"h-4 w-4 text-destructive"});case"warning":return e.jsx(P,{className:"h-4 w-4 text-warning"});case"info":return e.jsx(ee,{className:"h-4 w-4 text-primary"});case"debug":return e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"});default:return e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})}},le=s=>{const o={error:"destructive",warning:"secondary",info:"default",debug:"outline"};return e.jsx(S,{variant:o[s]||"outline",children:s.toUpperCase()})},T=t.filter(s=>{const o=u===""||s.message.toLowerCase().includes(u.toLowerCase())||s.source.toLowerCase().includes(u.toLowerCase()),n=i==="all"||s.level===i,X=f==="all"||s.source===f;return o&&n&&X}),ie=Array.from(new Set(t.map(s=>s.source)));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Performance Logs"}),e.jsx("p",{className:"text-muted-foreground",children:"Real-time system monitoring with AI analysis integration"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-success animate-pulse"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last updated: ",N.toLocaleTimeString()]})]}),M&&e.jsxs(S,{variant:"outline",className:"gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),"Agent System Active"]}),re&&e.jsxs(S,{variant:"destructive",className:"gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"High Memory Usage"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(V,{onClick:ae,disabled:m||t.length===0,variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(k,{className:`h-4 w-4 ${m?"animate-spin":""}`}),m?"Analyzing...":"AI Analysis"]}),e.jsxs(V,{onClick:A,disabled:d,variant:"outline",size:"sm",children:[e.jsx(de,{className:`h-4 w-4 mr-2 ${d?"animate-spin":""}`}),"Refresh"]})]})]}),x&&e.jsxs(me,{children:[e.jsx(k,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:"Master Bot Analysis"}),e.jsx(ue,{className:"mt-1",children:x.summary}),x.recommendations.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Recommendations:"}),e.jsx("ul",{className:"text-sm space-y-1 ml-4",children:x.recommendations.slice(0,3).map((s,o)=>e.jsx("li",{className:"list-disc",children:s},o))})]})]}),e.jsx(S,{variant:x.severity==="critical"?"destructive":"secondary",children:x.severity})]}),e.jsxs(C,{children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Enhanced Log Analysis",e.jsxs(S,{variant:"outline",className:"ml-auto",children:[T.length," logs"]})]})}),e.jsxs(I,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Search logs, correlation IDs, error messages...",value:u,onChange:s=>g(s.target.value),className:"pl-9"})]})}),e.jsxs(Y,{value:i,onValueChange:j,children:[e.jsx(q,{className:"w-40",children:e.jsx(Q,{placeholder:"Filter by level"})}),e.jsxs(W,{children:[e.jsx(y,{value:"all",children:"All Levels"}),e.jsx(y,{value:"error",children:"Error"}),e.jsx(y,{value:"warning",children:"Warning"}),e.jsx(y,{value:"info",children:"Info"}),e.jsx(y,{value:"debug",children:"Debug"})]})]}),e.jsxs(Y,{value:f,onValueChange:v,children:[e.jsx(q,{className:"w-40",children:e.jsx(Q,{placeholder:"Filter by source"})}),e.jsxs(W,{children:[e.jsx(y,{value:"all",children:"All Sources"}),ie.map(s=>e.jsx(y,{value:s,children:s.replace("_"," ").toUpperCase()},s))]})]})]}),e.jsxs(xe,{value:R,onValueChange:c,className:"space-y-4",children:[e.jsxs(ge,{children:[e.jsx(B,{value:"recent",children:"Recent Logs"}),e.jsx(B,{value:"errors",children:"Errors Only"}),e.jsx(B,{value:"analytics",children:"Analytics"})]}),e.jsx(F,{value:"recent",children:d?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"border rounded-lg",children:e.jsxs($,{children:[e.jsx(G,{children:e.jsxs(D,{children:[e.jsx(b,{className:"w-20",children:"Level"}),e.jsx(b,{className:"w-40",children:"Timestamp"}),e.jsx(b,{className:"w-32",children:"Source"}),e.jsx(b,{children:"Message"})]})}),e.jsxs(J,{children:[T.slice(0,50).map(s=>e.jsxs(D,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[ne(s.level),le(s.level)]})}),e.jsx(w,{className:"text-sm text-muted-foreground",children:se(new Date(s.timestamp),{addSuffix:!0})}),e.jsx(w,{className:"text-sm font-mono",children:s.source.replace("_"," ")}),e.jsxs(w,{className:"text-sm",children:[s.message,s.correlation_id&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["ID: ",s.correlation_id]})]})]},s.id)),T.length===0&&e.jsx(D,{children:e.jsx(w,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No logs found matching your criteria."})})]})]})})}),e.jsx(F,{value:"errors",children:e.jsx("div",{className:"border rounded-lg",children:e.jsxs($,{children:[e.jsx(G,{children:e.jsxs(D,{children:[e.jsx(b,{children:"Timestamp"}),e.jsx(b,{children:"Source"}),e.jsx(b,{children:"Error Message"})]})}),e.jsx(J,{children:T.filter(s=>s.level==="error").slice(0,20).map(s=>e.jsxs(D,{children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:se(new Date(s.timestamp),{addSuffix:!0})}),e.jsx(w,{className:"text-sm font-mono",children:s.source.replace("_"," ")}),e.jsx(w,{className:"text-sm text-destructive",children:s.message})]},s.id))})]})})}),e.jsx(F,{value:"analytics",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(C,{children:e.jsxs(I,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-destructive",children:t.filter(s=>s.level==="error").length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Errors"})]})}),e.jsx(C,{children:e.jsxs(I,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:t.filter(s=>s.level==="warning").length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Warnings"})]})}),e.jsx(C,{children:e.jsxs(I,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:t.filter(s=>s.level==="info").length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Info Messages"})]})})]})})]})]})]})]})};export{ls as default};
