import{c as V,r as D,x as U,a7 as q,E as L,j as e,i as w,t as k,M as B,d as M,g as O,b3 as Q,S as z,n as _,ag as E,B as N,a5 as X,L as W,Z as K,U as ee,aa as H,a3 as se,a8 as te,k as T,l as I,m as ae,e as Y,F as A,ap as R,N as re,Y as ie}from"./index-BuFvfeSJ-1758786228561.js";import{C as P}from"./clock-L9lDq39G-1758786228561.js";import{S as ne}from"./scroll-area-B38B66GA-1758786228561.js";import{u as le}from"./useEnhancedDreams-ChJs_Rug-1758786228561.js";import{S as $}from"./separator-Dw6-6sPq-1758786228561.js";import{E as ce}from"./eye-y_7HgmvS-1758786228561.js";import{D as J}from"./download-BkfHqcY1-1758786228561.js";import{P as de}from"./phone-X_HeueAc-1758786228561.js";import{P as oe}from"./package-1JSV2QSJ-1758786228561.js";import{A as me}from"./activity-C11w7_sb-1758786228561.js";import{H as Z}from"./hotel-BhC--D2_-1758786228561.js";import{f as xe}from"./format-BSAa9Ml--1758786228561.js";import"./index-BdQq_4o_-1758786228561.js";import"./en-US-CC7XSppg-1758786228561.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=V("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]),G=()=>{const[a,h]=D.useState([]),[x,p]=D.useState(!0),[b,f]=D.useState(null),{user:g}=U(),i=async()=>{if(!g){h([]),p(!1);return}try{p(!0),f(null);const{data:n,error:s}=await q.rpc("get_user_bookings");if(s)throw s;let r=[];if(n)if(typeof n=="string")try{r=JSON.parse(n)}catch(l){L.error("Error parsing booking data:",l),r=[]}else Array.isArray(n)&&(r=n.map(l=>({id:l.id,booking_reference:l.booking_reference,status:l.status,booking_type:l.booking_type,total_amount:l.total_amount,currency:l.currency,created_at:l.created_at,updated_at:l.updated_at,booking_data:l.booking_data,check_in_date:l.check_in_date,check_out_date:l.check_out_date,guest_count:l.guest_count,items:l.items,latest_payment:l.latest_payment})));h(r)}catch(n){L.error("Error fetching bookings:",n),f(n.message||"Failed to fetch bookings")}finally{p(!1)}};return D.useEffect(()=>{i()},[g]),{bookings:a,loading:x,error:b,refetch:i}},F=({destination:a,departureDate:h,bookingType:x})=>{const[p,b]=D.useState({days:0,hours:0,minutes:0});return D.useEffect(()=>{const f=()=>{const i=new Date().getTime(),s=new Date(h).getTime()-i;s>0&&b({days:Math.floor(s/864e5),hours:Math.floor(s%864e5/36e5),minutes:Math.floor(s%36e5/6e4)})};f();const g=setInterval(f,6e4);return()=>clearInterval(g)},[h]),e.jsx(w,{className:"h-full flex flex-col bg-card/80 backdrop-blur-sm border border-border/50 bg-gradient-to-br from-primary/5 to-accent/5",children:e.jsxs(k,{className:"p-6 flex-1 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(P,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Next Adventure"})]}),e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground text-lg",children:a})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 bg-muted/30 rounded-lg p-4 border border-border/30",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:p.days}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"days"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold text-accent",children:p.hours}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"hours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-semibold text-accent",children:p.minutes}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"min"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx(M,{className:"h-3 w-3"}),e.jsxs("span",{className:"capitalize",children:[x," departure"]})]})]})]})})},ue=({onExplore:a})=>{const h=O(),{destinations:x,loading:p,error:b}=le({limit:10,includeAIContext:!0}),{travelDNA:f,intelligentRecommendations:g,highConfidenceRecommendations:i,urgentRecommendations:n,socialRecommendations:s,loading:r,confidenceScore:l}=Q(),c=x.map(t=>({id:t.id,name:t.name,country:t.country,category:t.category,avg_daily_cost:t.avg_daily_cost,highlights:t.highlights,continent:t.continent})),o=(()=>{if(!g.length)return c.slice(0,6);const t=g.slice(0,3).map(m=>({id:m.destination_id,name:m.destination_name,country:m.country,category:"ai_recommended",avg_daily_cost:null,highlights:m.recommendation_reasons.map(y=>y.reason_text),continent:m.continent,aiScore:m.recommendation_score,urgencyScore:m.urgency_score,socialProof:m.social_proof.friends_visited_count+m.social_proof.friends_planning_count,isAIRecommended:!0})),u=c.slice(0,3);return[...t,...u]})(),v=t=>{if(t==="ai_recommended")return e.jsx(E,{className:"h-3 w-3 text-purple-500"});switch(t){case"cultural":return e.jsx(te,{className:"h-3 w-3 text-blue-500"});case"beaches":return e.jsx(B,{className:"h-3 w-3 text-cyan-500"});case"mountains":return e.jsx(se,{className:"h-3 w-3 text-green-500"});default:return e.jsx(B,{className:"h-3 w-3 text-gray-500"})}},j=t=>{if(t.isAIRecommended){if(t.urgencyScore>=80)return e.jsx(_,{variant:"destructive",className:"text-xs",children:"High Priority"});if(t.urgencyScore>=60)return e.jsx(_,{variant:"outline",className:"text-xs border-orange-300 text-orange-600",children:"Trending"});if(t.aiScore>=90)return e.jsx(_,{variant:"secondary",className:"text-xs bg-purple-100 text-purple-700",children:"AI Pick"})}return null};return e.jsx(w,{className:"h-full flex flex-col bg-card/80 backdrop-blur-sm border border-border/50",children:e.jsxs(k,{className:"p-6 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-primary"}),"Smart Dream Destinations",f&&e.jsxs(_,{variant:"outline",className:"text-xs bg-gradient-to-r from-purple-100 to-indigo-100 border-purple-200",children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),Math.round(l*100),"% AI Match"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{variant:"outline",className:"bg-gradient-to-r from-primary to-accent text-primary-foreground border-none text-xs",children:[o.length," Places"]}),e.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>h("/smart-dreams"),className:"text-xs px-2 py-1 h-6",children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"AI Hub"]})]})]}),g.length>0&&e.jsx("div",{className:"mb-4 p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-100",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:i.length}),e.jsx("div",{className:"text-xs text-blue-500",children:"High Confidence"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:n.length}),e.jsx("div",{className:"text-xs text-orange-500",children:"Urgent"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:s.length}),e.jsx("div",{className:"text-xs text-green-500",children:"Social Proof"})]})]})}),f&&e.jsxs("div",{className:"mb-4 p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-800",children:"Your Travel DNA"}),e.jsx(_,{variant:"outline",className:"text-xs bg-white",children:f.primary_type.replace("_"," ")})]}),e.jsx("div",{className:"space-y-1",children:f.personality_factors.slice(0,2).map((t,u)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"capitalize text-purple-700",children:t.factor}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{value:t.weight*100,className:"w-12 h-1"}),e.jsxs("span",{className:"text-purple-600 font-medium",children:[Math.round(t.weight*100),"%"]})]})]},u))})]}),p||r?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-foreground",children:r?"AI is analyzing destinations...":"Loading dream destinations..."})]})}):b?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("p",{className:"text-destructive text-sm",children:"Failed to load destinations"})}):e.jsx("div",{className:"flex-1",children:e.jsx(ne,{className:"h-full",children:e.jsx("div",{className:"space-y-3",children:o.map((t,u)=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md group ${t.isAIRecommended?"bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200":"bg-muted/50 border-border"}`,onClick:()=>a(t),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v(t.category),e.jsx("h4",{className:"font-medium text-foreground group-hover:text-primary transition-colors",children:t.name}),t.isAIRecommended&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3 text-yellow-500"}),e.jsxs("span",{className:"text-xs text-purple-600 font-medium",children:[t.aiScore,"/100"]})]})]}),j(t)]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.country}),t.isAIRecommended&&e.jsxs("div",{className:"space-y-2 mb-3",children:[t.socialProof>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[e.jsx(ee,{className:"h-3 w-3"}),t.socialProof," friends interested"]}),t.urgencyScore>=60&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-orange-600",children:[e.jsx(P,{className:"h-3 w-3"}),"Time-sensitive opportunity"]})]}),t.highlights&&t.highlights.length>0&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.highlights.slice(0,2).map((m,y)=>e.jsx(_,{variant:"outline",className:"text-xs py-0 px-2 h-5",children:typeof m=="string"?m.slice(0,20)+(m.length>20?"...":""):String(m)},y)),t.highlights.length>2&&e.jsxs(_,{variant:"outline",className:"text-xs py-0 px-2 h-5",children:["+",t.highlights.length-2]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[t.avg_daily_cost&&e.jsxs("span",{className:"text-sm font-medium text-primary",children:["$",t.avg_daily_cost,"/day"]}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors"})]})]},t.id))})})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-border/50",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",className:"flex-1 text-xs",onClick:()=>h("/smart-dreams"),children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Explore All"]}),e.jsxs(N,{variant:"outline",size:"sm",className:"flex-1 text-xs",onClick:()=>h("/smart-dreams"),children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"AI Insights"]})]})})]})})},ge=a=>{switch(a){case"flight":return e.jsx(Y,{className:"h-5 w-5"});case"hotel":return e.jsx(Z,{className:"h-5 w-5"});case"activity":return e.jsx(me,{className:"h-5 w-5"});case"package":return e.jsx(oe,{className:"h-5 w-5"});default:return e.jsx(B,{className:"h-5 w-5"})}},pe=a=>{switch(a){case"confirmed":return"bg-green-100 text-green-800 border-green-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};function fe({booking:a,onViewDetails:h,onDownloadItinerary:x}){var i;const p=()=>{var r,l;const n=((r=a.items)==null?void 0:r.filter(c=>c.item_type==="flight_segment"))||[],s=((l=a.items)==null?void 0:l.filter(c=>c.item_type==="passenger"))||[];return e.jsxs("div",{className:"space-y-3",children:[n.map((c,d)=>e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-medium text-blue-900",children:[c.item_details.type.toUpperCase()," FLIGHT"]}),e.jsx(_,{variant:"outline",className:"text-blue-700",children:c.item_details.class})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Route:"})," ",c.item_details.route]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Flight:"})," ",c.item_details.flight]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(c.item_details.date).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Duration:"})," ",c.item_details.duration]})]})]},d)),s.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("h4",{className:"font-medium mb-2",children:["Passengers (",s.length,")"]}),e.jsx("div",{className:"grid gap-2",children:s.map((c,d)=>e.jsxs("div",{className:"text-sm p-2 bg-gray-50 rounded",children:[e.jsx("strong",{children:c.item_details.name}),c.item_details.seat&&e.jsxs("span",{className:"ml-2 text-gray-600",children:["• Seat: ",c.item_details.seat]})]},d))})]})]})},b=()=>{var c,d;const n=((c=a.items)==null?void 0:c.filter(o=>o.item_type==="hotel_night"))||[],s=((d=a.items)==null?void 0:d.filter(o=>o.item_type==="hotel_extra"))||[];if(n.length===0)return null;const r=n[0],l=n[n.length-1];return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-green-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Hotel:"})," ",r.item_details.hotel_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Room:"})," ",r.item_details.room_type]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Check-in:"})," ",new Date(r.item_details.date).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Check-out:"})," ",new Date(new Date(l.item_details.date).getTime()+864e5).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Nights:"})," ",n.length]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Guests:"})," ",r.item_details.guests]})]})}),s.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Extras & Add-ons"}),e.jsx("div",{className:"space-y-1",children:s.map((o,v)=>e.jsxs("div",{className:"text-sm p-2 bg-gray-50 rounded flex justify-between",children:[e.jsx("span",{children:o.item_details.name}),e.jsxs("span",{className:"font-medium",children:[a.currency," ",o.total_price]})]},v))})]})]})},f=()=>{var l,c;const n=((l=a.items)==null?void 0:l.filter(d=>d.item_type==="activity_participant"))||[],s=((c=a.items)==null?void 0:c.filter(d=>d.item_type==="activity_addon"))||[];if(n.length===0)return null;const r=n[0];return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-purple-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Activity:"})," ",r.item_details.activity_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(r.item_details.date).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Time:"})," ",r.item_details.time]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Duration:"})," ",r.item_details.duration]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("strong",{children:"Location:"})," ",r.item_details.location]})]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2",children:["Participants (",n.length,")"]}),e.jsx("div",{className:"grid gap-2",children:n.map((d,o)=>e.jsxs("div",{className:"text-sm p-2 bg-gray-50 rounded",children:[e.jsx("strong",{children:d.item_details.participant_name}),e.jsxs("span",{className:"ml-2 text-gray-600",children:["• ",d.item_details.participant_type]})]},o))})]}),s.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Add-ons"}),e.jsx("div",{className:"space-y-1",children:s.map((d,o)=>e.jsxs("div",{className:"text-sm p-2 bg-gray-50 rounded flex justify-between",children:[e.jsx("span",{children:d.item_details.name}),e.jsxs("span",{className:"font-medium",children:[a.currency," ",d.total_price]})]},o))})]})]})},g=()=>{switch(a.booking_type){case"flight":return p();case"hotel":return b();case"activity":return f();default:return null}};return e.jsxs(w,{className:"w-full",children:[e.jsx(T,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:ge(a.booking_type)}),e.jsxs("div",{children:[e.jsx(I,{className:"text-lg",children:a.booking_reference}),e.jsxs(ae,{className:"text-sm",children:[a.booking_type.charAt(0).toUpperCase()+a.booking_type.slice(1)," Booking"]})]})]}),e.jsx(_,{className:pe(a.status),children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-primary",children:[a.currency," ",a.total_amount]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Amount"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:new Date(a.created_at).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-600",children:"Booked On"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:((i=a.latest_payment)==null?void 0:i.status)||"Pending"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Payment Status"})]})]}),e.jsx($,{}),g(),e.jsx($,{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>h==null?void 0:h(a.id),className:"flex-1",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>x==null?void 0:x(a.id),className:"flex-1",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Support"]})]})]})]})}const je="https://iomeddeasarntjhqzndu.supabase.co",Ne="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvbWVkZGVhc2FybnRqaHF6bmR1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzODk0NjksImV4cCI6MjA2OTk2NTQ2OX0.tZ50J9PPa6ZqDdPF0-WPYwoLO-aGBIf6Qtjr7dgYrDI";function be(){const{bookings:a,loading:h}=G(),[x,p]=D.useState(null),b=async(i,n)=>{p(`${i}-${n}`);try{const s=a==null?void 0:a.find(v=>v.id===i);if(!s)throw new Error("Booking not found");const r=await fetch(`${je}/functions/v1/generate-travel-document`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ne}`},body:JSON.stringify({bookingId:i,docType:n,bookingData:s})});if(!r.ok)throw new Error("Failed to generate document");const l=await r.blob(),c=window.URL.createObjectURL(l);let d="";n==="ticket"?d=s.booking_type==="flight"?`e-ticket-${s.booking_reference}.pdf`:`hotel-confirmation-${s.booking_reference}.pdf`:n==="invoice"?d=`tax-invoice-${s.booking_reference}.pdf`:d=`confirmation-${s.booking_reference}.pdf`;const o=document.createElement("a");o.href=c,o.download=d,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(c)}catch(s){console.error("Download failed:",s)}finally{p(null)}},g=(()=>{if(console.log("🔍 TravelDocuments Debug - Raw bookings:",a),!a)return console.log("❌ No bookings data available"),[];console.log("📊 Processing",a.length,"total bookings");const n=a.map(s=>{var l,c,d,o,v,j,t,u,m,y,C,S;const r={id:s.id,type:s.booking_type,title:s.booking_type==="flight"?`Flight ${((l=s.booking_data)==null?void 0:l.flightNumber)||"Booking"}`:((d=(c=s.booking_data)==null?void 0:c.hotel)==null?void 0:d.hotel)||((o=s.booking_data)==null?void 0:o.hotelName)||"Hotel Booking",bookingReference:s.booking_reference,status:s.status,date:s.booking_type==="flight"?((v=s.booking_data)==null?void 0:v.departureDate)||s.created_at:((j=s.booking_data)==null?void 0:j.checkInDate)||((t=s.booking_data)==null?void 0:t.checkIn)||s.created_at,destination:s.booking_type==="flight"?`${((u=s.booking_data)==null?void 0:u.origin)||""} → ${((m=s.booking_data)==null?void 0:m.destination)||""}`:((y=s.booking_data)==null?void 0:y.destination)||((S=(C=s.booking_data)==null?void 0:C.hotel)==null?void 0:S.hotel)||"Hotel",hasTicket:s.booking_type==="flight"&&s.status==="confirmed",hasConfirmation:s.status==="confirmed"};return console.log(`📋 Booking ${s.booking_reference}:`,{type:r.type,status:r.status,hasTicket:r.hasTicket,hasConfirmation:r.hasConfirmation,willShow:r.hasTicket||r.hasConfirmation}),r}).filter(s=>s.hasTicket||s.hasConfirmation);return console.log("📊 Summary:",{totalBookings:a.length,documentsAfterFilter:n.length,statusBreakdown:a.reduce((s,r)=>(s[r.status]=(s[r.status]||0)+1,s),{})}),n})();return h?e.jsxs(w,{className:"h-full flex flex-col bg-card/80 backdrop-blur-sm border border-border/50",children:[e.jsx(T,{className:"pb-4",children:e.jsxs(I,{className:"flex items-center gap-2 text-lg",children:[e.jsx(A,{className:"h-5 w-5 text-primary"}),"Travel Documents"]})}),e.jsx(k,{className:"flex-1 flex flex-col space-y-3",children:[1,2,3].map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border/30 rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"h-4 w-48"}),e.jsx(R,{className:"h-3 w-32"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{className:"h-8 w-16"}),e.jsx(R,{className:"h-8 w-20"})]})]},i))})]}):g.length===0?e.jsxs(w,{className:"h-full flex flex-col bg-card/80 backdrop-blur-sm border border-border/50",children:[e.jsx(T,{className:"pb-4",children:e.jsxs(I,{className:"flex items-center gap-2 text-lg",children:[e.jsx(A,{className:"h-5 w-5 text-primary"}),"Travel Documents"]})}),e.jsx(k,{className:"flex-1 flex flex-col justify-center",children:e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx(A,{className:"h-10 w-10 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium mb-1",children:"No documents available"}),e.jsx("p",{className:"text-xs",children:"Your tickets and confirmations will appear here"})]})})]}):e.jsxs(w,{className:"h-full flex flex-col bg-card/80 backdrop-blur-sm border border-border/50",children:[e.jsx(T,{className:"pb-4",children:e.jsxs(I,{className:"flex items-center gap-2 text-lg",children:[e.jsx(A,{className:"h-5 w-5 text-primary"}),"Travel Documents"]})}),e.jsxs(k,{className:"flex-1 flex flex-col space-y-3",children:[g.slice(0,2).map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border/30 rounded-lg hover:bg-muted/50 transition-colors bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 flex-shrink-0",children:i.type==="flight"?e.jsx(Y,{className:"h-4 w-4 text-primary"}):e.jsx(Z,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"space-y-1 min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:i.title}),e.jsx(_,{variant:i.status==="confirmed"?"default":"secondary",className:"text-xs px-2 py-0",children:i.status})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(A,{className:"h-3 w-3 flex-shrink-0"}),i.bookingReference]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"h-3 w-3 flex-shrink-0"}),xe(new Date(i.date),"MMM dd")]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(i.hasTicket||i.hasConfirmation)&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>b(i.id,i.type==="flight"?"ticket":"confirmation"),disabled:x===`${i.id}-${i.type==="flight"?"ticket":"confirmation"}`,className:"text-xs px-2 py-1 h-auto",children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),i.type==="flight"?"Ticket":"Confirmation"]}),i.hasConfirmation&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>b(i.id,"invoice"),disabled:x===`${i.id}-invoice`,className:"text-xs px-2 py-1 h-auto",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"Tax Invoice"]})]})]},i.id)),g.length>2&&e.jsxs(N,{variant:"ghost",size:"sm",className:"text-xs text-muted-foreground mt-2",children:["View all ",g.length," documents"]})]})]})}function Pe(){var l,c,d,o,v;const a=O(),{user:h}=U(),{bookings:x,loading:p,error:b}=G(),[f,g]=D.useState([]);D.useEffect(()=>{if(x&&x.length>0){const j=[...x].sort((t,u)=>new Date(u.created_at).getTime()-new Date(t.created_at).getTime());g(j.slice(0,3))}else g([])},[x]);const i=()=>!x||x.length===0?null:x.filter(t=>{var m;const u=t.check_in_date||((m=t.booking_data)==null?void 0:m.departure_date);return u&&new Date(u)>new Date}).sort((t,u)=>{var C,S;const m=new Date(t.check_in_date||((C=t.booking_data)==null?void 0:C.departure_date)),y=new Date(u.check_in_date||((S=u.booking_data)==null?void 0:S.departure_date));return m.getTime()-y.getTime()})[0]||null,n=()=>{if(!x||x.length===0)return[];const j=[];return x.forEach(t=>{var m,y,C,S;const u=((m=t.booking_data)==null?void 0:m.destination)||((C=(y=t.booking_data)==null?void 0:y.hotel)==null?void 0:C.city)||((S=t.booking_data)==null?void 0:S.arrival_city);u&&!j.includes(u)&&j.push(u)}),j.slice(0,3)},s=i();n();const r=j=>{a(`/search?destination=${encodeURIComponent(j.name)}`)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-muted/10 to-muted/20",children:[e.jsx(re,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8 pt-24 max-w-7xl",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-card/80 backdrop-blur-sm rounded-full shadow-sm mb-4 border border-border/50",children:[e.jsx(B,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Your Travel Hub"})]}),e.jsxs("h1",{className:"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-primary via-primary/80 to-accent bg-clip-text text-transparent mb-2",children:["Welcome back, ",((l=h==null?void 0:h.user_metadata)==null?void 0:l.first_name)||"Traveler","!"]}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Ready for your next adventure?"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(w,{className:"bg-card/80 backdrop-blur-sm shadow-sm hover:shadow-md transition-all duration-200 border border-border/50",children:e.jsx(k,{className:"p-4",children:e.jsx(N,{variant:"secondary",className:"w-full h-10 text-sm font-medium",onClick:()=>a("/flights"),children:"Find Flights"})})}),e.jsx(w,{className:"bg-card/80 backdrop-blur-sm shadow-sm hover:shadow-md transition-all duration-200 border border-border/50",children:e.jsx(k,{className:"p-4",children:e.jsx(N,{variant:"secondary",className:"w-full h-10 text-sm font-medium",onClick:()=>a("/search"),children:"Discover Hotels"})})}),e.jsx(w,{className:"bg-card/80 backdrop-blur-sm shadow-sm hover:shadow-md transition-all duration-200 border border-border/50",children:e.jsx(k,{className:"p-4",children:e.jsx(N,{variant:"secondary",className:"w-full h-10 text-sm font-medium",onClick:()=>a("/activities"),children:"Explore Activities"})})}),e.jsx(w,{className:"bg-card/80 backdrop-blur-sm shadow-sm hover:shadow-md transition-all duration-200 border border-border/50",children:e.jsx(k,{className:"p-4",children:e.jsxs(N,{variant:"secondary",className:"w-full h-10 text-sm font-medium",onClick:()=>a("/travel-fund"),children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Travel Fund"]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:"lg:col-span-6",children:s?e.jsx(F,{destination:((c=s.booking_data)==null?void 0:c.destination)||((o=(d=s.booking_data)==null?void 0:d.hotel)==null?void 0:o.city)||"Your Destination",departureDate:s.check_in_date||((v=s.booking_data)==null?void 0:v.departure_date)||new Date().toISOString(),bookingType:s.booking_type}):e.jsx(F,{destination:"Your Next Adventure",departureDate:new Date(Date.now()+7*24*60*60*1e3).toISOString(),bookingType:"upcoming"})}),e.jsx("div",{className:"lg:col-span-6",children:e.jsx(be,{})}),e.jsx("div",{className:"lg:col-span-12",children:e.jsxs(w,{className:"h-full flex flex-col bg-card/80 backdrop-blur-sm border border-border/50",children:[e.jsx(T,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(I,{className:"flex items-center gap-2 text-xl",children:[e.jsx(P,{className:"h-5 w-5 text-primary"}),"Recent Bookings"]}),e.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>a("/bookings"),className:"text-sm",children:["View All",e.jsx(H,{className:"ml-2 h-4 w-4"})]})]})}),e.jsx(k,{className:"flex-1 flex flex-col",children:p?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading bookings..."})]})}):b?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive mb-2",children:"Error loading bookings"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),children:"Try Again"})]})}):f.length>0?e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx("div",{className:"space-y-4 flex-1",children:f.map(j=>e.jsx(fe,{booking:j,onViewDetails:t=>a(`/bookings/${t}`)},j.id))})}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No recent bookings found"}),e.jsx(N,{onClick:()=>a("/search"),className:"px-6",children:"Start Planning Your Trip"})]})})})]})}),e.jsx("div",{className:"lg:col-span-12",children:e.jsx(ue,{onExplore:r})})]})]})]})}export{Pe as default};
