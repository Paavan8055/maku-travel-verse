import{r as n,g as $,y as X,j as e,i as j,k as p,l as g,t as f,B as l,I as y,n as q,a6 as Z,v as O,M as ee,d as F,U as se,N as te}from"./index-d-8tyMGC-1758786116292.js";import{u as ae,B as re}from"./use-currency-B_LB9w43-1758786116292.js";import{S as k}from"./separator-CbSxjNJh-1758786116292.js";import{L as d}from"./label-ClyCZyyK-1758786116292.js";import{S as ie,a as ne,b as le,c as ce,d as b}from"./select-Bcvr8baX-1758786116292.js";import{C as H}from"./checkbox-DuMG0u4L-1758786116292.js";import{T as oe}from"./textarea-DRoEDgIU-1758786116292.js";import{u as de}from"./useBookingPayment-BzquirGq-1758786116292.js";import{C as me}from"./credit-card-CIvxed_s-1758786116292.js";import{H as I}from"./hotel-DDcXtntT-1758786116292.js";import{C as M}from"./circle-check-big-DTI3ltYe-1758786116292.js";import{U as he}from"./utensils-CkLJduUp-1758786116292.js";import{W as xe}from"./waves-it4GNAT9-1758786116292.js";import{C as ue}from"./car-BmSIGP5u-1758786116292.js";import{C as je}from"./coffee-BZKqFcu5-1758786116292.js";import{f as U}from"./format-BCNDo0EQ-1758786116292.js";import"./index-BdQq_4o_-1758786116292.js";import"./index-mgK-jcXt-1758786116292.js";import"./en-US-CC7XSppg-1758786116292.js";const fe=["Review","Guest Details","Room Preferences","Payment","Confirmation"],pe=[{id:"early-checkin",name:"Early Check-in",description:"Check in before 3 PM",price:25,icon:e.jsx(M,{className:"w-4 h-4"})},{id:"late-checkout",name:"Late Check-out",description:"Check out after 11 AM",price:30,icon:e.jsx(M,{className:"w-4 h-4"})},{id:"breakfast",name:"Breakfast Package",description:"Daily breakfast for all guests",price:35,icon:e.jsx(he,{className:"w-4 h-4"})},{id:"spa-access",name:"Spa Access",description:"Full spa and wellness center access",price:85,icon:e.jsx(xe,{className:"w-4 h-4"})},{id:"airport-transfer",name:"Airport Transfer",description:"Private transfer from/to airport",price:55,icon:e.jsx(ue,{className:"w-4 h-4"})},{id:"welcome-package",name:"Welcome Package",description:"Champagne and fruit basket on arrival",price:45,icon:e.jsx(je,{className:"w-4 h-4"})}],ge=["High floor","Low floor","Quiet location","City view","Ocean view","Balcony","King bed","Twin beds","Non-smoking","Accessible room","Connecting rooms","Away from elevator"],ve=()=>{const[v,m]=n.useState(1),[a,P]=n.useState(null),[i,h]=n.useState({firstName:"",lastName:"",email:"",phone:"",specialRequests:"",roomPreferences:[],arrivalTime:""}),[c,S]=n.useState([]),[R,A]=n.useState([]),[T,D]=n.useState(!1),[C,L]=n.useState(!1),[V,G]=n.useState(!1),N=$(),{toast:o}=X(),{formatPrice:x}=ae(),{createBookingPayment:W,isLoading:B}=de();n.useEffect(()=>{const s=sessionStorage.getItem("selectedHotelOffer");if(s)try{const t=JSON.parse(s);P(t)}catch(t){console.error("Error parsing hotel data:",t),o({title:"Error",description:"Failed to load hotel information. Please start over.",variant:"destructive"}),N("/search/hotels")}else o({title:"No hotel selected",description:"Please select a hotel first.",variant:"destructive"}),N("/search/hotels")},[N,o]),n.useEffect(()=>{a&&v===1&&!C&&z()},[a,v,C]);const z=async()=>{if(a){D(!0);try{const t=await(await fetch("/api/verify-hotel-rate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hotelId:a.hotel.id,checkInDate:a.checkInDate,checkOutDate:a.checkOutDate,originalRate:a.totalAmount})})).json();t.rateChanged&&(G(!0),P(r=>r?{...r,totalAmount:t.newRate}:null),o({title:"Rate Updated",description:`The hotel rate has changed to ${x(t.newRate,a.currency)}`,variant:"default"})),L(!0)}catch(s){console.error("Rate verification failed:",s),o({title:"Rate Verification Failed",description:"Unable to verify current rates. Rates may have changed.",variant:"destructive"})}finally{D(!1)}}},w=()=>{if(!a)return 0;const s=a.totalAmount,t=c.reduce((r,u)=>r+u.price*u.quantity,0);return s+t},J=()=>{if(!i.firstName||!i.lastName||!i.email){o({title:"Incomplete Information",description:"Please fill in all required guest details.",variant:"destructive"});return}m(3)},Y=()=>{m(4)},K=s=>{const t=c.find(r=>r.id===s.id);S(t?r=>r.filter(u=>u.id!==s.id):r=>[...r,{id:s.id,name:s.name,price:s.price,quantity:1,description:s.description}])},Q=async()=>{var s;if(a)try{const t={hotelData:a,guestData:i,selectedAddOns:c,selectedPreferences:R,totalAmount:w()},r=await W({bookingType:"hotel",bookingData:t,amount:w(),currency:a.currency,customerInfo:{email:i.email,firstName:i.firstName,lastName:i.lastName},paymentMethod:"card"});if(r.success&&((s=r.payment)!=null&&s.checkoutUrl))window.location.href=r.payment.checkoutUrl;else throw new Error(r.error||"Payment setup failed")}catch(t){console.error("Payment error:",t),o({title:"Payment Error",description:"Failed to process payment. Please try again.",variant:"destructive"})}},E=()=>{var s;return a?e.jsxs(j,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Hotel Summary",V&&e.jsxs(q,{variant:"secondary",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Rate Updated"]})]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[((s=a.hotel.photos)==null?void 0:s[0])&&e.jsx("img",{src:a.hotel.photos[0],alt:a.hotel.name,className:"w-24 h-24 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:a.hotel.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex items-center",children:Array.from({length:a.hotel.rating||0},(t,r)=>e.jsx(O,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},r))}),a.hotel.category&&e.jsx(q,{variant:"outline",children:a.hotel.category})]}),a.hotel.address&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-muted-foreground",children:[e.jsx(ee,{className:"w-3 h-3"}),e.jsx("span",{children:a.hotel.address.countryCode})]})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Check-in"}),e.jsx("div",{children:U(new Date(a.checkInDate),"MMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Check-out"}),e.jsx("div",{children:U(new Date(a.checkOutDate),"MMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[a.guestCount," Guest",a.guestCount>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[a.nights," Night",a.nights>1?"s":""]})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Hotel Total (",a.nights," nights):"]}),e.jsx("span",{className:"font-medium",children:x(a.totalAmount,a.currency)})]}),c.length>0&&e.jsxs(e.Fragment,{children:[c.map(t=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[t.name," Ã— ",t.quantity,":"]}),e.jsx("span",{children:x(t.price*t.quantity,a.currency)})]},t.id)),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Add-ons Total:"}),e.jsx("span",{className:"font-medium",children:x(c.reduce((t,r)=>t+r.price*r.quantity,0),a.currency)})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{children:x(w(),a.currency)})]})]})]})]}):null},_=()=>{if(!a)return null;switch(v){case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Review Your Hotel Booking"}),e.jsx("p",{className:"text-muted-foreground",children:"Please review your hotel details before proceeding."})]}),E(),T&&e.jsx(j,{children:e.jsx(f,{className:"py-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),e.jsx("span",{children:"Verifying current rates..."})]})})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{variant:"outline",onClick:()=>N("/search/hotels"),children:"Back to Search"}),e.jsx(l,{onClick:()=>m(2),disabled:T||!C,children:"Continue to Guest Details"})]})]});case 2:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Guest Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Please provide guest information for your reservation."})]}),e.jsxs(j,{children:[e.jsx(p,{children:e.jsx(g,{children:"Primary Guest Information"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"firstName",children:"First Name *"}),e.jsx(y,{id:"firstName",value:i.firstName,onChange:s=>h(t=>({...t,firstName:s.target.value})),placeholder:"Enter first name"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"lastName",children:"Last Name *"}),e.jsx(y,{id:"lastName",value:i.lastName,onChange:s=>h(t=>({...t,lastName:s.target.value})),placeholder:"Enter last name"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email Address *"}),e.jsx(y,{id:"email",type:"email",value:i.email,onChange:s=>h(t=>({...t,email:s.target.value})),placeholder:"Enter email address"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"phone",children:"Phone Number"}),e.jsx(y,{id:"phone",type:"tel",value:i.phone,onChange:s=>h(t=>({...t,phone:s.target.value})),placeholder:"Enter phone number"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"arrivalTime",children:"Expected Arrival Time"}),e.jsxs(ie,{value:i.arrivalTime,onValueChange:s=>h(t=>({...t,arrivalTime:s})),children:[e.jsx(ne,{children:e.jsx(le,{placeholder:"Select arrival time"})}),e.jsxs(ce,{children:[e.jsx(b,{value:"morning",children:"Morning (8:00 - 12:00)"}),e.jsx(b,{value:"afternoon",children:"Afternoon (12:00 - 17:00)"}),e.jsx(b,{value:"evening",children:"Evening (17:00 - 22:00)"}),e.jsx(b,{value:"late",children:"Late Night (22:00+)"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"specialRequests",children:"Special Requests"}),e.jsx(oe,{id:"specialRequests",value:i.specialRequests,onChange:s=>h(t=>({...t,specialRequests:s.target.value})),placeholder:"Any special requests or dietary requirements...",rows:3})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{variant:"outline",onClick:()=>m(1),children:"Back"}),e.jsx(l,{onClick:J,children:"Continue to Preferences"})]})]});case 3:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Room Preferences & Add-ons"}),e.jsx("p",{className:"text-muted-foreground",children:"Customize your stay with additional services and room preferences."})]}),e.jsxs(j,{children:[e.jsx(p,{children:e.jsx(g,{children:"Room Preferences"})}),e.jsx(f,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:ge.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:s,checked:R.includes(s),onCheckedChange:t=>{A(t?r=>[...r,s]:r=>r.filter(u=>u!==s))}}),e.jsx(d,{htmlFor:s,className:"text-sm",children:s})]},s))})})]}),e.jsxs(j,{children:[e.jsx(p,{children:e.jsx(g,{children:"Enhancement Add-ons"})}),e.jsx(f,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:pe.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg cursor-pointer hover:bg-muted/50",onClick:()=>K(s),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{checked:c.some(t=>t.id===s.id)}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon,e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:x(s.price,a.currency)}),a.nights>1&&s.id!=="early-checkin"&&s.id!=="late-checkout"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"per night"})]})]},s.id))})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{variant:"outline",onClick:()=>m(2),children:"Back"}),e.jsx(l,{onClick:Y,children:"Continue to Payment"})]})]});case 4:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Payment"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your hotel booking by processing payment."})]}),E(),e.jsxs(j,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"Payment Method"]})}),e.jsxs(f,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"You will be redirected to our secure payment processor to complete your booking."}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{variant:"outline",onClick:()=>m(3),children:"Back"}),e.jsx(l,{onClick:Q,disabled:B,className:"min-w-[120px]",children:B?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):"Pay Now"})]})]})]})]});default:return null}};return a?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsx(re,{currentStep:v,steps:fe}),_()]}):e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})},Ue=()=>e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(te,{}),e.jsx("div",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsx(ve,{})})]});export{Ue as default};
