import{J as F,g as S,x as P,y as D,r,j as e,L as f,i as j,t as p,B as o,k as J,n as L,l as T,a5 as k,M as U,d as _,a8 as M,U as B}from"./index-BuFvfeSJ-1758786228561.js";import{t as N}from"./travelFundClient-BGcAbu9P-1758786228561.js";const A=()=>{const[v]=F(),i=S(),{user:c}=P(),{toast:d}=D(),[y,u]=r.useState(!0),[m,x]=r.useState(!1),[a,w]=r.useState(null),[h,l]=r.useState(""),s=v.get("code");r.useEffect(()=>{(async()=>{if(!s){l("Invalid invitation link"),u(!1);return}try{const{data:n,error:C}=await N.joinFundByCode(s);C?l("Fund not found or invitation expired"):w(n)}catch{l("Unable to load fund details")}finally{u(!1)}})()},[s]);const b=async()=>{if(!c){i(`/auth?redirect=${encodeURIComponent(window.location.pathname+window.location.search)}`);return}if(s){x(!0);try{const{data:t,error:n}=await N.joinFundByCode(s);n?d({title:"Unable to join fund",description:n.message||"Please check the invitation and try again.",variant:"destructive"}):(d({title:"Successfully joined fund!",description:`Welcome to "${t==null?void 0:t.name}". You can now contribute and use the shared balance.`,variant:"default"}),i("/travel-fund"))}catch{d({title:"Error joining fund",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{x(!1)}}};if(y)return e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(f,{className:"h-8 w-8 animate-spin"})});if(h||!a)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(j,{className:"max-w-md mx-auto",children:e.jsxs(p,{className:"text-center p-6",children:[e.jsx("p",{className:"text-destructive mb-4",children:h||"Fund not found"}),e.jsx(o,{onClick:()=>i("/"),variant:"outline",children:"Return Home"})]})})});const g=a.target_amount?Math.round(a.balance/a.target_amount*100):0;return e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:e.jsxs(j,{className:"shadow-lg",children:[e.jsxs(J,{className:"text-center pb-6",children:[e.jsx(L,{variant:"secondary",className:"mb-2 mx-auto w-fit",children:"Travel Fund Invitation"}),e.jsx(T,{className:"text-3xl font-bold",children:a.name}),a.description&&e.jsx("p",{className:"text-muted-foreground mt-2",children:a.description})]}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold mb-2",children:["$",a.balance.toLocaleString()," ",a.currency]}),a.target_amount&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{value:g,className:"h-3"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[g,"% of $",a.target_amount.toLocaleString()," goal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.destination&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Destination: ",a.destination]})]}),a.deadline&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Deadline: ",new Date(a.deadline).toLocaleDateString()]})]}),a.target_amount&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Target: $",a.target_amount.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Type: ",a.fund_type," fund"]})]})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Join this travel fund to save money together for your dream trip!"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Powered by MAKU.Travel - Making group travel savings simple and secure"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{onClick:b,className:"flex-1",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Joining Fund...":"Redirecting..."]}):c?"Join This Fund":"Sign Up & Join Fund"}),e.jsx(o,{variant:"outline",onClick:()=>i("/"),className:"px-6",children:"Learn More"})]}),!c&&e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Already have an account? You'll be redirected to sign in."})]})]})})};export{A as default};
