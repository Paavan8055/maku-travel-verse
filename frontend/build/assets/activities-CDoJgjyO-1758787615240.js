const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-sjMrv3Ur-1758787615240.js","assets/index-BTiYtIJ1-1758787615240.css"])))=>i.map(i=>d[i]);
import{z as k,g as E,t as T,r as x,j as e,N as C,k as v,a1 as P,B as f,l as _,M as j,_ as M}from"./index-sjMrv3Ur-1758787615240.js";import{S as D,a as L}from"./inputValidation-BwR0CGta-1758787615240.js";import{C as B}from"./clock-Di0Wnbwb-1758787615240.js";import{f as I}from"./format-PzJabrMJ-1758787615240.js";import"./correlationId-CbwbdUz_-1758787615240.js";import"./search-DF0qoHZs-1758787615240.js";import"./en-US-CC7XSppg-1758787615240.js";const J=()=>{const[h]=k(),N=E(),{toast:b}=T(),i=h.get("destination")||"sydney",c=h.get("date")||"2025-08-24",n=parseInt(h.get("participants")||"2"),[d,u]=x.useState(!0),[p,g]=x.useState(null),[m,y]=x.useState([]);console.log("ActivitiesPage: Search criteria:",{destination:i,date:c,participants:n}),x.useEffect(()=>{(async()=>{u(!0),g(null);const r=L({destination:i,date:c,participants:n});if(!r.isValid){g(r.error||"Invalid search parameters"),u(!1),b({title:"Invalid Search",description:r.error,variant:"destructive"});return}try{console.log("Testing activity search with:",{destination:i,date:c,participants:n});const{supabase:a}=await M(async()=>{const{supabase:o}=await import("./index-sjMrv3Ur-1758787615240.js").then(S=>S.bJ);return{supabase:o}},__vite__mapDeps([0,1])),{data:t,error:l}=await a.functions.invoke("provider-rotation",{body:{searchType:"activity",params:{destination:i,date:c,participants:n}}});if(console.log("Activity search response:",{data:t,error:l}),l)throw new Error(l.message||"Activity search failed");if(t!=null&&t.success&&(t!=null&&t.data)){const o=t.data.data||t.data.activities||t.data;y(Array.isArray(o)?o:[]),console.log("Found activities:",Array.isArray(o)?o.length:0)}else throw new Error((t==null?void 0:t.error)||"No activities found")}catch(a){console.error("Activity search error:",a),g(a instanceof Error?a.message:"Activity search failed")}finally{u(!1)}})()},[i,c,n]);const w=s=>{console.log("Activity selected:",s),s.bookingLink&&window.open(s.bookingLink,"_blank")},A=s=>{const r=document.createElement("div");return r.innerHTML=s,r.textContent||r.innerText||""};return e.jsx(D,{fallbackMessage:"Activity search is temporarily unavailable. Please try again later.",children:e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(C,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8 pt-24",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-4xl font-bold mb-4",children:["Activities in ",i]}),e.jsxs("p",{className:"text-muted-foreground",children:[I(new Date(c),"MMM dd, yyyy")," â€¢ ",n," participant",n!==1?"s":""]})]}),d&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Finding activities..."}),e.jsx("p",{className:"text-muted-foreground",children:"Searching for the best experiences"})]}),p&&!d&&e.jsxs(v,{className:"p-12 text-center",children:[e.jsx(P,{className:"h-16 w-16 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Service Temporarily Unavailable"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Activity search providers are currently experiencing issues. Please try again in a few minutes."}),e.jsx(f,{onClick:()=>window.location.reload(),variant:"outline",children:"Try Again"})]}),!d&&!p&&m.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Found ",m.length," activities"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map((s,r)=>{var a,t;return e.jsxs(v,{className:"hover:shadow-lg transition-shadow",children:[s.pictures&&s.pictures[0]&&e.jsx("div",{className:"aspect-video relative overflow-hidden rounded-t-lg",children:e.jsx("img",{src:s.pictures[0],alt:s.name,className:"w-full h-full object-cover",onError:l=>{l.currentTarget.style.display="none"}})}),e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:A(s.description)})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{children:i})]}),s.minimumDuration&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:s.minimumDuration})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[((a=s.price)==null?void 0:a.currencyCode)||"AUD"," ",((t=s.price)==null?void 0:t.amount)||"99"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"per person"})]}),e.jsx(f,{onClick:()=>w(s),children:"Book Now"})]})]})})]},`${s.id}-${r}`)})})]}),!d&&!p&&m.length===0&&e.jsxs(v,{className:"p-12 text-center",children:[e.jsx(j,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Service Temporarily Unavailable"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Activity search providers are currently experiencing issues. Please try again later."}),e.jsx(f,{onClick:()=>N("/"),variant:"outline",children:"New Search"})]})]})]})})};export{J as default};
