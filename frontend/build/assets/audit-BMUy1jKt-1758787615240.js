import{j as e,J as w,B as A,ac as L,k as a,n as i,o as n,l,x as C,a1 as S,p as c,a2 as d}from"./index-sjMrv3Ur-1758787615240.js";import{T as k,a as T,b as m,c as x}from"./tabs-O1Phtj_U-1758787615240.js";import{u as U}from"./useQuery-CDJe1vNe-1758787615240.js";import{E}from"./eye-Bn53Wnmf-1758787615240.js";import{C as o}from"./clock-Di0Wnbwb-1758787615240.js";const F=()=>{var j,u,f,g,p,N;const{data:t,isLoading:h,refetch:v}=U({queryKey:["admin-audit-logs"],queryFn:async()=>{const{data:s}=await d.from("system_logs").select("*").order("created_at",{ascending:!1}).limit(100),{data:r}=await d.from("user_activity_logs").select("*").order("created_at",{ascending:!1}).limit(100),{data:_}=await d.from("booking_access_audit").select("*").order("created_at",{ascending:!1}).limit(50);return{systemLogs:s||[],userActivity:r||[],bookingAccess:_||[]}},refetchInterval:3e4}),y=s=>{switch(s.toLowerCase()){case"error":return"destructive";case"warn":return"secondary";case"info":return"default";default:return"outline"}},b=s=>s.includes("admin")?"destructive":s.includes("login")?"default":"secondary";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(w,{className:"h-8 w-8"}),"Audit Logs"]}),e.jsx("p",{className:"text-muted-foreground",children:"Comprehensive system and user activity monitoring"})]}),e.jsxs(A,{onClick:()=>v(),disabled:h,children:[e.jsx(L,{className:`h-4 w-4 mr-2 ${h?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(a,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"System Events"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((j=t==null?void 0:t.systemLogs)==null?void 0:j.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recent system events"})]})]}),e.jsxs(a,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"User Activities"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((u=t==null?void 0:t.userActivity)==null?void 0:u.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"User interactions logged"})]})]}),e.jsxs(a,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Access Attempts"}),e.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((f=t==null?void 0:t.bookingAccess)==null?void 0:f.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Booking access logs"})]})]})]}),e.jsxs(k,{defaultValue:"system",className:"space-y-6",children:[e.jsxs(T,{children:[e.jsx(m,{value:"system",children:"System Logs"}),e.jsx(m,{value:"user",children:"User Activity"}),e.jsx(m,{value:"access",children:"Access Logs"})]}),e.jsx(x,{value:"system",children:e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(n,{children:"Recent System Events"})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:(g=t==null?void 0:t.systemLogs)==null?void 0:g.map(s=>{var r;return e.jsxs("div",{className:"flex items-start justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{variant:y(s.log_level),children:(r=s.log_level)==null?void 0:r.toUpperCase()}),e.jsx("span",{className:"font-medium",children:s.service_name}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.correlation_id||"N/A"})]}),e.jsx("p",{className:"text-sm",children:s.message}),s.error_details&&e.jsx("div",{className:"mt-2 p-2 bg-destructive/10 rounded text-sm font-mono",children:JSON.stringify(s.error_details,null,2)})]}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(o,{className:"h-3 w-3"}),new Date(s.created_at).toLocaleString()]})]},s.id)})})})]})}),e.jsx(x,{value:"user",children:e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(n,{children:"User Activity Logs"})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:(p=t==null?void 0:t.userActivity)==null?void 0:p.map(s=>{var r;return e.jsxs("div",{className:"flex items-start justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{variant:b(s.activity_type),children:(r=s.activity_type)==null?void 0:r.replace("_"," ")}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["User: ",s.user_id]})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s.item_type}),s.item_id&&`: ${s.item_id}`]}),s.item_data&&e.jsx("div",{className:"mt-2 p-2 bg-muted/50 rounded text-sm",children:JSON.stringify(s.item_data,null,2)})]}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(o,{className:"h-3 w-3"}),new Date(s.created_at).toLocaleString()]})]},s.id)})})})]})}),e.jsx(x,{value:"access",children:e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(n,{children:"Booking Access Audit"})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:(N=t==null?void 0:t.bookingAccess)==null?void 0:N.map(s=>{var r;return e.jsxs("div",{className:"flex items-start justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{variant:s.success?"default":"destructive",children:s.success?"SUCCESS":"FAILED"}),e.jsx("span",{className:"font-medium",children:s.access_type}),s.access_method&&e.jsx(c,{variant:"outline",children:s.access_method})]}),e.jsxs("p",{className:"text-sm",children:["Booking ID: ",e.jsx("span",{className:"font-mono",children:s.booking_id})]}),s.failure_reason&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:s.failure_reason}),s.ip_address&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["IP: ",((r=s.ip_address)==null?void 0:r.toString())||"N/A"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(o,{className:"h-3 w-3"}),new Date(s.created_at).toLocaleString()]})]},s.id)})})})]})})]})]})};export{F as default};
