import{c as se,r as m,h as W,j as e,d as A,f as I,g as P,e as T,A as $,T as O,q as D,a as L,B as F,s as C,k as te}from"./index-WZ5873Kb-1761320647954.js";import{T as ae,a as re,b as q,c as R}from"./tabs-CkEpXT3n-1761320647954.js";import{N as z}from"./Navbar-C8B6vPux-1761320647954.js";import{C as Y}from"./calendar-CU1lGzdv-1761320647954.js";import{D as G}from"./dollar-sign-CaNlxS5E-1761320647954.js";import{C as X}from"./clock-Cchxu6X8-1761320647954.js";import{P as M}from"./plane-CdGs5sGg-1761320647954.js";import{M as H}from"./map-pin-B5w2eX9k-1761320647954.js";import{C as ie}from"./circle-x-BOhHSa1d-1761320647954.js";import{C as J}from"./circle-check-big-BfnbplvO-1761320647954.js";import{C as ne}from"./checkbox-BsbyhOvX-1761320647954.js";import{S as U}from"./shopping-cart-EPZtMZp9-1761320647954.js";import{W as ce}from"./wifi-DmO2KVQ--1761320647954.js";import{C as le}from"./coffee-CO0gKzYF-1761320647954.js";import{L as oe}from"./luggage-DXdPQfMC-1761320647954.js";import{B as de}from"./bell-DuqDHA3w-1761320647954.js";import{S as Q}from"./settings-PrBrSsOL-1761320647954.js";import"./useApiHealth-C23KhVpJ-1761320647954.js";import"./avatar-Cd_a4EgP-1761320647954.js";import"./index-DC9fIEWk-1761320647954.js";import"./globe-DVebn8Do-1761320647954.js";import"./useHealthMonitor-DpxDAnis-1761320647954.js";import"./useAIIntelligence-BKwtkQSh-1761320647954.js";import"./sparkles-SMFb5l-Y-1761320647954.js";import"./chevron-down-CGV8_cQf-1761320647954.js";import"./brain-Bmvmfo3M-1761320647954.js";import"./zap-D1HJ0AA9-1761320647954.js";import"./users-BvYlCToH-1761320647954.js";import"./shield-CFtTHNb0-1761320647954.js";import"./user-_AOv4nkS-1761320647954.js";import"./index-5DJ3VfZM-1761320647954.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=se("Armchair",[["path",{d:"M19 9V6a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v3",key:"irtipd"}],["path",{d:"M3 16a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v1.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V11a2 2 0 0 0-4 0z",key:"1qyhux"}],["path",{d:"M5 18v2",key:"ppbyun"}],["path",{d:"M19 18v2",key:"gy7782"}]]),me=({booking:c,onExchangeComplete:n})=>{var w,k,f,i,t;const[p,y]=m.useState(!1),[l,g]=m.useState([]),[h,N]=m.useState(null),[x,j]=m.useState(null),{toast:u}=W(),_=async()=>{y(!0);try{const{data:s,error:a}=await C.functions.invoke("sabre-flight-exchange",{body:{action:"get_exchange_options",pnrLocator:c.booking_data.pnr_locator,userId:c.booking_data.userId}});if(a)throw a;if(s.success)g(s.exchangeOptions||[]),j(s.fareRules);else throw new Error(s.error||"Failed to fetch exchange options")}catch(s){console.error("Exchange options fetch error:",s),u({title:"Error",description:"Failed to fetch exchange options. Please try again.",variant:"destructive"})}finally{y(!1)}},E=async()=>{if(h){y(!0);try{const{data:s,error:a}=await C.functions.invoke("sabre-flight-exchange",{body:{action:"process_exchange",pnrLocator:c.booking_data.pnr_locator,selectedOption:h,userId:c.booking_data.userId}});if(a)throw a;if(s.success)u({title:"Exchange Successful",description:"Your flight has been successfully exchanged."}),n==null||n();else throw new Error(s.error||"Exchange processing failed")}catch(s){console.error("Exchange processing error:",s),u({title:"Exchange Failed",description:"Failed to process exchange. Please contact support.",variant:"destructive"})}finally{y(!1)}}},S=c.status==="confirmed"&&((k=(w=c.booking_data)==null?void 0:w.flight)==null?void 0:k.departure_time)&&new Date(c.booking_data.flight.departure_time)>new Date;return e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Flight Exchange"]})}),e.jsx(T,{className:"space-y-4",children:S?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Current Flight"}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[(f=c.booking_data.flight)==null?void 0:f.origin," â†’ ",(i=c.booking_data.flight)==null?void 0:i.destination]}),e.jsx(L,{variant:"outline",children:c.booking_reference})]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:new Date((t=c.booking_data.flight)==null?void 0:t.departure_time).toLocaleDateString()})]})]}),l.length?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Available Exchange Options"}),x&&e.jsxs($,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs(D,{children:[e.jsx("strong",{children:"Fare Rules:"})," ",x.exchangeFee&&`Exchange fee: ${x.exchangeFee}`,x.restrictions&&` | ${x.restrictions}`]})]}),e.jsx("div",{className:"space-y-3",children:l.map((s,a)=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${(h==null?void 0:h.id)===s.id?"border-primary bg-primary/5":"hover:border-muted-foreground"}`,onClick:()=>N(s),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium",children:[s.origin," â†’ ",s.destination]}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(Y,{className:"h-3 w-3"}),new Date(s.departure_time).toLocaleDateString(),e.jsx(X,{className:"h-3 w-3"}),new Date(s.departure_time).toLocaleTimeString()]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[s.fare_difference>0?"+":"",s.fare_difference," ",s.currency]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Fare difference"})]})]})},a))}),e.jsx(F,{onClick:E,disabled:!h||p,className:"w-full",children:p?"Processing Exchange...":"Confirm Exchange"})]}):e.jsx(F,{onClick:_,disabled:p,className:"w-full",children:p?"Loading...":"Find Exchange Options"})]}):e.jsxs($,{children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(D,{children:"Flight exchange is not available for this booking. The flight may have already departed or the booking is not eligible for changes."})]})})]})},he=({booking:c})=>{var S,w,k,f,i,t,s,a,r,d,b,V;const[n,p]=m.useState(null),[y,l]=m.useState([]),[g,h]=m.useState(!1),{toast:N}=W(),x=async()=>{var o;h(!0);try{const{data:v,error:B}=await C.functions.invoke("sabre-travel-alerts",{body:{action:"get_flight_status",pnrLocator:c.booking_data.pnr_locator,flightNumber:(o=c.booking_data.flight)==null?void 0:o.flight_number}});if(B)throw B;if(v.success)p(v.flightStatus);else throw new Error(v.error||"Failed to fetch flight status")}catch(v){console.error("Flight status fetch error:",v),N({title:"Error",description:"Failed to fetch flight status. Please try again.",variant:"destructive"})}finally{h(!1)}},j=async()=>{try{const{data:o,error:v}=await C.functions.invoke("sabre-travel-alerts",{body:{action:"check_alerts",pnrLocator:c.booking_data.pnr_locator,userId:c.booking_data.userId}});if(v)throw v;o.success&&l(o.alerts||[])}catch(o){console.error("Travel alerts fetch error:",o)}},u=async o=>{try{const{data:v,error:B}=await C.functions.invoke("sabre-travel-alerts",{body:{action:"acknowledge_alert",alertId:o}});if(B)throw B;v.success&&(l(Z=>Z.filter(ee=>ee.id!==o)),N({title:"Alert Acknowledged",description:"The alert has been marked as acknowledged."}))}catch(v){console.error("Alert acknowledgment error:",v),N({title:"Error",description:"Failed to acknowledge alert.",variant:"destructive"})}};m.useEffect(()=>{x(),j();const o=setInterval(()=>{x(),j()},3e5);return()=>clearInterval(o)},[]);const _=o=>{switch(o==null?void 0:o.toLowerCase()){case"on_time":return"default";case"delayed":return"destructive";case"cancelled":return"destructive";case"boarding":return"secondary";case"departed":return"default";default:return"outline"}},E=o=>{switch(o==null?void 0:o.toLowerCase()){case"on_time":return e.jsx(J,{className:"h-4 w-4"});case"delayed":return e.jsx(X,{className:"h-4 w-4"});case"cancelled":return e.jsx(ie,{className:"h-4 w-4"});case"boarding":return e.jsx(M,{className:"h-4 w-4"});case"departed":return e.jsx(M,{className:"h-4 w-4"});default:return e.jsx(M,{className:"h-4 w-4"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Flight Status",e.jsx(F,{variant:"outline",size:"sm",onClick:x,disabled:g,children:g?"Refreshing...":"Refresh"})]})}),e.jsx(T,{children:n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[E(n.status),e.jsxs("span",{className:"font-medium",children:["Flight ",(S=c.booking_data.flight)==null?void 0:S.flight_number]})]}),e.jsx(L,{variant:_(n.status),children:(w=n.status)==null?void 0:w.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Departure"})]}),e.jsxs("div",{className:"pl-6",children:[e.jsx("div",{children:((k=n.departure)==null?void 0:k.airport)||((f=c.booking_data.flight)==null?void 0:f.origin)}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Scheduled: ",new Date(((i=n.departure)==null?void 0:i.scheduled)||((t=c.booking_data.flight)==null?void 0:t.departure_time)).toLocaleString()]}),((s=n.departure)==null?void 0:s.actual)&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Actual: ",new Date(n.departure.actual).toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Arrival"})]}),e.jsxs("div",{className:"pl-6",children:[e.jsx("div",{children:((a=n.arrival)==null?void 0:a.airport)||((r=c.booking_data.flight)==null?void 0:r.destination)}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Scheduled: ",new Date(((d=n.arrival)==null?void 0:d.scheduled)||((b=c.booking_data.flight)==null?void 0:b.arrival_time)).toLocaleString()]}),((V=n.arrival)==null?void 0:V.actual)&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Actual: ",new Date(n.arrival.actual).toLocaleString()]})]})]})]}),n.gate&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Gate: ",n.gate]}),n.terminal&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Terminal: ",n.terminal]})]})]}):e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Click refresh to check flight status"})})]}),y.length>0&&e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Travel Alerts"]})}),e.jsx(T,{className:"space-y-3",children:y.map(o=>{var v;return e.jsxs($,{variant:o.severity==="high"?"destructive":"default",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsxs(D,{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(v=o.alert_type)==null?void 0:v.replace("_"," ").toUpperCase()}),e.jsx("div",{children:o.message}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(o.created_at).toLocaleString()})]}),!o.acknowledged&&e.jsx(F,{size:"sm",variant:"outline",onClick:()=>u(o.id),children:"Acknowledge"})]})]},o.id)})})]})]})},xe=({booking:c,onSeatSelectionComplete:n})=>{var i;const[p,y]=m.useState(null),[l,g]=m.useState([]),[h,N]=m.useState(!1),[x,j]=m.useState(!1),{toast:u}=W(),_=async()=>{var t;N(!0);try{const{data:s,error:a}=await C.functions.invoke("sabre-seat-selection",{body:{action:"get_seatmap",pnrLocator:c.booking_data.pnr_locator,flightSegmentId:((t=c.booking_data.flight)==null?void 0:t.segment_id)||"1",userId:c.booking_data.userId}});if(a)throw a;if(s.success)y(s.seatMap);else throw new Error(s.error||"Failed to fetch seat map")}catch(s){console.error("Seat map fetch error:",s),u({title:"Error",description:"Failed to load seat map. Please try again.",variant:"destructive"})}finally{N(!1)}},E=t=>{var a;if(l.some(r=>r.seatNumber===t.seatNumber))g(r=>r.filter(d=>d.seatNumber!==t.seatNumber));else{const r=((a=c.booking_data.passengers)==null?void 0:a.length)||1;l.length<r?g(d=>[...d,t]):u({title:"Selection Limit",description:`You can only select ${r} seat(s) for this booking.`,variant:"destructive"})}},S=async()=>{var t;if(l.length!==0){j(!0);try{const{data:s,error:a}=await C.functions.invoke("sabre-seat-selection",{body:{action:"select_seats",pnrLocator:c.booking_data.pnr_locator,flightSegmentId:((t=c.booking_data.flight)==null?void 0:t.segment_id)||"1",seatSelections:l.map(r=>{var d,b;return{passengerName:((b=(d=c.booking_data.passengers)==null?void 0:d[0])==null?void 0:b.name)||"Passenger",seatNumber:r.seatNumber,seatType:r.seatType,price:r.price||0}}),userId:c.booking_data.userId}});if(a)throw a;if(s.success)u({title:"Seats Selected",description:"Your seat selection has been confirmed."}),n==null||n();else throw new Error(s.error||"Seat selection failed")}catch(s){console.error("Seat selection error:",s),u({title:"Selection Failed",description:"Failed to confirm seat selection. Please try again.",variant:"destructive"})}finally{j(!1)}}};m.useEffect(()=>{_()},[]);const w=t=>t.occupied?"â›”":l.some(s=>s.seatNumber===t.seatNumber)?"âœ…":t.seatType==="business"?"ðŸ’º":t.seatType==="premium"?"ðŸª‘":t.seatType==="exit_row"?"ðŸšª":"ðŸ’º",k=t=>t.occupied?"bg-red-100 text-red-800 cursor-not-allowed":l.some(s=>s.seatNumber===t.seatNumber)?"bg-green-100 text-green-800":t.seatType==="business"?"bg-purple-100 text-purple-800 hover:bg-purple-200":t.seatType==="premium"?"bg-blue-100 text-blue-800 hover:bg-blue-200":t.seatType==="exit_row"?"bg-orange-100 text-orange-800 hover:bg-orange-200":"bg-white text-gray-800 hover:bg-gray-200",f=l.reduce((t,s)=>t+(s.price||0),0);return e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Seat Selection",e.jsx(F,{variant:"outline",size:"sm",onClick:_,disabled:h,children:h?"Loading...":"Refresh"})]})}),e.jsxs(T,{className:"space-y-6",children:[l.length>0&&e.jsxs($,{children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(D,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Selected ",l.length," seat(s): ",l.map(t=>t.seatNumber).join(", ")]}),f>0&&e.jsxs("span",{className:"font-medium",children:["Total: $",f.toFixed(2)]})]})})]}),p?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm font-medium mb-2",children:["Aircraft: ",p.aircraftType]}),e.jsx("div",{className:"w-full h-2 bg-gradient-to-r from-primary/20 to-primary/40 rounded mb-4"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"âœˆï¸ Front of Aircraft"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center text-xs",children:[e.jsx(L,{variant:"outline",children:"ðŸ’º Standard"}),e.jsx(L,{variant:"outline",className:"bg-purple-100",children:"ðŸ’º Business"}),e.jsx(L,{variant:"outline",className:"bg-blue-100",children:"ðŸª‘ Premium"}),e.jsx(L,{variant:"outline",className:"bg-orange-100",children:"ðŸšª Exit Row"}),e.jsx(L,{variant:"outline",className:"bg-red-100",children:"â›” Occupied"}),e.jsx(L,{variant:"outline",className:"bg-green-100",children:"âœ… Selected"})]}),e.jsx("div",{className:"max-w-2xl mx-auto",children:(i=p.rows)==null?void 0:i.map((t,s)=>e.jsxs("div",{className:"flex justify-center items-center gap-1 mb-2",children:[e.jsx("span",{className:"text-xs w-8 text-center font-mono",children:t.rowNumber}),e.jsx("div",{className:"flex gap-1",children:t.seats.filter(a=>{var r,d,b;return((r=a.position)==null?void 0:r.startsWith("A"))||((d=a.position)==null?void 0:d.startsWith("B"))||((b=a.position)==null?void 0:b.startsWith("C"))}).map((a,r)=>e.jsx("button",{className:`w-8 h-8 text-xs rounded border transition-colors ${k(a)}`,onClick:()=>!a.occupied&&E(a),disabled:a.occupied,title:`Seat ${a.seatNumber}${a.price?` - $${a.price}`:""}`,children:w(a)},r))}),e.jsx("div",{className:"w-4"}),e.jsx("div",{className:"flex gap-1",children:t.seats.filter(a=>{var r,d,b;return((r=a.position)==null?void 0:r.startsWith("D"))||((d=a.position)==null?void 0:d.startsWith("E"))||((b=a.position)==null?void 0:b.startsWith("F"))}).map((a,r)=>e.jsx("button",{className:`w-8 h-8 text-xs rounded border transition-colors ${k(a)}`,onClick:()=>!a.occupied&&E(a),disabled:a.occupied,title:`Seat ${a.seatNumber}${a.price?` - $${a.price}`:""}`,children:w(a)},r))}),e.jsx("span",{className:"text-xs w-8 text-center font-mono",children:t.rowNumber})]},s))}),e.jsx("div",{className:"flex justify-center",children:e.jsx(F,{onClick:S,disabled:l.length===0||x,className:"min-w-32",children:x?"Processing...":`Confirm Selection${f>0?` ($${f.toFixed(2)})`:""}`})})]}):h?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading seat map..."})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Seat map not available for this flight"})]})]})},ue=({booking:c,onExtrasComplete:n})=>{const[p,y]=m.useState([]),[l,g]=m.useState([]),[h,N]=m.useState(!1),[x,j]=m.useState(!1),{toast:u}=W(),_=async()=>{var i;N(!0);try{const{data:t,error:s}=await C.functions.invoke("sabre-air-extras",{body:{action:"get_available",pnrLocator:c.booking_data.pnr_locator,flightSegmentId:((i=c.booking_data.flight)==null?void 0:i.segment_id)||"1",userId:c.booking_data.userId}});if(s)throw s;if(t.success)y(t.availableExtras||[]);else throw new Error(t.error||"Failed to fetch available extras")}catch(t){console.error("Air extras fetch error:",t),u({title:"Error",description:"Failed to load available extras. Please try again.",variant:"destructive"})}finally{N(!1)}},E=i=>{const t=l.some(s=>s.code===i.code);g(t?s=>s.filter(a=>a.code!==i.code):s=>[...s,{...i,quantity:1}])},S=(i,t)=>{t<=0?g(s=>s.filter(a=>a.code!==i)):g(s=>s.map(a=>a.code===i?{...a,quantity:t}:a))},w=async()=>{var i;if(l.length!==0){j(!0);try{const{data:t,error:s}=await C.functions.invoke("sabre-air-extras",{body:{action:"book_extras",pnrLocator:c.booking_data.pnr_locator,flightSegmentId:((i=c.booking_data.flight)==null?void 0:i.segment_id)||"1",extraSelections:l.map(a=>{var r,d;return{code:a.code,quantity:a.quantity,passengerName:((d=(r=c.booking_data.passengers)==null?void 0:r[0])==null?void 0:d.name)||"Passenger"}}),userId:c.booking_data.userId}});if(s)throw s;if(t.success)u({title:"Extras Booked",description:"Your air extras have been successfully added to your booking."}),n==null||n(),g([]);else throw new Error(t.error||"Air extras booking failed")}catch(t){console.error("Air extras booking error:",t),u({title:"Booking Failed",description:"Failed to book air extras. Please try again.",variant:"destructive"})}finally{j(!1)}}};m.useEffect(()=>{_()},[]);const k=i=>{switch(i==null?void 0:i.toLowerCase()){case"baggage":return e.jsx(oe,{className:"h-4 w-4"});case"meals":return e.jsx(le,{className:"h-4 w-4"});case"wifi":return e.jsx(ce,{className:"h-4 w-4"});default:return e.jsx(U,{className:"h-4 w-4"})}},f=l.reduce((i,t)=>i+t.price*t.quantity,0);return e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Air Extras",e.jsx(F,{variant:"outline",size:"sm",onClick:_,disabled:h,children:h?"Loading...":"Refresh"})]})}),e.jsxs(T,{className:"space-y-6",children:[l.length>0&&e.jsxs($,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx(D,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:[l.length," extra(s) selected"]}),e.jsxs("span",{className:"font-medium",children:["Total: $",f.toFixed(2)]})]})})]}),p.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Available Add-ons"}),e.jsx("div",{className:"grid gap-4",children:p.map(i=>{var t,s,a;return e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{checked:l.some(r=>r.code===i.code),onCheckedChange:()=>E(i)}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[k(i.category),e.jsx("span",{className:"font-medium",children:i.name}),e.jsx(L,{variant:"outline",children:i.category})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.description}),i.restrictions&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:i.restrictions})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["$",(t=i.price)==null?void 0:t.toFixed(2)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:i.currency})]})]}),l.some(r=>r.code===i.code)&&e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t",children:[e.jsx("span",{className:"text-sm",children:"Quantity:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{size:"sm",variant:"outline",onClick:()=>{const r=l.find(d=>d.code===i.code);S(i.code,((r==null?void 0:r.quantity)||1)-1)},children:"-"}),e.jsx("span",{className:"w-8 text-center",children:((s=l.find(r=>r.code===i.code))==null?void 0:s.quantity)||1}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>{const r=l.find(d=>d.code===i.code);S(i.code,((r==null?void 0:r.quantity)||1)+1)},children:"+"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-auto",children:["Subtotal: $",(i.price*(((a=l.find(r=>r.code===i.code))==null?void 0:a.quantity)||1)).toFixed(2)]})]})]},i.code)})}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(F,{onClick:w,disabled:l.length===0||x,className:"min-w-32",children:x?"Processing...":`Book Extras ($${f.toFixed(2)})`})})]}):h?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading available extras..."})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No additional extras available for this flight"})]})]})},Ve=()=>{var _,E,S,w,k,f,i,t,s;const[c]=te(),[n,p]=m.useState(null),[y,l]=m.useState(!0),[g,h]=m.useState(null),{toast:N}=W(),x=c.get("booking"),j=c.get("ref");m.useEffect(()=>{(async()=>{if(!x&&!j){h("No booking identifier provided"),l(!1);return}try{let r=C.from("bookings").select("*").eq("booking_type","flight");x?r=r.eq("id",x):j&&(r=r.eq("booking_reference",j));const{data:d,error:b}=await r.single();if(b)throw b;if(!d)throw new Error("Booking not found");p(d)}catch(r){console.error("Error fetching booking:",r),h(r instanceof Error?r.message:"Failed to load booking"),N({title:"Error",description:"Failed to load booking details",variant:"destructive"})}finally{l(!1)}})()},[x,j,N]);const u=()=>{window.location.reload()};return y?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(z,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2",children:"Loading booking details..."})]})})]}):g||!n?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(z,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx($,{variant:"destructive",children:e.jsx(D,{children:g||"Booking not found"})})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(z,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Flight Management"}),e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Flight Details"]})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Booking Reference"}),e.jsx("div",{className:"font-medium",children:n.booking_reference})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Route"}),e.jsxs("div",{className:"font-medium",children:[(E=(_=n.booking_data)==null?void 0:_.flight)==null?void 0:E.origin," â†’ ",(w=(S=n.booking_data)==null?void 0:S.flight)==null?void 0:w.destination]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("div",{className:"font-medium capitalize",children:n.status})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Departure"}),e.jsx("div",{className:"font-medium",children:(f=(k=n.booking_data)==null?void 0:k.flight)!=null&&f.departure_time?new Date(n.booking_data.flight.departure_time).toLocaleString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Flight Number"}),e.jsx("div",{className:"font-medium",children:((t=(i=n.booking_data)==null?void 0:i.flight)==null?void 0:t.flight_number)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PNR Locator"}),e.jsx("div",{className:"font-medium",children:((s=n.booking_data)==null?void 0:s.pnr_locator)||"N/A"})]})]})})]})]}),e.jsxs(ae,{defaultValue:"status",className:"space-y-6",children:[e.jsxs(re,{className:"grid w-full grid-cols-5",children:[e.jsxs(q,{value:"status",className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Status & Alerts"]}),e.jsxs(q,{value:"exchange",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Exchange Flight"]}),e.jsxs(q,{value:"seats",className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Seat Selection"]}),e.jsxs(q,{value:"extras",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Air Extras"]}),e.jsxs(q,{value:"manage",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Manage Booking"]})]}),e.jsx(R,{value:"status",children:e.jsx(he,{booking:n})}),e.jsx(R,{value:"exchange",children:e.jsx(me,{booking:n,onExchangeComplete:u})}),e.jsx(R,{value:"seats",children:e.jsx(xe,{booking:n,onSeatSelectionComplete:u})}),e.jsx(R,{value:"extras",children:e.jsx(ue,{booking:n,onExtrasComplete:u})}),e.jsx(R,{value:"manage",children:e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Booking Management"]})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx($,{children:e.jsx(D,{children:"Advanced booking management features including cancellation, contact updates, and special service requests will be available here."})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Contact Information"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Update your contact details for this booking"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Special Service Requests"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Add or modify special service requests (SSRs)"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Cancellation"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cancel your booking and process refunds"})]})]})]})})]})})]})]})]})};export{Ve as default};
