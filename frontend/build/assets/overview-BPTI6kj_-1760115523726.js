import{r as h,l as f,s as y,j as e,B as g,R as w,a as i,d as o,e as c,b as l}from"./index-DQQjtSjM-1760115523726.js";import{U as k}from"./users-XTVR641H-1760115523726.js";import{B}from"./building-DVym6JbN-1760115523726.js";import{C as S}from"./credit-card-D6NkYFnh-1760115523726.js";import{T as U}from"./trending-up-BJh6tM2D-1760115523726.js";const _=()=>{const[s,n]=h.useState(null),[d,a]=h.useState(!0),[m,t]=h.useState(null),p=new URLSearchParams(window.location.search).get("bypass")==="admin",N=window.location.hostname.includes("preview.emergentagent.com"),b=p&&N,j=async()=>{try{if(a(!0),t(null),b){f.info("Admin bypass mode: Using mock admin metrics");const v={totalBookings:1247,totalRevenue:89650.5,totalUsers:2834,activeProperties:156,recentBookings:[{id:"bk_001",booking_reference:"MK-2024-001",booking_type:"Hotel",customer_email:"demo@example.com",amount:299.99,created_at:new Date().toISOString()},{id:"bk_002",booking_reference:"MK-2024-002",booking_type:"Flight",customer_email:"test@example.com",amount:599.99,created_at:new Date(Date.now()-864e5).toISOString()}],lastUpdated:new Date().toISOString()};n(v),f.info("Mock admin metrics loaded successfully");return}const{data:r,error:x}=await y.functions.invoke("admin-metrics");if(x)throw x;if(!r.success)throw new Error(r.error||"Failed to fetch admin metrics");n(r.data),f.info("Admin metrics loaded successfully")}catch(r){const x=r instanceof Error?r.message:"Failed to fetch admin metrics";t(x),f.error("Error fetching admin metrics:",r)}finally{a(!1)}};return h.useEffect(()=>{j()},[]),{metrics:s,loading:d,error:m,refetch:j}},D=()=>{const{metrics:s,loading:n,error:d,refetch:a}=_();return n?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):d?e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-destructive mb-4",children:"Error Loading Dashboard"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:d}),e.jsx(g,{onClick:a,children:"Try Again"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Overview"}),e.jsx("p",{className:"text-muted-foreground",children:"Monitor key metrics and system performance"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Last updated: ",s!=null&&s.lastUpdated?new Date(s.lastUpdated).toLocaleString():"Never"]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:a,className:"gap-2",children:[e.jsx(w,{className:n?"h-4 w-4 animate-spin":"h-4 w-4"}),"Refresh"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(i,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalUsers)||0})})]}),e.jsxs(i,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Bookings"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalBookings)||0})})]}),e.jsxs(i,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(l,{children:e.jsxs("div",{className:"text-2xl font-bold",children:["$",((s==null?void 0:s.totalRevenue)||0).toLocaleString()]})})]}),e.jsxs(i,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Active Properties"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(l,{children:e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.activeProperties)||0})})]})]}),e.jsxs(i,{children:[e.jsx(o,{children:e.jsx(c,{children:"System Overview"})}),e.jsxs(l,{className:"space-y-4",children:[e.jsx("p",{children:"Welcome to the MAKU Travel admin dashboard. Monitor system health and key metrics here."}),(()=>{const m=Array.isArray(s==null?void 0:s.recentBookings)?s.recentBookings:typeof(s==null?void 0:s.recentBookings)=="string"?(()=>{try{return JSON.parse(s.recentBookings)}catch{return[]}})():[];return m.length>0?e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Recent Bookings"}),e.jsx("div",{className:"space-y-2",children:m.slice(0,5).map((t,u)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-mono text-sm",children:t.booking_reference||"N/A"}),e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:t.booking_type||"Unknown"})]}),e.jsxs("div",{className:"text-sm",children:[t.currency||"USD"," ",t.total_amount||"0.00"]})]},t.id||u))})]}):e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Recent Bookings"}),e.jsx("p",{className:"text-muted-foreground",children:"No recent bookings found."})]})})()]})]})]})};export{D as default};
