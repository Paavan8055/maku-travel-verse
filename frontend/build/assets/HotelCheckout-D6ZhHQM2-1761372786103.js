import{F as v,r as p,h as Ce,u as ct,j as e,d as G,B as Y,n as kt,t as Ze,f as ve,g as ye,e as X,a as Qe,A as Te,q as Be,k as Et,b as Pt,s as Ie,l as ne}from"./index-DJr1750g-1761372786103.js";import{P as w}from"./index-ByAvQQN_-1761372786103.js";import{N as Re}from"./Navbar-BsidW7ha-1761372786103.js";import{u as Ft,t as At}from"./zod-Ct-APAJw-1761372786103.js";import{I as Q}from"./input-DqGcWsQw-1761372786103.js";import{S as Ot,a as Tt,b as Bt,c as It,d as fe}from"./select-1lOxQt2b-1761372786103.js";import{T as Rt}from"./textarea-DwNmCsqW-1761372786103.js";import{C as Fe}from"./checkbox-BNMDxIBc-1761372786103.js";import{F as $t,a as q,b as z,c as W,d as V,e as K}from"./form-M8v6HevJ-1761372786103.js";import{a as et}from"./autofillService-DQKDYY-t-1761372786103.js";import{u as tt}from"./bookingStore-Cdgeya0O-1761372786103.js";import{S as dt}from"./sparkles-1TFqtcdt-1761372786103.js";import{U as Lt}from"./user-d1mCht9P-1761372786103.js";import{o as _t,b as Ae,s as Z}from"./types-BekIk3NQ-1761372786103.js";import{C as Ut}from"./circle-check-CyZTn2ix-1761372786103.js";import{E as Mt}from"./ErrorBoundary-CL3RWthp-1761372786103.js";import{L as qt}from"./label-_gSJFdDg-1761372786103.js";import{S as zt}from"./separator-CuUhLzUA-1761372786103.js";import{D as Wt,a as Vt,b as Yt,c as Gt}from"./dialog-DIT-eZAC-1761372786103.js";import{u as Ht}from"./useTravelFunds-Cg_lAnQu-1761372786103.js";import{W as be}from"./wallet-BfpqDcgy-1761372786103.js";import{B as Jt}from"./brain-Cw34cxNH-1761372786103.js";import{Z as xe}from"./zap-DVLc29wt-1761372786103.js";import{T as Dt}from"./trending-up-DwP9sF2f-1761372786103.js";import{C as Kt}from"./clock-CWvlsLHC-1761372786103.js";import{C as Xt}from"./credit-card-DFezJ7-2-1761372786103.js";import{C as Se}from"./circle-alert-DbsfEIHX-1761372786103.js";import{t as st}from"./travelFundClient-A8Lq06lB-1761372786103.js";import{C as Zt}from"./chevron-left-DWkROGy5-1761372786103.js";import{S as Qt}from"./shield-Dyr_tcSc-1761372786103.js";import"./useApiHealth-nqc67E7W-1761372786103.js";import"./avatar-C-jVzCdJ-1761372786103.js";import"./index-DsQq8d_h-1761372786103.js";import"./globe-BIc4cSc9-1761372786103.js";import"./useHealthMonitor-B6XLbbaC-1761372786103.js";import"./useAIIntelligence-u1xm4jYe-1761372786103.js";import"./plane-C31ePVtH-1761372786103.js";import"./map-pin-DCTTjC40-1761372786103.js";import"./chevron-down-9xMs7EAx-1761372786103.js";import"./calendar-BHB0CqgJ-1761372786103.js";import"./users-DVHEI_ct-1761372786103.js";import"./settings-BNbhqb_d-1761372786103.js";import"./index-BdQq_4o_-1761372786103.js";import"./index-BxHCFFya-1761372786103.js";import"./index-CiQXE_-m-1761372786103.js";var ut="https://js.stripe.com/v3",es=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var ts=function(){for(var t=document.querySelectorAll('script[src^="'.concat(ut,'"]')),r=0;r<t.length;r++){var n=t[r];if(es.test(n.src))return n}return null},rt=function(t){var r="",n=document.createElement("script");n.src="".concat(ut).concat(r);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(n),n},ss=function(t,r){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"3.4.1",startTime:r})},de=null,ge=null,je=null,rs=function(t){return function(){t(new Error("Failed to load Stripe.js"))}},ns=function(t,r){return function(){window.Stripe?t(window.Stripe):r(new Error("Stripe.js not available"))}},as=function(t){return de!==null?de:(de=new Promise(function(r,n){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var i=ts();if(!(i&&t)){if(!i)i=rt(t);else if(i&&je!==null&&ge!==null){var l;i.removeEventListener("load",je),i.removeEventListener("error",ge),(l=i.parentNode)===null||l===void 0||l.removeChild(i),i=rt(t)}}je=ns(r,n),ge=rs(n),i.addEventListener("load",je),i.addEventListener("error",ge)}catch(m){n(m);return}}),de.catch(function(r){return de=null,Promise.reject(r)}))},is=function(t,r,n){if(t===null)return null;var i=t.apply(void 0,r);return ss(i,n),i},ue,mt=!1,pt=function(){return ue||(ue=as(null).catch(function(t){return ue=null,Promise.reject(t)}),ue)};Promise.resolve().then(function(){return pt()}).catch(function(s){mt||console.warn(s)});var os=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];mt=!0;var i=Date.now();return pt().then(function(l){return is(l,r,i)})};function nt(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),r.push.apply(r,n)}return r}function at(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nt(Object(r),!0).forEach(function(n){ht(s,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):nt(Object(r)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(r,n))})}return s}function Ne(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ne=function(t){return typeof t}:Ne=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ne(s)}function ht(s,t,r){return t in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function ft(s,t){return ls(s)||cs(s,t)||ds(s,t)||us()}function ls(s){if(Array.isArray(s))return s}function cs(s,t){var r=s&&(typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"]);if(r!=null){var n=[],i=!0,l=!1,m,o;try{for(r=r.call(s);!(i=(m=r.next()).done)&&(n.push(m.value),!(t&&n.length===t));i=!0);}catch(d){l=!0,o=d}finally{try{!i&&r.return!=null&&r.return()}finally{if(l)throw o}}return n}}function ds(s,t){if(s){if(typeof s=="string")return it(s,t);var r=Object.prototype.toString.call(s).slice(8,-1);if(r==="Object"&&s.constructor&&(r=s.constructor.name),r==="Map"||r==="Set")return Array.from(s);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return it(s,t)}}function it(s,t){(t==null||t>s.length)&&(t=s.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=s[r];return n}function us(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var U=function(t,r,n){var i=!!n,l=v.useRef(n);v.useEffect(function(){l.current=n},[n]),v.useEffect(function(){if(!i||!t)return function(){};var m=function(){l.current&&l.current.apply(l,arguments)};return t.on(r,m),function(){t.off(r,m)}},[i,r,t,l])},$e=function(t){var r=v.useRef(t);return v.useEffect(function(){r.current=t},[t]),r.current},ae=function(t){return t!==null&&Ne(t)==="object"},ms=function(t){return ae(t)&&typeof t.then=="function"},ps=function(t){return ae(t)&&typeof t.elements=="function"&&typeof t.createToken=="function"&&typeof t.createPaymentMethod=="function"&&typeof t.confirmCardPayment=="function"},ot="[object Object]",hs=function s(t,r){if(!ae(t)||!ae(r))return t===r;var n=Array.isArray(t),i=Array.isArray(r);if(n!==i)return!1;var l=Object.prototype.toString.call(t)===ot,m=Object.prototype.toString.call(r)===ot;if(l!==m)return!1;if(!l&&!n)return t===r;var o=Object.keys(t),d=Object.keys(r);if(o.length!==d.length)return!1;for(var x={},f=0;f<o.length;f+=1)x[o[f]]=!0;for(var j=0;j<d.length;j+=1)x[d[j]]=!0;var b=Object.keys(x);if(b.length!==o.length)return!1;var g=t,a=r,y=function(h){return s(g[h],a[h])};return b.every(y)},xt=function(t,r,n){return ae(t)?Object.keys(t).reduce(function(i,l){var m=!ae(r)||!hs(t[l],r[l]);return n.includes(l)?(m&&console.warn("Unsupported prop change: options.".concat(l," is not a mutable property.")),i):m?at(at({},i||{}),{},ht({},l,t[l])):i},null):null},gt="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",lt=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gt;if(t===null||ps(t))return t;throw new Error(r)},fs=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gt;if(ms(t))return{tag:"async",stripePromise:Promise.resolve(t).then(function(i){return lt(i,r)})};var n=lt(t,r);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},xs=function(t){!t||!t._registerWrapper||!t.registerAppInfo||(t._registerWrapper({name:"react-stripe-js",version:"2.8.1"}),t.registerAppInfo({name:"react-stripe-js",version:"2.8.1",url:"https://stripe.com/docs/stripe-js/react"}))},we=v.createContext(null);we.displayName="ElementsContext";var jt=function(t,r){if(!t)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(r," in an <Elements> provider."));return t},vt=function(t){var r=t.stripe,n=t.options,i=t.children,l=v.useMemo(function(){return fs(r)},[r]),m=v.useState(function(){return{stripe:l.tag==="sync"?l.stripe:null,elements:l.tag==="sync"?l.stripe.elements(n):null}}),o=ft(m,2),d=o[0],x=o[1];v.useEffect(function(){var b=!0,g=function(y){x(function(c){return c.stripe?c:{stripe:y,elements:y.elements(n)}})};return l.tag==="async"&&!d.stripe?l.stripePromise.then(function(a){a&&b&&g(a)}):l.tag==="sync"&&!d.stripe&&g(l.stripe),function(){b=!1}},[l,d,n]);var f=$e(r);v.useEffect(function(){f!==null&&f!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[f,r]);var j=$e(n);return v.useEffect(function(){if(d.elements){var b=xt(n,j,["clientSecret","fonts"]);b&&d.elements.update(b)}},[n,j,d.elements]),v.useEffect(function(){xs(d.stripe)},[d.stripe]),v.createElement(we.Provider,{value:d},i)};vt.propTypes={stripe:w.any,options:w.object};var gs=function(t){var r=v.useContext(we);return jt(r,t)},js=function(){var t=gs("calls useElements()"),r=t.elements;return r};w.func.isRequired;var yt=v.createContext(null);yt.displayName="CustomCheckoutSdkContext";var vs=function(t,r){if(!t)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(r," in an <CustomCheckoutProvider> provider."));return t},ys=v.createContext(null);ys.displayName="CustomCheckoutContext";w.any,w.shape({clientSecret:w.string.isRequired,elementsOptions:w.object}).isRequired;var Le=function(t){var r=v.useContext(yt),n=v.useContext(we);if(r&&n)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CustomCheckoutProvider> and <Elements> providers."));return r?vs(r,t):jt(n,t)},bs=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},F=function(t,r){var n="".concat(bs(t),"Element"),i=function(d){var x=d.id,f=d.className,j=d.options,b=j===void 0?{}:j,g=d.onBlur,a=d.onFocus,y=d.onReady,c=d.onChange,h=d.onEscape,k=d.onClick,P=d.onLoadError,B=d.onLoaderStart,me=d.onNetworksChange,ie=d.onConfirm,u=d.onCancel,N=d.onShippingAddressChange,O=d.onShippingRateChange,E=Le("mounts <".concat(n,">")),R="elements"in E?E.elements:null,$="customCheckoutSdk"in E?E.customCheckoutSdk:null,se=v.useState(null),ee=ft(se,2),T=ee[0],oe=ee[1],I=v.useRef(null),H=v.useRef(null);U(T,"blur",g),U(T,"focus",a),U(T,"escape",h),U(T,"click",k),U(T,"loaderror",P),U(T,"loaderstart",B),U(T,"networkschange",me),U(T,"confirm",ie),U(T,"cancel",u),U(T,"shippingaddresschange",N),U(T,"shippingratechange",O),U(T,"change",c);var J;y&&(t==="expressCheckout"?J=y:J=function(){y(T)}),U(T,"ready",J),v.useLayoutEffect(function(){if(I.current===null&&H.current!==null&&(R||$)){var C=null;$?C=$.createElement(t,b):R&&(C=R.create(t,b)),I.current=C,oe(C),C&&C.mount(H.current)}},[R,$,b]);var le=$e(b);return v.useEffect(function(){if(I.current){var C=xt(b,le,["paymentRequest"]);C&&"update"in I.current&&I.current.update(C)}},[b,le]),v.useLayoutEffect(function(){return function(){if(I.current&&typeof I.current.destroy=="function")try{I.current.destroy(),I.current=null}catch{}}},[]),v.createElement("div",{id:x,className:f,ref:H})},l=function(d){Le("mounts <".concat(n,">"));var x=d.id,f=d.className;return v.createElement("div",{id:x,className:f})},m=r?l:i;return m.propTypes={id:w.string,className:w.string,onChange:w.func,onBlur:w.func,onFocus:w.func,onReady:w.func,onEscape:w.func,onClick:w.func,onLoadError:w.func,onLoaderStart:w.func,onNetworksChange:w.func,onConfirm:w.func,onCancel:w.func,onShippingAddressChange:w.func,onShippingRateChange:w.func,options:w.object},m.displayName=n,m.__elementType=t,m},A=typeof window>"u",Ns=v.createContext(null);Ns.displayName="EmbeddedCheckoutProviderContext";var Ss=function(){var t=Le("calls useStripe()"),r=t.stripe;return r};F("auBankAccount",A);F("card",A);F("cardNumber",A);F("cardExpiry",A);F("cardCvc",A);F("fpxBank",A);F("iban",A);F("idealBank",A);F("p24Bank",A);F("epsBank",A);var Cs=F("payment",A);F("expressCheckout",A);F("currencySelector",A);F("paymentRequestButton",A);F("linkAuthentication",A);F("address",A);F("shippingAddress",A);F("paymentMethodMessaging",A);F("affirmMessage",A);F("afterpayClearpayMessage",A);const ws=_t({title:Z().min(1,"Title is required"),firstName:Z().min(1,"First name is required"),lastName:Z().min(1,"Last name is required"),email:Z().email("Valid email is required"),phone:Z().min(10,"Valid phone number is required"),arrivalTime:Z().optional(),specialRequests:Z().optional(),smsNotifications:Ae().default(!1),emailUpdates:Ae().default(!0),roomPreferences:Z().optional(),acknowledgment:Ae().refine(s=>s===!0,{message:"You must acknowledge the terms and conditions"})});function ks({onChange:s,initial:t}){const[r,n]=p.useState(!1),{toast:i}=Ce(),{user:l}=ct(),m=()=>{const{guestInfo:a}=tt.getState();return{title:"",firstName:"",lastName:"",email:"",phone:"",arrivalTime:"",specialRequests:"",smsNotifications:!1,emailUpdates:!0,roomPreferences:"",acknowledgment:!1,...a,...t}},o=Ft({resolver:At(ws),mode:"onBlur",defaultValues:m()}),{watch:d,formState:{isValid:x}}=o,f=p.useCallback(()=>{if(s){const a=o.getValues();x&&a.firstName&&a.lastName&&a.email&&tt.getState().setGuestInfo({firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone||"",title:a.title,arrivalTime:a.arrivalTime,specialRequests:a.specialRequests,roomPreferences:a.roomPreferences,smsNotifications:a.smsNotifications,emailUpdates:a.emailUpdates}),s(a,x)}},[s,x,o]);p.useEffect(()=>{const a=o.watch(()=>{f()});return f(),()=>a.unsubscribe()},[o,f]);const j=a=>a.toUpperCase(),b=()=>{i({title:"Demo data not available",description:"Please enter guest information manually",variant:"destructive"})},g=async()=>{if(!(l!=null&&l.id)){i({title:"Please log in",description:"You need to be logged in to use saved information",variant:"destructive"});return}n(!0);try{const a=await et.loadUserStoredData(l.id);if(!a.hasStoredData){i({title:"No saved data found",description:"Please save your preferences and passport info first",variant:"destructive"});return}const y=et.userDataToHotelForm(a);o.reset(y),i({title:"Information loaded",description:"Form filled with your saved information"})}catch{i({title:"Error loading data",description:"Could not load your saved information",variant:"destructive"})}finally{setTimeout(()=>n(!1),500)}};return e.jsxs(G,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Guest Details"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Y,{type:"button",variant:"outline",size:"sm",onClick:b,disabled:r,className:"text-xs",children:[e.jsx(dt,{className:"h-3 w-3 mr-1"}),"Fill Demo Data"]}),e.jsxs(Y,{type:"button",variant:"outline",size:"sm",onClick:g,disabled:r,className:"text-xs",children:[e.jsx(Lt,{className:"h-3 w-3 mr-1"}),"Use My Info"]})]})]}),e.jsx($t,{...o,children:e.jsxs("form",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(q,{control:o.control,name:"title",render:({field:a})=>e.jsxs(z,{children:[e.jsx(W,{children:"Title"}),e.jsxs(Ot,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(V,{children:e.jsx(Tt,{children:e.jsx(Bt,{placeholder:"Select title"})})}),e.jsxs(It,{children:[e.jsx(fe,{value:"Mr",children:"Mr"}),e.jsx(fe,{value:"Mrs",children:"Mrs"}),e.jsx(fe,{value:"Ms",children:"Ms"}),e.jsx(fe,{value:"Dr",children:"Dr"})]})]}),e.jsx(K,{})]})}),e.jsx(q,{control:o.control,name:"firstName",render:({field:a})=>e.jsxs(z,{children:[e.jsx(W,{children:"First Name"}),e.jsx(V,{children:e.jsx(Q,{...a,onChange:y=>a.onChange(j(y.target.value)),placeholder:"Enter first name"})}),e.jsx(K,{})]})}),e.jsx(q,{control:o.control,name:"lastName",render:({field:a})=>e.jsxs(z,{children:[e.jsx(W,{children:"Last Name"}),e.jsx(V,{children:e.jsx(Q,{...a,onChange:y=>a.onChange(j(y.target.value)),placeholder:"Enter last name"})}),e.jsx(K,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(q,{control:o.control,name:"email",render:({field:a})=>e.jsxs(z,{children:[e.jsx(W,{children:"Email"}),e.jsx(V,{children:e.jsx(Q,{...a,type:"email",placeholder:"Enter email address"})}),e.jsx(K,{})]})}),e.jsx(q,{control:o.control,name:"phone",render:({field:a})=>e.jsxs(z,{children:[e.jsx(W,{children:"Phone Number"}),e.jsx(V,{children:e.jsx(Q,{...a,placeholder:"Enter phone number"})}),e.jsx(K,{})]})})]}),e.jsx(q,{control:o.control,name:"arrivalTime",render:({field:a})=>e.jsxs(z,{children:[e.jsx(W,{children:"Estimated Arrival Time (Optional)"}),e.jsx(V,{children:e.jsx(Q,{...a,placeholder:"e.g., 3:00 PM or After 6:00 PM"})}),e.jsx(K,{})]})}),e.jsx(q,{control:o.control,name:"roomPreferences",render:({field:a})=>e.jsxs(z,{children:[e.jsx(W,{children:"Room Preferences (Optional)"}),e.jsx(V,{children:e.jsx(Q,{...a,placeholder:"e.g., High floor, Quiet room, Near elevator"})}),e.jsx(K,{})]})}),e.jsx(q,{control:o.control,name:"specialRequests",render:({field:a})=>e.jsxs(z,{children:[e.jsx(W,{children:"Special Requests (Optional)"}),e.jsx(V,{children:e.jsx(Rt,{...a,placeholder:"Enter any special requests or accessibility needs",className:"min-h-[80px]"})}),e.jsx(K,{})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{control:o.control,name:"smsNotifications",render:({field:a})=>e.jsxs(z,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(V,{children:e.jsx(Fe,{checked:a.value,onCheckedChange:a.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(W,{children:"Receive SMS notifications about booking updates"})})]})}),e.jsx(q,{control:o.control,name:"emailUpdates",render:({field:a})=>e.jsxs(z,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(V,{children:e.jsx(Fe,{checked:a.value,onCheckedChange:a.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(W,{children:"Receive email updates about your stay"})})]})}),e.jsx(q,{control:o.control,name:"acknowledgment",render:({field:a})=>e.jsxs(z,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(V,{children:e.jsx(Fe,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(W,{children:"I acknowledge that I have read and agree to the hotel's booking terms, cancellation policy, and privacy policy."}),e.jsx(K,{})]})]})})]})]})})]})}const Es=({currentStep:s,totalSteps:t=3,steps:r=["Search","Room Selection","Checkout","Payment"]})=>{const n=t||r.length,i=s/n*100;return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Step ",s," of ",n]}),e.jsxs("span",{children:[Math.round(i),"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-primary-hover transition-all duration-500 ease-out",style:{width:`${i}%`}})})]}),e.jsx("div",{className:"flex items-center justify-center space-x-4",children:r.slice(0,n).map((l,m)=>{const o=m+1,d=o<s,x=o===s;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[d?e.jsx(Ut,{className:"h-5 w-5 text-green-600"}):e.jsx(kt,{className:Ze("h-5 w-5",x?"text-primary fill-primary":"text-muted-foreground")}),e.jsx("span",{className:Ze("text-sm font-medium",x?"text-primary":d?"text-green-600":"text-muted-foreground"),children:l})]}),m<n-1&&e.jsx("div",{className:"w-8 h-0.5 bg-border ml-2"})]},l)})})]})},Ps=({bookingData:s,biddingData:t,open:r,onOpenChange:n,onPaymentMethodSelected:i})=>{const{toast:l}=Ce(),{funds:m}=Ht(),[o,d]=p.useState("funds"),[x,f]=p.useState({}),[j,b]=p.useState((t==null?void 0:t.minimumBid)||0),[g,a]=p.useState(!1),y=m.reduce((u,N)=>u+N.balance,0),c=Object.values(x).reduce((u,N)=>u+N,0),h=Math.max(0,s.amount-c),P=m.filter(u=>{var N;return((N=u.destination)==null?void 0:N.toLowerCase().includes(s.destination.toLowerCase()))||u.balance>=s.amount*.25}).sort((u,N)=>N.balance-u.balance).slice(0,3),B=y>=s.amount,me=()=>{let u=s.amount;const N={};for(const O of P){if(u<=0)break;const E=Math.min(O.balance,u);E>0&&(N[O.id]=E,u-=E)}f(N),l({title:"Smart allocation applied",description:`Optimized fund usage for your ${s.destination} booking`})},ie=()=>{const N={fundUsage:Object.entries(x).filter(([O,E])=>E>0).map(([O,E])=>({fundId:O,amount:E})),cardPayment:h,biddingAmount:o==="bidding"?j:void 0,totalCovered:c+(o==="bidding"?j:0)};i(N)};return e.jsx(Wt,{open:r,onOpenChange:n,children:e.jsxs(Vt,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Yt,{children:e.jsxs(Gt,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-6 w-6 text-orange-500"}),"Enhanced Payment Options"]})}),e.jsxs("div",{className:"space-y-6",children:[P.length>0&&e.jsxs(G,{className:"bg-gradient-to-r from-orange-50 to-green-50 border-orange-200",children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Jt,{className:"h-5 w-5 text-orange-600"}),"Smart Fund Recommendations"]})}),e.jsx(X,{children:e.jsxs("div",{className:"space-y-3",children:[P.map(u=>{var N;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:u.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["$",u.balance," available ",u.destination&&`• ${u.destination}`]})]}),e.jsx(Qe,{className:"bg-orange-100 text-orange-600",children:(N=u.destination)!=null&&N.toLowerCase().includes(s.destination.toLowerCase())?"Perfect Match":"Good Option"})]},u.id)}),e.jsxs(Y,{onClick:me,className:"w-full bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Apply Smart Allocation"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(G,{className:`cursor-pointer transition-all ${o==="funds"?"ring-2 ring-orange-500 bg-orange-50":"hover:bg-white"}`,onClick:()=>d("funds"),children:e.jsxs(X,{className:"p-4 text-center",children:[e.jsx(be,{className:"h-8 w-8 mx-auto mb-2 text-orange-500"}),e.jsx("h3",{className:"font-medium",children:"Travel Funds"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use saved money"})]})}),(t==null?void 0:t.enabled)&&e.jsx(G,{className:`cursor-pointer transition-all ${o==="bidding"?"ring-2 ring-blue-500 bg-blue-50":"hover:bg-white"}`,onClick:()=>d("bidding"),children:e.jsxs(X,{className:"p-4 text-center",children:[e.jsx(xe,{className:"h-8 w-8 mx-auto mb-2 text-blue-500"}),e.jsx("h3",{className:"font-medium",children:"Smart Bidding"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Lock deal with bid"})]})}),e.jsx(G,{className:`cursor-pointer transition-all ${o==="hybrid"?"ring-2 ring-purple-500 bg-purple-50":"hover:bg-white"}`,onClick:()=>d("hybrid"),children:e.jsxs(X,{className:"p-4 text-center",children:[e.jsx(Dt,{className:"h-8 w-8 mx-auto mb-2 text-purple-500"}),e.jsx("h3",{className:"font-medium",children:"Hybrid"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Funds + Bidding"})]})})]}),o==="bidding"&&t&&e.jsxs(G,{className:"bg-gradient-to-r from-blue-50 to-cyan-50 border-blue-200",children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-blue-600"}),"Smart Bidding with Funds"]})}),e.jsxs(X,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Original Price"}),e.jsxs("p",{className:"text-xl font-bold line-through text-gray-400",children:["$",t.originalPrice.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Current Bid"}),e.jsxs("p",{className:"text-xl font-bold text-blue-600",children:["$",t.currentBid.toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(qt,{children:"Your Bid Amount"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{type:"number",value:j,onChange:u=>b(Number(u.target.value)),min:t.minimumBid,max:y}),e.jsx(Y,{variant:"outline",onClick:()=>b(Math.min(y,t.currentBid+100)),children:"Competitive"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-100 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Fund Coverage"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:y>=j?"100%":`${Math.round(y/j*100)}%`})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-700",children:[e.jsx(Kt,{className:"h-4 w-4"}),e.jsxs("span",{children:[Math.round(t.timeRemaining/60)," minutes remaining"]})]})]})]}),(o==="funds"||o==="hybrid")&&e.jsxs(G,{children:[e.jsx(ve,{children:e.jsx(ye,{children:"Select Travel Funds"})}),e.jsx(X,{className:"space-y-4",children:m.map(u=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:u.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Available: $",u.balance," ",u.destination&&`• ${u.destination}`]})]}),e.jsx(Qe,{variant:"secondary",children:u.fund_type})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{type:"number",placeholder:"Amount to use",value:x[u.id]||"",onChange:N=>{const O=Number(N.target.value)||0;O<=u.balance&&f(E=>({...E,[u.id]:O}))},max:u.balance}),e.jsx(Y,{variant:"outline",size:"sm",onClick:()=>{const N=Math.min(u.balance,s.amount-c+(x[u.id]||0));f(O=>({...O,[u.id]:N}))},children:"Max"})]})]},u.id))})]}),e.jsx(G,{className:"bg-white",children:e.jsx(X,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Booking Amount:"}),e.jsxs("span",{className:"font-medium",children:["$",s.amount.toLocaleString()]})]}),c>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3 text-green-500"}),"Fund Payment:"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["-$",c.toFixed(2)]})]}),o==="bidding"&&j>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3 text-blue-500"}),"Bid Amount:"]}),e.jsxs("span",{className:"font-medium text-blue-600",children:["$",j.toLocaleString()]})]}),h>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Xt,{className:"h-3 w-3 text-gray-500"}),"Card Payment:"]}),e.jsxs("span",{className:"font-medium",children:["$",h.toFixed(2)]})]}),e.jsx(zt,{}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",s.amount.toFixed(2)]})]})]})})}),!B&&o==="funds"&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(Se,{className:"h-4 w-4 text-amber-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-800",children:"Partial Fund Coverage"}),e.jsxs("p",{className:"text-amber-700",children:["Your funds can cover $",c.toFixed(2),". Consider creating a fund for future ",s.destination," trips!"]})]})]}),(t==null?void 0:t.enabled)&&o==="bidding"&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(xe,{className:"h-4 w-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Smart Bidding Active"}),e.jsxs("p",{className:"text-blue-700",children:["Save $",(t.originalPrice-j).toLocaleString()," with strategic bidding. Your funds will be temporarily locked during the bid."]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Y,{onClick:ie,disabled:o==="funds"&&c===0,className:"flex-1 bg-gradient-to-r from-orange-500 to-green-500 hover:from-orange-600 hover:to-green-600 text-white",children:o==="bidding"?`Place Bid: $${j.toLocaleString()}`:`Confirm Payment: $${(c||s.amount).toFixed(2)}`}),e.jsx(Y,{variant:"outline",onClick:()=>n(!1),children:"Cancel"})]})]})]})})},Fs=()=>{const{user:s}=ct(),{toast:t}=Ce(),[r,n]=p.useState([]),[i,l]=p.useState(!0),[m,o]=p.useState(null),[d,x]=p.useState(null),f=p.useCallback(async()=>{if(!s){n([]),l(!1);return}try{l(!0);const{data:c,error:h}=await st.getUserFunds();if(h)throw h;n(c||[]);const k=await fetch("/api/travel-funds/integration-data",{headers:{Authorization:`Bearer ${s.id}`}});if(k.ok){const B=await k.json();o(B)}const P=await fetch("/api/travel-funds/enhanced-stats",{headers:{Authorization:`Bearer ${s.id}`}});if(P.ok){const B=await P.json();x(B)}}catch(c){console.error("Error fetching enhanced fund data:",c),t({title:"Error",description:"Failed to load enhanced fund data",variant:"destructive"})}finally{l(!1)}},[s,t]),j=p.useCallback(async c=>{var h;try{const k={name:`${c.dreamName} 2025`,description:`AI-generated savings plan for ${c.destination} adventure`,target_amount:c.estimatedCost,destination:c.destination,fund_type:c.companions>0?"group":"personal",deadline:((h=c.travelDates)==null?void 0:h.start.toISOString().split("T")[0])||new Date(Date.now()+31536e6).toISOString().split("T")[0],smart_dreams_integration:{source:"smart_dreams",dream_data:c,created_at:new Date().toISOString()}},P=await st.createFund(k);if(P.data)return t({title:"Dream fund created!",description:`Your ${c.destination} savings journey begins now`}),f(),P.data;throw new Error(P.error)}catch{return t({title:"Error",description:"Failed to create dream fund",variant:"destructive"}),null}},[t,f]),b=p.useCallback(async c=>{try{const h=c.fundAllocations.map(B=>fetch(`/api/travel-funds/${B.fundId}/bidding/lock`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:B.amount,bid_id:c.dealId,lock_duration:c.lockDuration})}));if((await Promise.all(h)).every(B=>B.ok))return t({title:"Funds locked for bidding",description:`$${c.bidAmount} secured for your bid`}),f(),!0;throw new Error("Some fund locks failed")}catch{return t({title:"Error",description:"Failed to lock funds for bidding",variant:"destructive"}),!1}},[t,f]),g=p.useCallback(async(c,h,k)=>{try{(await fetch(`/api/travel-funds/bidding/${c}/${h?"process-win":"release-locks"}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({final_price:k})})).ok&&(t({title:h?"Bid won!":"Bid unsuccessful",description:h?`Congratulations! Your bid of $${k} won the deal`:"Your funds have been released back to your account",variant:h?"default":"destructive"}),f())}catch(P){console.error("Error processing bid result:",P)}},[t,f]),a=p.useCallback(async(c,h)=>{try{const k=await fetch(`/api/travel-funds/${c}/nft/mint-milestone`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({milestone_type:h})});if(k.ok){const P=await k.json();return t({title:"NFT Minted!",description:`Your ${h} NFT has been added to your collection`}),P}}catch(k){console.error("Error minting NFT:",k)}return null},[t]),y=p.useCallback(async c=>{try{const h=await fetch("/api/travel-funds/checkout/suggestions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(h.ok)return await h.json()}catch(h){console.error("Error getting checkout suggestions:",h)}return[]},[]);return p.useEffect(()=>{f()},[f]),{funds:r,loading:i,integrationData:m,enhancedStats:d,createFundFromDream:j,lockFundsForBidding:b,processBidResult:g,mintMilestoneNFT:a,getCheckoutSuggestions:y,refetchData:f,totalFundBalance:r.reduce((c,h)=>c+h.balance,0),activeFundsCount:r.filter(c=>c.target_amount>c.balance).length}};let Oe=null;const As=async()=>(Oe||(Oe=(async()=>{try{const{data:s,error:t}=await Ie.functions.invoke("get-stripe-publishable-key");if(t||!(s!=null&&s.publishable_key))throw ne.error("Failed to get Stripe publishable key:",t),new Error("Failed to load payment system");console.log("✅ Loading Stripe with key:",s.publishable_key.substring(0,20)+"...");const r=await os(s.publishable_key);return console.log("✅ Stripe loaded successfully:",!!r),r}catch(s){return ne.error("Stripe initialization error:",s),null}})()),Oe);function Os(){var qe,ze,We;const[s]=Et();Pt();const t=Ss(),r=js(),{toast:n}=Ce(),{funds:i}=Fs(),[l,m]=p.useState(!1),[o,d]=p.useState(null),[x,f]=p.useState(!1),[j,b]=p.useState(null),[g,a]=p.useState(null),[y,c]=p.useState(null),[h,k]=p.useState(!0),[P,B]=p.useState(!1),[me,ie]=p.useState([]),[u,N]=p.useState(0),O=s.get("hotelId"),E=s.get("offerId"),R=s.get("checkIn"),$=s.get("checkOut"),se=parseInt(s.get("adults")||"2"),ee=parseInt(s.get("children")||"0"),T=parseInt(s.get("rooms")||"1"),oe=(s.get("addons")||"").split(",").filter(Boolean),I=s.get("bedPref")||"",H=s.get("note")||"";p.useEffect(()=>{(async()=>{var L,re,Ve,Ye,Ge,He,Je,De;if(!O||!E||!R||!$){console.log("❌ Missing required parameters:",{hotelId:O,offerId:E,checkIn:R,checkOut:$}),c("Missing booking parameters. Please return to hotel search."),k(!1);return}try{c(null),console.log("🔍 Creating hotel booking with parameters:",{hotelId:O,offerId:E,checkIn:R,checkOut:$,adults:se,children:ee,rooms:T,addons:oe,bedPref:I,note:H}),console.log("🔍 Testing Stripe publishable key...");const{data:te,error:ce}=await Ie.functions.invoke("get-stripe-publishable-key");if(ce){console.log("❌ Stripe key retrieval failed:",ce),c("Payment system configuration error. Please contact support."),k(!1);return}if(!(te!=null&&te.publishable_key)){console.log("❌ No publishable key returned:",te),c("Payment system not configured. Please contact support."),k(!1);return}console.log("✅ Stripe key retrieved successfully");const D=JSON.parse(sessionStorage.getItem("selectedOffer")||"{}"),Ke=JSON.parse(sessionStorage.getItem("selectedAddOns")||"[]"),Ct=Math.ceil((new Date($).getTime()-new Date(R).getTime())/(1e3*60*60*24)),ke=parseFloat(((L=D==null?void 0:D.price)==null?void 0:L.total)||"299.99"),Ee=Ke.reduce((he,Pe)=>{const wt=Pe.perNight?Pe.price*Ct:Pe.price;return he+wt},0),Xe=ke+Ee;console.log("💰 Pricing breakdown:",{baseAmount:ke,addOnsAmount:Ee,totalAmount:Xe,currency:((re=D==null?void 0:D.price)==null?void 0:re.currency)||"USD"});const{data:_,error:M}=await Ie.functions.invoke("create-booking-payment",{body:{booking_type:"hotel",amount:Xe,currency:((Ve=D==null?void 0:D.price)==null?void 0:Ve.currency)||"USD",metadata:{hotelId:O,offerId:E,checkIn:R,checkOut:$,adults:se,children:ee,rooms:T,addons:oe,bedPref:I,note:H,baseAmount:ke,addOnsAmount:Ee,selectedAddOns:Ke}}});if(console.log("📋 Booking creation response:",{data:_,error:M}),M)throw ne.error("Booking creation error:",M),(Ye=M.message)!=null&&Ye.includes("STRIPE_SECRET_KEY")?c("Payment system configuration error. Our technical team has been notified. Please try again in a few minutes or contact support."):(Ge=M.message)!=null&&Ge.includes("Authentication")?c("Session expired. Please refresh the page and try again."):(He=M.message)!=null&&He.includes("network")||(Je=M.message)!=null&&Je.includes("fetch")?c("Network connectivity issue. Please check your internet connection and try again."):(De=M.message)!=null&&De.includes("rate limit")?c("Too many requests. Please wait a moment before trying again."):c(`Booking preparation failed: ${M.message||M}. Please refresh the page or try a different payment method.`),M;if(_!=null&&_.success&&_.clientSecret)console.log("✅ Booking created successfully with client secret"),b(_.clientSecret),a({booking_id:_.booking_id,total_amount:_.total_amount,currency:_.currency,amount_cents:_.amount_cents}),n({title:"Booking prepared",description:"Ready for payment"});else{const he=(_==null?void 0:_.error)||"Failed to create booking - no client secret received";throw console.log("❌ Booking creation failed:",_),c(he),new Error(he)}}catch(te){ne.error("Error creating booking:",te);const ce=te.message||"Failed to prepare booking";c(ce),n({title:"Booking error",description:ce,variant:"destructive"})}finally{k(!1)}})()},[O,E,R,$,se,ee,T,oe,I,H,n]);const J=Math.ceil((new Date($).getTime()-new Date(R).getTime())/(1e3*60*60*24)),le=se+ee,C=JSON.parse(sessionStorage.getItem("selectedOffer")||"{}"),pe=JSON.parse(sessionStorage.getItem("selectedAddOns")||"[]"),bt=new Date(R).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Nt=new Date($).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),_e=async()=>{if(!(!t||!r||!j)){f(!0);try{o&&sessionStorage.setItem("guestInfo",JSON.stringify(o));const{error:S}=await t.confirmPayment({elements:r,confirmParams:{return_url:`${window.location.origin}/booking-success?booking_id=${g==null?void 0:g.booking_id}&type=hotel`}});S&&(ne.error("Payment error:",S),n({title:"Payment failed",description:S.message,variant:"destructive"}))}catch(S){ne.error("Payment processing error:",S),n({title:"Payment error",description:"Failed to process payment",variant:"destructive"})}finally{f(!1)}}},Ue=p.useCallback(()=>{if(!(x||!t||!r)){if(!o||!l){n({title:"Complete guest details",description:"Please fill all required fields before continuing.",variant:"destructive"});const S=document.getElementById("guest-details");S&&typeof S.scrollIntoView=="function"&&S.scrollIntoView({behavior:"smooth",block:"start"});return}_e()}},[x,l,o,t,r,_e,n]),Me=!l||!o||x||!j||!!y,St=p.useCallback((S,L)=>{d(S),m(L)},[]);return e.jsx(Mt,{children:e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Re,{}),e.jsx("div",{className:"pt-24 pb-6 px-6 bg-gradient-to-b from-muted/30 to-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs(Y,{variant:"ghost",size:"sm",onClick:()=>window.history.back(),className:"mb-4",children:[e.jsx(Zt,{className:"h-4 w-4 mr-1"}),"Back to Room Selection"]}),e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Complete your ",e.jsx("span",{className:"hero-text",children:"Hotel Booking"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Enter guest details and confirm your reservation"}),e.jsx("div",{className:"mt-6",children:e.jsx(Es,{currentStep:3,totalSteps:4})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 pb-20",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{id:"guest-details",children:e.jsx(ks,{onChange:St})}),e.jsxs(G,{className:"travel-card",children:[e.jsx(ve,{children:e.jsx(ye,{children:"Payment Details"})}),e.jsxs(X,{className:"space-y-4",children:[y?e.jsxs(Te,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(Be,{children:y})]}):j?e.jsx(Cs,{}):h?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Preparing payment..."})]}):e.jsxs(Te,{children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(Be,{children:"Payment system not ready. Please refresh the page."})]}),g&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total Amount:"}),e.jsxs("span",{className:"font-bold text-lg",children:[g.currency," ",((g.total_amount||0)-u).toFixed(2)]})]}),u>0&&e.jsxs("div",{className:"flex justify-between items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Travel Fund Payment:"}),e.jsxs("span",{className:"text-green-600 font-medium",children:["-",g.currency," ",u.toFixed(2)]})]})]}),i.length>0&&e.jsxs(Y,{onClick:()=>B(!0),variant:"outline",className:"w-full border-orange-500 text-orange-600 hover:bg-orange-50",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Use Travel Funds"]})]}),e.jsx(Y,{onClick:Ue,className:"btn-primary h-12 w-full",size:"lg",disabled:Me,children:x?"Processing Payment...":"Pay Now"})]})]})]}),e.jsx("div",{children:e.jsx(G,{className:"travel-card sticky top-24",children:e.jsxs(X,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Hotel Booking Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Hotel Booking"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Offer ID: ",E]}),I&&I!=="any"&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Bed preference: ",I]}),H&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Special requests: ",H]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Check-in"}),e.jsx("p",{className:"font-medium",children:bt})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Check-out"}),e.jsx("p",{className:"font-medium",children:Nt})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Duration"}),e.jsxs("p",{className:"font-medium",children:[J," nights"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Guests"}),e.jsxs("p",{className:"font-medium",children:[le," ",le===1?"guest":"guests"]})]})]}),pe.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Selected Add-ons"}),pe.map(S=>{var L;return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[S.name," ",S.perNight?`(${J} nights)`:""]}),e.jsxs("span",{children:[((L=C==null?void 0:C.price)==null?void 0:L.currency)||"USD"," ",(S.price*(S.perNight?J:1)).toFixed(2)]})]},S.id)})]}),g&&e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[((qe=C==null?void 0:C.price)==null?void 0:qe.total)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Room Rate (",J," nights)"]}),e.jsxs("span",{children:[C.price.currency," ",parseFloat(C.price.total).toFixed(2)]})]}),pe.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Add-ons"}),e.jsxs("span",{children:[((ze=C==null?void 0:C.price)==null?void 0:ze.currency)||g.currency," ",pe.reduce((S,L)=>S+L.price*(L.perNight?J:1),0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[g.currency," ",(We=g.total_amount)==null?void 0:We.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg flex items-center space-x-2",children:[e.jsx(Qt,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Secure Payment"}),e.jsx("p",{className:"text-xs text-green-600",children:"256-bit SSL encryption"})]})]})]}),e.jsx(Y,{onClick:Ue,className:"w-full mt-6 btn-primary h-12",disabled:Me,children:x?"Processing Payment...":"Pay Now"})]})})})]})}),e.jsx(Ps,{bookingData:{destination:hotelName||"Hotel Booking",amount:(g==null?void 0:g.total_amount)||0,type:"hotel",dates:{checkIn:R,checkOut:$}},biddingData:{enabled:!1,currentBid:0,minimumBid:0,originalPrice:(g==null?void 0:g.total_amount)||0,timeRemaining:0,dealType:"negotiation"},open:P,onOpenChange:B,onPaymentMethodSelected:S=>{ie(S.fundUsage),N(S.fundUsage.reduce((L,re)=>L+re.amount,0)),B(!1),n({title:"Payment method updated",description:`Using $${S.fundUsage.reduce((L,re)=>L+re.amount,0)} from travel funds`})}})]})})}function Sr(){const[s,t]=p.useState(null),[r,n]=p.useState(null);p.useEffect(()=>{(async()=>{try{const m=await As();m?(t(m),console.log("✅ Stripe initialized successfully")):n("Failed to initialize payment system")}catch(m){console.error("Stripe initialization error:",m),n("Failed to load payment system")}})()},[]);const i=p.useMemo(()=>({appearance:{theme:"stripe"}}),[]);return r?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Re,{}),e.jsx("div",{className:"pt-24 px-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(Te,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsxs(Be,{children:[r,". Please refresh the page or contact support."]})]})})})]}):s?e.jsx(vt,{stripe:s,options:i,children:e.jsx(Os,{})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Re,{}),e.jsx("div",{className:"pt-24 px-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading payment system..."})]})})]})}export{Sr as default};
