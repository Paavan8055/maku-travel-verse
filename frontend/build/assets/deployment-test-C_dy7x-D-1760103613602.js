import{r as x,h as D,j as e,a as f,d as y,e as N,i as C,b as v,B as b,L as T,f as u,s as i,T as k,R}from"./index-cL9etfPl-1760103613602.js";import{C as S}from"./circle-x-Du27z8FZ-1760103613602.js";import{C as w}from"./circle-check-big-DrxdnNO6-1760103613602.js";import{C as E}from"./clock-DUxD1Emg-1760103613602.js";import{C as P}from"./circle-alert-dPOveVir-1760103613602.js";const A=()=>{const[l,c]=x.useState(!1),[a,h]=x.useState([]),{toast:o}=D(),p=async(s,t)=>{const m=Date.now();try{const r=await t(),n=Date.now()-m;return{name:s,status:"success",message:"Test passed",data:r,duration:n}}catch(r){const n=Date.now()-m;return{name:s,status:"error",message:r.message||"Test failed",data:r,duration:n}}},g=async()=>{c(!0),h([]);const s=[{name:"Deployment Validator",test:()=>i.functions.invoke("deployment-validator")},{name:"Critical Debug",test:()=>i.functions.invoke("critical-debug")},{name:"Provider Rotation",test:()=>i.functions.invoke("provider-rotation",{body:{searchType:"hotel",params:{destination:"sydney",checkIn:"2025-08-25",checkOut:"2025-08-26",guests:2,rooms:1,currency:"AUD"}}})},{name:"Health Check",test:()=>i.functions.invoke("health-check")},{name:"Provider Configs Query",test:async()=>{const{data:r,error:n}=await i.from("provider_configs").select("*").eq("enabled",!0);if(n)throw n;return r}}],t=[];for(const r of s){const n=await p(r.name,r.test);t.push(n),h([...t])}c(!1);const m=t.filter(r=>r.status==="error").length;m>0?o({title:"Diagnostics Complete",description:`${m} test(s) failed. Check results below.`,variant:"destructive"}):o({title:"All Tests Passed",description:"Deployment appears to be working correctly.",variant:"default"})},d=s=>{switch(s){case"success":return e.jsx(w,{className:"h-4 w-4 text-green-500"});case"error":return e.jsx(S,{className:"h-4 w-4 text-red-500"});case"warning":return e.jsx(k,{className:"h-4 w-4 text-yellow-500"});default:return null}},j=s=>{switch(s){case"success":return"bg-green-500/10 text-green-700 border-green-200";case"error":return"bg-red-500/10 text-red-700 border-red-200";case"warning":return"bg-yellow-500/10 text-yellow-700 border-yellow-200";default:return"bg-gray-500/10 text-gray-700 border-gray-200"}};return e.jsxs(f,{className:"w-full max-w-4xl",children:[e.jsxs(y,{children:[e.jsx(N,{children:"Deployment Diagnostics"}),e.jsx(C,{children:"Test Supabase Edge Functions and database connectivity to verify deployment status"})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsx(b,{onClick:g,disabled:l,className:"w-full",children:l?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Diagnostics..."]}):"Run Deployment Diagnostics"}),a.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Test Results"}),a.map((s,t)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d(s.status),e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.duration&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.duration,"ms"]}),e.jsx(u,{className:j(s.status),children:s.status})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.message}),s.data&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-muted-foreground hover:text-foreground",children:"View Response Data"}),e.jsx("pre",{className:"mt-2 p-2 bg-muted rounded text-xs overflow-auto max-h-40",children:JSON.stringify(s.data,null,2)})]})]},t))]})]})]})},F=()=>{const[l,c]=x.useState(!1),[a,h]=x.useState(null),[o,p]=x.useState(null),g=async()=>{c(!0),p(null);try{console.log("🧪 Running deployment validator...");const{data:s,error:t}=await i.functions.invoke("deployment-validator");if(t)throw new Error(t.message);h(s),console.log("✅ Deployment validation complete:",s)}catch(s){console.error("❌ Deployment test failed:",s),p(s.message||"Test failed")}finally{c(!1)}},d=s=>{switch(s){case"healthy":return"bg-green-500";case"degraded":return"bg-yellow-500";case"critical":case"error":return"bg-red-500";default:return"bg-gray-500"}},j=s=>{switch(s){case"healthy":return e.jsx(w,{className:"h-4 w-4"});case"error":case"critical":return e.jsx(P,{className:"h-4 w-4"});default:return e.jsx(E,{className:"h-4 w-4"})}};return e.jsxs(f,{children:[e.jsx(y,{children:e.jsxs(N,{className:"flex items-center justify-between",children:["Deployment Validation",e.jsx(b,{onClick:g,disabled:l,size:"sm",variant:"outline",children:l?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}),"Testing..."]}):"Run Test"})]})}),e.jsxs(v,{className:"space-y-4",children:[o&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-red-800 text-sm",children:o})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(u,{className:d(a.deployment.status),children:[j(a.deployment.status),e.jsx("span",{className:"ml-1",children:a.deployment.status})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(a.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Database"}),e.jsx(u,{variant:"outline",className:d(a.database.status),children:a.database.status})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Providers"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:["Total: ",a.providers.total]}),e.jsxs("p",{children:["Hotels: ",a.providers.hotel]}),e.jsxs("p",{children:["Enabled: ",a.providers.enabled]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Functions"}),e.jsx("div",{className:"space-y-1",children:Object.entries(a.functions).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:s}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{variant:"outline",className:d(t.status),children:t.status}),t.responseTime&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.responseTime,"ms"]})]})]},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"API Credentials"}),e.jsx("div",{className:"space-y-1",children:Object.entries(a.configurations.secrets).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:s}),e.jsx(u,{variant:"outline",className:t.configured&&t.hasValue?"bg-green-500":"bg-red-500",children:t.configured&&t.hasValue?"OK":"Missing"})]},s))})]})]})]})]})};function L(){return e.jsx("div",{className:"container mx-auto py-8 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Deployment Testing"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:"Use this page to test Supabase Edge Functions deployment and verify the system is working correctly."}),e.jsx(F,{}),e.jsx(A,{})]})})}export{L as default};
