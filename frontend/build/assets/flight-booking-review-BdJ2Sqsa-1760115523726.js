import{c as me,r as w,j as e,B as f,t as ee,a as H,d as R,e as W,b as O,f as xe,u as pe,k as je,h as fe,T as ge}from"./index-DQQjtSjM-1760115523726.js";import{P as ie,a as le,b as ce,N as ve}from"./Navbar-DmnRNmFi-1760115523726.js";import{u as ue,B as Ne}from"./use-currency-CJBZN00y-1760115523726.js";import{u as ye,t as be}from"./zod-Ovj5aO5f-1760115523726.js";import{I as E}from"./input-CXpAni8X-1760115523726.js";import{S as z,a as $,b as G,c as J,d as m}from"./select-Ce7qLWqS-1760115523726.js";import{F as we,a as g,b as v,c as N,d as y,e as b}from"./form-BmJNFoYs-1760115523726.js";import{C as de}from"./calendar-G-xD1-b5-1760115523726.js";import{C as ae}from"./calendar-DBg4Wl9r-1760115523726.js";import{o as Pe,e as Y,s as M,a as Ce,d as oe}from"./types-BekIk3NQ-1760115523726.js";import{f as U}from"./format-BW2ck5sV-1760115523726.js";import{C as se}from"./checkbox-D0pH12YE-1760115523726.js";import{S as Q}from"./separator-CgbFWVEq-1760115523726.js";import{C as Se}from"./circle-check-big-BC9Jh4yE-1760115523726.js";import{W as ke}from"./wifi-CYkOhXIn-1760115523726.js";import{S as Fe}from"./shield-R0yVNnqf-1760115523726.js";import{C as Ie}from"./car-CXH50t7f-1760115523726.js";import{H as Ae}from"./hotel-xhxYFwdR-1760115523726.js";import{M as De}from"./minus-a9j8R0NF-1760115523726.js";import{P as Te}from"./plus-UakSlhXw-1760115523726.js";import{u as Me}from"./useBookingPayment-DCnoQ5mh-1760115523726.js";import{C as Be}from"./credit-card-D6NkYFnh-1760115523726.js";import{P as re}from"./plane-B7gIkj3I-1760115523726.js";import{U as qe}from"./users-XTVR641H-1760115523726.js";import"./useApiHealth-CJts1VM3-1760115523726.js";import"./avatar-sp5_TXm2-1760115523726.js";import"./index-sb_C2OYH-1760115523726.js";import"./globe-CWRjv72A-1760115523726.js";import"./useHealthMonitor-C3kSmdGR-1760115523726.js";import"./useAIIntelligence-Cmi78WFC-1760115523726.js";import"./map-pin-DMax6vhW-1760115523726.js";import"./sparkles-Cg1wPKlX-1760115523726.js";import"./chevron-down-DptI0Tvw-1760115523726.js";import"./brain-hCtmJ5Ou-1760115523726.js";import"./zap-BxsNOfn6-1760115523726.js";import"./trophy-DcUNk98F-1760115523726.js";import"./settings-uh9Q_XHj-1760115523726.js";import"./user-C4f7Sjmt-1760115523726.js";import"./index-BdQq_4o_-1760115523726.js";import"./index-oS-Pyhyd-1760115523726.js";import"./label-opxJz_yY-1760115523726.js";import"./en-US-CC7XSppg-1760115523726.js";import"./endOfMonth-Dbhb-tb--1760115523726.js";import"./chevron-left-BSzSixJw-1760115523726.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=me("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=me("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]),Ue=Pe({firstName:M().min(2,"First name is required"),lastName:M().min(2,"Last name is required"),dateOfBirth:oe({required_error:"Date of birth is required"}),gender:Y(["M","F","X"]),title:Y(["Mr","Mrs","Ms","Miss","Dr"]),passportNumber:M().min(6,"Passport number is required"),passportExpiry:oe({required_error:"Passport expiry is required"}),nationality:M().min(2,"Nationality is required"),specialRequests:Ce(M()).optional(),frequentFlyerNumber:M().optional(),knownTravelerNumber:M().optional(),seatPreference:Y(["aisle","window","middle","none"]).optional(),mealPreference:Y(["standard","vegetarian","vegan","kosher","halal","gluten-free","none"]).optional()}),He=({passengerCount:P,onSubmit:C,onBack:a,initialData:B=[]})=>{const[j,p]=w.useState(Array.from({length:P},(r,t)=>B[t]||{})),[u,k]=w.useState(0),d=ye({resolver:be(Ue),defaultValues:j[u]||{}}),I=r=>{const t=[...j];t[u]=r,p(t),u<P-1?(k(u+1),d.reset(t[u+1]||{})):C(t)},F=r=>{const t=j[r];return t&&t.firstName&&t.lastName&&t.dateOfBirth};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:P},(r,t)=>e.jsxs(f,{variant:u===t?"default":"outline",size:"sm",onClick:()=>{k(t),d.reset(j[t]||{})},className:ee("relative",F(t)&&"ring-2 ring-green-500"),children:["Passenger ",t+1,F(t)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full"})]},t))}),e.jsxs(H,{children:[e.jsx(R,{children:e.jsxs(W,{children:["Passenger ",u+1," Details"]})}),e.jsx(O,{children:e.jsx(we,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(I),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(g,{control:d.control,name:"title",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"Title"}),e.jsxs(z,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(y,{children:e.jsx($,{children:e.jsx(G,{placeholder:"Select title"})})}),e.jsxs(J,{children:[e.jsx(m,{value:"Mr",children:"Mr"}),e.jsx(m,{value:"Mrs",children:"Mrs"}),e.jsx(m,{value:"Ms",children:"Ms"}),e.jsx(m,{value:"Miss",children:"Miss"}),e.jsx(m,{value:"Dr",children:"Dr"})]})]}),e.jsx(b,{})]})}),e.jsx(g,{control:d.control,name:"firstName",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"First Name"}),e.jsx(y,{children:e.jsx(E,{placeholder:"Enter first name",...r})}),e.jsx(b,{})]})}),e.jsx(g,{control:d.control,name:"lastName",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"Last Name"}),e.jsx(y,{children:e.jsx(E,{placeholder:"Enter last name",...r})}),e.jsx(b,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(g,{control:d.control,name:"dateOfBirth",render:({field:r})=>e.jsxs(v,{className:"flex flex-col",children:[e.jsx(N,{children:"Date of Birth"}),e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsx(y,{children:e.jsxs(f,{variant:"outline",className:ee("w-full pl-3 text-left font-normal",!r.value&&"text-muted-foreground"),children:[r.value?U(r.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(ae,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(ce,{className:"w-auto p-0",align:"start",children:e.jsx(de,{mode:"single",selected:r.value,onSelect:r.onChange,disabled:t=>t>new Date||t<new Date("1900-01-01"),initialFocus:!0,className:"pointer-events-auto"})})]}),e.jsx(b,{})]})}),e.jsx(g,{control:d.control,name:"gender",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"Gender"}),e.jsxs(z,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(y,{children:e.jsx($,{children:e.jsx(G,{placeholder:"Select gender"})})}),e.jsxs(J,{children:[e.jsx(m,{value:"M",children:"Male"}),e.jsx(m,{value:"F",children:"Female"}),e.jsx(m,{value:"X",children:"Other"})]})]}),e.jsx(b,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Passport Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(g,{control:d.control,name:"passportNumber",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"Passport Number"}),e.jsx(y,{children:e.jsx(E,{placeholder:"Enter passport number",...r})}),e.jsx(b,{})]})}),e.jsx(g,{control:d.control,name:"nationality",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"Nationality"}),e.jsx(y,{children:e.jsx(E,{placeholder:"Enter nationality",...r})}),e.jsx(b,{})]})}),e.jsx(g,{control:d.control,name:"passportExpiry",render:({field:r})=>e.jsxs(v,{className:"flex flex-col",children:[e.jsx(N,{children:"Passport Expiry"}),e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsx(y,{children:e.jsxs(f,{variant:"outline",className:ee("w-full pl-3 text-left font-normal",!r.value&&"text-muted-foreground"),children:[r.value?U(r.value,"PPP"):e.jsx("span",{children:"Pick expiry date"}),e.jsx(ae,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(ce,{className:"w-auto p-0",align:"start",children:e.jsx(de,{mode:"single",selected:r.value,onSelect:r.onChange,disabled:t=>t<new Date,initialFocus:!0,className:"pointer-events-auto"})})]}),e.jsx(b,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Travel Preferences"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(g,{control:d.control,name:"seatPreference",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"Seat Preference"}),e.jsxs(z,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(y,{children:e.jsx($,{children:e.jsx(G,{placeholder:"Select preference"})})}),e.jsxs(J,{children:[e.jsx(m,{value:"aisle",children:"Aisle"}),e.jsx(m,{value:"window",children:"Window"}),e.jsx(m,{value:"middle",children:"Middle"}),e.jsx(m,{value:"none",children:"No preference"})]})]}),e.jsx(b,{})]})}),e.jsx(g,{control:d.control,name:"mealPreference",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"Meal Preference"}),e.jsxs(z,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(y,{children:e.jsx($,{children:e.jsx(G,{placeholder:"Select meal preference"})})}),e.jsxs(J,{children:[e.jsx(m,{value:"standard",children:"Standard"}),e.jsx(m,{value:"vegetarian",children:"Vegetarian"}),e.jsx(m,{value:"vegan",children:"Vegan"}),e.jsx(m,{value:"kosher",children:"Kosher"}),e.jsx(m,{value:"halal",children:"Halal"}),e.jsx(m,{value:"gluten-free",children:"Gluten Free"}),e.jsx(m,{value:"none",children:"No preference"})]})]}),e.jsx(b,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(g,{control:d.control,name:"frequentFlyerNumber",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"Frequent Flyer Number (Optional)"}),e.jsx(y,{children:e.jsx(E,{placeholder:"Enter frequent flyer number",...r})}),e.jsx(b,{})]})}),e.jsx(g,{control:d.control,name:"knownTravelerNumber",render:({field:r})=>e.jsxs(v,{children:[e.jsx(N,{children:"Known Traveler Number (Optional)"}),e.jsx(y,{children:e.jsx(E,{placeholder:"Enter known traveler number",...r})}),e.jsx(b,{})]})})]})]}),e.jsxs("div",{className:"flex justify-between pt-6",children:[e.jsx(f,{type:"button",variant:"outline",onClick:a,children:"Back"}),e.jsx(f,{type:"submit",children:u<P-1?"Next Passenger":"Continue to Payment"})]})]})})})]})]})},K=[{id:"checked-bag",type:"baggage",name:"Checked Baggage",description:"Additional checked baggage allowance (23kg)",price:45,currency:"AUD",icon:e.jsx(Ve,{className:"w-5 h-5"}),passengerSpecific:!0,maxQuantity:3},{id:"extra-legroom",type:"seat",name:"Extra Legroom Seat",description:"Seats with additional legroom for comfort",price:89,currency:"AUD",icon:e.jsx(Se,{className:"w-5 h-5"}),passengerSpecific:!0},{id:"premium-meal",type:"meal",name:"Premium Meal",description:"Upgrade to premium dining experience",price:32,currency:"AUD",icon:e.jsx(Ee,{className:"w-5 h-5"}),passengerSpecific:!0,options:[{id:"beef",name:"Premium Beef",price:32},{id:"chicken",name:"Gourmet Chicken",price:28},{id:"vegetarian",name:"Vegetarian Deluxe",price:25},{id:"seafood",name:"Fresh Seafood",price:45}]},{id:"wifi",type:"wifi",name:"In-Flight WiFi",description:"High-speed internet access throughout the flight",price:18,currency:"AUD",icon:e.jsx(ke,{className:"w-5 h-5"}),options:[{id:"basic",name:"Basic (messaging)",price:12},{id:"standard",name:"Standard (browsing)",price:18},{id:"premium",name:"Premium (streaming)",price:28}]},{id:"travel-insurance",type:"insurance",name:"Travel Insurance",description:"Comprehensive travel protection coverage",price:85,currency:"AUD",icon:e.jsx(Fe,{className:"w-5 h-5"}),options:[{id:"basic",name:"Basic Coverage",price:65},{id:"comprehensive",name:"Comprehensive",price:85},{id:"premium",name:"Premium Plus",price:125}]},{id:"airport-transfer",type:"transfer",name:"Airport Transfer",description:"Private transfer from airport to hotel",price:45,currency:"AUD",icon:e.jsx(Ie,{className:"w-5 h-5"}),options:[{id:"shared",name:"Shared Shuttle",price:25},{id:"private",name:"Private Car",price:45},{id:"luxury",name:"Luxury Vehicle",price:95}]},{id:"lounge-access",type:"lounge",name:"Airport Lounge Access",description:"Premium lounge access with food and beverages",price:55,currency:"AUD",icon:e.jsx(Ae,{className:"w-5 h-5"}),passengerSpecific:!0}],Oe=({passengerCount:P,onSelectionChange:C,onContinue:a,onBack:B,initialSelection:j=[]})=>{const[p,u]=w.useState(j),{formatPrice:k}=ue(),d=s=>{u(s),C(s)},I=(s,i,n)=>{const o=p.findIndex(l=>l.serviceId===s&&l.passengerIndex===i&&l.optionId===n);if(o>=0){const l=p.filter((c,A)=>A!==o);d(l)}else{const l=[...p,{serviceId:s,passengerIndex:i,optionId:n,quantity:1}];d(l)}},F=(s,i,n,o)=>{const l=p.findIndex(c=>c.serviceId===s&&c.passengerIndex===i&&c.optionId===n);if(l>=0){const c=[...p],A=Math.max(0,c[l].quantity+o);if(A===0)c.splice(l,1);else{const L=K.find(_=>_.id===s),Z=(L==null?void 0:L.maxQuantity)||10;c[l].quantity=Math.min(A,Z)}d(c)}},r=(s,i,n)=>p.some(o=>o.serviceId===s&&o.passengerIndex===i&&o.optionId===n),t=(s,i,n)=>{const o=p.find(l=>l.serviceId===s&&l.passengerIndex===i&&l.optionId===n);return(o==null?void 0:o.quantity)||0},X=()=>p.reduce((s,i)=>{const n=K.find(l=>l.id===i.serviceId);if(!n)return s;let o=n.price;if(i.optionId&&n.options){const l=n.options.find(c=>c.id===i.optionId);o=(l==null?void 0:l.price)||n.price}return s+o*i.quantity},0),q=s=>e.jsxs(H,{className:"h-full",children:[e.jsx(R,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:s.icon}),e.jsxs("div",{children:[e.jsx(W,{className:"text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]})]}),e.jsx(xe,{variant:"secondary",children:k(s.price,s.currency)})]})}),e.jsx(O,{className:"space-y-4",children:s.options?e.jsx("div",{className:"space-y-3",children:s.options.map(i=>e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{checked:r(s.id,void 0,i.id),onCheckedChange:()=>I(s.id,void 0,i.id)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:k(i.price,s.currency)})]})]})},i.id))}):s.passengerSpecific?e.jsx("div",{className:"space-y-3",children:Array.from({length:P},(i,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{checked:r(s.id,n),onCheckedChange:()=>I(s.id,n)}),e.jsxs("span",{className:"font-medium",children:["Passenger ",n+1]})]}),s.maxQuantity&&s.maxQuantity>1&&r(s.id,n)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>F(s.id,n,void 0,-1),disabled:t(s.id,n)<=1,children:e.jsx(De,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-8 text-center",children:t(s.id,n)}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>F(s.id,n,void 0,1),disabled:t(s.id,n)>=s.maxQuantity,children:e.jsx(Te,{className:"w-3 h-3"})})]})]},n))}):e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{checked:r(s.id),onCheckedChange:()=>I(s.id)}),e.jsx("span",{className:"font-medium",children:"Add to booking"})]})})})]},s.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Enhance Your Journey"}),e.jsx("p",{className:"text-muted-foreground",children:"Add services to make your travel more comfortable and convenient."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:K.map(q)}),p.length>0&&e.jsxs(H,{children:[e.jsx(R,{children:e.jsx(W,{children:"Selected Services Summary"})}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-3",children:[p.map((s,i)=>{const n=K.find(c=>c.id===s.serviceId);if(!n)return null;let o=n.name,l=n.price;if(s.optionId&&n.options){const c=n.options.find(A=>A.id===s.optionId);o+=` (${c==null?void 0:c.name})`,l=(c==null?void 0:c.price)||n.price}return s.passengerIndex!==void 0&&(o+=` - Passenger ${s.passengerIndex+1}`),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:o}),s.quantity>1&&e.jsxs("span",{className:"text-muted-foreground",children:[" Ã— ",s.quantity]})]}),e.jsx("span",{className:"font-medium",children:k(l*s.quantity,n.currency)})]},i)}),e.jsx(Q,{}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold",children:[e.jsx("span",{children:"Total Add-ons:"}),e.jsx("span",{children:k(X(),"AUD")})]})]})})]}),e.jsxs("div",{className:"flex justify-between pt-6",children:[e.jsx(f,{variant:"outline",onClick:B,children:"Back"}),e.jsx(f,{onClick:a,children:"Continue to Payment"})]})]})},Le=["Review","Passengers","Services","Payment","Confirmation"],Qe=()=>{const[P,C]=w.useState(1),[a,B]=w.useState(null),[j,p]=w.useState([]),[u,k]=w.useState([]),[d,I]=w.useState(!1),[F,r]=w.useState(!1),[t,X]=w.useState(!1),q=pe();je();const{toast:s}=fe(),{formatPrice:i}=ue(),{createBookingPayment:n,isLoading:o}=Me();w.useEffect(()=>{const x=sessionStorage.getItem("selectedFlightOffer");if(x)try{const h=JSON.parse(x);B(h)}catch(h){console.error("Error parsing flight data:",h),s({title:"Error",description:"Failed to load flight information. Please start over.",variant:"destructive"}),q("/search/flights")}else s({title:"No flight selected",description:"Please select a flight first.",variant:"destructive"}),q("/search/flights")},[q,s]),w.useEffect(()=>{a&&P===1&&!F&&l()},[a,P,F]);const l=async()=>{if(a){I(!0);try{const h=await(await fetch("/api/verify-flight-price",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({flightOfferId:a.outbound.id,originalPrice:a.totalAmount})})).json();h.priceChanged&&(X(!0),B(S=>S?{...S,totalAmount:h.newPrice}:null),s({title:"Price Updated",description:`The flight price has changed to ${i(h.newPrice,a.currency)}`,variant:"default"})),r(!0)}catch(x){console.error("Price verification failed:",x),s({title:"Price Verification Failed",description:"Unable to verify current prices. Prices may have changed.",variant:"destructive"})}finally{I(!1)}}},c=()=>{if(!a)return 0;const x=a.totalAmount,h=u.reduce((S,D)=>S+D.quantity*50,0);return x+h},A=x=>{p(x),C(3)},L=x=>{k(x)},Z=async()=>{var x,h,S,D;if(a)try{const V={flightData:a,passengers:j,selectedServices:u,totalAmount:c()},T=await n({bookingType:"flight",bookingData:V,amount:c(),currency:a.currency,customerInfo:{email:(x=j[0])!=null&&x.firstName?`${j[0].firstName.toLowerCase()}@example.com`:"guest@example.com",firstName:((h=j[0])==null?void 0:h.firstName)||"Guest",lastName:((S=j[0])==null?void 0:S.lastName)||"User"},paymentMethod:"card"});if(T.success&&((D=T.payment)!=null&&D.checkoutUrl))window.location.href=T.payment.checkoutUrl;else throw new Error(T.error||"Payment setup failed")}catch(V){console.error("Payment error:",V),s({title:"Payment Error",description:"Failed to process payment. Please try again.",variant:"destructive"})}},_=()=>{var x,h,S,D,V,T,ne,te;return a?e.jsxs(H,{children:[e.jsx(R,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Flight Summary",t&&e.jsxs(xe,{variant:"secondary",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Price Updated"]})]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Outbound Flight"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:(x=a.outbound.departure)==null?void 0:x.iataCode}),e.jsx("div",{className:"text-sm text-muted-foreground",children:U(new Date((h=a.outbound.departure)==null?void 0:h.at),"HH:mm")})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center",children:[e.jsx("div",{className:"w-full border-t border-dashed"}),e.jsx(re,{className:"w-4 h-4 mx-2 text-muted-foreground"}),e.jsx("div",{className:"w-full border-t border-dashed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:(S=a.outbound.arrival)==null?void 0:S.iataCode}),e.jsx("div",{className:"text-sm text-muted-foreground",children:U(new Date((D=a.outbound.arrival)==null?void 0:D.at),"HH:mm")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Duration"}),e.jsx("div",{className:"font-medium",children:a.outbound.duration})]})]})]}),a.inbound&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Return Flight"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:(V=a.inbound.departure)==null?void 0:V.iataCode}),e.jsx("div",{className:"text-sm text-muted-foreground",children:U(new Date((T=a.inbound.departure)==null?void 0:T.at),"HH:mm")})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center",children:[e.jsx("div",{className:"w-full border-t border-dashed"}),e.jsx(re,{className:"w-4 h-4 mx-2 text-muted-foreground"}),e.jsx("div",{className:"w-full border-t border-dashed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:(ne=a.inbound.arrival)==null?void 0:ne.iataCode}),e.jsx("div",{className:"text-sm text-muted-foreground",children:U(new Date((te=a.inbound.arrival)==null?void 0:te.at),"HH:mm")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Duration"}),e.jsx("div",{className:"font-medium",children:a.inbound.duration})]})]})]})]}),e.jsx(Q,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[a.passengerCount," Passenger",a.passengerCount>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:a.tripType==="roundtrip"?"Round Trip":"One Way"})]})]}),e.jsx(Q,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Flight Total:"}),e.jsx("span",{className:"font-medium",children:i(a.totalAmount,a.currency)})]}),u.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Add-ons:"}),e.jsx("span",{className:"font-medium",children:i(c()-a.totalAmount,a.currency)})]}),e.jsx(Q,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{children:i(c(),a.currency)})]})]})]})]}):null},he=()=>{if(!a)return null;switch(P){case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Review Your Flight"}),e.jsx("p",{className:"text-muted-foreground",children:"Please review your flight details before proceeding."})]}),_(),d&&e.jsx(H,{children:e.jsx(O,{className:"py-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),e.jsx("span",{children:"Verifying current prices..."})]})})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(f,{variant:"outline",onClick:()=>q("/search/flights"),children:"Back to Search"}),e.jsx(f,{onClick:()=>C(2),disabled:d||!F,children:"Continue to Passenger Details"})]})]});case 2:return e.jsx(He,{passengerCount:a.passengerCount,onSubmit:A,onBack:()=>C(1),initialData:j});case 3:return e.jsx(Oe,{passengerCount:a.passengerCount,onSelectionChange:L,onContinue:()=>C(4),onBack:()=>C(2),initialSelection:u});case 4:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Payment"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your booking by processing payment."})]}),_(),e.jsxs(H,{children:[e.jsx(R,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Payment Method"]})}),e.jsxs(O,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"You will be redirected to our secure payment processor to complete your booking."}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(f,{variant:"outline",onClick:()=>C(3),children:"Back"}),e.jsx(f,{onClick:Z,disabled:o,className:"min-w-[120px]",children:o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):"Pay Now"})]})]})]})]});default:return null}};return a?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsx(Ne,{currentStep:P,steps:Le}),he()]}):e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})},Ms=()=>e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ve,{}),e.jsx("div",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsx(Qe,{})})]});export{Ms as default};
