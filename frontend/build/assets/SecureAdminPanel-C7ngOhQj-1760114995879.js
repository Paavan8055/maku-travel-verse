import{r as p,h as E,l as T,s as v,j as e,a as m,d as N,e as y,T as D,i as $,b as x,B as g,R as F,f as w,p as U,P as H,L as O}from"./index-C3qX88Wl-1760114995879.js";import{A as M}from"./AdminGuard-CGBKUYLX-1760114995879.js";import{P as B}from"./play-C55sz_x2-1760114995879.js";import{C as k}from"./circle-check-big-DleFGrZt-1760114995879.js";import{C as A}from"./circle-x-Fd8ZMMz5-1760114995879.js";import{S as R}from"./shield-Ky2PP539-1760114995879.js";import{T as L,a as V,b as C,c as P}from"./tabs-BSQse6Fc-1760114995879.js";import{D as W}from"./dollar-sign-B51DAtMh-1760114995879.js";import{U as Z}from"./users-l0KmxuX8-1760114995879.js";import{A as q}from"./activity-DPW3XwJV-1760114995879.js";import{T as G}from"./test-tube-D9VffRWZ-1760114995879.js";import{Z as X}from"./zap-BU_tdUO8-1760114995879.js";import{C as _}from"./clock-CMNr8sqo-1760114995879.js";const Y=()=>{const[s,n]=p.useState(!1),[l,u]=p.useState(null),{toast:h}=E();return{isRunning:s,report:l,runEmergencyFix:async()=>{var o,r;n(!0),u(null);try{T.info("ðŸš¨ Initiating emergency provider rotation fix..."),h({title:"Emergency Fix Started",description:"Attempting to repair provider rotation system...",variant:"default"});const{data:i,error:a}=await v.functions.invoke("emergency-provider-fix",{body:{}});if(a)throw new Error(a.message);const c=i;if(u(c),c.success){const b=(o=c.report)==null?void 0:o.summary;h({title:"Emergency Fix Completed âœ…",description:`${b==null?void 0:b.workingProviders}/${b==null?void 0:b.totalProviders} providers restored`,variant:"default"}),T.info("âœ… Emergency fix successful:",(r=c.report)==null?void 0:r.summary)}else h({title:"Emergency Fix Failed âŒ",description:c.error||"Unknown error occurred",variant:"destructive"}),T.error("âŒ Emergency fix failed:",c.error);return c}catch(i){const a=i instanceof Error?i.message:"Unknown error";T.error("Emergency fix error:",i);const c={success:!1,message:"Emergency fix failed",error:a};return u(c),h({title:"Emergency Fix Failed âŒ",description:a,variant:"destructive"}),c}finally{n(!1)}},testProviderRotation:async()=>{try{T.info("Testing provider rotation system...");const o={searchType:"hotel",params:{destination:"SYD",checkInDate:"2025-08-26",checkOutDate:"2025-08-27",adults:2,rooms:1}},{data:r,error:i}=await v.functions.invoke("provider-rotation",{body:o});if(i)return T.error("Provider rotation test failed:",i),!1;const a=(r==null?void 0:r.success)&&(r==null?void 0:r.provider)&&(r==null?void 0:r.data);return T.info("Provider rotation test result:",{success:a,provider:r==null?void 0:r.provider,hasData:!!(r!=null&&r.data)}),a}catch(o){return T.error("Provider rotation test error:",o),!1}}}},J=()=>{var o,r,i;const{isRunning:s,report:n,runEmergencyFix:l,testProviderRotation:u}=Y(),[h,f]=p.useState(!1),j=async()=>{f(!0),await u(),f(!1)};return e.jsxs(m,{className:"border-destructive/50 bg-destructive/5",children:[e.jsxs(N,{children:[e.jsxs(y,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(D,{className:"h-5 w-5"}),"Emergency Provider Rotation Fix"]}),e.jsx($,{children:"Critical system repair for provider rotation failures detected in audit"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{onClick:l,disabled:s,variant:"destructive",className:"flex items-center gap-2",children:[s?e.jsx(F,{className:"h-4 w-4 animate-spin"}):e.jsx(B,{className:"h-4 w-4"}),s?"Running Fix...":"Run Emergency Fix"]}),e.jsxs(g,{onClick:j,disabled:h||s,variant:"outline",className:"flex items-center gap-2",children:[h?e.jsx(F,{className:"h-4 w-4 animate-spin"}):e.jsx(k,{className:"h-4 w-4"}),h?"Testing...":"Test System"]})]}),n&&e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.success?e.jsx(k,{className:"h-5 w-5 text-success"}):e.jsx(A,{className:"h-5 w-5 text-destructive"}),e.jsx("span",{className:"font-medium",children:n.success?"Fix Completed Successfully":"Fix Failed"})]}),((o=n.report)==null?void 0:o.summary)&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Total Providers"}),e.jsx("div",{className:"text-2xl font-bold",children:n.report.summary.totalProviders})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Working Providers"}),e.jsx("div",{className:"text-2xl font-bold text-success",children:n.report.summary.workingProviders})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Failed Tests"}),e.jsx("div",{className:"text-2xl font-bold text-destructive",children:n.report.summary.failedTests})]})]}),((r=n.report)==null?void 0:r.testResults)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium text-sm",children:"Test Results:"}),n.report.testResults.map((a,c)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.success?e.jsx(k,{className:"h-4 w-4 text-success"}):e.jsx(A,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"capitalize",children:a.searchType}),a.provider&&e.jsx(w,{variant:"outline",className:"text-xs",children:a.provider}),a.error&&e.jsx("span",{className:"text-destructive text-xs",children:a.error})]},c))]}),((i=n.report)==null?void 0:i.enabledProviders)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium text-sm",children:"Enabled Providers:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:n.report.enabledProviders.map(a=>e.jsx(w,{variant:"secondary",className:"text-xs",children:a},a))})]}),n.error&&e.jsxs("div",{className:"text-sm text-destructive bg-destructive/10 p-2 rounded",children:["Error: ",n.error]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground border-t pt-3",children:[e.jsx("p",{children:e.jsx("strong",{children:"What this does:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 mt-1",children:[e.jsx("li",{children:"Validates all provider credentials"}),e.jsx("li",{children:"Resets quota limits that may be blocking requests"}),e.jsx("li",{children:"Re-enables working provider configurations"}),e.jsx("li",{children:"Tests each service type (hotels, flights, activities)"}),e.jsx("li",{children:"Creates alerts for manual intervention if needed"})]})]})]})]})},K=()=>{var o;const[s,n]=p.useState(!1),[l,u]=p.useState(null),{toast:h}=E(),f=async()=>{n(!0);try{const{data:r,error:i}=await v.functions.invoke("security-hardening",{body:{action:"audit"}});if(i)throw i;u(r),h({title:"Security Audit Complete",description:`Security score: ${r.overallScore}% (${r.securityLevel})`,variant:r.overallScore>80?"default":"destructive"})}catch(r){h({title:"Security Audit Failed",description:r.message,variant:"destructive"})}finally{n(!1)}},j=async()=>{n(!0);try{const{data:r,error:i}=await v.functions.invoke("comprehensive-testing-suite",{body:{testTypes:["all"]}});if(i)throw i;h({title:"System Tests Complete",description:`Overall score: ${r.overallScore}% (${r.summary.passed}/${r.summary.total} passed)`,variant:r.overallScore>80?"default":"destructive"})}catch(r){h({title:"System Tests Failed",description:r.message,variant:"destructive"})}finally{n(!1)}};return e.jsxs(m,{className:"w-full",children:[e.jsxs(N,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"System Hardening & Testing"]}),e.jsx($,{children:"Comprehensive security audit and system testing suite"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{onClick:f,disabled:s,variant:"outline",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),s?"Running...":"Security Audit"]}),e.jsxs(g,{onClick:j,disabled:s,variant:"outline",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),s?"Testing...":"Full Test Suite"]})]}),l&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Security Score"}),e.jsxs(w,{variant:l.overallScore>80?"default":"destructive",children:[l.overallScore,"% (",l.securityLevel,")"]})]}),e.jsx("div",{className:"space-y-2",children:(o=l.checks)==null?void 0:o.slice(0,5).map((r,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-secondary rounded",children:[e.jsx("span",{className:"text-sm",children:r.description}),r.status==="passed"?e.jsx(k,{className:"h-4 w-4 text-green-500"}):r.status==="warning"?e.jsx(D,{className:"h-4 w-4 text-yellow-500"}):e.jsx(A,{className:"h-4 w-4 text-red-500"})]},i))}),l.recommendations&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-medium text-sm",children:"Recommendations:"}),l.recommendations.slice(0,3).map((r,i)=>e.jsxs("div",{className:"text-xs text-muted-foreground",children:["â€¢ ",r]},i))]})]})]})]})},Q=()=>{var b;const[s,n]=p.useState(null),[l,u]=p.useState(null),[h,f]=p.useState(!0),[j,o]=p.useState(!1),{toast:r}=E();p.useEffect(()=>{i()},[]);const i=async()=>{try{const{data:{session:t}}=await v.auth.getSession();if(!t){r({title:"Authentication Required",description:"Please log in to access the admin dashboard",variant:"destructive"});return}const{data:d,error:S}=await v.rpc("get_admin_status");if(S||!d){r({title:"Access Denied",description:"Admin privileges required to access this dashboard",variant:"destructive"});return}o(!0),await a()}catch(t){console.error("Admin access check failed:",t),r({title:"Error",description:"Failed to verify admin access",variant:"destructive"})}},a=async()=>{try{f(!0);const{data:{session:t}}=await v.auth.getSession();if(!t)return;const{data:d,error:S}=await v.functions.invoke("secure-admin-dashboard",{body:{action:"get_metrics"},headers:{Authorization:`Bearer ${t.access_token}`}}),{data:z,error:I}=await v.functions.invoke("secure-admin-dashboard",{body:{action:"get_provider_health"},headers:{Authorization:`Bearer ${t.access_token}`}});S?(console.error("Failed to load metrics:",S),r({title:"Error",description:"Failed to load dashboard metrics",variant:"destructive"})):n(d),I?console.error("Failed to load provider health:",I):u(z)}catch(t){console.error("Dashboard loading error:",t),r({title:"Error",description:"Failed to load dashboard data",variant:"destructive"})}finally{f(!1)}},c=()=>{a(),r({title:"Dashboard Refreshed",description:"All data has been updated"})};return j?h?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Admin Dashboard"}),e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[...Array(4)].map((t,d)=>e.jsx(m,{className:"animate-pulse",children:e.jsxs(x,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-8 bg-muted rounded w-1/2"})]})},d))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(R,{className:"h-6 w-6"}),"Secure Admin Dashboard"]}),e.jsxs(g,{onClick:c,variant:"outline",size:"sm",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(m,{children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Bookings"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.bookings.total)||0})]}),e.jsx(U,{className:"h-8 w-8 text-primary"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[(s==null?void 0:s.bookings.today)||0," today"]})]})}),e.jsx(m,{children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",(((s==null?void 0:s.bookings.revenue)||0)/100).toFixed(2)]})]}),e.jsx(W,{className:"h-8 w-8 text-green-600"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Total confirmed bookings"})]})}),e.jsx(m,{children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.users.total)||0})]}),e.jsx(Z,{className:"h-8 w-8 text-blue-600"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[(s==null?void 0:s.users.newToday)||0," new today"]})]})}),e.jsx(m,{children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"System Health"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"98%"})]}),e.jsx(q,{className:"h-8 w-8 text-green-600"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"All systems operational"})]})})]}),e.jsxs(L,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(V,{children:[e.jsx(C,{value:"overview",children:"Overview"}),e.jsx(C,{value:"providers",children:"Provider Health"}),e.jsx(C,{value:"bookings",children:"Booking Status"}),e.jsx(C,{value:"analytics",children:"Analytics"})]}),e.jsx(P,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsx(N,{children:e.jsx(y,{children:"Recent Activity"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"New booking created"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"2 min ago"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Payment processed"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"5 min ago"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"User registered"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"12 min ago"})]})]})})]}),e.jsxs(m,{children:[e.jsx(N,{children:e.jsx(y,{children:"System Alerts"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"outline",className:"text-green-600",children:"INFO"}),e.jsx("span",{className:"text-sm",children:"All providers operational"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"outline",className:"text-blue-600",children:"INFO"}),e.jsx("span",{className:"text-sm",children:"Database backup completed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"outline",className:"text-yellow-600",children:"WARN"}),e.jsx("span",{className:"text-sm",children:"High API usage detected"})]})]})})]})]})}),e.jsx(P,{value:"providers",className:"space-y-4",children:e.jsxs(m,{children:[e.jsx(N,{children:e.jsx(y,{children:"Provider Health Status"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:((b=l==null?void 0:l.providers)==null?void 0:b.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.status==="healthy"?"bg-green-500":t.status==="degraded"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.provider_id.toUpperCase()}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Response: ",t.response_time,"ms | Success: ",t.success_rate,"%"]})]})]}),e.jsx(w,{variant:t.status==="healthy"?"default":"destructive",children:t.status})]},t.provider_id)))||e.jsx("p",{className:"text-muted-foreground",children:"No provider health data available"})})})]})}),e.jsx(P,{value:"bookings",className:"space-y-4",children:e.jsxs(m,{children:[e.jsx(N,{children:e.jsx(y,{children:"Booking Status Distribution"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:(s==null?void 0:s.bookings.byStatus)&&Object.entries(s.bookings.byStatus).map(([t,d])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm capitalize",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${d/((s==null?void 0:s.bookings.total)||1)*100}%`}})}),e.jsx("span",{className:"text-sm font-medium w-8",children:d})]})]},t))})})]})}),e.jsx(P,{value:"analytics",className:"space-y-4",children:e.jsxs(m,{children:[e.jsx(N,{children:e.jsx(y,{children:"Performance Analytics"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"96.5%"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Uptime"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"1.2s"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Response"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"8.4%"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Conversion Rate"})]})]})})]})})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs(m,{className:"w-full max-w-md",children:[e.jsxs(N,{className:"text-center",children:[e.jsx(R,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),e.jsx(y,{children:"Access Restricted"})]}),e.jsxs(x,{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"This dashboard requires administrator privileges"}),e.jsx(g,{onClick:i,variant:"outline",children:"Retry Access Check"})]})]})})},ee=()=>{const[s,n]=p.useState(null),[l,u]=p.useState(!1),[h,f]=p.useState("all"),{toast:j}=E(),o=async t=>{try{u(!0),f(t);const{data:d,error:S}=await v.functions.invoke("comprehensive-testing-framework",{body:{action:"run_tests",test_type:t}});S?(console.error("Test execution failed:",S),j({title:"Test Execution Failed",description:"Unable to run the test suite",variant:"destructive"})):(n(d),j({title:"Tests Completed",description:`${t.toUpperCase()} tests finished with ${d.pass_rate.toFixed(1)}% pass rate`,variant:d.pass_rate>=80?"default":"destructive"}))}catch(d){console.error("Testing error:",d),j({title:"Error",description:"An unexpected error occurred during testing",variant:"destructive"})}finally{u(!1)}},r=async()=>{try{u(!0);const{data:t,error:d}=await v.functions.invoke("comprehensive-testing-framework",{body:{action:"validate_booking_flow"}});d?(console.error("Booking validation failed:",d),j({title:"Validation Failed",description:"Booking flow validation encountered errors",variant:"destructive"})):j({title:"Booking Flow Validated",description:"All booking flow steps verified successfully"})}catch(t){console.error("Validation error:",t)}finally{u(!1)}},i=async()=>{try{u(!0);const{data:t,error:d}=await v.functions.invoke("comprehensive-testing-framework",{body:{action:"test_provider_integrations"}});d?(console.error("Provider testing failed:",d),j({title:"Provider Tests Failed",description:"Some provider integrations are not responding correctly",variant:"destructive"})):j({title:"Provider Tests Complete",description:"All provider integrations tested successfully"})}catch(t){console.error("Provider testing error:",t)}finally{u(!1)}},a=async()=>{try{u(!0);const{data:t,error:d}=await v.functions.invoke("comprehensive-testing-framework",{body:{action:"stress_test"}});d?(console.error("Stress test failed:",d),j({title:"Stress Test Failed",description:"System performance issues detected under load",variant:"destructive"})):j({title:"Stress Test Complete",description:`System handled ${t.concurrent_users} concurrent users successfully`})}catch(t){console.error("Stress testing error:",t)}finally{u(!1)}},c=t=>{switch(t){case"passed":return e.jsx(k,{className:"h-4 w-4 text-green-600"});case"failed":return e.jsx(A,{className:"h-4 w-4 text-red-600"});case"skipped":return e.jsx(_,{className:"h-4 w-4 text-yellow-600"});default:return e.jsx(_,{className:"h-4 w-4 text-gray-400"})}},b=t=>{switch(t){case"passed":return"text-green-600";case"failed":return"text-red-600";case"skipped":return"text-yellow-600";default:return"text-gray-400"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(N,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Comprehensive Testing Framework"]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(g,{onClick:()=>o("api"),disabled:l,variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(q,{className:"h-6 w-6"}),"API Tests"]}),e.jsxs(g,{onClick:()=>o("booking"),disabled:l,variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(k,{className:"h-6 w-6"}),"Booking Tests"]}),e.jsxs(g,{onClick:()=>o("integration"),disabled:l,variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(R,{className:"h-6 w-6"}),"Integration Tests"]}),e.jsxs(g,{onClick:()=>o("performance"),disabled:l,variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(X,{className:"h-6 w-6"}),"Performance Tests"]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(g,{onClick:r,disabled:l,variant:"secondary",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Validate Booking Flow"]}),e.jsxs(g,{onClick:i,disabled:l,variant:"secondary",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Test Providers"]}),e.jsxs(g,{onClick:a,disabled:l,variant:"secondary",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Stress Test"]})]})]})]}),l&&e.jsx(m,{children:e.jsx(x,{className:"py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsxs("p",{className:"text-lg font-medium",children:["Running ",h.toUpperCase()," Tests..."]}),e.jsx("p",{className:"text-muted-foreground",children:"This may take a few moments"})]})})}),s&&e.jsxs(m,{children:[e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{children:s.name}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(w,{variant:s.pass_rate>=80?"default":"destructive",children:[s.pass_rate.toFixed(1),"% Pass Rate"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.total_duration,"ms total"]})]})]}),e.jsx(H,{value:s.pass_rate,className:"w-full"})]}),e.jsx(x,{children:e.jsxs(L,{defaultValue:"results",className:"w-full",children:[e.jsxs(V,{children:[e.jsx(C,{value:"results",children:"Test Results"}),e.jsx(C,{value:"summary",children:"Summary"})]}),e.jsx(P,{value:"results",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:s.tests.map((t,d)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c(t.status),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.test_name}),t.error&&e.jsx("p",{className:"text-sm text-red-600",children:t.error})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(w,{variant:"outline",className:b(t.status),children:t.status}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.duration_ms,"ms"]})]})]},d))})}),e.jsxs(P,{value:"summary",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(m,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx(k,{className:"h-8 w-8 mx-auto text-green-600 mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:s.tests.filter(t=>t.status==="passed").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Passed"})]})}),e.jsx(m,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx(A,{className:"h-8 w-8 mx-auto text-red-600 mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:s.tests.filter(t=>t.status==="failed").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Failed"})]})}),e.jsx(m,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx(_,{className:"h-8 w-8 mx-auto text-yellow-600 mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:s.tests.filter(t=>t.status==="skipped").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Skipped"})]})})]}),e.jsx(m,{children:e.jsxs(x,{className:"p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Performance Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Duration:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[s.total_duration,"ms"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Average Test Time:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[Math.round(s.total_duration/s.tests.length),"ms"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Success Rate:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[s.pass_rate.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Tests:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.tests.length})]})]})]})})]})]})})]})]})},se=()=>{var r,i;const[s,n]=p.useState(null),[l,u]=p.useState(!1),[h,f]=p.useState(null),j=async()=>{u(!0),f(null),n(null);try{const{data:a,error:c}=await v.functions.invoke("debug-sabre-credentials",{body:{}});if(c)throw new Error(c.message);n(a)}catch(a){f(a instanceof Error?a.message:"Unknown error occurred")}finally{u(!1)}},o=a=>a?e.jsx(k,{className:"h-5 w-5 text-green-500"}):e.jsx(A,{className:"h-5 w-5 text-red-500"});return e.jsxs(m,{className:"w-full",children:[e.jsx(N,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Sabre Authentication Debug Panel"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(g,{onClick:j,disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}),"Testing..."]}):"Run Sabre Debug Test"})}),h&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Error:"}),e.jsx("p",{className:"text-red-600",children:h})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Environment Variables"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 text-sm",children:Object.entries(s.environment).map(([a,c])=>e.jsxs("div",{className:"flex items-center gap-2",children:[o(c.exists),e.jsx("span",{className:"font-mono",children:a}),e.jsx("span",{className:"text-gray-500",children:c.exists?`${c.length||0} chars`:"Missing"})]},a))})]}),s.pccTests&&s.pccTests.length>0&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-green-900 mb-2",children:"PCC Authentication Tests"}),e.jsx("div",{className:"space-y-3",children:s.pccTests.map((a,c)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded border",children:[o(a.success),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium",children:[a.type.toUpperCase()," PCC: ",a.pcc]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",a.status," - ",a.statusText]}),a.success&&e.jsx("p",{className:"text-sm text-green-600",children:"âœ… Token received successfully"}),!a.success&&a.error&&e.jsxs("p",{className:"text-sm text-red-600",children:["âŒ ",a.error]})]})]},c))})]}),s.authTest&&e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-yellow-900 mb-2",children:"Legacy Authentication Test"}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white rounded border",children:[o(s.authTest.success),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Without PCC"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",s.authTest.status," - ",s.authTest.statusText]}),!s.authTest.success&&s.authTest.error&&e.jsxs("p",{className:"text-sm text-red-600",children:["âŒ ",s.authTest.error]})]})]})]}),s.recommendations&&e.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-purple-900 mb-2",children:"Recommendations"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[((r=s.recommendations.workingEnvironments)==null?void 0:r.length)>0&&e.jsxs("p",{className:"text-green-700",children:["âœ… Working environments: ",s.recommendations.workingEnvironments.join(", ")]}),((i=s.recommendations.missingCredentials)==null?void 0:i.length)>0&&e.jsxs("p",{className:"text-red-700",children:["âŒ Missing credentials: ",s.recommendations.missingCredentials.join(", ")]}),s.recommendations.requiresPCC&&e.jsx("p",{className:"text-orange-700",children:"âš ï¸ PCC codes are required for Sabre authentication"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Test completed at: ",new Date(s.timestamp).toLocaleString()]})]})]})]})},je=()=>e.jsx(M,{redirectTo:"/",children:e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"bg-destructive/5 border-y border-destructive/20 py-6",children:e.jsx("div",{className:"max-w-6xl mx-auto px-6 space-y-6",children:e.jsxs(m,{children:[e.jsxs(N,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Admin Control Panel"]}),e.jsx($,{children:"Emergency fixes and system administration tools"})]}),e.jsxs(x,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(J,{}),e.jsx(K,{})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Q,{}),e.jsx(ee,{})]}),e.jsx("div",{className:"w-full",children:e.jsx(se,{})})]})]})})})})});export{je as SecureAdminPanel};
