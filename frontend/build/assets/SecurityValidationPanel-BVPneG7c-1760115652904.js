import{r as o,h as z,j as e,a as p,d as v,e as N,i as y,b as _,P as w,B as C,f as A,s as b,T as S}from"./index-DCRQEUcE-1760115652904.js";import{S as L}from"./shield-BL4n2Pad-1760115652904.js";import{P as M}from"./play-BXHQmzRr-1760115652904.js";import{Z as O}from"./zap-B9rCeUv_-1760115652904.js";import{C as V}from"./clock-d4DfbCUF-1760115652904.js";import{C as Z}from"./circle-x-DmxjwOS_-1760115652904.js";import{C as D}from"./circle-check-big-CbK-34Yn-1760115652904.js";const Q=()=>{const[i,T]=o.useState([]),[u,m]=o.useState(!1),[d,h]=o.useState(new Set),{toast:x}=z(),f=async()=>{try{const{data:s,error:t}=await b.from("system_validation_tests").select("*").order("test_category",{ascending:!0});if(t)throw t;T(s||[])}catch(s){console.error("Error fetching tests:",s),x({title:"Failed to Load Tests",description:"Could not load validation tests",variant:"destructive"})}};o.useEffect(()=>{f()},[]);const g=async s=>{h(t=>new Set(t).add(s));try{const{data:t,error:a}=await b.rpc("run_validation_test",{p_test_id:s});if(a)throw a;x({title:"Test Completed",description:"Test completed",variant:"default"}),await f()}catch(t){console.error("Error running test:",t),x({title:"Test Failed",description:"Failed to execute test",variant:"destructive"})}finally{h(t=>{const a=new Set(t);return a.delete(s),a})}},P=async s=>{const t=i.filter(a=>a.test_category===s);m(!0);try{for(const a of t)await g(a.id)}finally{m(!1)}},R=s=>{switch(s){case"passed":return e.jsx(D,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(Z,{className:"h-4 w-4 text-red-500"});case"running":return e.jsx(V,{className:"h-4 w-4 text-blue-500 animate-spin"});case"skipped":return e.jsx(S,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(S,{className:"h-4 w-4 text-gray-500"})}},k=s=>{switch(s){case"passed":return"default";case"failed":return"destructive";case"running":return"secondary";default:return"outline"}},B=i.reduce((s,t)=>(s[t.test_category]||(s[t.test_category]=[]),s[t.test_category].push(t),s),{}),E=s=>{const t=s.length,a=s.filter(l=>l.test_status==="passed").length,c=s.filter(l=>l.test_status==="failed").length,n=s.filter(l=>l.test_status==="pending").length,F=s.filter(l=>l.test_status==="running").length;return{total:t,passed:a,failed:c,pending:n,running:F}},r={total:i.length,passed:i.filter(s=>s.test_status==="passed").length,failed:i.filter(s=>s.test_status==="failed").length,pending:i.filter(s=>s.test_status==="pending").length,running:i.filter(s=>s.test_status==="running").length},j=r.total>0?(r.passed+r.failed)/r.total*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsxs(v,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"System Validation & Testing Suite"]}),e.jsx(y,{children:"Comprehensive security and functionality validation for production readiness"})]}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:r.total}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Tests"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.passed}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Passed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.failed}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Failed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.running}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Running"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:r.pending}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pending"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Overall Progress"}),e.jsxs("span",{children:[Math.round(j),"%"]})]}),e.jsx(w,{value:j,className:"h-2"})]})]})})]}),Object.entries(B).map(([s,t])=>{const a=E(t),c=a.total>0?(a.passed+a.failed)/a.total*100:0;return e.jsxs(p,{children:[e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"capitalize",children:[s.replace("_"," ")," Tests"]}),e.jsxs(y,{children:[a.passed,"/",a.total," tests passed"]})]}),e.jsxs(C,{onClick:()=>P(s),disabled:u||a.running>0,variant:"outline",size:"sm",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Run All"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round(c),"%"]})]}),e.jsx(w,{value:c,className:"h-1"})]})]}),e.jsx(_,{children:e.jsx("div",{className:"space-y-3",children:t.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[R(d.has(n.id)?"running":n.test_status),e.jsx("span",{className:"font-medium",children:n.test_name.replace("_"," ")}),e.jsx(A,{variant:k(n.test_status),children:d.has(n.id)?"running":n.test_status})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n.test_description}),n.execution_time_ms&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-muted-foreground",children:[e.jsx(O,{className:"h-3 w-3"}),n.execution_time_ms,"ms"]})]}),e.jsx(C,{onClick:()=>g(n.id),disabled:d.has(n.id)||u,variant:"ghost",size:"sm",children:d.has(n.id)?"Running...":"Run Test"})]},n.id))})})]},s)})]})};export{Q as SecurityValidationPanel};
