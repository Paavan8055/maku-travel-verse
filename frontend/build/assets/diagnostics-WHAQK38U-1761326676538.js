import{r as j,j as e,d as h,f as x,g as u,i as v,e as g,B as N,a as d,s as y,w as I,h as F,T as R}from"./index-DqGZ8t5e-1761326676538.js";import{A as P}from"./AdminGuard-C_3J7kQL-1761326676538.js";import{T as M,a as O,b as w,c as T}from"./tabs-nrWL1gVf-1761326676538.js";import{S as B}from"./separator-wTyn9BK9-1761326676538.js";import{C as A}from"./credit-card-Romc88iU-1761326676538.js";import{M as D}from"./map-pin-qlXifRZs-1761326676538.js";import{C as E}from"./calendar-CL2YOCTx-1761326676538.js";import{U as C}from"./users-Cryeq6Pw-1761326676538.js";import{u as U}from"./useHealthMonitor-FMCjsxDd-1761326676538.js";import{M as _}from"./monitor-Dq532RxD-1761326676538.js";import{A as L}from"./activity-vR8JaOKB-1761326676538.js";import{T as H}from"./test-tube-BZ3vXcKR-1761326676538.js";import{S as $}from"./settings-WM63zvrn-1761326676538.js";const K=()=>{const[o,m]=j.useState(!1),[s,p]=j.useState(null),S=async()=>{m(!0),p(null);try{const{data:i,error:r}=await y.functions.invoke("critical-debug");if(r)throw new Error(`Debug function error: ${r.message}`);let f="Not tested";try{const{data:n,error:t}=await y.functions.invoke("amadeus-hotel-offers",{body:{hotelId:"RTPAR001",checkIn:"2025-12-01",checkOut:"2025-12-02",adults:2,rooms:1,currency:"USD"}});f=t?`ERROR: ${t.message}`:"SUCCESS"}catch(n){f=`FAILED: ${n instanceof Error?n.message:"Unknown error"}`}let l="Not tested";try{const{data:n,error:t}=await y.functions.invoke("provider-rotation",{body:{searchType:"flight",params:{originLocationCode:"SYD",destinationLocationCode:"MEL",departureDate:"2025-12-01",passengers:1}}});l=t?`ERROR: ${t.message}`:"SUCCESS"}catch(n){l=`FAILED: ${n instanceof Error?n.message:"Unknown error"}`}let b="Not tested";try{const{data:n,error:t}=await y.functions.invoke("hotelbeds-activities",{body:{destination:"Sydney",language:"en"}});b=t?`ERROR: ${t.message}`:"SUCCESS"}catch(n){b=`FAILED: ${n instanceof Error?n.message:"Unknown error"}`}p({debug:i,tests:{hotel_offers:f,flight_search:l,activities:b}}),I.success("Diagnostics completed")}catch(i){I.error(`Diagnostics failed: ${i instanceof Error?i.message:"Unknown error"}`),p({error:i instanceof Error?i.message:"Unknown error"})}finally{m(!1)}};return e.jsxs(h,{className:"max-w-4xl mx-auto",children:[e.jsxs(x,{children:[e.jsx(u,{children:"Production Diagnostics"}),e.jsx(v,{children:"Test edge function deployment and API connectivity"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsx(N,{onClick:S,disabled:o,className:"w-full",children:o?"Running Diagnostics...":"Run Full Diagnostics"}),s&&e.jsx("div",{className:"space-y-4",children:s.error?e.jsxs("div",{className:"p-4 border border-red-200 rounded-lg bg-red-50",children:[e.jsx("h3",{className:"font-semibold text-red-800",children:"Critical Error"}),e.jsx("p",{className:"text-red-600",children:s.error})]}):e.jsxs(e.Fragment,{children:[s.debug&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Edge Function Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(d,{variant:s.debug.success?"default":"destructive",children:["Debug Function: ",s.debug.success?"Working":"Failed"]}),e.jsx(d,{variant:"outline",children:s.debug.deployment_status})]}),s.debug.environment_status&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Environment Variables"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 text-xs",children:Object.entries(s.debug.environment_status).map(([i,r])=>e.jsxs(d,{variant:r==="Present"?"default":"destructive",className:"text-xs",children:[i,": ",r]},i))})]}),s.debug.amadeus_api_test&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Amadeus API Test: "}),e.jsx(d,{variant:s.debug.amadeus_api_test==="SUCCESS"?"default":"destructive",children:s.debug.amadeus_api_test})]})]}),s.tests&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"API Function Tests"}),e.jsx("div",{className:"space-y-1",children:Object.entries(s.tests).map(([i,r])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm capitalize",children:i.replace("_"," ")}),e.jsx(d,{variant:r==="SUCCESS"?"default":"destructive",children:r})]},i))})]}),s.debug&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:"Raw Debug Data"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded overflow-auto",children:JSON.stringify(s.debug,null,2)})]})]})})]})]})};function z(){const[o,m]=j.useState(!1),[s,p]=j.useState(!1),[S,i]=j.useState(null),[r,f]=j.useState(null),{toast:l}=F(),b=async()=>{m(!0);try{console.log("ðŸ” Testing Stripe publishable key retrieval...");const t=Date.now(),{data:a,error:c}=await y.functions.invoke("get-stripe-publishable-key"),k=Date.now()-t;console.log("Stripe key test result:",{data:a,error:c,responseTime:k}),i({data:a,error:c,responseTime:k,timestamp:new Date().toISOString()}),c?l({title:"Stripe Key Test Failed",description:c.message||"Unknown error",variant:"destructive"}):a!=null&&a.publishable_key?l({title:"âœ… Stripe Key Test Success",description:`Key retrieved in ${k}ms`}):l({title:"Stripe Key Test Issue",description:"No key in response",variant:"destructive"})}catch(t){console.error("Stripe key test error:",t),i({error:t.message||t,timestamp:new Date().toISOString()}),l({title:"Stripe Key Test Error",description:t.message||"Network error",variant:"destructive"})}finally{m(!1)}},n=async()=>{p(!0);try{console.log("ðŸ” Testing hotel booking creation...");const t={hotelId:"TEST_HOTEL",offerId:"TEST_OFFER",checkIn:"2024-02-01",checkOut:"2024-02-03",adults:2,children:0,rooms:1,addons:[],bedPref:"king",note:"Test booking for debugging"},{data:a,error:c}=await y.functions.invoke("create-hotel-booking",{body:t});console.log("Booking test result:",{data:a,error:c}),f({data:a,error:c,testData:t,timestamp:new Date().toISOString()}),c?l({title:"Booking Test Failed",description:c.message,variant:"destructive"}):a!=null&&a.success?l({title:"Booking Test Success",description:"Test booking created successfully"}):l({title:"Booking Test Issue",description:(a==null?void 0:a.error)||"Unknown error",variant:"destructive"})}catch(t){console.error("Booking test error:",t),f({error:t,timestamp:new Date().toISOString()})}finally{p(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(u,{children:"Payment System Debugger"})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(N,{onClick:b,disabled:o,variant:"outline",children:o?"Testing...":"Test Stripe Key"}),e.jsx(N,{onClick:n,disabled:s,variant:"outline",children:s?"Testing...":"Test Booking Creation"})]}),S&&e.jsxs("div",{className:"border rounded p-4 bg-muted/50",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Stripe Key Test Result:"}),e.jsx("pre",{className:"text-xs overflow-auto bg-background p-2 rounded",children:JSON.stringify(S,null,2)})]}),r&&e.jsxs("div",{className:"border rounded p-4 bg-muted/50",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Booking Test Result:"}),e.jsx("pre",{className:"text-xs overflow-auto bg-background p-2 rounded",children:JSON.stringify(r,null,2)})]})]})]})})}const J=({onTestHotelBooking:o,onTestFlightBooking:m,onTestActivityBooking:s})=>e.jsxs(h,{className:"w-full max-w-4xl mx-auto mt-8",children:[e.jsx(x,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"End-to-End Booking Test Panel"]})}),e.jsxs(g,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Hotel Booking Flow"}),e.jsx(d,{variant:"secondary",children:"Test Mode"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Location: Sydney, Australia"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Dates: Check-in Tomorrow, Check-out +2 days"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Guests: 2 Adults, 1 Room"})]})]}),e.jsx(N,{onClick:o,className:"w-full",variant:"outline",children:"Test Complete Hotel Booking Flow"})]}),e.jsx(B,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Flight Booking Flow"}),e.jsx(d,{variant:"secondary",children:"Test Mode"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Route: SYD â†’ MEL (Sydney to Melbourne)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Date: Tomorrow"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Passengers: 1 Adult"})]})]}),e.jsx(N,{onClick:m,className:"w-full",variant:"outline",children:"Test Complete Flight Booking Flow"})]}),e.jsx(B,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Activity Booking Flow"}),e.jsx(d,{variant:"secondary",children:"Test Mode"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Location: Sydney, Australia"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Date: Tomorrow"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Participants: 2 Adults"})]})]}),e.jsx(N,{onClick:s,className:"w-full",variant:"outline",children:"Test Complete Activity Booking Flow"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Test Flow Includes:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"â€¢ Provider rotation and API integration"}),e.jsx("li",{children:"â€¢ Search results and selection"}),e.jsx("li",{children:"â€¢ Booking form completion"}),e.jsx("li",{children:"â€¢ Stripe test payment processing"}),e.jsx("li",{children:"â€¢ Booking confirmation and database storage"}),e.jsx("li",{children:"â€¢ Email confirmation (test mode)"})]})]})]})]}),V=()=>window.location.hostname==="localhost"||window.location.search.includes("test=true")?e.jsx("div",{className:"fixed top-4 left-4 z-50",children:e.jsxs(d,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 border-yellow-300",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Test Mode"]})}):null,Y=()=>{U();const[o,m]=j.useState(!1),[s,p]=j.useState(!1);return null},le=()=>e.jsx(P,{children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(_,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold",children:"System Diagnostics"})]}),e.jsxs(M,{defaultValue:"system",className:"space-y-6",children:[e.jsxs(O,{className:"grid w-full grid-cols-5",children:[e.jsxs(w,{value:"system",className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"System Health"]}),e.jsxs(w,{value:"payments",className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Payment Debug"]}),e.jsxs(w,{value:"bookings",className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Booking Tests"]}),e.jsxs(w,{value:"environment",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Environment"]}),e.jsxs(w,{value:"monitoring",className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Monitoring"]})]}),e.jsx(T,{value:"system",className:"space-y-6",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Production System Diagnostics"}),e.jsx(v,{children:"Real-time system health and performance monitoring"})]}),e.jsx(g,{children:e.jsx(K,{})})]})}),e.jsx(T,{value:"payments",className:"space-y-6",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Payment System Debugger"}),e.jsx(v,{children:"Test and debug payment processing flows"})]}),e.jsx(g,{children:e.jsx(z,{})})]})}),e.jsx(T,{value:"bookings",className:"space-y-6",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Booking Flow Test Panel"}),e.jsx(v,{children:"Test complete booking flows for hotels, flights, and activities"})]}),e.jsx(g,{children:e.jsx(J,{onTestHotelBooking:()=>window.location.href="/search/hotels?destination=Sydney&checkIn="+new Date(Date.now()+864e5).toISOString().split("T")[0]+"&checkOut="+new Date(Date.now()+2*864e5).toISOString().split("T")[0]+"&adults=2&rooms=1&test=true",onTestFlightBooking:()=>window.location.href="/search/flights?origin=SYD&destination=MEL&departure="+new Date(Date.now()+864e5).toISOString().split("T")[0]+"&adults=1&test=true",onTestActivityBooking:()=>window.location.href="/search/activities?destination=Sydney&date="+new Date(Date.now()+864e5).toISOString().split("T")[0]+"&participants=2&test=true"})})]})}),e.jsx(T,{value:"environment",className:"space-y-6",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Environment & Test Mode"}),e.jsx(v,{children:"Environment configuration and test mode indicators"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Environment Variables"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:["Node Environment: ",e.jsx("code",{children:"production"})]}),e.jsxs("div",{children:["Development Mode: ",e.jsx("code",{children:"No"})]}),e.jsxs("div",{children:["Host: ",e.jsx("code",{children:window.location.hostname})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Build Information"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:["Timestamp: ",e.jsx("code",{children:new Date().toISOString()})]}),e.jsxs("div",{children:["User Agent: ",e.jsxs("code",{className:"text-xs",children:[navigator.userAgent.substring(0,50),"..."]})]})]})]})]})]})})]})}),e.jsx(T,{value:"monitoring",className:"space-y-6",children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Health Monitoring"}),e.jsx(v,{children:"Real-time health monitoring and circuit breaker status"})]}),e.jsx(g,{children:e.jsx(Y,{})})]})})]})]})});export{le as default};
