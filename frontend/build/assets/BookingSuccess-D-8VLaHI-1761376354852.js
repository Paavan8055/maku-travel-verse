import{k as I,b as S,h as R,r as o,s as b,j as e,d as j,e as p,B as t,f as M,g as P}from"./index-DlBCXUos-1761376354852.js";import{C as A}from"./circle-check-big-C0_G-q_f-1761376354852.js";import{M as T}from"./mail-sNB1Jzbm-1761376354852.js";import{D as H}from"./download-DdH4qWqA-1761376354852.js";import{M as w}from"./map-pin-CeXuAAjT-1761376354852.js";import{C as c}from"./calendar-DogrcAi5-1761376354852.js";import{U as k}from"./users-DyysgK2H-1761376354852.js";function O(){const[l]=I(),d=S(),{toast:m}=R(),[C,x]=o.useState(!0),[r,B]=o.useState(null),[g,N]=o.useState(!1),u=l.get("booking_id"),f=l.get("session_id"),h=l.get("payment_intent");o.useEffect(()=>{u||f||h?D():x(!1)},[u,f,h]);const D=async()=>{var s,i,a;try{x(!0);const{data:n,error:v}=await b.functions.invoke("verify-booking-payment",{body:{booking_id:u,session_id:f,payment_intent_id:h}});if(v)throw v;if(n.success)B(n.booking),(a=(i=(s=n.booking)==null?void 0:s.booking_data)==null?void 0:i.customerInfo)!=null&&a.email&&await y(n.booking.id,n.booking.booking_data.customerInfo.email,n.booking.booking_type);else throw new Error(n.error||"Booking verification failed")}catch(n){console.error("Booking verification error:",n),m({title:"Verification Failed",description:"There was an issue verifying your booking. Please contact support.",variant:"destructive"})}finally{x(!1)}},y=async(s,i,a)=>{try{N(!0);const{error:n}=await b.functions.invoke("send-booking-confirmation",{body:{bookingId:s,customerEmail:i,bookingType:a}});if(n)throw n;m({title:"Confirmation Sent",description:"A confirmation email has been sent to your email address."})}catch(n){console.error("Error sending confirmation:",n),m({title:"Email Error",description:"Confirmation email could not be sent, but your booking is confirmed.",variant:"destructive"})}finally{N(!1)}},E=()=>{if(!r)return null;const{booking_data:s,booking_type:i}=r;switch(i){case"flight":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[s==null?void 0:s.origin," → ",s==null?void 0:s.destination]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Departure: ",s==null?void 0:s.departureDate]})]}),(s==null?void 0:s.returnDate)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Return: ",s==null?void 0:s.returnDate]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[(s==null?void 0:s.passengers)||(s==null?void 0:s.adults)||1," passenger(s)"]})]})]});case"hotel":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:(s==null?void 0:s.hotelName)||(s==null?void 0:s.destination)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Check-in: ",s==null?void 0:s.checkInDate]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Check-out: ",s==null?void 0:s.checkOutDate]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[(s==null?void 0:s.guestCount)||(s==null?void 0:s.adults)||1," guest(s)"]})]})]});default:return e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Booking details available in your confirmation email."})})}};return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{children:"Verifying your booking..."})]})}):r?e.jsx("div",{className:"min-h-screen bg-background p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsxs(j,{className:"mb-8",children:[e.jsxs(M,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(A,{className:"h-16 w-16 text-green-500"})}),e.jsx(P,{className:"text-2xl text-green-600",children:"Booking Confirmed!"}),e.jsx("p",{className:"text-muted-foreground",children:"Your booking has been successfully confirmed and payment processed."})]}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Booking Reference"}),e.jsx("p",{className:"text-2xl font-mono font-bold text-primary",children:r.booking_reference})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Booking Details"}),E()]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Amount"}),e.jsxs("p",{className:"font-semibold",children:[r.currency," ",r.total_amount.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Booking Date"}),e.jsx("p",{className:"font-semibold",children:new Date(r.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"space-y-3 pt-6 border-t",children:[e.jsxs(t,{variant:"outline",className:"w-full",onClick:()=>{var s,i;return y(r.id,(i=(s=r.booking_data)==null?void 0:s.customerInfo)==null?void 0:i.email,r.booking_type)},disabled:g,children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),g?"Sending...":"Resend Confirmation Email"]}),e.jsxs(t,{variant:"outline",className:"w-full",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Download Receipt"]}),e.jsx(t,{className:"w-full",onClick:()=>d("/bookings"),children:"View My Bookings"}),e.jsx(t,{variant:"ghost",className:"w-full",onClick:()=>d("/"),children:"Return Home"})]})]})]}),e.jsx(j,{children:e.jsxs(p,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"What's Next?"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"• A confirmation email has been sent to your email address"}),e.jsx("li",{children:'• You can manage your booking in the "My Bookings" section'}),e.jsx("li",{children:"• Check-in online 24 hours before departure (for flights)"}),e.jsx("li",{children:"• Keep your booking reference handy for any inquiries"}),e.jsx("li",{children:"• Contact our support team if you need any assistance"})]})]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsx(j,{className:"max-w-md w-full",children:e.jsxs(p,{className:"text-center p-6",children:[e.jsx("p",{className:"text-destructive mb-4",children:"Booking not found or verification failed."}),e.jsx(t,{onClick:()=>d("/"),children:"Return Home"})]})})})}export{O as default};
