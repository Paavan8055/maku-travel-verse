import{t as I,r as g,j as e,k as C,n as Q,o as Z,e as M,l as P,M as U,I as B,B as S,P as W,a as z,ae as Y,d as A,b as $,p as H,a6 as V,a2 as ee,z as se,g as ae,N as re}from"./index-sjMrv3Ur-1758787615240.js";import{v as te,S as ne}from"./inputValidation-BwR0CGta-1758787615240.js";import{L as v}from"./label-BgKM8khV-1758787615240.js";import{C as J}from"./calendar-0JXfKBaU-1758787615240.js";import{S as X,a as _,b as q,c as G,d as D}from"./select-_L-I_tXd-1758787615240.js";import{S as ie}from"./search-DF0qoHZs-1758787615240.js";import{f as N}from"./format-PzJabrMJ-1758787615240.js";import{S as F}from"./separator-Dkfs-3lo-1758787615240.js";import{W as le}from"./wifi-Cc4Y4cD8-1758787615240.js";import{U as ce}from"./utensils-BaOFpsTK-1758787615240.js";import{M as de}from"./monitor-DR4XgEbK-1758787615240.js";import{L as oe}from"./luggage-Cel8MUyQ-1758787615240.js";import"./correlationId-CbwbdUz_-1758787615240.js";import"./en-US-CC7XSppg-1758787615240.js";import"./endOfMonth-DVEPoWiB-1758787615240.js";import"./chevron-left-B_7GVsNv-1758787615240.js";import"./index-BdQq_4o_-1758787615240.js";import"./index-Ds7e5B5O-1758787615240.js";const me=({onSearch:i,loading:m=!1,initialValues:l={}})=>{const{toast:f}=I(),[r,s]=g.useState({origin:l.origin||"",destination:l.destination||"",departureDate:l.departureDate||"",returnDate:l.returnDate||"",passengers:l.passengers||1,tripType:l.tripType||"roundtrip",travelClass:l.travelClass||"ECONOMY"}),[d,x]=g.useState(!1),[y,o]=g.useState(!1),c=(a,u)=>{s(t=>({...t,[a]:u}))},w=a=>{a.preventDefault();const u=te(r);if(!u.isValid){f({title:"Invalid Search",description:u.error||"Invalid search parameters",variant:"destructive"});return}i(r)},n=()=>{s(a=>({...a,origin:a.destination,destination:a.origin}))};return e.jsxs(C,{className:"w-full max-w-4xl mx-auto",children:[e.jsx(Q,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Search Flights"]})}),e.jsx(P,{children:e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(v,{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"tripType",value:"roundtrip",checked:r.tripType==="roundtrip",onChange:a=>c("tripType",a.target.value),className:"w-4 h-4"}),"Round Trip"]}),e.jsxs(v,{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"tripType",value:"oneway",checked:r.tripType==="oneway",onChange:a=>c("tripType",a.target.value),className:"w-4 h-4"}),"One Way"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 relative",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"origin",children:"From"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{id:"origin",placeholder:"Origin airport (LAX)",value:r.origin,onChange:a=>c("origin",a.target.value.toUpperCase()),className:"pl-10",maxLength:3})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"destination",children:"To"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(B,{id:"destination",placeholder:"Destination airport (SYD)",value:r.destination,onChange:a=>c("destination",a.target.value.toUpperCase()),className:"pl-10",maxLength:3})]})]}),e.jsx(S,{type:"button",variant:"ghost",size:"sm",onClick:n,className:"absolute top-8 left-1/2 transform -translate-x-1/2 z-10 bg-background border rounded-full p-2 h-8 w-8",children:"â‡„"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Departure Date"}),e.jsxs(W,{open:d,onOpenChange:x,children:[e.jsx(z,{asChild:!0,children:e.jsxs(S,{variant:"outline",className:Y("w-full justify-start text-left font-normal",!r.departureDate&&"text-muted-foreground"),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),r.departureDate?N(new Date(r.departureDate),"PPP"):"Select departure date"]})}),e.jsx($,{className:"w-auto p-0",align:"start",children:e.jsx(J,{mode:"single",selected:r.departureDate?new Date(r.departureDate):void 0,onSelect:a=>{a&&(c("departureDate",N(a,"yyyy-MM-dd")),x(!1))},disabled:a=>a<new Date,initialFocus:!0})})]})]}),r.tripType==="roundtrip"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Return Date"}),e.jsxs(W,{open:y,onOpenChange:o,children:[e.jsx(z,{asChild:!0,children:e.jsxs(S,{variant:"outline",className:Y("w-full justify-start text-left font-normal",!r.returnDate&&"text-muted-foreground"),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),r.returnDate?N(new Date(r.returnDate),"PPP"):"Select return date"]})}),e.jsx($,{className:"w-auto p-0",align:"start",children:e.jsx(J,{mode:"single",selected:r.returnDate?new Date(r.returnDate):void 0,onSelect:a=>{a&&(c("returnDate",N(a,"yyyy-MM-dd")),o(!1))},disabled:a=>a<new Date||r.departureDate&&a<=new Date(r.departureDate),initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"passengers",children:"Passengers"}),e.jsxs(X,{value:r.passengers.toString(),onValueChange:a=>c("passengers",parseInt(a)),children:[e.jsx(_,{children:e.jsx(q,{placeholder:"Select passengers"})}),e.jsx(G,{children:[1,2,3,4,5,6,7,8,9].map(a=>e.jsxs(D,{value:a.toString(),children:[a," ",a===1?"Passenger":"Passengers"]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"travelClass",children:"Travel Class"}),e.jsxs(X,{value:r.travelClass,onValueChange:a=>c("travelClass",a),children:[e.jsx(_,{children:e.jsx(q,{placeholder:"Select class"})}),e.jsxs(G,{children:[e.jsx(D,{value:"ECONOMY",children:"Economy"}),e.jsx(D,{value:"PREMIUM_ECONOMY",children:"Premium Economy"}),e.jsx(D,{value:"BUSINESS",children:"Business"}),e.jsx(D,{value:"FIRST",children:"First"})]})]})]})]}),e.jsx(S,{type:"submit",className:"w-full",disabled:m,size:"lg",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Searching Flights..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Search Flights"]})})]})})]})},xe=({flights:i,loading:m,error:l,onFlightSelect:f,onRetry:r})=>m?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(C,{className:"animate-pulse",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-32"}),e.jsx("div",{className:"h-6 bg-muted rounded w-48"})]}),e.jsx("div",{className:"h-8 bg-muted rounded w-24"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-16"}),e.jsx("div",{className:"h-4 bg-muted rounded w-8"}),e.jsx("div",{className:"h-4 bg-muted rounded w-16"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24"}),e.jsx("div",{className:"h-10 bg-muted rounded w-32"})]})]})})},s))}):l?e.jsx(C,{className:"text-center py-8",children:e.jsx(P,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-destructive/10 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"h-8 w-8 text-destructive"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Search Failed"}),e.jsx("p",{className:"text-muted-foreground",children:l})]}),r&&e.jsx(S,{onClick:r,variant:"outline",children:"Try Again"})]})})}):!i||i.length===0?e.jsx(C,{className:"text-center py-8",children:e.jsx(P,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-muted rounded-full flex items-center justify-center",children:e.jsx(M,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"No Flights Found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search criteria or dates"})]})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:[i.length," flights found"]}),e.jsx(H,{variant:"secondary",children:"Best results shown first"})]}),i.map((s,d)=>{var x,y,o,c,w,n,a,u,t,h,p,j,b,T,E,O,k,L,R;return e.jsx(C,{className:"hover:shadow-lg transition-shadow",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[((x=s.airline)==null?void 0:x.logo)&&e.jsx("img",{src:s.airline.logo,alt:s.airline.name,className:"w-8 h-8 rounded",onError:K=>{K.target.style.display="none"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((y=s.airline)==null?void 0:y.name)||((o=s.airline)==null?void 0:o.code)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.flightNumber})]})]}),e.jsx(H,{variant:s.cabinClass==="ECONOMY"?"secondary":"default",children:s.cabinClass})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:(c=s.departure)==null?void 0:c.time}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(w=s.departure)==null?void 0:w.airport}),((n=s.departure)==null?void 0:n.date)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:N(new Date(s.departure.date),"MMM dd")})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(F,{className:"flex-1"}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.duration}),s.stops>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.stops," stop",s.stops>1?"s":""]}),s.stopoverInfo&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.stopoverInfo})]}),e.jsx(F,{className:"flex-1"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:(a=s.arrival)==null?void 0:a.time}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(u=s.arrival)==null?void 0:u.airport}),((t=s.arrival)==null?void 0:t.date)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:N(new Date(s.arrival.date),"MMM dd")})]})]}),s.returnItinerary&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold",children:(h=s.returnItinerary.departure)==null?void 0:h.time}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(p=s.returnItinerary.departure)==null?void 0:p.airport}),((j=s.returnItinerary.departure)==null?void 0:j.date)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:N(new Date(s.returnItinerary.departure.date),"MMM dd")})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx(F,{className:"flex-1"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:s.returnItinerary.duration}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Return"})]}),e.jsx(F,{className:"flex-1"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold",children:(b=s.returnItinerary.arrival)==null?void 0:b.time}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(T=s.returnItinerary.arrival)==null?void 0:T.airport}),((E=s.returnItinerary.arrival)==null?void 0:E.date)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:N(new Date(s.returnItinerary.arrival.date),"MMM dd")})]})]})]}),s.amenities&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.amenities.wifi&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-4 w-4"}),"WiFi"]}),s.amenities.meal&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-4 w-4"}),"Meal"]}),s.amenities.entertainment&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-4 w-4"}),"Entertainment"]}),((O=s.baggage)==null?void 0:O.included)>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-4 w-4"}),s.baggage.included," bag",s.baggage.included>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[(k=s.price)==null?void 0:k.currency," ",(R=(L=s.price)==null?void 0:L.amount)==null?void 0:R.toLocaleString()]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total for ",s.passengers||1," passenger",(s.passengers||1)>1?"s":""]})]}),e.jsxs(S,{onClick:()=>f(s),size:"lg",className:"px-8",children:["Select Flight",e.jsx(V,{className:"ml-2 h-4 w-4"})]})]})]})})},s.id||d)})]}),ue=()=>{const[i,m]=g.useState(!1),{toast:l}=I();return{searchWithRotation:g.useCallback(async r=>{m(!0);try{const{data:s,error:d}=await ee.functions.invoke("provider-rotation",{body:r});if(d)throw new Error(d.message);return s.fallbackUsed?l({title:"Service Notice",description:"Search completed with limited providers available. Results may be fewer than usual.",variant:"default"}):s.provider&&console.log(`Search completed using ${s.provider} provider in ${s.responseTime}ms`),s}catch(s){console.error("Provider rotation failed:",s);const d=s instanceof Error&&s.message.includes("Provider")?"Search providers are temporarily unavailable. Our team has been notified and is working to resolve this issue.":"Unable to complete search. Please verify your search criteria and try again.";return l({title:"Search Error",description:d,variant:"destructive"}),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}finally{m(!1)}},[l]),isLoading:i}},Ee=()=>{const[i,m]=se(),l=ae(),{toast:f}=I(),{searchWithRotation:r,isLoading:s}=ue(),[d,x]=g.useState([]),[y,o]=g.useState(null),[c,w]=g.useState(!1),n=()=>({origin:i.get("origin")||"",destination:i.get("destination")||"",departureDate:i.get("departureDate")||"",returnDate:i.get("returnDate")||"",passengers:parseInt(i.get("passengers")||"1"),tripType:i.get("tripType")||"roundtrip",travelClass:i.get("travelClass")||"ECONOMY"}),a=async t=>{try{o(null),w(!0);const h=new URLSearchParams;Object.entries(t).forEach(([j,b])=>{b&&h.set(j,b.toString())}),m(h),console.log("FlightsPage: Starting flight search with:",t);const p=await r({searchType:"flight",params:{origin:t.origin,destination:t.destination,departureDate:t.departureDate,returnDate:t.tripType==="roundtrip"?t.returnDate:void 0,passengers:t.passengers,travelClass:t.travelClass}});if(console.log("FlightsPage: Provider rotation result:",p),p.success&&p.data){const j=p.data.flights||[];console.log("FlightsPage: Setting flights data:",j),x(j),j.length===0&&o("No flights found for your search criteria. Please try different dates or destinations.")}else console.error("FlightsPage: Search failed:",p.error),o(p.error||"Unable to search flights at this time"),x([])}catch(h){console.error("FlightsPage: Flight search error:",h),o("An unexpected error occurred while searching for flights"),x([]),f({title:"Search Error",description:"Unable to search flights. Please try again later.",variant:"destructive"})}},u=t=>{try{sessionStorage.setItem("selectedFlight",JSON.stringify(t)),console.log("FlightsPage: Flight selected:",t),l("/flights/review")}catch(h){console.error("FlightsPage: Error selecting flight:",h),f({title:"Selection Error",description:"Unable to select flight. Please try again.",variant:"destructive"})}};return g.useEffect(()=>{const t=n();t.origin&&t.destination&&t.departureDate&&!c&&(console.log("FlightsPage: Auto-searching with URL criteria:",t),a(t))},[]),e.jsx(ne,{children:e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(re,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[e.jsx(me,{onSearch:a,loading:s,initialValues:n()}),c&&e.jsxs("div",{className:"space-y-6",children:[(d.length>0||y)&&e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Flight Search Results"}),d.length>0&&e.jsxs("p",{className:"text-muted-foreground",children:[n().origin," â†’ ",n().destination,n().departureDate&&e.jsxs(e.Fragment,{children:[" â€¢ ",new Date(n().departureDate).toLocaleDateString()]}),n().returnDate&&n().tripType==="roundtrip"&&e.jsxs(e.Fragment,{children:[" â€¢ ",new Date(n().returnDate).toLocaleDateString()]}),"â€¢ ",n().passengers," passenger",n().passengers>1?"s":""]})]}),e.jsx(xe,{flights:d,loading:s,error:y,onFlightSelect:u,onRetry:()=>a(n())})]}),!c&&!s&&e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"h-8 w-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Search for Flights"}),e.jsx("p",{className:"text-muted-foreground",children:"Enter your travel details above to find the best flight deals"})]})]})})]})]})})};export{Ee as default};
