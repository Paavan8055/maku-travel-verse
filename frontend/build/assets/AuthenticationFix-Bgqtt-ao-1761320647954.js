import{r as d,h as C,j as s,d as S,f as k,g as b,i as F,e as R,B as i,R as h,A as T,T as m,q as U,a as n,s as a}from"./index-WZ5873Kb-1761320647954.js";import{U as x}from"./user-check-C-LAy7RV-1761320647954.js";import{S as c}from"./shield-CFtTHNb0-1761320647954.js";import{S as g}from"./settings-PrBrSsOL-1761320647954.js";import{C as z}from"./circle-check-big-BfnbplvO-1761320647954.js";const W=()=>{const[o,l]=d.useState(!1),[u,r]=d.useState("unknown"),{toast:e}=C(),j=async()=>{l(!0);try{const{data:t,error:v}=await a.auth.getSession(),{data:{user:B},error:A}=await a.auth.getUser(),{data:{subscription:N}}=a.auth.onAuthStateChange((y,w)=>{console.log("Auth state change:",y,w)});v||A?(r("broken"),e({title:"Authentication Issues Detected",description:"Auth system has errors that need fixing",variant:"destructive"})):(r("working"),e({title:"Authentication Working",description:"Auth system is functioning correctly",variant:"default"})),N.unsubscribe()}catch(t){r("broken"),console.error("Auth test failed:",t),e({title:"Authentication Test Failed",description:"Critical auth system errors detected",variant:"destructive"})}finally{l(!1)}},f=async()=>{try{const{error:t}=await a.functions.invoke("configure-auth-security");e(t?{title:"Auth Fix Failed",description:t.message,variant:"destructive"}:{title:"Auth Configuration Updated",description:"Authentication system has been reconfigured",variant:"default"})}catch{e({title:"Auth Fix Error",description:"Failed to update auth configuration",variant:"destructive"})}},p=()=>{switch(u){case"working":return s.jsxs(n,{variant:"secondary",className:"bg-green-100 text-green-800",children:[s.jsx(z,{className:"w-3 h-3 mr-1"}),"Working"]});case"broken":return s.jsxs(n,{variant:"destructive",children:[s.jsx(m,{className:"w-3 h-3 mr-1"}),"Broken"]});default:return s.jsxs(n,{variant:"outline",children:[s.jsx(c,{className:"w-3 h-3 mr-1"}),"Unknown"]})}};return s.jsx("div",{className:"space-y-6",children:s.jsxs(S,{children:[s.jsxs(k,{children:[s.jsxs(b,{className:"flex items-center gap-2",children:[s.jsx(x,{className:"w-5 h-5"}),"Authentication System Recovery"]}),s.jsx(F,{children:"Diagnose and fix authentication issues preventing user login/signup"})]}),s.jsxs(R,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium",children:"Auth Status:"}),p()]}),s.jsx(i,{onClick:j,disabled:o,variant:"outline",size:"sm",children:o?s.jsxs(s.Fragment,{children:[s.jsx(h,{className:"w-4 h-4 mr-2 animate-spin"}),"Testing..."]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{className:"w-4 h-4 mr-2"}),"Test Auth"]})})]}),u==="broken"&&s.jsxs(T,{variant:"destructive",children:[s.jsx(m,{className:"h-4 w-4"}),s.jsxs(U,{children:["Critical authentication issues detected. Users cannot login or signup.",s.jsxs(i,{onClick:f,className:"ml-2",size:"sm",variant:"secondary",children:[s.jsx(g,{className:"w-4 h-4 mr-1"}),"Fix Auth Config"]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium",children:"Known Auth Issues:"}),s.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[s.jsx("li",{children:"• OAuth redirect URL misconfigurations"}),s.jsx("li",{children:"• Supabase auth trigger function errors"}),s.jsx("li",{children:"• RLS policy conflicts preventing user operations"}),s.jsx("li",{children:"• Session management and token refresh failures"}),s.jsx("li",{children:"• Email confirmation process blocking access"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium",children:"Recovery Actions:"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[s.jsxs(i,{variant:"outline",size:"sm",className:"justify-start",children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"Fix OAuth URLs"]}),s.jsxs(i,{variant:"outline",size:"sm",className:"justify-start",children:[s.jsx(x,{className:"w-4 h-4 mr-2"}),"Test Signup Flow"]}),s.jsxs(i,{variant:"outline",size:"sm",className:"justify-start",children:[s.jsx(c,{className:"w-4 h-4 mr-2"}),"Verify RLS Policies"]}),s.jsxs(i,{variant:"outline",size:"sm",className:"justify-start",children:[s.jsx(h,{className:"w-4 h-4 mr-2"}),"Reset Auth State"]})]})]})]})]})})};export{W as AuthenticationFix};
