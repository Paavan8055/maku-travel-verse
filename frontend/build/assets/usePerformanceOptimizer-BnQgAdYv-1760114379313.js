import{r as t,s as v}from"./index-4Iw_Ltix-1760114379313.js";const M=y=>{const{componentName:a,enableMonitoring:o=!1,reportToAnalytics:d=!1,memoryThreshold:l=80}=y,[s,p]=t.useState({renderTime:0,memoryUsage:0,rerenderCount:0,lastRenderTime:0}),u=t.useRef(0),i=t.useRef(0),e=t.useRef(null),m=t.useRef(!1),C=t.useCallback(()=>{o&&(u.current=performance.now())},[o]),b=t.useCallback(()=>{if(!o||u.current===0)return;const r=performance.now()-u.current;i.current+=1,p(n=>({...n,renderTime:r,lastRenderTime:r,rerenderCount:i.current})),d&&r>100&&R(r),u.current=0},[o,d,a]),g=t.useCallback(()=>{if(!m.current&&typeof performance<"u"&&"memory"in performance){const r=performance.memory,n=Math.round(r.usedJSHeapSize/r.totalJSHeapSize*100);if(n>90){m.current=!0,e.current&&(clearInterval(e.current),e.current=null),console.error(`CRITICAL: Memory usage ${n}% - disabling monitoring for ${a}`);return}p(c=>({...c,memoryUsage:n})),n>l&&(console.warn(`High memory usage in ${a}: ${n}%`),n>85&&(m.current=!0,e.current&&(clearInterval(e.current),e.current=null)))}},[a,l]),R=async r=>{try{await v.functions.invoke("track-performance",{body:{component:a,renderTime:r,memoryUsage:s.memoryUsage,rerenderCount:i.current,timestamp:new Date().toISOString()}})}catch(n){console.error("Failed to report performance metrics:",n)}},f=t.useCallback(()=>{typeof window<"u"&&window.gc&&window.gc(),i.current=0,e.current&&clearInterval(e.current)},[]);t.useEffect(()=>{if(!o||m.current){e.current&&(clearInterval(e.current),e.current=null);return}return e.current=setInterval(g,1e4),()=>{e.current&&(clearInterval(e.current),e.current=null)}},[o,g]);const w=t.useCallback(r=>{r.loading="lazy",r.decoding="async"},[]),I=t.useCallback(()=>new IntersectionObserver(r=>{r.forEach(n=>{if(n.isIntersecting){const c=n.target;c.dataset.src&&(c.src=c.dataset.src,c.removeAttribute("data-src"))}})}),[]),k=t.useCallback(()=>{f()},[f]);return{metrics:s,startRender:C,endRender:b,optimizeComponent:f,optimizeImage:w,createLazyLoader:I,cleanup:k,isHighMemoryUsage:s.memoryUsage>l,isSlowRender:s.lastRenderTime>16.67}};export{M as u};
