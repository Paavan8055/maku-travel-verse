import{ar as m,r as b,y as Ze,x as mt,j as e,i as Se,B as ie,S as pt,D as ft,I as X,T as ht,ah as We,N as Ce,ac as Ne,ae as ke,J as xt,g as gt,k as vt,l as yt,t as ze,Q as jt,a7 as we,E as Z}from"./index-BuFvfeSJ-1758786228561.js";import{P as f}from"./index-zyu86E08-1758786228561.js";import{u as bt,t as St}from"./zod-USIVAxx3-1758786228561.js";import{S as Ct,a as Nt,b as kt,c as wt,d as ue}from"./select-D-JCiAP4-1758786228561.js";import{T as Et}from"./textarea-Uko5zEQl-1758786228561.js";import{C as ye}from"./checkbox-BzzG7YVb-1758786228561.js";import{F as Pt,a as I,b as A,c as R,d as T,e as V}from"./form-BD95eC8u-1758786228561.js";import{a as $e}from"./autofillService-B9F31r5j-1758786228561.js";import{u as Ge}from"./bookingStore-BHNggQRf-1758786228561.js";import{o as Ot,b as je,s as z}from"./types-BekIk3NQ-1758786228561.js";import{C as It}from"./circle-check-DAY2_L-D-1758786228561.js";import{E as At}from"./ErrorBoundary-DopKQJhH-1758786228561.js";import{C as Ee}from"./circle-alert-BiE7KCZ3-1758786228561.js";import{C as Rt}from"./chevron-left-Ciz90jCt-1758786228561.js";import"./index-BdQq_4o_-1758786228561.js";import"./index-CJWzJC_R-1758786228561.js";import"./label-DYU-yWis-1758786228561.js";var et="https://js.stripe.com/v3",Tt=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var Ft=function(){for(var t=document.querySelectorAll('script[src^="'.concat(et,'"]')),r=0;r<t.length;r++){var s=t[r];if(Tt.test(s.src))return s}return null},He=function(t){var r="",s=document.createElement("script");s.src="".concat(et).concat(r);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(s),s},Bt=function(t,r){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"3.4.1",startTime:r})},ae=null,de=null,me=null,Lt=function(t){return function(){t(new Error("Failed to load Stripe.js"))}},Dt=function(t,r){return function(){window.Stripe?t(window.Stripe):r(new Error("Stripe.js not available"))}},Ut=function(t){return ae!==null?ae:(ae=new Promise(function(r,s){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var o=Ft();if(!(o&&t)){if(!o)o=He(t);else if(o&&me!==null&&de!==null){var i;o.removeEventListener("load",me),o.removeEventListener("error",de),(i=o.parentNode)===null||i===void 0||i.removeChild(o),o=He(t)}}me=Dt(r,s),de=Lt(s),o.addEventListener("load",me),o.addEventListener("error",de)}catch(u){s(u);return}}),ae.catch(function(r){return ae=null,Promise.reject(r)}))},Mt=function(t,r,s){if(t===null)return null;var o=t.apply(void 0,r);return Bt(o,s),o},oe,tt=!1,rt=function(){return oe||(oe=Ut(null).catch(function(t){return oe=null,Promise.reject(t)}),oe)};Promise.resolve().then(function(){return rt()}).catch(function(n){tt||console.warn(n)});var _t=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];tt=!0;var o=Date.now();return rt().then(function(i){return Mt(i,r,o)})};function Je(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),r.push.apply(r,s)}return r}function Ye(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Je(Object(r),!0).forEach(function(s){nt(n,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Je(Object(r)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(r,s))})}return n}function pe(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pe=function(t){return typeof t}:pe=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pe(n)}function nt(n,t,r){return t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function st(n,t){return qt(n)||Vt(n,t)||Wt(n,t)||zt()}function qt(n){if(Array.isArray(n))return n}function Vt(n,t){var r=n&&(typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"]);if(r!=null){var s=[],o=!0,i=!1,u,l;try{for(r=r.call(n);!(o=(u=r.next()).done)&&(s.push(u.value),!(t&&s.length===t));o=!0);}catch(c){i=!0,l=c}finally{try{!o&&r.return!=null&&r.return()}finally{if(i)throw l}}return s}}function Wt(n,t){if(n){if(typeof n=="string")return Ke(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ke(n,t)}}function Ke(n,t){(t==null||t>n.length)&&(t=n.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=n[r];return s}function zt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var w=function(t,r,s){var o=!!s,i=m.useRef(s);m.useEffect(function(){i.current=s},[s]),m.useEffect(function(){if(!o||!t)return function(){};var u=function(){i.current&&i.current.apply(i,arguments)};return t.on(r,u),function(){t.off(r,u)}},[o,r,t,i])},Pe=function(t){var r=m.useRef(t);return m.useEffect(function(){r.current=t},[t]),r.current},ee=function(t){return t!==null&&pe(t)==="object"},$t=function(t){return ee(t)&&typeof t.then=="function"},Gt=function(t){return ee(t)&&typeof t.elements=="function"&&typeof t.createToken=="function"&&typeof t.createPaymentMethod=="function"&&typeof t.confirmCardPayment=="function"},Qe="[object Object]",Ht=function n(t,r){if(!ee(t)||!ee(r))return t===r;var s=Array.isArray(t),o=Array.isArray(r);if(s!==o)return!1;var i=Object.prototype.toString.call(t)===Qe,u=Object.prototype.toString.call(r)===Qe;if(i!==u)return!1;if(!i&&!s)return t===r;var l=Object.keys(t),c=Object.keys(r);if(l.length!==c.length)return!1;for(var v={},y=0;y<l.length;y+=1)v[l[y]]=!0;for(var S=0;S<c.length;S+=1)v[c[S]]=!0;var d=Object.keys(v);if(d.length!==l.length)return!1;var F=t,a=r,p=function(_){return n(F[_],a[_])};return d.every(p)},at=function(t,r,s){return ee(t)?Object.keys(t).reduce(function(o,i){var u=!ee(r)||!Ht(t[i],r[i]);return s.includes(i)?(u&&console.warn("Unsupported prop change: options.".concat(i," is not a mutable property.")),o):u?Ye(Ye({},o||{}),{},nt({},i,t[i])):o},null):null},ot="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",Xe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ot;if(t===null||Gt(t))return t;throw new Error(r)},Jt=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ot;if($t(t))return{tag:"async",stripePromise:Promise.resolve(t).then(function(o){return Xe(o,r)})};var s=Xe(t,r);return s===null?{tag:"empty"}:{tag:"sync",stripe:s}},Yt=function(t){!t||!t._registerWrapper||!t.registerAppInfo||(t._registerWrapper({name:"react-stripe-js",version:"2.8.1"}),t.registerAppInfo({name:"react-stripe-js",version:"2.8.1",url:"https://stripe.com/docs/stripe-js/react"}))},fe=m.createContext(null);fe.displayName="ElementsContext";var it=function(t,r){if(!t)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(r," in an <Elements> provider."));return t},ct=function(t){var r=t.stripe,s=t.options,o=t.children,i=m.useMemo(function(){return Jt(r)},[r]),u=m.useState(function(){return{stripe:i.tag==="sync"?i.stripe:null,elements:i.tag==="sync"?i.stripe.elements(s):null}}),l=st(u,2),c=l[0],v=l[1];m.useEffect(function(){var d=!0,F=function(p){v(function($){return $.stripe?$:{stripe:p,elements:p.elements(s)}})};return i.tag==="async"&&!c.stripe?i.stripePromise.then(function(a){a&&d&&F(a)}):i.tag==="sync"&&!c.stripe&&F(i.stripe),function(){d=!1}},[i,c,s]);var y=Pe(r);m.useEffect(function(){y!==null&&y!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[y,r]);var S=Pe(s);return m.useEffect(function(){if(c.elements){var d=at(s,S,["clientSecret","fonts"]);d&&c.elements.update(d)}},[s,S,c.elements]),m.useEffect(function(){Yt(c.stripe)},[c.stripe]),m.createElement(fe.Provider,{value:c},o)};ct.propTypes={stripe:f.any,options:f.object};var Kt=function(t){var r=m.useContext(fe);return it(r,t)},Qt=function(){var t=Kt("calls useElements()"),r=t.elements;return r};f.func.isRequired;var lt=m.createContext(null);lt.displayName="CustomCheckoutSdkContext";var Xt=function(t,r){if(!t)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(r," in an <CustomCheckoutProvider> provider."));return t},Zt=m.createContext(null);Zt.displayName="CustomCheckoutContext";f.any,f.shape({clientSecret:f.string.isRequired,elementsOptions:f.object}).isRequired;var Oe=function(t){var r=m.useContext(lt),s=m.useContext(fe);if(r&&s)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CustomCheckoutProvider> and <Elements> providers."));return r?Xt(r,t):it(s,t)},er=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},x=function(t,r){var s="".concat(er(t),"Element"),o=function(c){var v=c.id,y=c.className,S=c.options,d=S===void 0?{}:S,F=c.onBlur,a=c.onFocus,p=c.onReady,$=c.onChange,_=c.onEscape,G=c.onClick,W=c.onLoadError,B=c.onLoaderStart,L=c.onNetworksChange,J=c.onConfirm,Y=c.onCancel,te=c.onShippingAddressChange,re=c.onShippingRateChange,E=Oe("mounts <".concat(s,">")),D="elements"in E?E.elements:null,U="customCheckoutSdk"in E?E.customCheckoutSdk:null,ce=m.useState(null),C=st(ce,2),j=C[0],he=C[1],P=m.useRef(null),K=m.useRef(null);w(j,"blur",F),w(j,"focus",a),w(j,"escape",_),w(j,"click",G),w(j,"loaderror",W),w(j,"loaderstart",B),w(j,"networkschange",L),w(j,"confirm",J),w(j,"cancel",Y),w(j,"shippingaddresschange",te),w(j,"shippingratechange",re),w(j,"change",$);var Q;p&&(t==="expressCheckout"?Q=p:Q=function(){p(j)}),w(j,"ready",Q),m.useLayoutEffect(function(){if(P.current===null&&K.current!==null&&(D||U)){var k=null;U?k=U.createElement(t,d):D&&(k=D.create(t,d)),P.current=k,he(k),k&&k.mount(K.current)}},[D,U,d]);var ne=Pe(d);return m.useEffect(function(){if(P.current){var k=at(d,ne,["paymentRequest"]);k&&"update"in P.current&&P.current.update(k)}},[d,ne]),m.useLayoutEffect(function(){return function(){if(P.current&&typeof P.current.destroy=="function")try{P.current.destroy(),P.current=null}catch{}}},[]),m.createElement("div",{id:v,className:y,ref:K})},i=function(c){Oe("mounts <".concat(s,">"));var v=c.id,y=c.className;return m.createElement("div",{id:v,className:y})},u=r?i:o;return u.propTypes={id:f.string,className:f.string,onChange:f.func,onBlur:f.func,onFocus:f.func,onReady:f.func,onEscape:f.func,onClick:f.func,onLoadError:f.func,onLoaderStart:f.func,onNetworksChange:f.func,onConfirm:f.func,onCancel:f.func,onShippingAddressChange:f.func,onShippingRateChange:f.func,options:f.object},u.displayName=s,u.__elementType=t,u},g=typeof window>"u",tr=m.createContext(null);tr.displayName="EmbeddedCheckoutProviderContext";var rr=function(){var t=Oe("calls useStripe()"),r=t.stripe;return r};x("auBankAccount",g);x("card",g);x("cardNumber",g);x("cardExpiry",g);x("cardCvc",g);x("fpxBank",g);x("iban",g);x("idealBank",g);x("p24Bank",g);x("epsBank",g);var nr=x("payment",g);x("expressCheckout",g);x("currencySelector",g);x("paymentRequestButton",g);x("linkAuthentication",g);x("address",g);x("shippingAddress",g);x("paymentMethodMessaging",g);x("affirmMessage",g);x("afterpayClearpayMessage",g);const sr=Ot({title:z().min(1,"Title is required"),firstName:z().min(1,"First name is required"),lastName:z().min(1,"Last name is required"),email:z().email("Valid email is required"),phone:z().min(10,"Valid phone number is required"),arrivalTime:z().optional(),specialRequests:z().optional(),smsNotifications:je().default(!1),emailUpdates:je().default(!0),roomPreferences:z().optional(),acknowledgment:je().refine(n=>n===!0,{message:"You must acknowledge the terms and conditions"})});function ar({onChange:n,initial:t}){const[r,s]=b.useState(!1),{toast:o}=Ze(),{user:i}=mt(),u=()=>{const{guestInfo:a}=Ge.getState();return{title:"",firstName:"",lastName:"",email:"",phone:"",arrivalTime:"",specialRequests:"",smsNotifications:!1,emailUpdates:!0,roomPreferences:"",acknowledgment:!1,...a,...t}},l=bt({resolver:St(sr),mode:"onBlur",defaultValues:u()}),{watch:c,formState:{isValid:v}}=l,y=b.useCallback(()=>{if(n){const a=l.getValues();v&&a.firstName&&a.lastName&&a.email&&Ge.getState().setGuestInfo({firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone||"",title:a.title,arrivalTime:a.arrivalTime,specialRequests:a.specialRequests,roomPreferences:a.roomPreferences,smsNotifications:a.smsNotifications,emailUpdates:a.emailUpdates}),n(a,v)}},[n,v,l]);b.useEffect(()=>{const a=l.watch(()=>{y()});return y(),()=>a.unsubscribe()},[l,y]);const S=a=>a.toUpperCase(),d=()=>{o({title:"Demo data not available",description:"Please enter guest information manually",variant:"destructive"})},F=async()=>{if(!(i!=null&&i.id)){o({title:"Please log in",description:"You need to be logged in to use saved information",variant:"destructive"});return}s(!0);try{const a=await $e.loadUserStoredData(i.id);if(!a.hasStoredData){o({title:"No saved data found",description:"Please save your preferences and passport info first",variant:"destructive"});return}const p=$e.userDataToHotelForm(a);l.reset(p),o({title:"Information loaded",description:"Form filled with your saved information"})}catch{o({title:"Error loading data",description:"Could not load your saved information",variant:"destructive"})}finally{setTimeout(()=>s(!1),500)}};return e.jsxs(Se,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Guest Details"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ie,{type:"button",variant:"outline",size:"sm",onClick:d,disabled:r,className:"text-xs",children:[e.jsx(pt,{className:"h-3 w-3 mr-1"}),"Fill Demo Data"]}),e.jsxs(ie,{type:"button",variant:"outline",size:"sm",onClick:F,disabled:r,className:"text-xs",children:[e.jsx(ft,{className:"h-3 w-3 mr-1"}),"Use My Info"]})]})]}),e.jsx(Pt,{...l,children:e.jsxs("form",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{control:l.control,name:"title",render:({field:a})=>e.jsxs(A,{children:[e.jsx(R,{children:"Title"}),e.jsxs(Ct,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(T,{children:e.jsx(Nt,{children:e.jsx(kt,{placeholder:"Select title"})})}),e.jsxs(wt,{children:[e.jsx(ue,{value:"Mr",children:"Mr"}),e.jsx(ue,{value:"Mrs",children:"Mrs"}),e.jsx(ue,{value:"Ms",children:"Ms"}),e.jsx(ue,{value:"Dr",children:"Dr"})]})]}),e.jsx(V,{})]})}),e.jsx(I,{control:l.control,name:"firstName",render:({field:a})=>e.jsxs(A,{children:[e.jsx(R,{children:"First Name"}),e.jsx(T,{children:e.jsx(X,{...a,onChange:p=>a.onChange(S(p.target.value)),placeholder:"Enter first name"})}),e.jsx(V,{})]})}),e.jsx(I,{control:l.control,name:"lastName",render:({field:a})=>e.jsxs(A,{children:[e.jsx(R,{children:"Last Name"}),e.jsx(T,{children:e.jsx(X,{...a,onChange:p=>a.onChange(S(p.target.value)),placeholder:"Enter last name"})}),e.jsx(V,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(I,{control:l.control,name:"email",render:({field:a})=>e.jsxs(A,{children:[e.jsx(R,{children:"Email"}),e.jsx(T,{children:e.jsx(X,{...a,type:"email",placeholder:"Enter email address"})}),e.jsx(V,{})]})}),e.jsx(I,{control:l.control,name:"phone",render:({field:a})=>e.jsxs(A,{children:[e.jsx(R,{children:"Phone Number"}),e.jsx(T,{children:e.jsx(X,{...a,placeholder:"Enter phone number"})}),e.jsx(V,{})]})})]}),e.jsx(I,{control:l.control,name:"arrivalTime",render:({field:a})=>e.jsxs(A,{children:[e.jsx(R,{children:"Estimated Arrival Time (Optional)"}),e.jsx(T,{children:e.jsx(X,{...a,placeholder:"e.g., 3:00 PM or After 6:00 PM"})}),e.jsx(V,{})]})}),e.jsx(I,{control:l.control,name:"roomPreferences",render:({field:a})=>e.jsxs(A,{children:[e.jsx(R,{children:"Room Preferences (Optional)"}),e.jsx(T,{children:e.jsx(X,{...a,placeholder:"e.g., High floor, Quiet room, Near elevator"})}),e.jsx(V,{})]})}),e.jsx(I,{control:l.control,name:"specialRequests",render:({field:a})=>e.jsxs(A,{children:[e.jsx(R,{children:"Special Requests (Optional)"}),e.jsx(T,{children:e.jsx(Et,{...a,placeholder:"Enter any special requests or accessibility needs",className:"min-h-[80px]"})}),e.jsx(V,{})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{control:l.control,name:"smsNotifications",render:({field:a})=>e.jsxs(A,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(T,{children:e.jsx(ye,{checked:a.value,onCheckedChange:a.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(R,{children:"Receive SMS notifications about booking updates"})})]})}),e.jsx(I,{control:l.control,name:"emailUpdates",render:({field:a})=>e.jsxs(A,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(T,{children:e.jsx(ye,{checked:a.value,onCheckedChange:a.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(R,{children:"Receive email updates about your stay"})})]})}),e.jsx(I,{control:l.control,name:"acknowledgment",render:({field:a})=>e.jsxs(A,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(T,{children:e.jsx(ye,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(R,{children:"I acknowledge that I have read and agree to the hotel's booking terms, cancellation policy, and privacy policy."}),e.jsx(V,{})]})]})})]})]})})]})}const or=({currentStep:n,totalSteps:t=3,steps:r=["Search","Room Selection","Checkout","Payment"]})=>{const s=t||r.length,o=n/s*100;return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Step ",n," of ",s]}),e.jsxs("span",{children:[Math.round(o),"%"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-primary-hover transition-all duration-500 ease-out",style:{width:`${o}%`}})})]}),e.jsx("div",{className:"flex items-center justify-center space-x-4",children:r.slice(0,s).map((i,u)=>{const l=u+1,c=l<n,v=l===n;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[c?e.jsx(It,{className:"h-5 w-5 text-green-600"}):e.jsx(ht,{className:We("h-5 w-5",v?"text-primary fill-primary":"text-muted-foreground")}),e.jsx("span",{className:We("text-sm font-medium",v?"text-primary":c?"text-green-600":"text-muted-foreground"),children:i})]}),u<s-1&&e.jsx("div",{className:"w-8 h-0.5 bg-border ml-2"})]},i)})})]})};let be=null;const ir=async()=>(be||(be=(async()=>{try{const{data:n,error:t}=await we.functions.invoke("get-stripe-publishable-key");if(t||!(n!=null&&n.publishable_key))throw Z.error("Failed to get Stripe publishable key:",t),new Error("Failed to load payment system");console.log("✅ Loading Stripe with key:",n.publishable_key.substring(0,20)+"...");const r=await _t(n.publishable_key);return console.log("✅ Stripe loaded successfully:",!!r),r}catch(n){return Z.error("Stripe initialization error:",n),null}})()),be);function cr(){var Ie,Ae,Re,Te;const[n]=xt();gt();const t=rr(),r=Qt(),{toast:s}=Ze(),[o,i]=b.useState(!1),[u,l]=b.useState(null),[c,v]=b.useState(!1),[y,S]=b.useState(null),[d,F]=b.useState(null),[a,p]=b.useState(null),[$,_]=b.useState(!0),G=n.get("hotelId"),W=n.get("offerId"),B=n.get("checkIn"),L=n.get("checkOut"),J=parseInt(n.get("adults")||"2"),Y=parseInt(n.get("children")||"0"),te=parseInt(n.get("rooms")||"1"),re=(n.get("addons")||"").split(",").filter(Boolean),E=n.get("bedPref")||"",D=n.get("note")||"";b.useEffect(()=>{(async()=>{var M,Fe,Be,Le,De,Ue,Me,_e;if(!G||!W||!B||!L){console.log("❌ Missing required parameters:",{hotelId:G,offerId:W,checkIn:B,checkOut:L}),p("Missing booking parameters. Please return to hotel search."),_(!1);return}try{p(null),console.log("🔍 Creating hotel booking with parameters:",{hotelId:G,offerId:W,checkIn:B,checkOut:L,adults:J,children:Y,rooms:te,addons:re,bedPref:E,note:D}),console.log("🔍 Testing Stripe publishable key...");const{data:H,error:se}=await we.functions.invoke("get-stripe-publishable-key");if(se){console.log("❌ Stripe key retrieval failed:",se),p("Payment system configuration error. Please contact support."),_(!1);return}if(!(H!=null&&H.publishable_key)){console.log("❌ No publishable key returned:",H),p("Payment system not configured. Please contact support."),_(!1);return}console.log("✅ Stripe key retrieved successfully");const q=JSON.parse(sessionStorage.getItem("selectedOffer")||"{}"),qe=JSON.parse(sessionStorage.getItem("selectedAddOns")||"[]"),ut=Math.ceil((new Date(L).getTime()-new Date(B).getTime())/(1e3*60*60*24)),xe=parseFloat(((M=q==null?void 0:q.price)==null?void 0:M.total)||"299.99"),ge=qe.reduce((le,ve)=>{const dt=ve.perNight?ve.price*ut:ve.price;return le+dt},0),Ve=xe+ge;console.log("💰 Pricing breakdown:",{baseAmount:xe,addOnsAmount:ge,totalAmount:Ve,currency:((Fe=q==null?void 0:q.price)==null?void 0:Fe.currency)||"USD"});const{data:N,error:O}=await we.functions.invoke("create-booking-payment",{body:{booking_type:"hotel",amount:Ve,currency:((Be=q==null?void 0:q.price)==null?void 0:Be.currency)||"USD",metadata:{hotelId:G,offerId:W,checkIn:B,checkOut:L,adults:J,children:Y,rooms:te,addons:re,bedPref:E,note:D,baseAmount:xe,addOnsAmount:ge,selectedAddOns:qe}}});if(console.log("📋 Booking creation response:",{data:N,error:O}),O)throw Z.error("Booking creation error:",O),(Le=O.message)!=null&&Le.includes("STRIPE_SECRET_KEY")?p("Payment system configuration error. Our technical team has been notified. Please try again in a few minutes or contact support."):(De=O.message)!=null&&De.includes("Authentication")?p("Session expired. Please refresh the page and try again."):(Ue=O.message)!=null&&Ue.includes("network")||(Me=O.message)!=null&&Me.includes("fetch")?p("Network connectivity issue. Please check your internet connection and try again."):(_e=O.message)!=null&&_e.includes("rate limit")?p("Too many requests. Please wait a moment before trying again."):p(`Booking preparation failed: ${O.message||O}. Please refresh the page or try a different payment method.`),O;if(N!=null&&N.success&&N.clientSecret)console.log("✅ Booking created successfully with client secret"),S(N.clientSecret),F({booking_id:N.booking_id,total_amount:N.total_amount,currency:N.currency,amount_cents:N.amount_cents}),s({title:"Booking prepared",description:"Ready for payment"});else{const le=(N==null?void 0:N.error)||"Failed to create booking - no client secret received";throw console.log("❌ Booking creation failed:",N),p(le),new Error(le)}}catch(H){Z.error("Error creating booking:",H);const se=H.message||"Failed to prepare booking";p(se),s({title:"Booking error",description:se,variant:"destructive"})}finally{_(!1)}})()},[G,W,B,L,J,Y,te,re,E,D,s]);const U=Math.ceil((new Date(L).getTime()-new Date(B).getTime())/(1e3*60*60*24)),ce=J+Y,C=JSON.parse(sessionStorage.getItem("selectedOffer")||"{}"),j=JSON.parse(sessionStorage.getItem("selectedAddOns")||"[]"),he=new Date(B).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),P=new Date(L).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),K=async()=>{if(!(!t||!r||!y)){v(!0);try{u&&sessionStorage.setItem("guestInfo",JSON.stringify(u));const{error:h}=await t.confirmPayment({elements:r,confirmParams:{return_url:`${window.location.origin}/booking-success?booking_id=${d==null?void 0:d.booking_id}&type=hotel`}});h&&(Z.error("Payment error:",h),s({title:"Payment failed",description:h.message,variant:"destructive"}))}catch(h){Z.error("Payment processing error:",h),s({title:"Payment error",description:"Failed to process payment",variant:"destructive"})}finally{v(!1)}}},Q=b.useCallback(()=>{if(!(c||!t||!r)){if(!u||!o){s({title:"Complete guest details",description:"Please fill all required fields before continuing.",variant:"destructive"});const h=document.getElementById("guest-details");h&&typeof h.scrollIntoView=="function"&&h.scrollIntoView({behavior:"smooth",block:"start"});return}K()}},[c,o,u,t,r,K,s]),ne=!o||!u||c||!y||!!a,k=b.useCallback((h,M)=>{l(h),i(M)},[]);return e.jsx(At,{children:e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Ce,{}),e.jsx("div",{className:"pt-24 pb-6 px-6 bg-gradient-to-b from-muted/30 to-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs(ie,{variant:"ghost",size:"sm",onClick:()=>window.history.back(),className:"mb-4",children:[e.jsx(Rt,{className:"h-4 w-4 mr-1"}),"Back to Room Selection"]}),e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Complete your ",e.jsx("span",{className:"hero-text",children:"Hotel Booking"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Enter guest details and confirm your reservation"}),e.jsx("div",{className:"mt-6",children:e.jsx(or,{currentStep:3,totalSteps:4})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 pb-20",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{id:"guest-details",children:e.jsx(ar,{onChange:k})}),e.jsxs(Se,{className:"travel-card",children:[e.jsx(vt,{children:e.jsx(yt,{children:"Payment Details"})}),e.jsxs(ze,{className:"space-y-4",children:[a?e.jsxs(Ne,{variant:"destructive",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx(ke,{children:a})]}):y?e.jsx(nr,{}):$?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Preparing payment..."})]}):e.jsxs(Ne,{children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx(ke,{children:"Payment system not ready. Please refresh the page."})]}),d&&e.jsx("div",{className:"bg-muted p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total Amount:"}),e.jsxs("span",{className:"font-bold text-lg",children:[d.currency," ",(Ie=d.total_amount)==null?void 0:Ie.toFixed(2)]})]})}),e.jsx(ie,{onClick:Q,className:"btn-primary h-12 w-full",size:"lg",disabled:ne,children:c?"Processing Payment...":"Pay Now"})]})]})]}),e.jsx("div",{children:e.jsx(Se,{className:"travel-card sticky top-24",children:e.jsxs(ze,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Hotel Booking Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Hotel Booking"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Offer ID: ",W]}),E&&E!=="any"&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Bed preference: ",E]}),D&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Special requests: ",D]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Check-in"}),e.jsx("p",{className:"font-medium",children:he})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Check-out"}),e.jsx("p",{className:"font-medium",children:P})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Duration"}),e.jsxs("p",{className:"font-medium",children:[U," nights"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Guests"}),e.jsxs("p",{className:"font-medium",children:[ce," ",ce===1?"guest":"guests"]})]})]}),j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Selected Add-ons"}),j.map(h=>{var M;return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[h.name," ",h.perNight?`(${U} nights)`:""]}),e.jsxs("span",{children:[((M=C==null?void 0:C.price)==null?void 0:M.currency)||"USD"," ",(h.price*(h.perNight?U:1)).toFixed(2)]})]},h.id)})]}),d&&e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[((Ae=C==null?void 0:C.price)==null?void 0:Ae.total)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Room Rate (",U," nights)"]}),e.jsxs("span",{children:[C.price.currency," ",parseFloat(C.price.total).toFixed(2)]})]}),j.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Add-ons"}),e.jsxs("span",{children:[((Re=C==null?void 0:C.price)==null?void 0:Re.currency)||d.currency," ",j.reduce((h,M)=>h+M.price*(M.perNight?U:1),0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[d.currency," ",(Te=d.total_amount)==null?void 0:Te.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg flex items-center space-x-2",children:[e.jsx(jt,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Secure Payment"}),e.jsx("p",{className:"text-xs text-green-600",children:"256-bit SSL encryption"})]})]})]}),e.jsx(ie,{onClick:Q,className:"w-full mt-6 btn-primary h-12",disabled:ne,children:c?"Processing Payment...":"Pay Now"})]})})})]})})]})})}function wr(){const[n,t]=b.useState(null),[r,s]=b.useState(null);b.useEffect(()=>{(async()=>{try{const u=await ir();u?(t(u),console.log("✅ Stripe initialized successfully")):s("Failed to initialize payment system")}catch(u){console.error("Stripe initialization error:",u),s("Failed to load payment system")}})()},[]);const o=b.useMemo(()=>({appearance:{theme:"stripe"}}),[]);return r?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Ce,{}),e.jsx("div",{className:"pt-24 px-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(Ne,{variant:"destructive",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsxs(ke,{children:[r,". Please refresh the page or contact support."]})]})})})]}):n?e.jsx(ct,{stripe:n,options:o,children:e.jsx(cr,{})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Ce,{}),e.jsx("div",{className:"pt-24 px-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading payment system..."})]})})]})}export{wr as default};
