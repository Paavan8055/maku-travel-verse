import{m as F,u as S,h as P,i as T,r,j as e,L as g,a as p,e as j,B as l,f as D,b as L,g as J,P as U}from"./index-B3Fp9pX--1758306666989.js";import{t as N}from"./travelFundClient-DQgO_gRD-1758306666989.js";import{M as _}from"./map-pin-L_b8NZ8E-1758306666989.js";import{C as k}from"./calendar-BIklBwwn-1758306666989.js";import{T as M}from"./target-B-fdJCvR-1758306666989.js";import{U as B}from"./users-Bzs_S0Lp-1758306666989.js";const Y=()=>{const[v]=F(),i=S(),{user:o}=P(),{toast:c}=T(),[y,m]=r.useState(!0),[u,x]=r.useState(!1),[s,w]=r.useState(null),[h,d]=r.useState(""),a=v.get("code");r.useEffect(()=>{(async()=>{if(!a){d("Invalid invitation link"),m(!1);return}try{const{data:n,error:C}=await N.joinFundByCode(a);C?d("Fund not found or invitation expired"):w(n)}catch{d("Unable to load fund details")}finally{m(!1)}})()},[a]);const b=async()=>{if(!o){i(`/auth?redirect=${encodeURIComponent(window.location.pathname+window.location.search)}`);return}if(a){x(!0);try{const{data:t,error:n}=await N.joinFundByCode(a);n?c({title:"Unable to join fund",description:n.message||"Please check the invitation and try again.",variant:"destructive"}):(c({title:"Successfully joined fund!",description:`Welcome to "${t==null?void 0:t.name}". You can now contribute and use the shared balance.`,variant:"default"}),i("/travel-fund"))}catch{c({title:"Error joining fund",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{x(!1)}}};if(y)return e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(g,{className:"h-8 w-8 animate-spin"})});if(h||!s)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(p,{className:"max-w-md mx-auto",children:e.jsxs(j,{className:"text-center p-6",children:[e.jsx("p",{className:"text-destructive mb-4",children:h||"Fund not found"}),e.jsx(l,{onClick:()=>i("/"),variant:"outline",children:"Return Home"})]})})});const f=s.target_amount?Math.round(s.balance/s.target_amount*100):0;return e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:e.jsxs(p,{className:"shadow-lg",children:[e.jsxs(D,{className:"text-center pb-6",children:[e.jsx(L,{variant:"secondary",className:"mb-2 mx-auto w-fit",children:"Travel Fund Invitation"}),e.jsx(J,{className:"text-3xl font-bold",children:s.name}),s.description&&e.jsx("p",{className:"text-muted-foreground mt-2",children:s.description})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold mb-2",children:["$",s.balance.toLocaleString()," ",s.currency]}),s.target_amount&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{value:f,className:"h-3"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[f,"% of $",s.target_amount.toLocaleString()," goal"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.destination&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Destination: ",s.destination]})]}),s.deadline&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Deadline: ",new Date(s.deadline).toLocaleDateString()]})]}),s.target_amount&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Target: $",s.target_amount.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Type: ",s.fund_type," fund"]})]})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Join this travel fund to save money together for your dream trip!"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Powered by MAKU.Travel - Making group travel savings simple and secure"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{onClick:b,className:"flex-1",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),o?"Joining Fund...":"Redirecting..."]}):o?"Join This Fund":"Sign Up & Join Fund"}),e.jsx(l,{variant:"outline",onClick:()=>i("/"),className:"px-6",children:"Learn More"})]}),!o&&e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Already have an account? You'll be redirected to sign in."})]})]})})};export{Y as default};
