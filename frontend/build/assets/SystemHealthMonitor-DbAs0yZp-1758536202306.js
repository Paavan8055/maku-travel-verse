import{r as x,z as q,j as s,i as r,o as i,ae as w,ab as k,a6 as u,ad as S,k as n,l as c,m as L,a5 as E,B as F,R as I,w as t,x as T,Z as O,a7 as j}from"./index-BZMa5YK6-1758536202306.js";import{A as z}from"./activity-Tw0j6FJ0-1758536202306.js";import{D as Z}from"./database-C80_2prv-1758536202306.js";import{C as G}from"./clock-DuCsZkP2-1758536202306.js";import{C as Q}from"./circle-check-big-B2XwWZ78-1758536202306.js";const W=()=>{const[e,C]=x.useState(null),[A,_]=x.useState(!0),[p,P]=x.useState(null),{toast:H}=q(),f=async()=>{var a,N,v,g,b;try{_(!0);const[m,o,B,h]=await Promise.all([j.from("user_activity_logs").select("*").limit(100),j.from("provider_health").select("*").order("last_checked",{ascending:!1}),j.from("bookings").select("status").eq("status","pending"),j.from("critical_alerts").select("*").eq("resolved",!1)]),D={overall_health:h.data&&h.data.length>5?"critical":h.data&&h.data.length>0?"degraded":"healthy",auth_system:{status:m.error?"broken":"working",users_count:150,sessions_active:12,errors_24h:m.error?5:0},provider_apis:{status:o.data&&o.data.length>0?"healthy":"degraded",amadeus_status:((N=(a=o.data)==null?void 0:a.find(M=>M.provider==="amadeus-flight"))==null?void 0:N.status)||"unknown",sabre_status:"healthy",hotelbeds_status:"degraded",response_time_avg:((g=(v=o.data)==null?void 0:v[0])==null?void 0:g.response_time_ms)||0},database:{status:"healthy",connections_active:45,query_performance:95,stuck_bookings:((b=B.data)==null?void 0:b.length)||0},payment_system:{status:"healthy",stripe_status:"operational",pending_payments:3,success_rate_24h:98.5}};C(D),P(new Date)}catch(m){console.error("Failed to fetch system metrics:",m),H({title:"Metrics Fetch Failed",description:"Could not load system health metrics",variant:"destructive"})}finally{_(!1)}};x.useEffect(()=>{f();const a=setInterval(f,3e4);return()=>clearInterval(a)},[]);const l=a=>{switch(a){case"healthy":case"working":case"operational":return"text-green-600 bg-green-50";case"degraded":return"text-yellow-600 bg-yellow-50";case"critical":case"broken":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},d=a=>{switch(a){case"healthy":case"working":case"operational":return s.jsx(Q,{className:"w-4 h-4"});case"degraded":return s.jsx(u,{className:"w-4 h-4"});case"critical":case"broken":return s.jsx(u,{className:"w-4 h-4"});default:return s.jsx(G,{className:"w-4 h-4"})}},R=()=>{if(!e)return 0;let a=100;return e.auth_system.status==="broken"?a-=30:e.auth_system.status==="degraded"&&(a-=15),e.provider_apis.status==="critical"?a-=25:e.provider_apis.status==="degraded"&&(a-=10),e.database.stuck_bookings>10?a-=20:e.database.stuck_bookings>0&&(a-=5),e.payment_system.success_rate_24h<95&&(a-=15),Math.max(a,0)};if(A)return s.jsx(r,{children:s.jsxs(i,{className:"flex items-center justify-center p-6",children:[s.jsx(w,{className:"w-6 h-6 animate-spin mr-2"}),"Loading system metrics..."]})});if(!e)return s.jsxs(k,{variant:"destructive",children:[s.jsx(u,{className:"h-4 w-4"}),s.jsx(S,{children:"Failed to load system health metrics. Please refresh or check your connection."})]});const y=R();return s.jsxs("div",{className:"space-y-6",children:[s.jsxs(r,{children:[s.jsxs(n,{children:[s.jsxs(c,{className:"flex items-center gap-2",children:[s.jsx(z,{className:"w-5 h-5"}),"System Health Overview"]}),s.jsx(L,{children:"Real-time monitoring of critical system components"})]}),s.jsx(i,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium",children:"Overall Health Score"}),s.jsxs("span",{className:"text-2xl font-bold",children:[y,"%"]})]}),s.jsx(E,{value:y,className:"h-3"}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("span",{className:"text-muted-foreground",children:["Last updated: ",p==null?void 0:p.toLocaleTimeString()]}),s.jsxs(F,{onClick:f,size:"sm",variant:"outline",children:[s.jsx(w,{className:"w-4 h-4 mr-1"}),"Refresh"]})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs(r,{children:[s.jsx(n,{className:"pb-3",children:s.jsxs(c,{className:"flex items-center gap-2 text-base",children:[s.jsx(I,{className:"w-4 h-4"}),"Authentication System",s.jsxs(t,{className:l(e.auth_system.status),children:[d(e.auth_system.status),e.auth_system.status]})]})}),s.jsxs(i,{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Users"}),s.jsx("span",{className:"font-medium",children:e.auth_system.users_count})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Active Sessions"}),s.jsx("span",{className:"font-medium",children:e.auth_system.sessions_active})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Errors (24h)"}),s.jsx("span",{className:"font-medium",children:e.auth_system.errors_24h})]})]})]}),s.jsxs(r,{children:[s.jsx(n,{className:"pb-3",children:s.jsxs(c,{className:"flex items-center gap-2 text-base",children:[s.jsx(T,{className:"w-4 h-4"}),"Provider APIs",s.jsxs(t,{className:l(e.provider_apis.status),children:[d(e.provider_apis.status),e.provider_apis.status]})]})}),s.jsxs(i,{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Amadeus"}),s.jsx(t,{variant:"outline",className:"text-xs",children:e.provider_apis.amadeus_status})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Sabre"}),s.jsx(t,{variant:"outline",className:"text-xs",children:e.provider_apis.sabre_status})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"HotelBeds"}),s.jsx(t,{variant:"outline",className:"text-xs",children:e.provider_apis.hotelbeds_status})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Avg Response"}),s.jsxs("span",{className:"font-medium",children:[e.provider_apis.response_time_avg,"ms"]})]})]})]}),s.jsxs(r,{children:[s.jsx(n,{className:"pb-3",children:s.jsxs(c,{className:"flex items-center gap-2 text-base",children:[s.jsx(Z,{className:"w-4 h-4"}),"Database",s.jsxs(t,{className:l(e.database.status),children:[d(e.database.status),e.database.status]})]})}),s.jsxs(i,{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Active Connections"}),s.jsx("span",{className:"font-medium",children:e.database.connections_active})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Query Performance"}),s.jsxs("span",{className:"font-medium",children:[e.database.query_performance,"%"]})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Stuck Bookings"}),s.jsx("span",{className:`font-medium ${e.database.stuck_bookings>0?"text-red-600":"text-green-600"}`,children:e.database.stuck_bookings})]})]})]}),s.jsxs(r,{children:[s.jsx(n,{className:"pb-3",children:s.jsxs(c,{className:"flex items-center gap-2 text-base",children:[s.jsx(O,{className:"w-4 h-4"}),"Payment System",s.jsxs(t,{className:l(e.payment_system.status),children:[d(e.payment_system.status),e.payment_system.status]})]})}),s.jsxs(i,{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Stripe Status"}),s.jsx(t,{variant:"outline",className:"text-xs",children:e.payment_system.stripe_status})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Pending Payments"}),s.jsx("span",{className:"font-medium",children:e.payment_system.pending_payments})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:"Success Rate (24h)"}),s.jsxs("span",{className:"font-medium",children:[e.payment_system.success_rate_24h,"%"]})]})]})]})]}),y<80&&s.jsxs(k,{variant:"destructive",children:[s.jsx(u,{className:"h-4 w-4"}),s.jsx(S,{children:"System health is below acceptable levels. Critical issues require immediate attention."})]})]})};export{W as SystemHealthMonitor};
