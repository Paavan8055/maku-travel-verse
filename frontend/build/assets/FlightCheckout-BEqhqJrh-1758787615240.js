import{r as S,t as q,s as $,j as e,k,l as D,B as j,S as M,x as z,I as y,e as Z,p as T,U as G,J,aF as Y,ao as _,G as R,P as F,a as O,au as U,b as B,aa as E,g as W,N as H,y as K}from"./index-sjMrv3Ur-1758787615240.js";import{F as Q}from"./FlightBookingProgress-BRl-1Dtd-1758787615240.js";import{u as X,t as ee}from"./zod-CYnAEjta-1758787615240.js";import{S as se,a as ae,b as te,c as re,d as ie}from"./select-_L-I_tXd-1758787615240.js";import{L as f}from"./label-BgKM8khV-1758787615240.js";import{C as le}from"./checkbox-CL3ii1Rb-1758787615240.js";import{a as A}from"./autofillService-Qc2KkK-5-1758787615240.js";import{u as L}from"./bookingStore-BTvEpksk-1758787615240.js";import{o as ne,b as ce,s as v,e as oe}from"./types-BekIk3NQ-1758787615240.js";import{C as de}from"./chevron-left-B_7GVsNv-1758787615240.js";import"./circle-check-CXt0PjuS-1758787615240.js";import"./index-BdQq_4o_-1758787615240.js";import"./index-Ds7e5B5O-1758787615240.js";const me=ne({title:oe(["MR","MRS","MS","DR","PROF"],{required_error:"Title is required"}),firstName:v().min(1,"First name is required").transform(a=>a.toUpperCase()).refine(a=>/^[A-Z '-]+$/.test(a),{message:"Use letters A-Z only; no accents or special characters"}),lastName:v().min(1,"Last name is required").transform(a=>a.toUpperCase()).refine(a=>/^[A-Z '-]+$/.test(a),{message:"Use letters A-Z only; no accents or special characters"}),dateOfBirth:v().refine(a=>!!Date.parse(a)&&new Date(a)<new Date,{message:"Enter a valid past date"}),nationality:v().min(2,"2-3 letter code").max(3,"2-3 letter code").transform(a=>a.toUpperCase()).refine(a=>/^[A-Z]{2,3}$/.test(a),{message:"Use 2-3 letter ISO code"}),idDocument:v().min(5,"ID document number is required").transform(a=>a.toUpperCase()).refine(a=>/^[A-Z0-9]+$/.test(a),{message:"Alphanumeric only"}),email:v().email(),phone:v().regex(/^\+?[1-9]\d{7,14}$/i,"Use international format, e.g., +15551234567"),specialRequests:v().optional(),acknowledge:ce().refine(a=>a===!0,{message:"You must confirm before continuing"})}),xe=({onChange:a,initial:u,bookingType:s="hotel"})=>{const[o,h]=S.useState(!1),{toast:p}=q(),{user:t}=$(),x=()=>{const{passengerInfo:i}=L.getState(),c={title:"MR",acknowledge:!1,email:"",phone:"",firstName:"",lastName:"",specialRequests:"",dateOfBirth:"",nationality:"",idDocument:""};return i&&Object.assign(c,i),u&&Object.assign(c,u),c},{register:r,setValue:g,reset:N,watch:b,formState:{errors:l,isValid:d}}=X({resolver:ee(me),mode:"onChange",defaultValues:x()}),m=i=>c=>{g(i,c.target.value.toUpperCase(),{shouldValidate:!0})},I=()=>{p({title:"Demo data not available",description:"Please enter passenger information manually",variant:"destructive"})},P=async()=>{if(!(t!=null&&t.id)){p({title:"Please log in",description:"You need to be logged in to use saved information",variant:"destructive"});return}h(!0);try{const i=await A.loadUserStoredData(t.id);if(!i.hasStoredData){p({title:"No saved data found",description:"Please save your preferences and passport info first",variant:"destructive"});return}const c=A.userDataToPersonalForm(i);N(c),p({title:"Passport information loaded",description:"Form filled with your passport details"})}catch{p({title:"Error loading data",description:"Could not load your passport information",variant:"destructive"})}finally{setTimeout(()=>h(!1),500)}},n=b();return S.useEffect(()=>{if(d&&n&&n.firstName&&n.lastName&&n.email&&n.dateOfBirth){const i={firstName:n.firstName,lastName:n.lastName,email:n.email,phone:n.phone||"",dateOfBirth:n.dateOfBirth,gender:"M",title:n.title,nationality:n.nationality,specialRequests:n.specialRequests};L.getState().setPassengerInfo(i)}a==null||a(d?n:null,d)},[n,d,a]),e.jsx(k,{className:"travel-card",children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:s==="flight"?"Passenger Details":s==="activity"?"Participant Details":"Guest Details"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s==="flight"?"Enter passenger information as it appears on your ID document. This information will be used for flight check-in and boarding.":s==="activity"?"Enter participant information as it appears on your ID document.":"Enter guest information as it appears on your ID document. This information will be used for hotel check-in."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:I,disabled:o,className:"text-xs",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Fill Demo Data"]}),e.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:P,disabled:o,className:"text-xs",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Use My Passport"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx(f,{className:"mb-2 block",children:"Title"}),e.jsxs(se,{value:n.title,onValueChange:i=>g("title",i,{shouldValidate:!0}),children:[e.jsx(ae,{className:"w-full",children:e.jsx(te,{placeholder:"Title"})}),e.jsx(re,{className:"bg-card z-50",children:["MR","MRS","MS","DR","PROF"].map(i=>e.jsx(ie,{value:i,children:i},i))})]}),l.title&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.title.message})]}),e.jsxs("div",{className:"md:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{className:"mb-2 block",children:"First / Given Name"}),e.jsx(y,{...r("firstName"),onChange:m("firstName"),placeholder:"JANE"}),l.firstName&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.firstName.message})]}),e.jsxs("div",{children:[e.jsx(f,{className:"mb-2 block",children:"Last / Surname"}),e.jsx(y,{...r("lastName"),onChange:m("lastName"),placeholder:"DOE"}),l.lastName&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.lastName.message})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsx(f,{className:"mb-2 block",children:"Date of Birth"}),e.jsx(y,{type:"date",...r("dateOfBirth"),max:new Date(Date.now()-18*365*24*60*60*1e3).toISOString().split("T")[0],placeholder:"Select your birth date",className:"text-sm"}),l.dateOfBirth&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.dateOfBirth.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Must be 18+ years old"})]}),e.jsxs("div",{children:[e.jsx(f,{className:"mb-2 block",children:"Nationality (ISO Code)"}),e.jsx(y,{...r("nationality"),placeholder:"AU, US, UK, etc.",maxLength:3,onChange:i=>g("nationality",i.target.value.toUpperCase(),{shouldValidate:!0})}),l.nationality&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.nationality.message})]}),e.jsxs("div",{children:[e.jsx(f,{className:"mb-2 block",children:"ID Document Number"}),e.jsx(y,{...r("idDocument"),placeholder:"Passport/ID Number",onChange:i=>g("idDocument",i.target.value.toUpperCase(),{shouldValidate:!0})}),l.idDocument&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.idDocument.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"As shown on your passport or ID"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsx(f,{className:"mb-2 block",children:"Email"}),e.jsx(y,{type:"email",...r("email"),placeholder:"name@example.com"}),l.email&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.email.message})]}),e.jsxs("div",{children:[e.jsx(f,{className:"mb-2 block",children:"Mobile"}),e.jsx(y,{...r("phone"),placeholder:"+123456789"}),l.phone&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.phone.message})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(f,{className:"mb-2 block",children:"Special Requests (Optional)"}),e.jsx(y,{...r("specialRequests"),placeholder:"e.g., Wheelchair accessibility, dietary requirements, seat preferences"}),l.specialRequests&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.specialRequests.message})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(le,{id:"acknowledge",checked:!!n.acknowledge,onCheckedChange:i=>g("acknowledge",!!i,{shouldValidate:!0})}),e.jsxs(f,{htmlFor:"acknowledge",className:"text-sm leading-5",children:["I confirm the provided information is accurate and will be used for ",s==="flight"?"flight check-in, boarding, and communication purposes.":s==="activity"?"activity booking and communication purposes.":"hotel check-in and communication purposes."]})]}),l.acknowledge&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:l.acknowledge.message})]})]})})},he=({tripType:a,isRoundtrip:u,outbound:s,inbound:o,segments:h,amount:p,currency:t,carryOn:x,checked:r,passengers:g=1,currentLeg:N})=>{const b=d=>d?d.replace(/_/g," "):"—",l=a==="multicity"?"Multi-city":u||a==="roundtrip"?"Roundtrip":N==="inbound"?"Return flight":"One-way";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium text-foreground",children:"Trip"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{variant:"secondary",className:"uppercase tracking-wide",children:l}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[g," ",g===1?"traveller":"travellers"]})]})]})]}),a==="multicity"&&h?e.jsx("div",{className:"space-y-3",children:h.map((d,m)=>e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium",children:["Segment ",m+1," ",d.id?`#${d.id}`:""]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.origin," → ",d.destination]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fare: ",d.fareType?d.fareType.toUpperCase():"—"]})]},m))}):u?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium",children:["Outbound ",s!=null&&s.id?`#${s.id}`:""]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fare: ",s!=null&&s.fareType?s.fareType.toUpperCase():"—"]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium",children:["Inbound ",o!=null&&o.id?`#${o.id}`:""]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fare: ",o!=null&&o.fareType?o.fareType.toUpperCase():"—"]})]})]}):e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium",children:[N==="inbound"?"Return Flight":"Flight"," ",s!=null&&s.id?`#${s.id}`:""]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fare: ",s!=null&&s.fareType?s.fareType.toUpperCase():"—"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Carry-on"}),e.jsx("p",{className:"font-medium",children:b(x)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Checked bags"}),e.jsx("p",{className:"font-medium",children:b(r)})]})]}),e.jsx("div",{className:"border-t pt-4 space-y-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[t," ",p.toFixed(2)]})]})}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg flex items-center space-x-2",children:[e.jsx(J,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Secure Payment"}),e.jsx("p",{className:"text-xs text-green-600",children:"256-bit SSL encryption"})]})]})]})},C=[{code:"USD",symbol:"$",name:"US Dollar",flag:"🇺🇸"},{code:"EUR",symbol:"€",name:"Euro",flag:"🇪🇺"},{code:"GBP",symbol:"£",name:"British Pound",flag:"🇬🇧"},{code:"AUD",symbol:"A$",name:"Australian Dollar",flag:"🇦🇺"},{code:"CAD",symbol:"C$",name:"Canadian Dollar",flag:"🇨🇦"},{code:"JPY",symbol:"¥",name:"Japanese Yen",flag:"🇯🇵"},{code:"SGD",symbol:"S$",name:"Singapore Dollar",flag:"🇸🇬"},{code:"NZD",symbol:"NZ$",name:"New Zealand Dollar",flag:"🇳🇿"},{code:"INR",symbol:"₹",name:"Indian Rupee",flag:"🇮🇳"}],pe=({variant:a="compact",showSelector:u=!0})=>{const{selectedCurrency:s,setSelectedCurrency:o,formatCurrency:h}=Y(),[p,t]=_.useState(!1),x=C.find(r=>r.code===s)||C[0];return a==="compact"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{variant:"outline",className:"bg-background/50 text-foreground border-border/50",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),s]}),u&&e.jsxs(F,{open:p,onOpenChange:t,children:[e.jsx(O,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"sm",className:"h-8 px-2",children:[x.flag," ",x.symbol,e.jsx(U,{className:"h-3 w-3 ml-1"})]})}),e.jsx(B,{className:"w-64 p-2",align:"end",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium px-2 py-1",children:"Select Currency"}),C.map(r=>e.jsxs(j,{variant:"ghost",size:"sm",className:"w-full justify-start h-8",onClick:()=>{o(r.code),t(!1)},children:[e.jsx("span",{className:"mr-2",children:r.flag}),e.jsx("span",{className:"mr-2",children:r.symbol}),e.jsx("span",{className:"flex-1 text-left",children:r.name}),r.code===s&&e.jsx(E,{className:"h-4 w-4 text-primary"})]},r.code))]})})]})]}):e.jsx(k,{className:"border-border/50 bg-background/50",children:e.jsxs(D,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Currency"})]}),e.jsx(T,{variant:"secondary",children:s})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mb-3",children:["All prices are displayed in ",x.name," (",x.symbol,") and converted from the original booking currency using live exchange rates."]}),u&&e.jsxs(F,{open:p,onOpenChange:t,children:[e.jsx(O,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"sm",className:"w-full",children:[x.flag," ",x.name," (",x.symbol,")",e.jsx(U,{className:"h-4 w-4 ml-auto"})]})}),e.jsx(B,{className:"w-64 p-2",align:"start",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium px-2 py-1",children:"Select Currency"}),C.map(r=>e.jsxs(j,{variant:"ghost",size:"sm",className:"w-full justify-start h-8",onClick:()=>{o(r.code),t(!1)},children:[e.jsx("span",{className:"mr-2",children:r.flag}),e.jsx("span",{className:"mr-2",children:r.symbol}),e.jsx("span",{className:"flex-1 text-left",children:r.name}),r.code===s&&e.jsx(E,{className:"h-4 w-4 text-primary"})]},r.code))]})})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t text-xs text-muted-foreground",children:["Example: ",h(1e3)," • ",h(99)," • ",h(15)]})]})})},Ie=()=>{const[a,u]=S.useState(!1),[s,o]=S.useState(null),h=W(),{toast:p}=q(),t=new URLSearchParams(typeof window<"u"?window.location.search:""),x=(t.get("tripType")||"").toLowerCase(),r=t.get("outboundId"),g=t.get("inboundId");t.get("flightId");const N=t.get("segments"),b=(t.get("leg")||t.get("phase")||t.get("step")||"").toLowerCase(),l=["return","inbound"].includes(b)||!!(t.get("inboundId")||t.get("inboundFare")),d=()=>{try{return N?JSON.parse(decodeURIComponent(N)):[]}catch{return[]}},m={tripType:x||(r&&g?"roundtrip":N?"multicity":"oneway"),isRoundtrip:x==="roundtrip"||!!(r&&g),flightId:t.get("flightId")||"",fareType:t.get("fareType")||"",outbound:{id:t.get("outboundId")||t.get("flightId")||"",fareType:t.get("outboundFare")||t.get("fareType")||""},inbound:{id:t.get("inboundId")||"",fareType:t.get("inboundFare")||""},segments:d(),amount:Number(t.get("amount"))||0,currency:t.get("currency")||"USD",carryOn:t.get("carryOn")||"",checked:t.get("checked")||""},I=Number(t.get("passengers")||"1"),P=()=>{console.log("goToPayment called for flight booking",{passenger:s});try{s&&(sessionStorage.setItem("passengerInfo",JSON.stringify(s)),console.log("Saved passenger info to session storage"))}catch(V){K.error("Session storage error:",V)}const c=new URLSearchParams(typeof window<"u"?window.location.search:"");c.set("booking_type","flight");const w=c.toString();console.log("Navigating to payment with search:",w),h(`/booking/payment?${w}`)},n=()=>{if(console.log("Continue button clicked for flight",{passengerValid:a,passenger:!!s}),!s||!a){console.log("Flight validation failed - missing passenger data"),p({title:"Complete passenger details",description:"Please fill all required fields before continuing.",variant:"destructive"});const c=document.getElementById("passenger-details");c&&typeof c.scrollIntoView=="function"&&c.scrollIntoView({behavior:"smooth",block:"start"});return}console.log("Flight validation passed, proceeding to payment"),P()},i=!a||!s;return console.log("Flight checkout button state:",{passengerValid:a,hasPassenger:!!s,isButtonDisabled:i,passenger:s?Object.keys(s):null}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(H,{}),e.jsx(Q,{currentStep:3,steps:["SELECT FLIGHTS","REVIEW & DETAILS","PAYMENT & CONFIRMATION"]}),e.jsx("div",{className:"pt-6 pb-6 px-6 bg-gradient-to-b from-muted/30 to-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>h("/flight-booking-review"),className:"mb-4",children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Back to Review"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Complete your ",e.jsx("span",{className:"hero-text",children:"Flight Booking"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Enter passenger details and confirm your reservation"})]}),e.jsx(pe,{variant:"compact"})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 pb-20",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{id:"passenger-details",children:e.jsx(xe,{bookingType:"flight",onChange:(c,w)=>{console.log("Passenger form change:",{data:c,valid:w}),o(c),u(w)}})}),e.jsx(k,{className:"travel-card",children:e.jsxs(D,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Next: Payment"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Continue to secure payment to complete your booking."}),e.jsx(j,{onClick:n,className:"btn-primary h-12",size:"lg",disabled:i,children:"Continue to Payment"})]})})]}),e.jsx("div",{children:e.jsx(k,{className:"travel-card sticky top-24",children:e.jsxs(D,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Flight Booking Summary"}),e.jsx(he,{tripType:m.tripType,isRoundtrip:m.isRoundtrip,outbound:m.outbound,inbound:m.inbound,segments:m.segments,amount:m.amount,currency:m.currency,carryOn:m.carryOn,checked:m.checked,passengers:I,currentLeg:l?"inbound":"outbound"}),e.jsx(j,{onClick:n,className:"w-full mt-6 btn-primary h-12",disabled:i,children:"Continue to Payment"})]})})})]})})]})};export{Ie as default};
