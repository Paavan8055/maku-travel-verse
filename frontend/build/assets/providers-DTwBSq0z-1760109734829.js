import{r as l,h as M,j as e,a as g,d as y,e as N,T as k,b as w,A as H,q as B,B as E,L as _,R as W,f as p,s as f,i as G,P as K}from"./index-Cmnr9LP--1760109734829.js";import{C as b}from"./circle-check-big-ycpJfV8o-1760109734829.js";import{C as A}from"./circle-x-CeNBIZS8-1760109734829.js";import{S as Y}from"./switch-BZdenPej-1760109734829.js";import{L as F}from"./label-CCXh4509-1760109734829.js";import{I as Z}from"./input-CvRviaNF-1760109734829.js";import{S as ee}from"./separator-DvuR2XD2-1760109734829.js";import{A as z}from"./activity-BotcgPdd-1760109734829.js";import{S as U}from"./settings-ZcJfgv_u-1760109734829.js";import{T as se}from"./test-tube-DVSM9nID-1760109734829.js";import{P as te}from"./play-2i87H3yk-1760109734829.js";import{C as ae}from"./clock-Bwk96H2g-1760109734829.js";import{T as re,a as ie,b as I,c as q}from"./tabs-UK-FnbdU-1760109734829.js";import{W as ce}from"./wrench-13CpcamF-1760109734829.js";import{S as ne}from"./shield-Df6Ze5q_-1760109734829.js";import"./index-BbuU9_Dk-1760109734829.js";const le=()=>{const[t,h]=l.useState(!1),[x,j]=l.useState([]),[v,P]=l.useState(""),[d,S]=l.useState(null),[u,s]=l.useState(!0),{toast:i}=M();l.useEffect(()=>{(async()=>{s(!0);try{const{data:n,error:C}=await f.functions.invoke("emergency-provider-fix",{body:{action:"test_auth"}});if(C)throw C;n!=null&&n.results&&j(n.results)}catch(n){console.error("Auto-load authentication test failed:",n)}finally{s(!1)}})()},[]);const T=async m=>{h(!0);try{const{data:n,error:C}=await f.functions.invoke("emergency-provider-fix",{body:{action:m}});if(C)throw C;switch(m){case"force_reset_health":P(`âœ… Reset ${n.count} providers to healthy status`),i({title:"Health Reset Complete",description:`${n.count} providers reset to healthy`});break;case"test_auth":j(n.results||[]);const L=n.summary||{working:0,total:0};i({title:"Authentication Test Complete",description:`${L.working}/${L.total} providers working`});break;case"test_rotation":S(n),i({title:"Provider Rotation Test",description:n.rotationWorking?"Rotation working!":"Rotation failed",variant:n.rotationWorking?"default":"destructive"});break}}catch(n){console.error("Emergency action failed:",n),i({title:"Emergency Action Failed",description:n.message,variant:"destructive"})}finally{h(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(y,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-warning"}),"Emergency Provider Recovery"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs(H,{children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(B,{children:"This panel provides emergency tools to fix circuit breaker issues and restore provider functionality. Use these tools when providers are stuck in unhealthy states."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(E,{onClick:()=>T("force_reset_health"),disabled:t,variant:"destructive",className:"h-20 flex flex-col gap-2",children:[t?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:"Force Reset Health"}),e.jsx("span",{className:"text-xs opacity-80",children:"Clear all unhealthy statuses"})]}),e.jsxs(E,{onClick:()=>T("test_auth"),disabled:t,variant:"outline",className:"h-20 flex flex-col gap-2",children:[t?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh Authentication"}),e.jsx("span",{className:"text-xs opacity-80",children:"Re-test all provider credentials"})]}),e.jsxs(E,{onClick:()=>T("test_rotation"),disabled:t,variant:"secondary",className:"h-20 flex flex-col gap-2",children:[t?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Rotation"}),e.jsx("span",{className:"text-xs opacity-80",children:"Verify provider rotation works"})]})]}),v&&e.jsxs(H,{children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(B,{children:v})]})]})]}),(u||x.length>0)&&e.jsxs(g,{children:[e.jsx(y,{children:e.jsxs(N,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Provider Authentication Status"}),u&&e.jsx(_,{className:"h-4 w-4 animate-spin"})]})}),e.jsx(w,{children:u?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"text-muted-foreground",children:"Testing provider authentication..."})}):e.jsx("div",{className:"space-y-3",children:x.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m.authSuccess?e.jsx(b,{className:"h-5 w-5 text-success"}):e.jsx(A,{className:"h-5 w-5 text-destructive"}),e.jsx("span",{className:"font-medium capitalize",children:m.provider})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:m.authSuccess?"default":"destructive",children:m.authSuccess?"Working":"Failed"}),m.error&&e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate",children:m.error})]})]},m.provider))})})]}),d&&e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(N,{children:"Provider Rotation Test"})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d.rotationWorking?e.jsx(b,{className:"h-5 w-5 text-success"}):e.jsx(A,{className:"h-5 w-5 text-destructive"}),e.jsxs("span",{className:"font-medium",children:["Rotation Status: ",d.rotationWorking?"Working":"Failed"]})]}),d.error&&e.jsxs(H,{variant:"destructive",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(B,{children:d.error})]}),d.result&&e.jsx("div",{className:"bg-muted p-3 rounded-lg",children:e.jsx("pre",{className:"text-sm overflow-auto",children:JSON.stringify(d.result,null,2)})})]})})]})]})},de=()=>{const[t,h]=l.useState(null),[x,j]=l.useState(!1),[v,P]=l.useState(null),d=async()=>{j(!0);try{const{data:s,error:i}=await f.functions.invoke("credential-test",{body:{}});if(i)throw i;h(s),P(new Date)}catch(s){console.error("Credential test failed:",s)}finally{j(!1)}};l.useEffect(()=>{d()},[]);const S=s=>s.credentialsValid?s.authSuccess?e.jsx(b,{className:"h-4 w-4 text-green-600"}):e.jsx(k,{className:"h-4 w-4 text-amber-500"}):e.jsx(A,{className:"h-4 w-4 text-destructive"}),u=s=>s.credentialsValid?s.authSuccess?e.jsx(p,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Connected"}):e.jsx(p,{variant:"outline",className:"border-amber-500 text-amber-700",children:"Auth Failed"}):e.jsx(p,{variant:"destructive",children:"Missing Credentials"});return e.jsxs(g,{children:[e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{children:"Provider Credential Status"}),e.jsxs(E,{onClick:d,disabled:x,variant:"outline",size:"sm",children:[e.jsx(W,{className:`h-4 w-4 mr-2 ${x?"animate-spin":""}`}),"Test All"]})]}),t&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Environment: ",e.jsx(p,{variant:"outline",children:t.environment}),v&&e.jsxs("span",{className:"ml-2",children:["Last tested: ",v.toLocaleTimeString()]})]})]}),e.jsx(w,{children:t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.summary.working}),e.jsx("div",{className:"text-muted-foreground",children:"Working"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.summary.failed}),e.jsx("div",{className:"text-muted-foreground",children:"Failed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:t.summary.total}),e.jsx("div",{className:"text-muted-foreground",children:"Total"})]})]}),e.jsx("div",{className:"space-y-3",children:t.providers.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[S(s),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium capitalize",children:s.provider}),s.error&&e.jsx("div",{className:"text-sm text-red-600",children:s.error})]})]}),u(s)]},s.provider))})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"text-muted-foreground",children:x?"Testing credentials...":"No test results available"})})})]})},oe=()=>{const[t,h]=l.useState([]),[x,j]=l.useState([]),[v,P]=l.useState([]),[d,S]=l.useState(!0),[u,s]=l.useState(null),{toast:i}=M();l.useEffect(()=>{T()},[]);const T=async()=>{try{const[r,c,a]=await Promise.all([f.from("provider_configs").select("*").order("priority"),f.from("provider_health").select("*"),f.from("provider_quotas").select("*")]);r.data&&h(r.data),c.data&&j(c.data),a.data&&P(a.data)}catch{i({title:"Error",description:"Failed to fetch provider data",variant:"destructive"})}finally{S(!1)}},m=async(r,c)=>{try{const{error:a}=await f.from("provider_configs").update({enabled:c}).eq("id",r);if(a)throw a;h(R=>R.map(o=>o.id===r?{...o,enabled:c}:o)),i({title:"Success",description:`Provider ${c?"enabled":"disabled"} successfully`})}catch{i({title:"Error",description:"Failed to update provider status",variant:"destructive"})}},n=async(r,c)=>{try{const{error:a}=await f.from("provider_configs").update({priority:c}).eq("id",r);if(a)throw a;h(R=>R.map(o=>o.id===r?{...o,priority:c}:o)),i({title:"Success",description:"Provider priority updated successfully"})}catch{i({title:"Error",description:"Failed to update provider priority",variant:"destructive"})}},C=async r=>{s(r);try{const{data:c,error:a}=await f.functions.invoke("provider-credential-test",{body:{provider:r}});if(a)throw a;i({title:c.success?"Test Successful":"Test Failed",description:c.message||"Provider test completed",variant:c.success?"default":"destructive"}),T()}catch{i({title:"Test Failed",description:"Failed to test provider credentials",variant:"destructive"})}finally{s(null)}},L=r=>{const c=x.find(a=>a.provider===r);if(!c)return{status:"unknown",color:"secondary"};switch(c.status){case"healthy":return{status:"healthy",color:"success",icon:b};case"degraded":return{status:"degraded",color:"warning",icon:k};case"unhealthy":return{status:"unhealthy",color:"destructive",icon:A};default:return{status:"unknown",color:"secondary",icon:z}}},V=r=>v.find(c=>c.provider_id===r);if(d)return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Loading provider configuration..."})]})});const O=t.filter(r=>r.type==="flight"),Q=t.filter(r=>r.type==="hotel"),J=t.filter(r=>r.type==="activity"),$=({title:r,providers:c})=>e.jsxs(g,{children:[e.jsxs(y,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),r," Providers"]}),e.jsxs(G,{children:["Configure and manage ",r.toLowerCase()," search providers"]})]}),e.jsx(w,{className:"space-y-4",children:c.map(a=>{const R=L(a.id),o=V(a.id),X=R.icon;return e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:a.name})]}),e.jsx(p,{variant:R.color,children:R.status}),o&&e.jsxs(p,{variant:o.percentage_used>80?"destructive":"secondary",children:[o.percentage_used.toFixed(1),"% used"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{checked:a.enabled,onCheckedChange:D=>m(a.id,D)}),e.jsx(F,{className:"text-sm",children:"Enabled"})]})]}),e.jsx(ee,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:`priority-${a.id}`,children:"Priority"}),e.jsx(Z,{id:`priority-${a.id}`,type:"number",min:"1",max:"10",value:a.priority,onChange:D=>n(a.id,parseInt(D.target.value)),className:"w-full"})]}),o&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Quota Usage"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:["Used: ",o.quota_used.toLocaleString()]}),e.jsxs("div",{children:["Limit: ",o.quota_limit.toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Actions"}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>C(a.id),disabled:u===a.id,className:"w-full",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),u===a.id?"Testing...":"Test Credentials"]})]})]})]},a.id)})})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{title:"Flight",providers:O}),e.jsx($,{title:"Hotel",providers:Q}),e.jsx($,{title:"Activity",providers:J})]})},me=()=>{const[t,h]=l.useState(null),[x,j]=l.useState(!1),{toast:v}=M(),P=async()=>{j(!0);try{const{data:s,error:i}=await f.functions.invoke("system-recovery-orchestrator",{body:{action:"execute"}});if(i)throw i;if(s!=null&&s.success)h(s.recoveryPlan),v({title:"Recovery Completed",description:`System recovery completed in ${Math.round(s.recoveryPlan.totalDuration/1e3)}s`});else throw new Error((s==null?void 0:s.error)||"Recovery failed")}catch(s){console.error("Recovery execution failed:",s),v({title:"Recovery Failed",description:s.message,variant:"destructive"})}finally{j(!1)}},d=s=>{switch(s){case"completed":return e.jsx(b,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(A,{className:"h-4 w-4 text-red-500"});case"running":return e.jsx(W,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return e.jsx(ae,{className:"h-4 w-4 text-gray-400"})}},S=s=>{const i={completed:"default",failed:"destructive",running:"secondary",pending:"outline"};return e.jsx(p,{variant:i[s]||"outline",children:s.toUpperCase()})},u=()=>t?t.steps.filter(i=>i.status==="completed").length/t.steps.length*100:0;return e.jsxs(g,{children:[e.jsx(y,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-orange-500"}),"System Recovery Orchestrator"]})}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Execute comprehensive system recovery to restore all providers"})}),e.jsxs(E,{onClick:P,disabled:x,className:"flex items-center gap-2",children:[x?e.jsx(W,{className:"h-4 w-4 animate-spin"}):e.jsx(te,{className:"h-4 w-4"}),x?"Executing...":"Start Recovery"]})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold",children:["Recovery Plan: ",t.planId]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",S(t.status)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium",children:[Math.round(u()),"% Complete"]}),e.jsx(K,{value:u(),className:"w-32"})]})]}),e.jsx("div",{className:"space-y-3",children:t.steps.map((s,i)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d(s.status),e.jsx("span",{className:"font-medium",children:s.name})]}),S(s.status)]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.description}),s.duration&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Duration: ",Math.round(s.duration/1e3),"s"]}),s.error&&e.jsxs("div",{className:"text-xs text-red-500 mt-1",children:["Error: ",s.error]})]},s.id))}),t.summary&&e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(N,{className:"text-lg",children:"Recovery Summary"})}),e.jsxs(w,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Steps Completed"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[t.summary.completedSteps,"/",t.summary.totalSteps]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Total Duration"}),e.jsxs("div",{className:"text-2xl font-bold",children:[Math.round((t.totalDuration||0)/1e3),"s"]})]})]}),t.summary.recoveredProviders.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-medium text-green-600",children:"Recovered Providers"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.summary.recoveredProviders.map(s=>e.jsx(p,{variant:"default",children:s},s))})]}),t.summary.failedProviders.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-medium text-red-600",children:"Failed Providers"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.summary.failedProviders.map(s=>e.jsx(p,{variant:"destructive",children:s},s))})]})]})]})]})]})]})},ke=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Provider Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage API provider configurations, credentials, and emergency recovery"})]}),e.jsxs(re,{defaultValue:"recovery",className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-4",children:[e.jsxs(I,{value:"recovery",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"System Recovery"]}),e.jsxs(I,{value:"emergency",className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Emergency Recovery"]}),e.jsxs(I,{value:"credentials",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Credentials"]}),e.jsxs(I,{value:"configuration",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Configuration"]})]}),e.jsx(q,{value:"recovery",className:"space-y-6 mt-6",children:e.jsx(me,{})}),e.jsx(q,{value:"emergency",className:"space-y-6 mt-6",children:e.jsxs(g,{children:[e.jsx(y,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-destructive"}),"Emergency Provider Recovery"]})}),e.jsx(w,{children:e.jsx(le,{})})]})}),e.jsx(q,{value:"credentials",className:"space-y-6 mt-6",children:e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(N,{children:"Provider Credential Status"})}),e.jsx(w,{children:e.jsx(de,{})})]})}),e.jsx(q,{value:"configuration",className:"space-y-6 mt-6",children:e.jsx(oe,{})})]})]});export{ke as default};
