var oe=Object.defineProperty;var le=(h,r,s)=>r in h?oe(h,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[r]=s;var v=(h,r,s)=>le(h,typeof r!="symbol"?r+"":r,s);import{r as d,a7 as B,j as e,i as j,k as H,a6 as ce,l as Z,o as y,B as O,ae as te,b1 as de,U as me,Z as ue,w as W,C as he}from"./index-BZMa5YK6-1758536202306.js";import{T as xe,a as fe,b as ee,c as se}from"./tabs-BR9ZyH7J-1758536202306.js";import{C as ae}from"./circle-check-big-B2XwWZ78-1758536202306.js";import{C as ne}from"./clock-DuCsZkP2-1758536202306.js";import{C as ge}from"./chevron-left-sn26B6ok-1758536202306.js";import{A as pe}from"./activity-Tw0j6FJ0-1758536202306.js";import{C as je}from"./circle-x-B6z7ElBK-1758536202306.js";const _=class _{constructor(){v(this,"isDevelopment",!1);v(this,"sensitivePatterns",[/sk_test_[a-zA-Z0-9]+/g,/sk_live_[a-zA-Z0-9]+/g,/pk_test_[a-zA-Z0-9]+/g,/pk_live_[a-zA-Z0-9]+/g,/client_secret_[a-zA-Z0-9]+/g,/Bearer\s+[a-zA-Z0-9\-\._~\+\/]+=*/g,/password["\s]*[:=]["\s]*[^"\s]+/gi,/email["\s]*[:=]["\s]*[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/gi,/\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}/g])}static getInstance(){return _.instance||(_.instance=new _),_.instance}sanitizeMessage(r){let s=r;for(const t of this.sensitivePatterns)s=s.replace(t,"[REDACTED]");return s}sanitizeObject(r){if(typeof r=="string")return this.sanitizeMessage(r);if(typeof r!="object"||r===null)return r;if(Array.isArray(r))return r.map(t=>this.sanitizeObject(t));const s={};for(const[t,m]of Object.entries(r))["password","secret","token","key","authorization"].some(x=>t.toLowerCase().includes(x))?s[t]="[REDACTED]":s[t]=this.sanitizeObject(m);return s}formatMessage(r,s,t){const m=new Date().toISOString(),x=(t==null?void 0:t.correlationId)||"no-correlation",T=(t==null?void 0:t.component)||"unknown",N=`[${m}] [${r.toUpperCase()}] [${T}] [${x}]`,b=this.sanitizeMessage(s);if(t&&Object.keys(t).length>0){const C=this.sanitizeObject(t);return`${N} ${b} ${JSON.stringify(C)}`}return`${N} ${b}`}debug(r,s){this.isDevelopment&&console.debug(this.formatMessage("debug",r,s))}info(r,s){console.log(this.formatMessage("info",r,s))}warn(r,s){console.warn(this.formatMessage("warn",r,s))}error(r,s,t){const m={...t};s&&(m.error=s instanceof Error?{message:s.message,stack:this.isDevelopment?s.stack:"[REDACTED]",name:s.name}:this.sanitizeObject(s)),console.error(this.formatMessage("error",r,m))}userAction(r,s,t){this.info("User action performed",{component:"UserAction",action:r,userId:s||"anonymous",details:this.sanitizeObject(t)})}securityEvent(r,s,t){this.warn(`Security event: ${r}`,{component:"Security",severity:s,event:r,details:this.sanitizeObject(t)})}};v(_,"instance");let re=_;const z=re.getInstance(),ye=()=>{const[h,r]=d.useState(new Map),[s,t]=d.useState({cacheHits:0,cacheMisses:0,totalRequests:0,avgResponseTime:0}),m=d.useCallback((c,n,i=3e5)=>{r(u=>{const g=new Map(u);return g.set(c,{data:n,timestamp:Date.now(),ttl:i}),g})},[]),x=d.useCallback(c=>{const n=h.get(c);return n?Date.now()-n.timestamp>n.ttl?(r(i=>{const u=new Map(i);return u.delete(c),u}),t(i=>({...i,cacheMisses:i.cacheMisses+1})),null):(t(i=>({...i,cacheHits:i.cacheHits+1})),n.data):(t(i=>({...i,cacheMisses:i.cacheMisses+1})),null)},[h]),T=d.useCallback(c=>{r(c?n=>{const i=new Map(n);for(const u of i.keys())u.includes(c)&&i.delete(u);return i}:new Map)},[]),N=(c,n={page:1,limit:10})=>{const[i,u]=d.useState([]),[g,w]=d.useState(!1),[E,D]=d.useState(null),[I,F]=d.useState(0),[K,L]=d.useState(!0),M=d.useMemo(()=>`${c}_${JSON.stringify(n)}`,[c,n]),R=d.useCallback(async()=>{var $;w(!0),D(null);const o=Date.now();try{const f=x(M);if(f){u(f.data),F(f.count),L(f.data.length===n.limit),w(!1);return}const{page:P,limit:q,filters:U,orderBy:S}=n,G=(P-1)*q;let A=B.from(c).select("*",{count:"exact"}).range(G,G+q-1);U&&Object.entries(U).forEach(([k,Y])=>{Y!=null&&(A=A.eq(k,Y))}),S&&(A=A.order(S.column,{ascending:($=S.ascending)!=null?$:!0}));const{data:V,error:J,count:X}=await A;if(J)throw J;const l=V||[],p=X||0;m(M,{data:l,count:p},n.cacheTtl),u(l),F(p),L(l.length===q);const Q=Date.now()-o;t(k=>({...k,totalRequests:k.totalRequests+1,avgResponseTime:(k.avgResponseTime*(k.totalRequests-1)+Q)/k.totalRequests}))}catch(f){const P=f instanceof Error?f.message:"Unknown error";D(P),z.error("Paginated data fetch failed",f,{component:"useProductionOptimizations",tableName:c,cacheKey:M,options:n})}finally{w(!1)}},[M,x,m,n,c]);d.useEffect(()=>{R()},[R]);const a=d.useCallback(()=>{T(c),R()},[T,R,c]);return{data:i,loading:g,error:E,totalCount:I,hasMore:K,refetch:a,currentPage:n.page,totalPages:Math.ceil(I/n.limit)}},b=(c,n,i=1e3)=>{d.useEffect(()=>{let u;const g=E=>{clearTimeout(u),u=setTimeout(()=>n(E),i)},w=B.channel(`optimized_${c}`).on("postgres_changes",{event:"*",schema:"public",table:c},g).subscribe();return()=>{clearTimeout(u),B.removeChannel(w)}},[c,n,i])},C=d.useCallback((c,n)=>{const i=Date.now()-n;i>2e3&&z.warn("Slow operation detected",{component:"useProductionOptimizations",operation:c,duration:i,threshold:2e3}),typeof window<"u"&&window.gtag&&window.gtag("event","timing_complete",{name:c,value:i,event_category:"Performance"})},[]);return d.useEffect(()=>{const c=setInterval(()=>{const n=Date.now();r(i=>{const u=new Map(i);for(const[g,w]of u.entries())n-w.timestamp>w.ttl&&u.delete(g);return u})},6e4);return()=>clearInterval(c)},[]),{setCacheEntry:m,getCacheEntry:x,clearCache:T,usePaginatedData:N,useOptimizedSubscription:b,trackPerformance:C,metrics:s,cacheSize:h.size}};class ie extends d.Component{constructor(s){super(s);v(this,"retryTimeouts",[]);v(this,"reportToMonitoring",(s,t,m)=>{typeof window<"u"&&window.gtag&&window.gtag("event","exception",{description:s.message,fatal:!1,custom_map:{error_id:m,component_stack:t.componentStack}})});v(this,"handleRetry",()=>{const{retryLimit:s=3}=this.props,{retryCount:t}=this.state;if(t>=s){z.warn("Maximum retry attempts reached",{component:"ProductionErrorBoundary",errorId:this.state.errorId,retryCount:t});return}z.info("Retrying after error",{component:"ProductionErrorBoundary",errorId:this.state.errorId,retryCount:t+1});const m=Math.pow(2,t)*1e3,x=setTimeout(()=>{this.setState({hasError:!1,error:null,errorId:"",retryCount:t+1})},m);this.retryTimeouts.push(x)});v(this,"handleGoHome",()=>{window.location.href="/"});v(this,"getSeverityLevel",s=>{const t=s.message.toLowerCase();return t.includes("network")||t.includes("fetch")?"medium":t.includes("authentication")||t.includes("unauthorized")?"high":t.includes("payment")||t.includes("booking")?"critical":"low"});v(this,"getErrorCategory",s=>{const t=s.message.toLowerCase();return t.includes("network")||t.includes("fetch")?"Network Error":t.includes("payment")?"Payment Error":t.includes("booking")?"Booking Error":t.includes("authentication")?"Authentication Error":"Application Error"});this.state={hasError:!1,error:null,errorId:"",retryCount:0}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorId:crypto.randomUUID()}}componentDidCatch(s,t){const{onError:m}=this.props,{errorId:x}=this.state;z.error("Production error caught by boundary",s,{component:"ProductionErrorBoundary",errorId:x,componentStack:t.componentStack,retryCount:this.state.retryCount}),this.reportToMonitoring(s,t,x),m==null||m(s,t)}componentWillUnmount(){this.retryTimeouts.forEach(s=>clearTimeout(s))}render(){const{hasError:s,error:t,errorId:m,retryCount:x}=this.state,{children:T,fallbackComponent:N,enableRetry:b=!0,retryLimit:C=3}=this.props;if(s&&t){if(N)return N;const c=this.getSeverityLevel(t),n=this.getErrorCategory(t),i=b&&x<C;return e.jsx("div",{className:"min-h-[400px] flex items-center justify-center p-4",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsxs(H,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:e.jsx(ce,{className:"h-6 w-6 text-red-600"})}),e.jsx(Z,{className:"text-xl font-semibold text-red-900",children:n})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Something went wrong while loading this section."}),c==="critical"&&e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"This appears to be a critical issue. Our team has been notified."}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Error ID: ",m.slice(0,8)]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[i&&e.jsxs(O,{onClick:this.handleRetry,variant:"default",className:"w-full",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Try Again ",x>0&&`(${x}/${C})`]}),e.jsxs(O,{onClick:this.handleGoHome,variant:"outline",className:"w-full",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Go to Homepage"]})]}),!i&&x>=C&&e.jsx("div",{className:"text-center p-3 bg-yellow-50 rounded-md",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"Maximum retry attempts reached. Please refresh the page or contact support."})})]})]})})}return T}}const ze=()=>{const[h,r]=d.useState(null),[s,t]=d.useState(1),[m,x]=d.useState(null),[T,N]=d.useState([]),{usePaginatedData:b,useOptimizedSubscription:C,trackPerformance:c,metrics:n}=ye(),{data:i,loading:u,error:g,totalCount:w,totalPages:E,refetch:D}=b("agentic_tasks",{page:s,limit:10,orderBy:{column:"created_at",ascending:!1},cacheTtl:6e4});d.useEffect(()=>{I(),F(),K()},[i]),C("agentic_tasks",()=>{D(),I()},2e3);const I=async()=>{const a=Date.now();try{const{data:o,error:$}=await B.from("agentic_tasks").select("*").order("created_at",{ascending:!1});if($)throw $;if(!o){r({totalTasks:0,completedTasks:0,failedTasks:0,runningTasks:0,avgCompletionTime:0,successRate:0,tasksByAgent:{},tasksByStatus:{},recentTasks:[]});return}const f=o.length,P=o.filter(l=>l.status==="completed").length,q=o.filter(l=>l.status==="failed").length,U=o.filter(l=>l.status==="running"||l.status==="pending").length,S=o.filter(l=>l.status==="completed"&&l.created_at&&l.updated_at),G=S.length>0?S.reduce((l,p)=>{const Q=new Date(p.created_at).getTime(),k=new Date(p.updated_at).getTime();return l+(k-Q)},0)/S.length/1e3:0,A=f>0?P/f*100:0,V=o.reduce((l,p)=>(l[p.agent_id]=(l[p.agent_id]||0)+1,l),{}),J=o.reduce((l,p)=>(l[p.status]=(l[p.status]||0)+1,l),{}),X=o.slice(0,10);r({totalTasks:f,completedTasks:P,failedTasks:q,runningTasks:U,avgCompletionTime:G,successRate:A,tasksByAgent:V,tasksByStatus:J,recentTasks:X})}catch(o){z.error("Error fetching metrics",o,{component:"AgentMetrics",operation:"fetchMetrics"})}finally{c("fetchMetrics",a)}},F=async()=>{try{const{data:a,error:o}=await B.functions.invoke("admin-metrics",{body:{action:"get_issue_resolution_metrics"}});if(o)throw o;x(a)}catch(a){z.error("Failed to fetch issue resolution metrics",a)}},K=async()=>{try{const{data:a,error:o}=await B.functions.invoke("admin-metrics",{body:{action:"get_predictive_alerts"}});if(o)throw o;N(a||[])}catch(a){z.error("Failed to fetch predictive alerts",a)}},L=a=>a<60?`${a.toFixed(1)}s`:a<3600?`${(a/60).toFixed(1)}m`:`${(a/3600).toFixed(1)}h`,M=a=>{switch(a){case"completed":return"text-green-600";case"failed":return"text-red-600";case"running":return"text-blue-600";case"pending":return"text-yellow-600";default:return"text-gray-600"}},R=a=>{switch(a){case"completed":return e.jsx(ae,{className:"h-4 w-4"});case"failed":return e.jsx(je,{className:"h-4 w-4"});case"running":return e.jsx(pe,{className:"h-4 w-4 animate-pulse"});case"pending":return e.jsx(ne,{className:"h-4 w-4"});default:return e.jsx(ce,{className:"h-4 w-4"})}};return u?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((a,o)=>e.jsx(j,{children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})})},o))})}):g||!h?e.jsx(ie,{children:e.jsx(j,{children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-600",children:[g||"Failed to load metrics",e.jsxs(O,{onClick:D,className:"ml-4",variant:"outline",size:"sm",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsx(ie,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j,{children:[e.jsx(H,{children:e.jsxs(Z,{className:"flex items-center justify-between",children:["System Performance",e.jsxs(O,{onClick:D,variant:"outline",size:"sm",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Cache Hit Rate"}),e.jsxs("p",{className:"font-bold text-green-600",children:[n.totalRequests>0?(n.cacheHits/n.totalRequests*100).toFixed(1):0,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Avg Response Time"}),e.jsxs("p",{className:"font-bold",children:[n.avgResponseTime.toFixed(0),"ms"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Requests"}),e.jsx("p",{className:"font-bold",children:n.totalRequests})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Cache Size"}),e.jsx("p",{className:"font-bold",children:n.totalRequests})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(j,{children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Tasks"}),e.jsx("p",{className:"text-2xl font-bold",children:h.totalTasks})]})]})})}),e.jsx(j,{children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold",children:[h.successRate.toFixed(1),"%"]})]})]})})}),e.jsx(j,{children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg. Time"}),e.jsx("p",{className:"text-2xl font-bold",children:L(h.avgCompletionTime)})]})]})})}),e.jsx(j,{children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Tasks"}),e.jsx("p",{className:"text-2xl font-bold",children:h.runningTasks})]})]})})})]}),e.jsxs(xe,{defaultValue:"status",className:"space-y-4",children:[e.jsxs(fe,{children:[e.jsx(ee,{value:"status",children:"By Status"}),e.jsx(ee,{value:"agents",children:"By Agent"}),e.jsx(ee,{value:"recent",children:"Recent Tasks"})]}),e.jsx(se,{value:"status",children:e.jsxs(j,{children:[e.jsx(H,{children:e.jsx(Z,{children:"Tasks by Status"})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(h.tasksByStatus).map(([a,o])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:M(a),children:R(a)}),e.jsx("span",{className:"capitalize font-medium",children:a})]}),e.jsx(W,{variant:"outline",children:o})]},a))})})]})}),e.jsx(se,{value:"agents",children:e.jsxs(j,{children:[e.jsx(H,{children:e.jsx(Z,{children:"Tasks by Agent"})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:Object.entries(h.tasksByAgent).sort(([,a],[,o])=>o-a).map(([a,o])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${o/h.totalTasks*100}%`}})}),e.jsx(W,{variant:"outline",children:o})]})]},a))})})]})}),e.jsx(se,{value:"recent",children:e.jsxs(j,{children:[e.jsx(H,{children:e.jsx(Z,{children:"Recent Tasks"})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{onClick:()=>t(Math.max(1,s-1)),disabled:s===1,variant:"outline",size:"sm",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",s," of ",E]}),e.jsx(O,{onClick:()=>t(Math.min(E,s+1)),disabled:s===E,variant:"outline",size:"sm",children:e.jsx(he,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total: ",w," tasks"]})]}),i.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:M(a.status),children:R(a.status)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.agent_id}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(a.created_at).toLocaleString()})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{variant:"outline",className:M(a.status),children:a.status}),a.status==="running"&&e.jsxs(W,{variant:"secondary",children:[a.progress,"%"]})]})]},a.id))]})})]})})]})]})})};export{ze as default};
