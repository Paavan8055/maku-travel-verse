import{u as T,m as R,j as e,N as U,aw as E,b as I,r as p,h as F,L as M,d as c,e as l,B as f,f as x,g as h,s as q,l as H,a}from"./index-Ds3Fyqjq-1761390734507.js";import{N}from"./Navbar-Cta1wb01-1761390734507.js";import{S as G}from"./separator-Bs5ZZTHa-1761390734507.js";import{T as J,a as O,b as D,c as d,d as Q,e as o}from"./table-DKTSdzwj-1761390734507.js";import{A as z}from"./arrow-left-BVOxnG2I-1761390734507.js";import{D as K}from"./download-BU6TX-zI-1761390734507.js";import{C}from"./calendar-D9Gvdc7R-1761390734507.js";import{C as V}from"./credit-card-Ch-nN8V9-1761390734507.js";import{U as W}from"./users-DDw7hYke-1761390734507.js";import{D as X}from"./dollar-sign-CE-aZRiY-1761390734507.js";import"./useApiHealth-DwS5lxeB-1761390734507.js";import"./avatar-DmpTeAp2-1761390734507.js";import"./index-BkOho516-1761390734507.js";import"./globe-C_-iK_TJ-1761390734507.js";import"./useHealthMonitor-xHIaz80c-1761390734507.js";import"./useAIIntelligence-bO6OnE2b-1761390734507.js";import"./plane-BQiVZ_ye-1761390734507.js";import"./map-pin-BEOL209D-1761390734507.js";import"./sparkles-BoTGnZZP-1761390734507.js";import"./chevron-down-BR2MuXvI-1761390734507.js";import"./brain-BBf8ZmIX-1761390734507.js";import"./zap-CUOzWxu8-1761390734507.js";import"./settings-4RcyrRlS-1761390734507.js";import"./shield-B3chqNe1-1761390734507.js";import"./user-DUukUY7S-1761390734507.js";const Y=({children:r,redirectTo:n="/auth"})=>{const{user:s,loading:u}=T(),g=R();return u?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s?e.jsx(e.Fragment,{children:r}):e.jsx(U,{to:n,state:{from:g},replace:!0})},Z=()=>{const{id:r}=E(),n=I(),[s,u]=p.useState(null),[g,b]=p.useState(!0),{toast:j}=F(),{user:y,loading:v}=T(),B=async()=>{if(r)try{b(!0);const{data:t,error:m}=await q.rpc("get_user_bookings");if(m)throw m;const _=t.find(A=>A.id===r);if(!_){j({title:"Error",description:"Booking not found or you don't have access to it.",variant:"destructive"}),n("/dashboard");return}u(_)}catch(t){H.error("Error fetching booking details:",t),j({title:"Error",description:"Failed to load booking details. Please try again.",variant:"destructive"})}finally{b(!1)}},S=t=>{switch(t){case"confirmed":return e.jsx(a,{className:"bg-green-100 text-green-800 border-green-200",children:"Confirmed"});case"pending":return e.jsx(a,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"Pending"});case"cancelled":return e.jsx(a,{className:"bg-red-100 text-red-800 border-red-200",children:"Cancelled"});default:return e.jsx(a,{variant:"secondary",children:t})}},P=t=>{switch(t){case"succeeded":return e.jsx(a,{className:"bg-green-100 text-green-800 border-green-200",children:"Paid"});case"processing":return e.jsx(a,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Processing"});case"requires_payment":return e.jsx(a,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"Payment Required"});case"failed":return e.jsx(a,{className:"bg-red-100 text-red-800 border-red-200",children:"Failed"});case"refunded":return e.jsx(a,{className:"bg-white text-gray-800 border-gray-200",children:"Refunded"});default:return e.jsx(a,{variant:"secondary",children:t})}},w=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),k=t=>new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),i=(t,m)=>new Intl.NumberFormat("en-US",{style:"currency",currency:m.toUpperCase()}).format(t),L=()=>{j({title:"Coming Soon",description:"Receipt download functionality will be available soon."})};return p.useEffect(()=>{v||y&&B()},[r,y,v]),g?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(N,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(M,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading booking details..."})]})})]}):s?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(N,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(f,{variant:"ghost",onClick:()=>n("/dashboard"),className:"mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Back to Bookings"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold text-foreground",children:["Booking #",s.booking_reference]}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Created on ",k(s.created_at)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[S(s.status),e.jsxs(f,{variant:"outline",onClick:L,className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Download Receipt"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Booking Summary"]})}),e.jsxs(l,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Check-in"}),e.jsx("p",{className:"font-semibold",children:w(s.check_in_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Check-out"}),e.jsx("p",{className:"font-semibold",children:w(s.check_out_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Guests"}),e.jsxs("p",{className:"font-semibold",children:[s.guest_count," guest",s.guest_count>1?"s":""]})]})]}),s.booking_data&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Booking Details"}),e.jsx("div",{className:"bg-muted/50 p-4 rounded-lg",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap text-muted-foreground",children:JSON.stringify(s.booking_data,null,2)})})]})]})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsx(h,{children:"Booking Items"})}),e.jsxs(l,{children:[e.jsxs(J,{children:[e.jsx(O,{children:e.jsxs(D,{children:[e.jsx(d,{children:"Type"}),e.jsx(d,{children:"Details"}),e.jsx(d,{className:"text-center",children:"Qty"}),e.jsx(d,{className:"text-right",children:"Unit Price"}),e.jsx(d,{className:"text-right",children:"Total"})]})}),e.jsx(Q,{children:s.items.map(t=>e.jsxs(D,{children:[e.jsx(o,{className:"font-medium capitalize",children:t.item_type}),e.jsx(o,{children:e.jsx("div",{className:"max-w-xs",children:e.jsx("pre",{className:"text-xs whitespace-pre-wrap text-muted-foreground",children:JSON.stringify(t.item_details,null,2)})})}),e.jsx(o,{className:"text-center",children:t.quantity}),e.jsx(o,{className:"text-right",children:i(t.unit_price,s.currency)}),e.jsx(o,{className:"text-right font-semibold",children:i(t.total_price,s.currency)})]},t.id))})]}),e.jsx(G,{className:"my-4"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Total Amount:"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:i(s.total_amount,s.currency)})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Payment Information"]})}),e.jsx(l,{children:s.latest_payment?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),P(s.latest_payment.status)]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("span",{className:"font-semibold",children:i(s.latest_payment.amount,s.latest_payment.currency)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Payment ID"}),e.jsx("span",{className:"text-xs font-mono bg-muted px-2 py-1 rounded",children:s.latest_payment.stripe_payment_intent_id.slice(-8)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Date"}),e.jsx("span",{className:"text-sm",children:k(s.latest_payment.created_at)})]})]}):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No payment information available"})})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsx(h,{children:"Quick Stats"})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(C,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Duration"}),e.jsxs("p",{className:"font-semibold",children:[Math.ceil((new Date(s.check_out_date).getTime()-new Date(s.check_in_date).getTime())/(1e3*60*60*24))," night",Math.ceil((new Date(s.check_out_date).getTime()-new Date(s.check_in_date).getTime())/(1e3*60*60*24))>1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Items"}),e.jsx("p",{className:"font-semibold",children:s.items.length})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg. per night"}),e.jsx("p",{className:"font-semibold",children:i(s.total_amount/Math.max(1,Math.ceil((new Date(s.check_out_date).getTime()-new Date(s.check_in_date).getTime())/(1e3*60*60*24))),s.currency)})]})]})]})]})]})]})]})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(N,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(c,{children:e.jsxs(l,{className:"py-12 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Booking not found"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"The booking you're looking for doesn't exist or you don't have access to it."}),e.jsx(f,{onClick:()=>n("/dashboard"),children:"Back to Dashboard"})]})})})]})},_e=()=>e.jsx(Y,{children:e.jsx(Z,{})});export{_e as BookingDetails,_e as default};
