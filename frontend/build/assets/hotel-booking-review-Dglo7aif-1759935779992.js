import{r as n,u as $,h as X,j as e,a as p,d as j,e as g,b as f,B as l,f as q,T as Z}from"./index-D-GNMzbY-1759935779992.js";import{N as O}from"./Navbar-BkOPF8sw-1759935779992.js";import{u as ee,B as se}from"./use-currency-CNjqkrnW-1759935779992.js";import{S as k}from"./separator-BdU3oCPE-1759935779992.js";import{I as y}from"./input-1jVRH6sL-1759935779992.js";import{L as d}from"./label-VbMSHgtY-1759935779992.js";import{S as te,a as re,b as ae,c as ie,d as b}from"./select-BS--AF-v-1759935779992.js";import{C as F}from"./checkbox-Bm0I0sAA-1759935779992.js";import{T as ne}from"./textarea-CKpda_BH-1759935779992.js";import{u as le}from"./useBookingPayment-Dsh4nKNZ-1759935779992.js";import{C as ce}from"./credit-card-ZB2Qz-1O-1759935779992.js";import{H}from"./hotel-uDGZuA79-1759935779992.js";import{S as oe}from"./star-oCABYGpq-1759935779992.js";import{M as de}from"./map-pin-CDL93JUS-1759935779992.js";import{C as I}from"./calendar-DdMSO3Ob-1759935779992.js";import{U as me}from"./users-BCGW0sbz-1759935779992.js";import{C as M}from"./circle-check-big-DAehy0CH-1759935779992.js";import{U as he}from"./utensils-B82wo5Jr-1759935779992.js";import{W as xe}from"./waves-BlWW9JCz-1759935779992.js";import{C as ue}from"./car-gZ0LLvI9-1759935779992.js";import{C as pe}from"./coffee-CMp4t3jP-1759935779992.js";import{f as U}from"./format-DgZkbOKh-1759935779992.js";import"./useApiHealth-DFCi-2lC-1759935779992.js";import"./avatar-Cni_uW81-1759935779992.js";import"./index-CkrITfQE-1759935779992.js";import"./globe-BNcdo3UA-1759935779992.js";import"./useHealthMonitor-BiErJNRX-1759935779992.js";import"./useAIIntelligence-B6mwoxHn-1759935779992.js";import"./plane-u8buF5l0-1759935779992.js";import"./sparkles-sC8S1NPG-1759935779992.js";import"./chevron-down-j7aeQmXU-1759935779992.js";import"./brain-CjfP8leK-1759935779992.js";import"./zap-9L2DK5VR-1759935779992.js";import"./menu-Zm8MjVyH-1759935779992.js";import"./settings-Dx5WmXme-1759935779992.js";import"./shield-rFYFlV5t-1759935779992.js";import"./user-DsYEtQPx-1759935779992.js";import"./index-BdQq_4o_-1759935779992.js";import"./index-CyHbyfRV-1759935779992.js";import"./en-US-CC7XSppg-1759935779992.js";const fe=["Review","Guest Details","Room Preferences","Payment","Confirmation"],je=[{id:"early-checkin",name:"Early Check-in",description:"Check in before 3 PM",price:25,icon:e.jsx(M,{className:"w-4 h-4"})},{id:"late-checkout",name:"Late Check-out",description:"Check out after 11 AM",price:30,icon:e.jsx(M,{className:"w-4 h-4"})},{id:"breakfast",name:"Breakfast Package",description:"Daily breakfast for all guests",price:35,icon:e.jsx(he,{className:"w-4 h-4"})},{id:"spa-access",name:"Spa Access",description:"Full spa and wellness center access",price:85,icon:e.jsx(xe,{className:"w-4 h-4"})},{id:"airport-transfer",name:"Airport Transfer",description:"Private transfer from/to airport",price:55,icon:e.jsx(ue,{className:"w-4 h-4"})},{id:"welcome-package",name:"Welcome Package",description:"Champagne and fruit basket on arrival",price:45,icon:e.jsx(pe,{className:"w-4 h-4"})}],ge=["High floor","Low floor","Quiet location","City view","Ocean view","Balcony","King bed","Twin beds","Non-smoking","Accessible room","Connecting rooms","Away from elevator"],ve=()=>{const[v,m]=n.useState(1),[r,P]=n.useState(null),[i,h]=n.useState({firstName:"",lastName:"",email:"",phone:"",specialRequests:"",roomPreferences:[],arrivalTime:""}),[c,S]=n.useState([]),[R,A]=n.useState([]),[T,D]=n.useState(!1),[C,L]=n.useState(!1),[V,G]=n.useState(!1),N=$(),{toast:o}=X(),{formatPrice:x}=ee(),{createBookingPayment:W,isLoading:B}=le();n.useEffect(()=>{const s=sessionStorage.getItem("selectedHotelOffer");if(s)try{const t=JSON.parse(s);P(t)}catch(t){console.error("Error parsing hotel data:",t),o({title:"Error",description:"Failed to load hotel information. Please start over.",variant:"destructive"}),N("/search/hotels")}else o({title:"No hotel selected",description:"Please select a hotel first.",variant:"destructive"}),N("/search/hotels")},[N,o]),n.useEffect(()=>{r&&v===1&&!C&&z()},[r,v,C]);const z=async()=>{if(r){D(!0);try{const t=await(await fetch("/api/verify-hotel-rate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hotelId:r.hotel.id,checkInDate:r.checkInDate,checkOutDate:r.checkOutDate,originalRate:r.totalAmount})})).json();t.rateChanged&&(G(!0),P(a=>a?{...a,totalAmount:t.newRate}:null),o({title:"Rate Updated",description:`The hotel rate has changed to ${x(t.newRate,r.currency)}`,variant:"default"})),L(!0)}catch(s){console.error("Rate verification failed:",s),o({title:"Rate Verification Failed",description:"Unable to verify current rates. Rates may have changed.",variant:"destructive"})}finally{D(!1)}}},w=()=>{if(!r)return 0;const s=r.totalAmount,t=c.reduce((a,u)=>a+u.price*u.quantity,0);return s+t},J=()=>{if(!i.firstName||!i.lastName||!i.email){o({title:"Incomplete Information",description:"Please fill in all required guest details.",variant:"destructive"});return}m(3)},Y=()=>{m(4)},K=s=>{const t=c.find(a=>a.id===s.id);S(t?a=>a.filter(u=>u.id!==s.id):a=>[...a,{id:s.id,name:s.name,price:s.price,quantity:1,description:s.description}])},Q=async()=>{var s;if(r)try{const t={hotelData:r,guestData:i,selectedAddOns:c,selectedPreferences:R,totalAmount:w()},a=await W({bookingType:"hotel",bookingData:t,amount:w(),currency:r.currency,customerInfo:{email:i.email,firstName:i.firstName,lastName:i.lastName},paymentMethod:"card"});if(a.success&&((s=a.payment)!=null&&s.checkoutUrl))window.location.href=a.payment.checkoutUrl;else throw new Error(a.error||"Payment setup failed")}catch(t){console.error("Payment error:",t),o({title:"Payment Error",description:"Failed to process payment. Please try again.",variant:"destructive"})}},E=()=>{var s;return r?e.jsxs(p,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Hotel Summary",V&&e.jsxs(q,{variant:"secondary",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Rate Updated"]})]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[((s=r.hotel.photos)==null?void 0:s[0])&&e.jsx("img",{src:r.hotel.photos[0],alt:r.hotel.name,className:"w-24 h-24 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:r.hotel.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex items-center",children:Array.from({length:r.hotel.rating||0},(t,a)=>e.jsx(oe,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},a))}),r.hotel.category&&e.jsx(q,{variant:"outline",children:r.hotel.category})]}),r.hotel.address&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-muted-foreground",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsx("span",{children:r.hotel.address.countryCode})]})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Check-in"}),e.jsx("div",{children:U(new Date(r.checkInDate),"MMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Check-out"}),e.jsx("div",{children:U(new Date(r.checkOutDate),"MMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[r.guestCount," Guest",r.guestCount>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[r.nights," Night",r.nights>1?"s":""]})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Hotel Total (",r.nights," nights):"]}),e.jsx("span",{className:"font-medium",children:x(r.totalAmount,r.currency)})]}),c.length>0&&e.jsxs(e.Fragment,{children:[c.map(t=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[t.name," Ã— ",t.quantity,":"]}),e.jsx("span",{children:x(t.price*t.quantity,r.currency)})]},t.id)),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Add-ons Total:"}),e.jsx("span",{className:"font-medium",children:x(c.reduce((t,a)=>t+a.price*a.quantity,0),r.currency)})]})]}),e.jsx(k,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{children:x(w(),r.currency)})]})]})]})]}):null},_=()=>{if(!r)return null;switch(v){case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Review Your Hotel Booking"}),e.jsx("p",{className:"text-muted-foreground",children:"Please review your hotel details before proceeding."})]}),E(),T&&e.jsx(p,{children:e.jsx(f,{className:"py-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),e.jsx("span",{children:"Verifying current rates..."})]})})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{variant:"outline",onClick:()=>N("/search/hotels"),children:"Back to Search"}),e.jsx(l,{onClick:()=>m(2),disabled:T||!C,children:"Continue to Guest Details"})]})]});case 2:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Guest Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Please provide guest information for your reservation."})]}),e.jsxs(p,{children:[e.jsx(j,{children:e.jsx(g,{children:"Primary Guest Information"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"firstName",children:"First Name *"}),e.jsx(y,{id:"firstName",value:i.firstName,onChange:s=>h(t=>({...t,firstName:s.target.value})),placeholder:"Enter first name"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"lastName",children:"Last Name *"}),e.jsx(y,{id:"lastName",value:i.lastName,onChange:s=>h(t=>({...t,lastName:s.target.value})),placeholder:"Enter last name"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email Address *"}),e.jsx(y,{id:"email",type:"email",value:i.email,onChange:s=>h(t=>({...t,email:s.target.value})),placeholder:"Enter email address"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"phone",children:"Phone Number"}),e.jsx(y,{id:"phone",type:"tel",value:i.phone,onChange:s=>h(t=>({...t,phone:s.target.value})),placeholder:"Enter phone number"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"arrivalTime",children:"Expected Arrival Time"}),e.jsxs(te,{value:i.arrivalTime,onValueChange:s=>h(t=>({...t,arrivalTime:s})),children:[e.jsx(re,{children:e.jsx(ae,{placeholder:"Select arrival time"})}),e.jsxs(ie,{children:[e.jsx(b,{value:"morning",children:"Morning (8:00 - 12:00)"}),e.jsx(b,{value:"afternoon",children:"Afternoon (12:00 - 17:00)"}),e.jsx(b,{value:"evening",children:"Evening (17:00 - 22:00)"}),e.jsx(b,{value:"late",children:"Late Night (22:00+)"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"specialRequests",children:"Special Requests"}),e.jsx(ne,{id:"specialRequests",value:i.specialRequests,onChange:s=>h(t=>({...t,specialRequests:s.target.value})),placeholder:"Any special requests or dietary requirements...",rows:3})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{variant:"outline",onClick:()=>m(1),children:"Back"}),e.jsx(l,{onClick:J,children:"Continue to Preferences"})]})]});case 3:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Room Preferences & Add-ons"}),e.jsx("p",{className:"text-muted-foreground",children:"Customize your stay with additional services and room preferences."})]}),e.jsxs(p,{children:[e.jsx(j,{children:e.jsx(g,{children:"Room Preferences"})}),e.jsx(f,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:ge.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:s,checked:R.includes(s),onCheckedChange:t=>{A(t?a=>[...a,s]:a=>a.filter(u=>u!==s))}}),e.jsx(d,{htmlFor:s,className:"text-sm",children:s})]},s))})})]}),e.jsxs(p,{children:[e.jsx(j,{children:e.jsx(g,{children:"Enhancement Add-ons"})}),e.jsx(f,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:je.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg cursor-pointer hover:bg-muted/50",onClick:()=>K(s),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{checked:c.some(t=>t.id===s.id)}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon,e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:x(s.price,r.currency)}),r.nights>1&&s.id!=="early-checkin"&&s.id!=="late-checkout"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"per night"})]})]},s.id))})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{variant:"outline",onClick:()=>m(2),children:"Back"}),e.jsx(l,{onClick:Y,children:"Continue to Payment"})]})]});case 4:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Payment"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your hotel booking by processing payment."})]}),E(),e.jsxs(p,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Payment Method"]})}),e.jsxs(f,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"You will be redirected to our secure payment processor to complete your booking."}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{variant:"outline",onClick:()=>m(3),children:"Back"}),e.jsx(l,{onClick:Q,disabled:B,className:"min-w-[120px]",children:B?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):"Pay Now"})]})]})]})]});default:return null}};return r?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsx(se,{currentStep:v,steps:fe}),_()]}):e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})},ns=()=>e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(O,{}),e.jsx("div",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsx(ve,{})})]});export{ns as default};
