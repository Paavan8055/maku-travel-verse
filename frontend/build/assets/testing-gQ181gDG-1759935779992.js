import{c as Me,r as y,s as N,j as e,a as T,b as k,d as F,e as P,f as R,B as q,P as ue,h as X,F as Fe,g as he,L as Pe,i as J,T as W,o as Le,R as V,A as de,q as me,w as Y,p as Be,aR as He}from"./index-D-GNMzbY-1759935779992.js";import{T as ce,a as le,b as H,c as U}from"./tabs-_fg3vfzR-1759935779992.js";import{S as xe}from"./switch-Bd4uMGyj-1759935779992.js";import{u as Ee,a as fe}from"./useEnhancedLogging-DOq8RV_m-1759935779992.js";import{B as ie}from"./bot-DIc5gFbQ-1759935779992.js";import{A as te}from"./activity-BfEbK5Ia-1759935779992.js";import{B as ve}from"./brain-CjfP8leK-1759935779992.js";import{C as K}from"./clock-DhA54DJF-1759935779992.js";import{C as O}from"./circle-check-big-DAehy0CH-1759935779992.js";import{Z as ne}from"./zap-9L2DK5VR-1759935779992.js";import{D as Ue}from"./database-CRJYAmFm-1759935779992.js";import{S as re}from"./settings-Dx5WmXme-1759935779992.js";import{L as G}from"./label-VbMSHgtY-1759935779992.js";import{S as je,a as ye,b as Ne,c as _e,d as se}from"./select-BS--AF-v-1759935779992.js";import{C as ae}from"./checkbox-Bm0I0sAA-1759935779992.js";import{C as we}from"./calendar-DdMSO3Ob-1759935779992.js";import{P as ge}from"./play-C1Y3dIF0-1759935779992.js";import{S as Oe}from"./scroll-area-BBWJQA6y-1759935779992.js";import{B as oe}from"./bell-6OL8twvH-1759935779992.js";import{C as Z}from"./circle-x-ClWTjVBX-1759935779992.js";import{I as qe}from"./info-YDtlugfi-1759935779992.js";import{T as pe}from"./trending-up-B4zKzV44-1759935779992.js";import{H as Ve}from"./hotel-uDGZuA79-1759935779992.js";import{P as ze}from"./plane-u8buF5l0-1759935779992.js";import{C as Q}from"./circle-alert-Dq2NvjcS-1759935779992.js";import{U as We}from"./users-BCGW0sbz-1759935779992.js";import{D as Ge}from"./dollar-sign-2_UxWoyM-1759935779992.js";import{R as be,L as Ke,C as Se,X as Ce,Y as Te,T as ke,a as Ye,B as Ze,b as Ae}from"./BarChart-Gu2cC-A4-1759935779992.js";import{W as Xe}from"./wifi-off-D1RgFkZo-1759935779992.js";import{W as Qe}from"./wifi-S7ELKaJM-1759935779992.js";import{S as Re}from"./shield-rFYFlV5t-1759935779992.js";import{W as Je}from"./wrench-HOqy0WJt-1759935779992.js";import{T as Ie}from"./test-tube-Mzs-DYLZ-1759935779992.js";import"./index-CyHbyfRV-1759935779992.js";import"./correlationId-E68zmjFq-1759935779992.js";import"./index-BdQq_4o_-1759935779992.js";import"./chevron-down-j7aeQmXU-1759935779992.js";import"./index-Lk7mMJkG-1759935779992.js";import"./string-D4TST8LD-1759935779992.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=Me("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),ss=()=>{const[t,j]=y.useState({isConnected:!1,lastActivity:null,activeCommands:0,completedAnalyses:0,averageResponseTime:0,aiModelStatus:"offline"}),[g,f]=y.useState(!0),{isAnalyzing:d,latestAnalysis:v,requestAnalysis:l}=Ee();y.useEffect(()=>{h();const u=setInterval(h,3e4);return()=>clearInterval(u)},[]);const h=async()=>{var u;try{f(!0);const{data:r}=await N.from("admin_bot_commands").select("*").gte("created_at",new Date(Date.now()-24*60*60*1e3).toISOString()).order("created_at",{ascending:!1}),{data:m}=await N.from("admin_bot_commands").select("*").in("execution_status",["pending","processing"]),{data:i}=await N.from("bot_result_aggregation").select("*").eq("bot_id","master-bot-controller").gte("created_at",new Date(Date.now()-24*60*60*1e3).toISOString()),s=(r==null?void 0:r.filter(I=>I.execution_status==="completed"))||[],o=s.length>0?s.reduce((I,C)=>I+(C.actual_duration_minutes||0),0)/s.length:0,x=(u=r==null?void 0:r[0])!=null&&u.created_at?new Date(r[0].created_at):null;let b="offline";i&&i.length>0&&(b=i.some(C=>C.created_at>new Date(Date.now()-36e5).toISOString())?"active":"degraded"),j({isConnected:((m==null?void 0:m.length)||0)>0||s.length>0,lastActivity:x,activeCommands:(m==null?void 0:m.length)||0,completedAnalyses:(i==null?void 0:i.length)||0,averageResponseTime:o,aiModelStatus:b})}catch(r){console.error("Error fetching Master Bot status:",r)}finally{f(!1)}},a=async()=>{await l("system_health",{timestamp:new Date().toISOString(),test_type:"connection_test",services:["provider_diagnostics","system_health","performance"]},"Test Master Bot connection and AI analysis capabilities. Verify all systems are operational.")},c=(u,r)=>u?r==="active"?"text-green-500":r==="degraded"?"text-yellow-500":"text-gray-500":"text-red-500",_=(u,r)=>u?r==="active"?e.jsx(R,{variant:"default",children:"Active"}):r==="degraded"?e.jsx(R,{variant:"secondary",children:"Degraded"}):e.jsx(R,{variant:"outline",children:"Unknown"}):e.jsx(R,{variant:"destructive",children:"Offline"});return g?e.jsx(T,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"h-5 w-5 animate-pulse"}),e.jsx("span",{children:"Checking Master Bot status..."})]})})}):e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:`h-5 w-5 ${c(t.isConnected,t.aiModelStatus)}`}),"Master Bot Integration Status"]}),_(t.isConnected,t.aiModelStatus)]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Connection:"}),e.jsx(R,{variant:t.isConnected?"default":"destructive",children:t.isConnected?"Connected":"Disconnected"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"AI Model:"}),e.jsx(R,{variant:t.aiModelStatus==="active"?"default":t.aiModelStatus==="degraded"?"secondary":"destructive",children:t.aiModelStatus})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Active Commands:"})]}),e.jsx(R,{variant:"outline",children:t.activeCommands})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Completed (24h):"})]}),e.jsx(R,{variant:"outline",children:t.completedAnalyses})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Avg Response Time:"})]}),e.jsxs(R,{variant:"outline",children:[t.averageResponseTime.toFixed(1),"min"]})]})]}),t.lastActivity&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsxs("span",{children:["Last activity: ",t.lastActivity.toLocaleString("en-AU",{timeZone:"Australia/Sydney"})]})]}),v&&e.jsxs("div",{className:"border rounded-lg p-3 bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ve,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Latest AI Analysis"}),e.jsx(R,{variant:"outline",className:v.severity==="critical"?"text-red-600":v.severity==="high"?"text-orange-600":v.severity==="medium"?"text-yellow-600":"text-blue-600",children:v.severity})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[v.summary.slice(0,120),"..."]})]}),e.jsx(q,{onClick:a,disabled:d,variant:"outline",size:"sm",className:"w-full",children:d?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),"Testing Connection..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Test Master Bot Connection"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Integration Health"}),e.jsx("span",{className:"font-medium",children:t.isConnected&&t.aiModelStatus==="active"?"100%":t.isConnected?"70%":"0%"})]}),e.jsx(ue,{value:t.isConnected&&t.aiModelStatus==="active"?100:t.isConnected?70:0,className:"h-2"})]})]})]})},ts=({testResults:t,onHealthUpdate:j})=>{const{toast:g}=X(),{logSingle:f,logApiCall:d}=fe(),v=y.useCallback(async h=>{const a=Date.now();try{for(const c of h){const _={provider:c.provider||`${c.service.toLowerCase()}_provider`,status:c.success?"healthy":"degraded",response_time_ms:c.responseTime,error_count:c.success?0:1,last_checked:new Date().toISOString(),metadata:{test_type:"comprehensive_diagnostics",result_count:c.resultCount,error_details:c.error,test_timestamp:c.timestamp.toISOString(),provider_name:c.provider||`${c.service} Provider`,circuit_breaker_state:c.success?"closed":"open",credentials_valid:c.success,service_endpoints:{[c.service]:c.success},quota_status:c.success?"healthy":"warning"}},{error:u}=await N.from("provider_health").upsert(_,{onConflict:"provider",ignoreDuplicates:!1});u&&console.error("Failed to update provider health:",u),await f({service_name:"provider_health_monitor",log_level:c.success?"info":"warn",message:`Provider health updated: ${c.service}`,metadata:{provider:c.provider||c.service,status:c.success?"healthy":"degraded",response_time:c.responseTime,result_count:c.resultCount}}),c.success||await l(c)}await d("provider_health_integration","bulk_health_update",a,!0,200,void 0,{updated_providers:h.length}),j==null||j()}catch(c){console.error("Health monitoring integration failed:",c),await d("provider_health_integration","bulk_health_update",a,!1,500,c,{attempted_providers:h.length}),g({title:"Health Update Failed",description:"Failed to update provider health status",variant:"destructive"})}},[f,d,j,g]),l=y.useCallback(async h=>{try{const a={alert_type:"provider_failure",severity:"high",title:`${h.service} Provider Failure`,message:`Provider ${h.provider||h.service} failed with error: ${h.error||"Unknown error"}`,alert_data:{service:h.service,provider:h.provider,error:h.error,response_time:h.responseTime,timestamp:h.timestamp.toISOString()},is_resolved:!1},{error:c}=await N.from("critical_alerts").insert(a);c?console.error("Failed to create critical alert:",c):await f({service_name:"critical_alert_system",log_level:"error",message:`Critical alert generated for ${h.service} provider failure`,metadata:a})}catch(a){console.error("Failed to generate critical alert:",a)}},[f]);return y.useCallback(async()=>{const h=Date.now();try{const{data:a,error:c}=await N.functions.invoke("comprehensive-health-monitor",{body:{source:"unified_provider_diagnostics",trigger_comprehensive_check:!0,include_provider_rotation:!0}});if(c)throw c;await d("comprehensive_health_monitor","sync_trigger",h,!0,200,void 0,{sync_result:a}),g({title:"Health Monitor Synced",description:"Comprehensive health monitor updated with latest test results",variant:"default"})}catch(a){await d("comprehensive_health_monitor","sync_trigger",h,!1,500,a),console.error("Failed to sync with health monitor:",a)}},[d,g]),Fe.useEffect(()=>{t.length>0&&v(t)},[t,v]),null},rs=({testResults:t,testSummary:j,sessionId:g})=>{const{logSingle:f,logPerformance:d}=fe(),v=y.useCallback(async()=>{const h=`test_session_${g}_${Date.now()}`;try{await f({service_name:"unified_provider_diagnostics",log_level:"info",message:"Comprehensive test session completed",metadata:{session_id:g,correlation_id:h,test_summary:j,test_count:t.length,success_rate:j.successfulTests/j.totalTests*100}});for(const a of t)await f({service_name:`provider_test_${a.service.toLowerCase()}`,log_level:a.success?"info":"error",message:`Provider test ${a.success?"passed":"failed"}: ${a.service}`,duration_ms:a.responseTime,status_code:a.success?200:500,metadata:{session_id:g,correlation_id:h,provider:a.provider,service_type:a.service,result_count:a.resultCount,test_timestamp:a.timestamp.toISOString(),error_details:a.error?{message:a.error}:void 0},error_details:a.error?{error_type:"provider_test_failure",error_message:a.error,service:a.service,provider:a.provider}:void 0}),await d(`${a.service.toLowerCase()}_provider_test`,a.responseTime,{session_id:g,provider:a.provider,success:a.success,result_count:a.resultCount});await d("comprehensive_test_session",j.averageResponseTime,{session_id:g,total_tests:j.totalTests,success_rate:j.successfulTests/j.totalTests*100,total_results:j.totalResultCount}),await l(h,t,j)}catch(a){console.error("Failed to log test session:",a),await f({service_name:"unified_provider_diagnostics",log_level:"error",message:"Failed to log test session completely",metadata:{session_id:g,error:a instanceof Error?a.message:"Unknown error",partial_results:t.length}})}},[t,j,g,f,d]),l=y.useCallback(async(h,a,c)=>{var _,u,r;try{const m={correlation_id:h,service_name:"unified_provider_diagnostics",log_level:"info",level:"info",message:"Comprehensive provider diagnostic session",metadata:{session_data:{session_id:g,start_time:(_=a[0])==null?void 0:_.timestamp.toISOString(),end_time:(u=a[a.length-1])==null?void 0:u.timestamp.toISOString(),duration_ms:a.length>0?a[a.length-1].timestamp.getTime()-a[0].timestamp.getTime():0},test_summary:{totalTests:c.totalTests,successfulTests:c.successfulTests,failedTests:c.failedTests,averageResponseTime:c.averageResponseTime,totalResultCount:c.totalResultCount},provider_results:a.map(s=>({service:s.service,provider:s.provider,success:s.success,response_time:s.responseTime,result_count:s.resultCount,error:s.error})),system_health_impact:{critical_failures:a.filter(s=>!s.success).length,performance_degradation:a.filter(s=>s.responseTime>5e3).length,providers_affected:[...new Set(a.map(s=>s.provider||s.service))]}},user_id:((r=(await N.auth.getUser()).data.user)==null?void 0:r.id)||null},{error:i}=await N.from("system_logs").insert(m);i&&console.error("Failed to store structured log:",i)}catch(m){console.error("Failed to store structured logs:",m)}},[g]);return Fe.useEffect(()=>{t.length>0&&v()},[t,v]),null},De={auto_run_enabled:!1,test_interval_minutes:30,notification_preferences:{email_enabled:!0,push_enabled:!1,critical_only:!0},preferred_test_suites:["bot-integration","dashboard-performance"],failure_threshold:3},$e=()=>{const[t,j]=y.useState(De),[g,f]=y.useState(!0),{user:d}=he(),{toast:v}=X(),l=async()=>{if(d)try{const{data:a,error:c}=await N.from("communication_preferences").select("preferences").eq("user_id",d.id).single();if(c&&c.code!=="PGRST116")throw c;a!=null&&a.preferences&&typeof a.preferences=="object"&&a.preferences.testing&&j({...De,...a.preferences.testing})}catch(a){console.error("Error loading testing preferences:",a),v({title:"Error loading preferences",description:"Using default settings",variant:"destructive"})}finally{f(!1)}},h=async a=>{if(!d)return;const c={...t,...a};j(c);try{const{data:_}=await N.from("communication_preferences").select("preferences").eq("user_id",d.id).single(),u=_!=null&&_.preferences&&typeof _.preferences=="object"?_.preferences:{},{error:r}=await N.from("communication_preferences").upsert({user_id:d.id,preferences:{...u,testing:c}});if(r)throw r;v({title:"Preferences saved",description:"Testing preferences updated successfully"})}catch(_){console.error("Error saving testing preferences:",_),v({title:"Error saving preferences",description:"Please try again",variant:"destructive"})}};return y.useEffect(()=>{l()},[d]),{preferences:t,loading:g,savePreferences:h,reload:l}},as=[{id:"bot-integration",name:"Bot Integration Tests"},{id:"dashboard-performance",name:"Dashboard Performance"},{id:"security-validation",name:"Security Validation"},{id:"e2e-workflows",name:"End-to-End Workflows"}],is=[{value:15,label:"15 minutes"},{value:30,label:"30 minutes"},{value:60,label:"1 hour"},{value:180,label:"3 hours"},{value:360,label:"6 hours"},{value:720,label:"12 hours"}],ns=()=>{const{preferences:t,loading:j,savePreferences:g}=$e();return j?e.jsx(T,{children:e.jsx(k,{className:"flex items-center justify-center py-8",children:e.jsx(Pe,{className:"h-6 w-6 animate-spin"})})}):e.jsxs(T,{children:[e.jsxs(F,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Testing Preferences"]}),e.jsx(J,{children:"Configure automated testing and notification settings"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{htmlFor:"auto-run",children:"Enable Auto-run Testing"}),e.jsx(xe,{id:"auto-run",checked:t.auto_run_enabled,onCheckedChange:f=>g({auto_run_enabled:f})})]}),t.auto_run_enabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Test Interval"}),e.jsxs(je,{value:t.test_interval_minutes.toString(),onValueChange:f=>g({test_interval_minutes:parseInt(f)}),children:[e.jsx(ye,{children:e.jsx(Ne,{})}),e.jsx(_e,{children:is.map(f=>e.jsx(se,{value:f.value.toString(),children:f.label},f.value))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(G,{children:"Preferred Test Suites"}),e.jsx("div",{className:"space-y-2",children:as.map(f=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{id:f.id,checked:t.preferred_test_suites.includes(f.id),onCheckedChange:d=>{const v=d?[...t.preferred_test_suites,f.id]:t.preferred_test_suites.filter(l=>l!==f.id);g({preferred_test_suites:v})}}),e.jsx(G,{htmlFor:f.id,className:"text-sm",children:f.name})]},f.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(G,{children:"Notification Preferences"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{id:"email-notifications",checked:t.notification_preferences.email_enabled,onCheckedChange:f=>g({notification_preferences:{...t.notification_preferences,email_enabled:!!f}})}),e.jsx(G,{htmlFor:"email-notifications",className:"text-sm",children:"Email notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{id:"push-notifications",checked:t.notification_preferences.push_enabled,onCheckedChange:f=>g({notification_preferences:{...t.notification_preferences,push_enabled:!!f}})}),e.jsx(G,{htmlFor:"push-notifications",className:"text-sm",children:"Push notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{id:"critical-only",checked:t.notification_preferences.critical_only,onCheckedChange:f=>g({notification_preferences:{...t.notification_preferences,critical_only:!!f}})}),e.jsx(G,{htmlFor:"critical-only",className:"text-sm",children:"Critical failures only"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Failure Threshold"}),e.jsxs(je,{value:t.failure_threshold.toString(),onValueChange:f=>g({failure_threshold:parseInt(f)}),children:[e.jsx(ye,{children:e.jsx(Ne,{})}),e.jsxs(_e,{children:[e.jsx(se,{value:"1",children:"1 failure"}),e.jsx(se,{value:"2",children:"2 consecutive failures"}),e.jsx(se,{value:"3",children:"3 consecutive failures"}),e.jsx(se,{value:"5",children:"5 consecutive failures"})]})]})]})]})]})},cs=()=>{const[t,j]=y.useState([]),[g,f]=y.useState(!0),{user:d}=he(),{preferences:v}=$e(),{toast:l}=X(),h=async()=>{if(d)try{const{data:r,error:m}=await N.from("agent_scheduled_tasks").select("*").eq("agent_id","testing-framework").order("created_at",{ascending:!1});if(m)throw m;j(r||[])}catch(r){console.error("Error loading scheduled tasks:",r),l({title:"Error loading scheduled tasks",description:"Please try again",variant:"destructive"})}finally{f(!1)}},a=async r=>{if(d)try{const{error:m}=await N.from("agent_scheduled_tasks").insert({agent_id:"testing-framework",task_name:`Automated ${r} Testing`,description:`Automated testing for ${r} suite`,schedule_type:"recurring",schedule_config:{interval_minutes:v.test_interval_minutes,enabled:v.auto_run_enabled},task_parameters:{test_suite:r,user_id:d.id,automated:!0},status:v.auto_run_enabled?"scheduled":"paused",created_by:d.id});if(m)throw m;l({title:"Scheduled task created",description:`${r} testing has been scheduled`}),h()}catch(m){console.error("Error creating scheduled task:",m),l({title:"Error creating scheduled task",description:"Please try again",variant:"destructive"})}},c=async(r,m)=>{try{const i=m==="scheduled"?"paused":"scheduled",{error:s}=await N.from("agent_scheduled_tasks").update({status:i}).eq("id",r);if(s)throw s;l({title:`Task ${i}`,description:`Scheduled task has been ${i}`}),h()}catch(i){console.error("Error updating task status:",i),l({title:"Error updating task",description:"Please try again",variant:"destructive"})}},_=async(r,m)=>{try{const{error:i}=await N.from("agent_task_queue").insert({agent_id:"testing-framework",task_type:"immediate_test_run",task_data:{scheduled_task_id:r,immediate_execution:!0},priority:1});if(i)throw i;l({title:"Task queued",description:`${m} will run immediately`})}catch(i){console.error("Error queuing immediate task:",i),l({title:"Error running task",description:"Please try again",variant:"destructive"})}};y.useEffect(()=>{h()},[d]);const u=r=>{switch(r){case"scheduled":return"default";case"running":return"secondary";case"paused":return"outline";case"failed":return"destructive";default:return"outline"}};return g?e.jsx(T,{children:e.jsx(k,{className:"flex items-center justify-center py-8",children:e.jsx(Pe,{className:"h-6 w-6 animate-spin"})})}):e.jsxs(T,{children:[e.jsxs(F,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5"}),"Background Test Scheduler"]}),e.jsx(J,{children:"Manage automated testing schedules and background execution"})]}),e.jsxs(k,{className:"space-y-4",children:[v.auto_run_enabled&&v.preferred_test_suites.length>0&&e.jsx("div",{className:"space-y-2",children:v.preferred_test_suites.filter(r=>!t.some(m=>{const i=m.task_parameters;return(i==null?void 0:i.test_suite)===r})).map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ready to schedule automated testing"})]}),e.jsx(q,{size:"sm",onClick:()=>a(r),children:"Schedule"})]},r))}),e.jsx("div",{className:"space-y-3",children:t.map(r=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.task_name}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),"Every ",v.test_interval_minutes,"m"]}),e.jsxs("span",{children:["Executed ",r.execution_count," times"]}),r.error_count>0&&e.jsxs("span",{className:"text-destructive",children:[r.error_count," errors"]})]})]}),e.jsx(R,{variant:u(r.status),children:r.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.next_execution&&e.jsxs("span",{children:["Next: ",new Date(r.next_execution).toLocaleString()]}),r.last_execution&&e.jsxs("span",{className:"ml-4",children:["Last: ",new Date(r.last_execution).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>_(r.id,r.task_name),disabled:r.status==="running",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"Run Now"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{checked:r.status==="scheduled",onCheckedChange:()=>c(r.id,r.status)}),e.jsx(G,{className:"text-sm",children:r.status==="scheduled"?"Active":"Paused"})]})]})]})]},r.id))}),t.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(we,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No scheduled tasks yet"}),e.jsx("p",{className:"text-sm",children:"Enable auto-run in preferences to create scheduled tests"})]})]})]})},ls=()=>{const[t,j]=y.useState([]),[g,f]=y.useState(!0),[d,v]=y.useState(!0),{user:l}=he(),{toast:h}=X(),a=async()=>{if(l)try{const{data:i,error:s}=await N.from("notifications").select("*").or("type.eq.test_failure,type.eq.test_recovery,type.eq.critical_system_alert,type.eq.scheduled_test_result").order("created_at",{ascending:!1}).limit(50);if(s)throw s;j(i||[])}catch(i){console.error("Error loading notifications:",i),h({title:"Error loading notifications",description:"Please try again",variant:"destructive"})}finally{f(!1)}},c=async i=>{try{const{error:s}=await N.from("notifications").update({is_read:!0}).eq("id",i);if(s)throw s;j(o=>o.map(x=>x.id===i?{...x,is_read:!0}:x))}catch(s){console.error("Error marking notification as read:",s)}},_=async()=>{try{const i=t.filter(o=>!o.is_read).map(o=>o.id);if(i.length===0)return;const{error:s}=await N.from("notifications").update({is_read:!0}).in("id",i);if(s)throw s;j(o=>o.map(x=>({...x,is_read:!0}))),h({title:"All notifications marked as read"})}catch(i){console.error("Error marking all as read:",i)}},u=(i,s)=>s==="high"?e.jsx(W,{className:"h-4 w-4 text-destructive"}):i==="test_failure"?e.jsx(Z,{className:"h-4 w-4 text-destructive"}):i==="test_recovery"?e.jsx(Le,{className:"h-4 w-4 text-success"}):e.jsx(qe,{className:"h-4 w-4 text-info"}),r=i=>{switch(i){case"high":return"destructive";case"medium":return"secondary";case"low":return"outline";default:return"outline"}};y.useEffect(()=>{if(!d||!l)return;const i=N.channel("testing-notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:"type=in.(test_failure,test_recovery,critical_system_alert,scheduled_test_result)"},s=>{const o=s.new;j(x=>[o,...x]),o.priority==="high"&&h({title:o.title,description:o.message,variant:o.type==="test_failure"?"destructive":"default"})}).subscribe();return()=>{N.removeChannel(i)}},[d,l,h]),y.useEffect(()=>{a()},[l]);const m=t.filter(i=>!i.is_read).length;return e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),"Testing Notifications",m>0&&e.jsx(R,{variant:"destructive",className:"ml-2",children:m})]}),e.jsx(J,{children:"Real-time notifications for test results and system alerts"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{variant:"outline",size:"sm",onClick:()=>v(!d),children:d?e.jsx(oe,{className:"h-4 w-4"}):e.jsx(es,{className:"h-4 w-4"})}),m>0&&e.jsx(q,{variant:"outline",size:"sm",onClick:_,children:"Mark all read"})]})]})}),e.jsx(k,{children:e.jsx(Oe,{className:"h-96",children:e.jsxs("div",{className:"space-y-3",children:[t.map(i=>{var s;return e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${i.is_read?"hover:bg-muted/30":"bg-muted/50 border-primary/20"}`,onClick:()=>!i.is_read&&c(i.id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[u(i.type,i.priority),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:`text-sm font-medium ${i.is_read?"":"font-semibold"}`,children:i.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{variant:r(i.priority),className:"text-xs",children:i.priority}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(i.created_at).toLocaleTimeString()})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.message}),((s=i.metadata)==null?void 0:s.test_suite)&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Test Suite: ",i.metadata.test_suite]})]})]})},i.id)}),t.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No notifications yet"}),e.jsx("p",{className:"text-sm",children:"Testing notifications will appear here"})]})]})})})]})},os=()=>{const[t,j]=y.useState(new Map),[g,f]=y.useState(!1),{toast:d}=X(),v=u=>Math.min(3e4*Math.pow(2,u),9e5),l=u=>u<=2?{retryDelayMs:3e4,maxRetries:3,escalateAfter:3}:u<=5?{retryDelayMs:12e4,maxRetries:2,escalateAfter:5}:{retryDelayMs:3e5,maxRetries:1,escalateAfter:7},h=y.useCallback(async(u,r)=>{const m=new Date,i=t.get(u)||{testSuite:u,consecutiveFailures:0,lastFailureTime:m,recoveryAttempts:0},s={...i,consecutiveFailures:i.consecutiveFailures+1,lastFailureTime:m};j(new Map(t.set(u,s)));try{await N.functions.invoke("system-logging",{body:{correlation_id:crypto.randomUUID(),service_name:"testing-framework",log_level:"error",message:`Test suite ${u} failed`,metadata:{consecutive_failures:s.consecutiveFailures,error_details:r,recovery_attempts:s.recoveryAttempts}}})}catch(x){console.error("Failed to log failure:",x)}const o=l(s.consecutiveFailures);return s.consecutiveFailures>=o.escalateAfter&&await c(u,s,r),s},[t]),a=y.useCallback(u=>{if(t.has(u)){const r=t.get(u);r.consecutiveFailures>0&&(d({title:"Recovery successful",description:`${u} is now working properly`}),N.functions.invoke("system-logging",{body:{correlation_id:crypto.randomUUID(),service_name:"testing-framework",log_level:"info",message:`Test suite ${u} recovered`,metadata:{previous_failures:r.consecutiveFailures,recovery_attempts:r.recoveryAttempts}}})),j(new Map(t.set(u,{...r,consecutiveFailures:0,recoveryAttempts:0})))}},[t,d]),c=async(u,r,m)=>{try{await N.from("agent_alerts").insert({alert_type:"critical_test_failure",severity:"high",title:`Critical Test Failure: ${u}`,message:`Test suite has failed ${r.consecutiveFailures} consecutive times`,agent_id:"testing-framework",alert_data:{test_suite:u,consecutive_failures:r.consecutiveFailures,last_error:m,first_failure_time:new Date(Date.now()-r.consecutiveFailures*3e4).toISOString()}}),d({title:"Critical failure escalated",description:`Administrators have been notified about ${u}`,variant:"destructive"})}catch(i){console.error("Failed to escalate failure:",i)}},_=y.useCallback(async(u,r)=>{const m=t.get(u);if(!m)return{success:!1,shouldRetry:!1};const i=l(m.consecutiveFailures);if(m.recoveryAttempts>=i.maxRetries)return{success:!1,shouldRetry:!1};f(!0);try{const s=v(m.recoveryAttempts);await new Promise(x=>setTimeout(x,s));const o=await r();return a(u),f(!1),{success:!0,result:o,shouldRetry:!1}}catch{const o={...m,recoveryAttempts:m.recoveryAttempts+1};j(new Map(t.set(u,o))),f(!1);const x=o.recoveryAttempts<i.maxRetries;return x||d({title:"Recovery failed",description:`Unable to recover ${u} after ${i.maxRetries} attempts`,variant:"destructive"}),{success:!1,shouldRetry:x}}},[t,a,d]);return{failurePatterns:Array.from(t.values()),isRecovering:g,recordFailure:h,recordSuccess:a,attemptRecovery:_}},ds=()=>{const{failurePatterns:t,isRecovering:j}=os(),g=(l,h)=>{const a=l<=2?3:l<=5?2:1;return Math.min(h/a*100,100)},f=l=>l>=7?{level:"critical",color:"destructive"}:l>=5?{level:"high",color:"destructive"}:l>=3?{level:"medium",color:"secondary"}:{level:"low",color:"outline"},d=(l,h)=>{const _=Math.min(3e4*Math.pow(2,h),9e5);return new Date(Date.now()+_)},v=t.filter(l=>l.consecutiveFailures>0);return e.jsxs(T,{children:[e.jsxs(F,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(V,{className:`h-5 w-5 ${j?"animate-spin":""}`}),"Smart Failure Recovery",j&&e.jsx(R,{variant:"secondary",className:"ml-2",children:"Recovering..."})]}),e.jsx(J,{children:"Automated failure detection and intelligent recovery strategies"})]}),e.jsx(k,{className:"space-y-4",children:v.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(pe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"font-medium",children:"All systems healthy"}),e.jsx("p",{className:"text-sm",children:"No active failure patterns detected"})]}):e.jsxs("div",{className:"space-y-4",children:[v.map(l=>{const h=f(l.consecutiveFailures),a=g(l.consecutiveFailures,l.recoveryAttempts),c=d(l.consecutiveFailures,l.recoveryAttempts);return e.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:`h-4 w-4 ${h.level==="critical"?"text-destructive":"text-warning"}`}),e.jsx("span",{className:"font-medium",children:l.testSuite})]}),e.jsxs(R,{variant:h.color,children:[h.level," severity"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Consecutive failures:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.consecutiveFailures})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Recovery attempts:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.recoveryAttempts})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Last failure:"}),e.jsx("span",{className:"ml-2 font-medium",children:new Date(l.lastFailureTime).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Next retry:"}),e.jsx("span",{className:"ml-1 font-medium text-xs",children:c.toLocaleTimeString()})]})]}),l.recoveryAttempts>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Recovery progress"}),e.jsxs("span",{className:"font-medium",children:[Math.round(a),"%"]})]}),e.jsx(ue,{value:a,className:"h-2"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground p-2 bg-muted/50 rounded",children:[h.level==="critical"&&e.jsx("p",{children:"ðŸš¨ Critical failure - administrators have been notified"}),h.level==="high"&&e.jsx("p",{children:"âš ï¸ High severity - implementing extended retry intervals"}),h.level==="medium"&&e.jsx("p",{children:"ðŸ“Š Monitoring pattern - applying exponential backoff"}),h.level==="low"&&e.jsx("p",{children:"ðŸ”„ Minor issues detected - standard recovery in progress"})]})]},l.testSuite)}),e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Recovery Statistics"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Active patterns:"}),e.jsx("span",{className:"ml-2 font-medium",children:v.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Total attempts:"}),e.jsx("span",{className:"ml-2 font-medium",children:v.reduce((l,h)=>l+h.recoveryAttempts,0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Critical alerts:"}),e.jsx("span",{className:"ml-2 font-medium",children:v.filter(l=>l.consecutiveFailures>=7).length})]})]})]})]})})]})},ms=()=>{var $;const[t,j]=y.useState(!1),[g,f]=y.useState(!1),[d,v]=y.useState([]),[l,h]=y.useState(null),[a,c]=y.useState(0),[_,u]=y.useState(""),{toast:r}=X();fe(),Ee();const m=[{service:"Hotels",icon:Ve,searchType:"hotel",params:{cityCode:"SYD",checkInDate:"2025-09-20",checkOutDate:"2025-09-22",adults:2,roomQuantity:1}},{service:"Flights",icon:ze,searchType:"flight",params:{originLocationCode:"SYD",destinationLocationCode:"MEL",departureDate:"2025-09-25",adults:1}},{service:"Activities",icon:te,searchType:"activity",params:{destination:"sydney",date:"2025-09-20",participants:2,radius:20}}],i=y.useCallback(async()=>{j(!0),c(0),v([]),h(null);const n=[],w=m.length+1;let p=0;try{for(const A of m){u(`Testing ${A.service} provider rotation...`),c(p/w*100);try{const L=Date.now(),{data:S,error:M}=await N.functions.invoke("provider-rotation",{body:{searchType:A.searchType,params:A.params}}),ee=Date.now()-L;n.push({service:A.service,success:(S==null?void 0:S.success)||!1,provider:(S==null?void 0:S.provider)||"None",resultCount:Array.isArray(S==null?void 0:S.data)?S.data.length:0,responseTime:ee,error:(M==null?void 0:M.message)||(S!=null&&S.success||S==null?void 0:S.error),timestamp:new Date,details:{data:S,error:M}})}catch(L){n.push({service:A.service,success:!1,provider:"Error",resultCount:0,responseTime:0,error:L.message||"Test execution failed",timestamp:new Date})}p++,c(p/w*100)}u("Testing individual provider endpoints...");try{const{data:A,error:L}=await N.functions.invoke("test-provider-rotation",{body:{comprehensive:!0}});A!=null&&A.results&&A.results.forEach(S=>{n.push({service:`${S.service} (Direct)`,success:S.success,provider:S.provider||"N/A",resultCount:S.results||0,responseTime:0,error:S.error,timestamp:new Date,details:S})})}catch(A){console.warn("Individual provider test failed:",A)}p++,c(100),v(n),u("Analyzing results with AI Master Bot..."),await s(n);const D=n.filter(A=>A.success).length,E=n.length;r({title:"Testing Complete",description:`${D}/${E} tests passed. AI analysis available.`,variant:D===E?"default":"destructive"})}catch(D){console.error("Test execution failed:",D),r({title:"Test Failed",description:D.message||"Failed to complete testing",variant:"destructive"})}finally{j(!1),u(""),c(0)}},[r]),s=async n=>{try{for(const p of n)await N.from("provider_health").upsert({provider:p.provider,status:p.success?"healthy":"degraded",response_time_ms:p.responseTime,last_checked:new Date().toISOString(),error_message:p.error||null,metadata:p.details||{}});await N.from("system_logs").insert({service_name:"provider_diagnostics",level:"info",message:"Provider diagnostics completed",metadata:{test_count:n.length,successful_tests:n.filter(p=>p.success).length,failed_tests:n.filter(p=>!p.success).length,avg_response_time:n.reduce((p,D)=>p+D.responseTime,0)/n.length}});const w=n.filter(p=>!p.success);for(const p of w)await N.from("critical_alerts").insert({alert_type:"provider_failure",severity:"high",message:`${p.provider} ${p.service} failure: ${p.error||"Provider test failed"}`,metadata:{provider:p.provider,service:p.service,response_time:p.responseTime,timestamp:p.timestamp.toISOString()}});await o(n)}catch(w){console.error("Master Bot communication failed:",w),b(n)}},o=async n=>{var w;try{const{data:p}=await N.auth.getUser();if(!p.user){console.warn("User not authenticated, skipping Master Bot integration"),b(n);return}const D={admin_user_id:p.user.id,command_text:`Analyze provider test results: ${n.length} tests completed with ${n.filter(z=>z.success).length} successes and ${n.filter(z=>!z.success).length} failures. Generate comprehensive health assessment and actionable recommendations.`,command_type:"analysis",target_bots:["provider-health-analyzer","system-optimizer"],command_parameters:{test_results:n.map(z=>({service:z.service,provider:z.provider,success:z.success,response_time:z.responseTime,error:z.error,timestamp:z.timestamp.toISOString()})),analysis_type:"provider_diagnostics",priority:n.filter(z=>!z.success).length>0?"high":"medium"}},{data:E,error:A}=await N.from("admin_bot_commands").insert(D).select().single();if(A)throw A;const{data:L,error:S}=await N.functions.invoke("master-bot-controller",{body:{command_id:E.id,command_text:D.command_text,command_type:D.command_type,target_bots:D.target_bots,parameters:D.command_parameters}});if(S){console.error("Master Bot invocation failed:",S),b(n);return}const{data:M,error:ee}=await N.from("bot_result_aggregation").select("*").eq("correlation_id",E.id).order("created_at",{ascending:!1}).limit(1);if(ee||!(M!=null&&M.length)){console.warn("No bot results found, using fallback analysis"),b(n);return}const B=M[0].result_data;h({summary:(B==null?void 0:B.summary)||"AI analysis completed successfully",recommendations:(B==null?void 0:B.recommendations)||(B==null?void 0:B.optimization_suggestions)||[],actionItems:(B==null?void 0:B.action_items)||[],severity:x(B,n)}),r({title:"AI Analysis Complete",description:`Master Bot provided ${((w=B==null?void 0:B.recommendations)==null?void 0:w.length)||0} recommendations`,variant:"default"})}catch(p){console.error("Master Bot integration error:",p),b(n)}},x=(n,w)=>{if(n!=null&&n.severity)return n.severity;const p=w.filter(D=>!D.success).length/w.length;return p===1?"critical":p>.5?"high":p>.2?"medium":"low"},b=n=>{const w=n.filter(M=>M.success).length,p=n.length,D=n.reduce((M,ee)=>M+ee.responseTime,0)/n.length;let E="low",A="";const L=[],S=[];w===p?(E="low",A=`All ${p} provider tests passed successfully. System is operating normally with average response time of ${Math.round(D)}ms.`,L.push("Continue monitoring provider performance"),L.push("Consider implementing automated health checks")):w===0?(E="critical",A=`Critical: All ${p} provider tests failed. Complete service outage detected.`,S.push("Immediate investigation required"),S.push("Check provider credentials and API endpoints"),S.push("Verify network connectivity")):(E=w/p>.5?"medium":"high",A=`${w}/${p} provider tests passed. ${p-w} providers are currently unavailable.`,n.filter(M=>!M.success).forEach(M=>{S.push(`Fix ${M.service} provider: ${M.error||"Unknown error"}`)}),L.push("Implement provider fallback mechanisms"),L.push("Add circuit breaker patterns")),h({summary:A,recommendations:L,actionItems:S,severity:E})};y.useEffect(()=>{let n;return g&&!t?(console.log("Auto-run enabled for provider tests"),n=setInterval(()=>{i()},5*60*1e3)):g||console.log("Auto-run disabled for provider tests"),()=>{n&&clearInterval(n)}},[g,t,i]);const I=(n,w=!1)=>w?e.jsx(K,{className:"h-4 w-4 text-blue-500 animate-spin"}):n?e.jsx(O,{className:"h-4 w-4 text-green-500"}):e.jsx(Z,{className:"h-4 w-4 text-red-500"}),C=n=>{switch(n){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";default:return"text-blue-600 bg-blue-50 border-blue-200"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),"Unified Provider Diagnostics"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{checked:g,onCheckedChange:f,disabled:t}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Auto re-run (5min)"})]}),e.jsx(q,{onClick:i,disabled:t,className:"flex items-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 animate-spin"}),"Running Tests..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4"}),"Run Full Diagnostics"]})})]})]})}),e.jsxs(k,{children:[t&&e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:_}),e.jsxs("span",{className:"text-sm font-medium",children:[Math.round(a),"%"]})]}),e.jsx(ue,{value:a,className:"w-full"})]}),e.jsxs(ce,{defaultValue:"results",className:"space-y-4",children:[e.jsxs(le,{className:"grid w-full grid-cols-3",children:[e.jsx(H,{value:"results",children:"Test Results"}),e.jsx(H,{value:"ai-analysis",children:"AI Analysis"}),e.jsx(H,{value:"individual",children:"Individual Providers"})]}),e.jsxs(U,{value:"results",className:"space-y-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx(ss,{})}),d.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{children:[e.jsxs("strong",{children:[d.filter(n=>n.success).length,"/",d.length]})," tests passed"]}),e.jsxs("span",{className:"text-muted-foreground",children:["Last run: ",($=d[0])==null?void 0:$.timestamp.toLocaleString("en-AU",{timeZone:"Australia/Sydney"})]})]}),e.jsx("div",{className:"grid gap-3",children:m.map((n,w)=>{const p=d.find(E=>E.service===n.service),D=n.icon;return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:n.service}),p&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Provider: ",p.provider," â€¢ Response: ",p.responseTime,"ms",p.resultCount>0&&` â€¢ ${p.resultCount} results`]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:p?e.jsxs(e.Fragment,{children:[I(p.success),e.jsx(R,{variant:p.success?"default":"destructive",children:p.success?"Working":"Failed"})]}):e.jsx(R,{variant:"outline",children:"Not Tested"})})]},n.service)})})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No test results available. Run diagnostics to see provider status."})]}),e.jsx(U,{value:"ai-analysis",className:"space-y-4",children:l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{className:`border ${C(l.severity)}`,children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Master Bot AI Analysis",e.jsx(R,{variant:"outline",className:C(l.severity),children:l.severity.toUpperCase()})]})}),e.jsxs(k,{children:[e.jsx("p",{className:"text-sm",children:l.summary}),e.jsx("div",{className:"mt-3 text-xs text-muted-foreground",children:"Analysis powered by GPT-5 with real system data integration"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ns,{}),e.jsx(cs,{})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ls,{}),e.jsx(ds,{})]}),l.recommendations.length>0&&e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(P,{className:"text-lg flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-green-500"}),"AI Recommendations"]})}),e.jsx(k,{children:e.jsx("ul",{className:"space-y-2",children:l.recommendations.map((n,w)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(O,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),n]},w))})})]}),l.actionItems.length>0&&e.jsxs(T,{children:[e.jsx(F,{children:e.jsx(P,{className:"text-lg",children:"Action Items"})}),e.jsx(k,{children:e.jsx("ul",{className:"space-y-2",children:l.actionItems.map((n,w)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(W,{className:"h-4 w-4 text-orange-500 mt-0.5 flex-shrink-0"}),n]},w))})})]})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Run diagnostics to get AI-powered analysis and recommendations"})]})}),e.jsxs(U,{value:"individual",className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Individual provider endpoint testing shows the health of each specific provider function."}),d.filter(n=>n.service.includes("(Direct)")).length>0?e.jsx("div",{className:"space-y-2",children:d.filter(n=>n.service.includes("(Direct)")).map((n,w)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsx("span",{className:"font-medium",children:n.service}),e.jsxs("div",{className:"flex items-center gap-2",children:[I(n.success),e.jsx("span",{className:"text-sm text-muted-foreground",children:n.success?`${n.provider} (${n.resultCount} results)`:n.error})]})]},w))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Individual provider results will appear here after running diagnostics."})]})]})]})]}),e.jsx(ts,{testResults:d,onHealthUpdate:()=>console.log("Provider health updated")}),e.jsx(rs,{testResults:d,testSummary:{totalTests:d.length,successfulTests:d.filter(n=>n.success).length,failedTests:d.filter(n=>!n.success).length,averageResponseTime:d.length>0?d.reduce((n,w)=>n+w.responseTime,0)/d.length:0,totalResultCount:d.reduce((n,w)=>n+w.resultCount,0)},sessionId:`test_session_${Date.now()}`})]})};function us(){var a,c,_,u,r,m,i,s,o;const[t,j]=y.useState(null),[g,f]=y.useState(!0),{toast:d}=X(),v=async()=>{try{f(!0);const{data:x,error:b}=await N.functions.invoke("hotelbeds-monitoring",{body:{action:"get_dashboard_data"}});if(b)throw b;j(x)}catch(x){console.error("Failed to fetch monitoring data:",x),d({title:"Error",description:"Failed to load monitoring data",variant:"destructive"})}finally{f(!1)}};y.useEffect(()=>{v();const x=setInterval(v,3e4);return()=>clearInterval(x)},[]);const l=x=>{switch(x){case"healthy":return"text-green-600";case"degraded":return"text-yellow-600";case"down":return"text-red-600";default:return"text-gray-600"}},h=x=>{switch(x){case"healthy":return e.jsx(O,{className:"h-5 w-5 text-green-600"});case"degraded":return e.jsx(Q,{className:"h-5 w-5 text-yellow-600"});case"down":return e.jsx(Q,{className:"h-5 w-5 text-red-600"});default:return e.jsx(K,{className:"h-5 w-5 text-gray-600"})}};return g?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map((x,b)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},b))})]})}):t?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"HotelBeds Monitoring"}),e.jsx("p",{className:"text-muted-foreground",children:"Real-time provider health and analytics"})]}),e.jsxs(q,{onClick:v,variant:"outline",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(T,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Provider Status"}),h(t.healthStatus.status)]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:e.jsx("span",{className:l(t.healthStatus.status),children:t.healthStatus.status.charAt(0).toUpperCase()+t.healthStatus.status.slice(1)})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Success rate: ",t.healthStatus.successRate,"%"]})]})]}),e.jsxs(T,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Searches Today"}),e.jsx(We,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((c=(a=t==null?void 0:t.metrics)==null?void 0:a.searchCount)==null?void 0:c.toLocaleString())||"0"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Avg response: ",((_=t==null?void 0:t.metrics)==null?void 0:_.avgResponseTime)||0,"ms"]})]})]}),e.jsxs(T,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Bookings Today"}),e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((r=(u=t==null?void 0:t.metrics)==null?void 0:u.bookingCount)==null?void 0:r.toLocaleString())||"0"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conversion rate calculated"})]})]}),e.jsxs(T,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Error Rate"}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:((m=t==null?void 0:t.metrics)==null?void 0:m.errorCount)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Errors in last 24 hours"})]})]})]}),e.jsxs(ce,{defaultValue:"analytics",className:"space-y-4",children:[e.jsxs(le,{children:[e.jsx(H,{value:"analytics",children:"Analytics"}),e.jsx(H,{value:"activity",children:"Recent Activity"}),e.jsx(H,{value:"health",children:"Health Details"})]}),e.jsx(U,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(T,{children:[e.jsx(F,{children:e.jsx(P,{children:"Response Time Trend"})}),e.jsx(k,{children:e.jsx(be,{width:"100%",height:300,children:e.jsxs(Ke,{data:(t==null?void 0:t.analytics)||[],children:[e.jsx(Se,{strokeDasharray:"3 3"}),e.jsx(Ce,{dataKey:"date"}),e.jsx(Te,{}),e.jsx(ke,{}),e.jsx(Ye,{type:"monotone",dataKey:"responseTime",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),e.jsxs(T,{children:[e.jsx(F,{children:e.jsx(P,{children:"Search vs Booking Volume"})}),e.jsx(k,{children:e.jsx(be,{width:"100%",height:300,children:e.jsxs(Ze,{data:(t==null?void 0:t.analytics)||[],children:[e.jsx(Se,{strokeDasharray:"3 3"}),e.jsx(Ce,{dataKey:"date"}),e.jsx(Te,{}),e.jsx(ke,{}),e.jsx(Ae,{dataKey:"searches",fill:"hsl(var(--primary))"}),e.jsx(Ae,{dataKey:"bookings",fill:"hsl(var(--secondary))"})]})})})]})]})}),e.jsx(U,{value:"activity",className:"space-y-4",children:e.jsxs(T,{children:[e.jsx(F,{children:e.jsx(P,{children:"Recent Activity"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-2",children:((i=t==null?void 0:t.recentActivity)==null?void 0:i.length)>0?t.recentActivity.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{variant:x.type==="error"?"destructive":"default",children:x.type}),e.jsx("span",{className:"text-sm",children:x.timestamp})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[JSON.stringify(x.details||{},null,2).substring(0,100),"..."]})]},x.id)):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No recent activity data available"})})})]})}),e.jsx(U,{value:"health",className:"space-y-4",children:e.jsxs(T,{children:[e.jsx(F,{children:e.jsx(P,{children:"Provider Health Details"})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Last Health Check"}),e.jsx("div",{className:"text-2xl font-bold",children:((s=t==null?void 0:t.healthStatus)==null?void 0:s.lastCheck)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Response Time"}),e.jsxs("div",{className:"text-2xl font-bold",children:[((o=t==null?void 0:t.healthStatus)==null?void 0:o.responseTime)||0,"ms"]})]})]}),e.jsxs(de,{children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(me,{children:"All HotelBeds services are operating normally. API endpoints are responsive and booking capabilities are fully functional."})]})]})]})})]})]}):e.jsxs("div",{className:"p-6",children:[e.jsxs(de,{children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx(me,{children:"Unable to load monitoring data. HotelBeds monitoring service may be temporarily unavailable."})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(q,{onClick:v,variant:"outline",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Retry Connection"]})})]})}function hs(){const[t,j]=y.useState({amadeus:null,sabre:null,hotelbeds:null,overall:{healthy:0,total:0,status:"critical"}}),[g,f]=y.useState(!1),[d,v]=y.useState(new Set),l=async s=>{v(o=>new Set([...o,s]));try{let o;switch(s){case"amadeus":o=await a();break;case"sabre":o=await c();break;case"hotelbeds":o=await _();break;default:throw new Error("Unknown provider")}j(x=>({...x,[s]:o,overall:u({...x,[s]:o})})),o.success?Y.success(`${s.charAt(0).toUpperCase()+s.slice(1)} credentials verified`):Y.error(`${s.charAt(0).toUpperCase()+s.slice(1)} test failed`)}catch(o){const x={success:!1,provider:s,error:o instanceof Error?o.message:"Unknown error",timestamp:new Date().toISOString()};j(b=>({...b,[s]:x,overall:u({...b,[s]:x})})),Y.error(`Failed to test ${s} credentials`)}finally{v(o=>{const x=new Set(o);return x.delete(s),x})}},h=async()=>{f(!0);try{await Promise.all([l("amadeus"),l("sabre"),l("hotelbeds")])}finally{f(!1)}},a=async()=>{var x,b,I,C,$,n,w,p,D,E,A,L,S;const{data:s,error:o}=await N.functions.invoke("amadeus-health");if(o)throw o;return{success:(s==null?void 0:s.success)||!1,provider:"amadeus",endpoints:[{name:"Authentication",status:(x=s==null?void 0:s.auth)!=null&&x.success?"success":"error",message:((b=s==null?void 0:s.auth)==null?void 0:b.message)||"Authentication test failed",responseTime:(I=s==null?void 0:s.auth)==null?void 0:I.responseTime},{name:"Flight Search API",status:(C=s==null?void 0:s.flightSearch)!=null&&C.success?"success":"warning",message:(($=s==null?void 0:s.flightSearch)==null?void 0:$.message)||"Flight search endpoint not tested",responseTime:(n=s==null?void 0:s.flightSearch)==null?void 0:n.responseTime},{name:"Hotel Search API",status:(w=s==null?void 0:s.hotelSearch)!=null&&w.success?"success":"warning",message:((p=s==null?void 0:s.hotelSearch)==null?void 0:p.message)||"Hotel search endpoint not tested",responseTime:(D=s==null?void 0:s.hotelSearch)==null?void 0:D.responseTime}],credentials:{configured:!!((E=s==null?void 0:s.credentials)!=null&&E.clientId&&((A=s==null?void 0:s.credentials)!=null&&A.clientSecret)),details:`Client ID: ${(L=s==null?void 0:s.credentials)!=null&&L.clientId?"configured":"missing"}, Secret: ${(S=s==null?void 0:s.credentials)!=null&&S.clientSecret?"configured":"missing"}`},timestamp:new Date().toISOString()}},c=async()=>{var x,b,I,C,$,n,w,p,D,E,A;const{data:s,error:o}=await N.functions.invoke("sabre-health");if(o)throw o;return{success:(s==null?void 0:s.success)||!1,provider:"sabre",endpoints:[{name:"Authentication",status:(x=s==null?void 0:s.auth)!=null&&x.success?"success":"error",message:((b=s==null?void 0:s.auth)==null?void 0:b.message)||"Authentication failed",responseTime:(I=s==null?void 0:s.auth)==null?void 0:I.responseTime},{name:"Flight Search API",status:(C=s==null?void 0:s.flightSearch)!=null&&C.available?"success":"warning",message:(($=s==null?void 0:s.flightSearch)==null?void 0:$.message)||"Flight search not available"},{name:"Hotel Search API",status:(n=s==null?void 0:s.hotelSearch)!=null&&n.available?"success":"warning",message:((w=s==null?void 0:s.hotelSearch)==null?void 0:w.message)||"Hotel search not available"}],credentials:{configured:!!((p=s==null?void 0:s.credentials)!=null&&p.clientId&&((D=s==null?void 0:s.credentials)!=null&&D.clientSecret)),details:`Client ID: ${(E=s==null?void 0:s.credentials)!=null&&E.clientId?"configured":"missing"}, Secret: ${(A=s==null?void 0:s.credentials)!=null&&A.clientSecret?"configured":"missing"}`},timestamp:new Date().toISOString()}},_=async()=>{var I,C,$,n,w,p,D,E,A,L;const{data:s,error:o}=await N.functions.invoke("hotelbeds-credential-test");if(o)throw o;const x=((C=(I=s==null?void 0:s.results)==null?void 0:I.summary)==null?void 0:C.hotelReady)||!1,b=((n=($=s==null?void 0:s.results)==null?void 0:$.summary)==null?void 0:n.activityReady)||!1;return{success:(s==null?void 0:s.success)||!1,provider:"hotelbeds",endpoints:[{name:"Hotel Service",status:x?"success":"error",message:x?"Hotel credentials configured":"Hotel credentials missing or invalid"},{name:"Activity Service",status:b?"success":"error",message:b?"Activity credentials configured":"Activity credentials missing or invalid"},{name:"Generic Fallback",status:(p=(w=s==null?void 0:s.results)==null?void 0:w.generic)!=null&&p.hasGenericCredentials?"success":"warning",message:(E=(D=s==null?void 0:s.results)==null?void 0:D.generic)!=null&&E.hasGenericCredentials?"Generic credentials available":"No generic fallback"}],credentials:{configured:x||b,details:((L=(A=s==null?void 0:s.results)==null?void 0:A.summary)==null?void 0:L.recommendedAction)||"Credential status unknown"},timestamp:new Date().toISOString()}},u=s=>{const o=[s.amadeus,s.sabre,s.hotelbeds],x=o.filter(C=>C!==null).length,b=o.filter(C=>C==null?void 0:C.success).length;let I;return b===x&&x>0?I="healthy":b>0?I="degraded":I="critical",{healthy:b,total:x,status:I}},r=s=>{switch(s){case"success":return e.jsx(O,{className:"h-4 w-4 text-success"});case"warning":return e.jsx(W,{className:"h-4 w-4 text-warning"});case"error":return e.jsx(Z,{className:"h-4 w-4 text-destructive"})}},m=()=>{switch(t.overall.status){case"healthy":return e.jsx(Qe,{className:"h-5 w-5 text-success"});case"degraded":return e.jsx(W,{className:"h-5 w-5 text-warning"});case"critical":return e.jsx(Xe,{className:"h-5 w-5 text-destructive"})}},i=s=>{const o=t[s],x=d.has(s);return e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{className:"capitalize",children:s}),e.jsxs(J,{children:[s==="amadeus"&&"Flight, Hotel & Activity search provider",s==="sabre"&&"Flight & Hotel search provider",s==="hotelbeds"&&"Hotel & Activity booking provider"]})]}),e.jsxs(q,{onClick:()=>l(s),disabled:x,variant:"outline",size:"sm",children:[x?e.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(V,{className:"h-4 w-4 mr-2"}),"Test"]})]})}),e.jsx(k,{children:o?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Overall Status"}),e.jsx(R,{variant:o.success?"default":"destructive",children:o.success?"Connected":"Failed"})]}),o.credentials&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Credentials"}),o.credentials.configured?e.jsx(O,{className:"h-4 w-4 text-success"}):e.jsx(Z,{className:"h-4 w-4 text-destructive"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o.credentials.details})]}),o.endpoints&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Endpoints"}),o.endpoints.map((b,I)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-card border rounded text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[r(b.status),e.jsx("span",{children:b.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-muted-foreground",children:b.message}),b.responseTime&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[b.responseTime,"ms"]})]})]},I))]}),o.error&&e.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg text-sm",children:[e.jsx("div",{className:"font-medium text-destructive mb-1",children:"Error"}),e.jsx("div",{className:"text-muted-foreground",children:o.error})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Tested: ",new Date(o.timestamp).toLocaleString()]})]}):e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(W,{className:"h-6 w-6 mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-sm",children:['Click "Test" to validate ',s," credentials"]})]})})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{children:e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[m(),e.jsxs("div",{children:[e.jsx(P,{children:"Provider Credential Status"}),e.jsx(J,{children:"Test all API provider credentials and connections"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"font-medium",children:[t.overall.healthy,"/",t.overall.total," Providers Healthy"]}),e.jsx(R,{variant:t.overall.status==="healthy"?"default":t.overall.status==="degraded"?"secondary":"destructive",children:t.overall.status})]}),e.jsxs(q,{onClick:h,disabled:g,variant:"default",children:[g?e.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(V,{className:"h-4 w-4 mr-2"}),"Test All"]})]})]})})}),e.jsxs(ce,{defaultValue:"amadeus",className:"space-y-4",children:[e.jsxs(le,{className:"grid w-full grid-cols-3",children:[e.jsxs(H,{value:"amadeus",className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Amadeus"}),t.amadeus&&(t.amadeus.success?e.jsx(O,{className:"h-3 w-3 text-success"}):e.jsx(Z,{className:"h-3 w-3 text-destructive"}))]}),e.jsxs(H,{value:"sabre",className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Sabre"}),t.sabre&&(t.sabre.success?e.jsx(O,{className:"h-3 w-3 text-success"}):e.jsx(Z,{className:"h-3 w-3 text-destructive"}))]}),e.jsxs(H,{value:"hotelbeds",className:"flex items-center space-x-2",children:[e.jsx("span",{children:"HotelBeds"}),t.hotelbeds&&(t.hotelbeds.success?e.jsx(O,{className:"h-3 w-3 text-success"}):e.jsx(Z,{className:"h-3 w-3 text-destructive"}))]})]}),e.jsx(U,{value:"amadeus",children:i("amadeus")}),e.jsx(U,{value:"sabre",children:i("sabre")}),e.jsx(U,{value:"hotelbeds",children:i("hotelbeds")})]})]})}function xs(){const[t,j]=y.useState(!1),[g,f]=y.useState(null),{toast:d}=X(),v=async()=>{j(!0);try{const{data:a,error:c}=await N.functions.invoke("foundation-repair-test");if(c)throw c;f(a);const _=a.summary.failed>0;d({title:_?"Foundation Issues Found":"Foundation Tests Passed",description:`${a.summary.passed} passed, ${a.summary.failed} failed`,variant:_?"destructive":"default"})}catch(a){console.error("Foundation test failed:",a),d({title:"Foundation Test Failed",description:a.message||"Failed to execute foundation tests",variant:"destructive"})}finally{j(!1)}},l=a=>{switch(a){case"passed":return e.jsx(O,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(Q,{className:"h-4 w-4 text-red-500"});default:return e.jsx(V,{className:"h-4 w-4 text-gray-400"})}},h=a=>{switch(a){case"passed":return e.jsx(R,{variant:"default",className:"bg-green-100 text-green-800",children:"Passed"});case"failed":return e.jsx(R,{variant:"destructive",children:"Failed"});default:return e.jsx(R,{variant:"secondary",children:"Pending"})}};return e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Foundation Repair Tests"]}),e.jsx(J,{children:"Validate core system components and provider configurations"})]}),e.jsxs(q,{onClick:v,disabled:t,className:"flex items-center gap-2",children:[t?e.jsx(V,{className:"h-4 w-4 animate-spin"}):e.jsx(ge,{className:"h-4 w-4"}),t?"Testing...":"Run Foundation Tests"]})]})}),e.jsxs(k,{className:"space-y-4",children:[g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Summary:"})," ",g.summary.passed," passed, ",g.summary.failed," failed"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Last run: ",new Date(g.timestamp).toLocaleString()]})]}),e.jsx("div",{className:"space-y-3",children:g.tests.map((a,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l(a.status),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.name}),a.message&&e.jsx("div",{className:"text-sm text-muted-foreground",children:a.message})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:h(a.status)})]},c))}),g.summary.failed>0&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Critical Issues Found"}),e.jsx("div",{className:"text-sm text-red-700",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:g.tests.filter(a=>a.status==="failed").map((a,c)=>{var _;return e.jsxs("li",{children:[a.name,": ",((_=a.details)==null?void 0:_.error)||"Configuration missing"]},c)})})})]})]}),!g&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Run foundation tests to validate system configuration"})]})]})]})}function fs(){var u;const[t,j]=y.useState([]),[g,f]=y.useState([]),[d,v]=y.useState(!1),[l,h]=y.useState(null),a=async()=>{v(!0);try{const{data:r,error:m}=await N.from("provider_health").select("*").order("last_checked",{ascending:!1});if(m)throw m;const{data:i,error:s}=await N.from("provider_quotas").select("*");if(s)throw s;const o=(r==null?void 0:r.map(I=>{const C=i==null?void 0:i.find($=>$.provider_id===I.provider);return{...I,quota_usage:(C==null?void 0:C.percentage_used)||0,quota_status:(C==null?void 0:C.status)||"healthy"}}))||[];j(o);const{data:x,error:b}=await N.from("system_logs").select("*").eq("service_name","provider-rotation").eq("log_level","error").gte("created_at",new Date(Date.now()-24*60*60*1e3).toISOString()).order("created_at",{ascending:!1}).limit(10);if(!b&&x){const I=x.map(C=>{const $=typeof C.metadata=="object"&&C.metadata!==null?C.metadata:{};return{timestamp:C.created_at,provider:($==null?void 0:$.provider)||"unknown",error_message:C.message,search_type:($==null?void 0:$.searchType)||"unknown",response_time:C.duration_ms||0}});f(I)}h(new Date)}catch(r){console.error("Failed to fetch provider health:",r)}finally{v(!1)}},c=r=>{switch(r){case"healthy":return e.jsx(O,{className:"w-4 h-4 text-success"});case"degraded":case"warning":return e.jsx(W,{className:"w-4 h-4 text-warning"});case"down":case"critical":case"exceeded":return e.jsx(Z,{className:"w-4 h-4 text-destructive"});default:return e.jsx(Q,{className:"w-4 h-4 text-muted-foreground"})}},_=r=>{switch(r){case"healthy":return"default";case"degraded":case"warning":return"secondary";case"down":case"critical":case"exceeded":return"destructive";default:return"outline"}};return y.useEffect(()=>{a();const r=setInterval(a,3e4);return()=>clearInterval(r)},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ne,{className:"w-6 h-6"}),"Provider Health Monitor"]}),e.jsx("p",{className:"text-muted-foreground",children:"Real-time monitoring of travel API providers and quota usage"})]}),e.jsx(q,{onClick:a,disabled:d,variant:"outline",children:d?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),"Refreshing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Refresh"]})})]}),g.length>0&&e.jsxs(de,{variant:"destructive",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs(me,{children:[e.jsx("strong",{children:"Critical Issue Detected:"})," Multiple provider rotation failures in the last 24 hours.",e.jsx("br",{}),"Latest error: ",(u=g[0])==null?void 0:u.error_message,e.jsx("br",{}),e.jsx("em",{children:"This may impact search functionality and user experience."})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(r=>e.jsxs(T,{children:[e.jsx(F,{className:"pb-3",children:e.jsxs(P,{className:"text-base flex items-center justify-between",children:[e.jsx("span",{children:r.provider}),c(r.status)]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Status"}),e.jsx(R,{variant:_(r.status),children:r.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Response Time"}),e.jsxs("span",{className:`text-sm font-medium ${r.response_time_ms<1e3?"text-success":r.response_time_ms<3e3?"text-warning":"text-destructive"}`,children:[r.response_time_ms,"ms"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Error Count"}),e.jsx("span",{className:`text-sm font-medium ${r.error_count===0?"text-success":r.error_count<5?"text-warning":"text-destructive"}`,children:r.error_count})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Quota Usage"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:[r.quota_usage,"%"]}),e.jsx(R,{variant:_(r.quota_status),children:r.quota_status})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(K,{className:"w-3 h-3"}),"Last checked: ",new Date(r.last_checked).toLocaleTimeString()]})]})})]},r.provider))}),g.length>0&&e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Recent Provider Rotation Errors (Last 24h)"]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-3",children:g.slice(0,5).map((r,m)=>e.jsxs("div",{className:"border-l-4 border-destructive pl-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(R,{variant:"destructive",children:r.provider}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(r.timestamp).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.error_message}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Type: ",r.search_type]}),r.response_time>0&&e.jsxs("span",{children:["Response: ",r.response_time,"ms"]})]})]},m))})})]}),e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"Performance Insights"]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-success",children:t.filter(r=>r.status==="healthy").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Healthy Providers"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-warning",children:t.filter(r=>r.status==="degraded").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Degraded Providers"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-destructive",children:t.filter(r=>r.status==="down").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Down Providers"})]})]}),l&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center mt-4 flex items-center justify-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),"Last updated: ",l.toLocaleString()]})]})]})]})}function gs(){const[t,j]=y.useState({stuck_bookings:0,last_cleanup:null,automated_active:!1,critical_alerts:0,github_actions_status:"unknown"}),[g,f]=y.useState(!0),[d,v]=y.useState(!1),l=async()=>{var u;try{const{data:r,error:m}=await N.from("bookings").select("id").eq("status","pending").lt("created_at",new Date(Date.now()-12e4).toISOString());if(m)throw m;const{data:i,error:s}=await N.from("cleanup_audit").select("created_at").order("created_at",{ascending:!1}).limit(1);if(s)throw s;const{data:o,error:x}=await N.from("critical_alerts").select("id").eq("resolved",!1);if(x)throw x;j({stuck_bookings:(r==null?void 0:r.length)||0,last_cleanup:((u=i==null?void 0:i[0])==null?void 0:u.created_at)||null,automated_active:i!=null&&i[0]?Date.now()-new Date(i[0].created_at).getTime()<5*60*1e3:!1,critical_alerts:(o==null?void 0:o.length)||0,github_actions_status:"unknown"})}catch(r){console.error("Error fetching cleanup status:",r),Y.error("Failed to fetch cleanup status")}finally{f(!1)}},h=async()=>{var u,r;v(!0);try{Y.info("Starting manual cleanup...");const{data:m,error:i}=await N.functions.invoke("enhanced-cleanup",{body:{trigger:"manual_emergency",correlationId:crypto.randomUUID(),cleanupType:"comprehensive"}});if(i)throw console.error("Supabase function error:",i),i;if(m!=null&&m.success){const s=((u=m.results)==null?void 0:u.total_processed)||0,o=((r=m.results)==null?void 0:r.errors)||0;o>0?Y.warning(`Cleanup completed with warnings: ${s} bookings processed, ${o} errors`):Y.success(`Manual cleanup completed: ${s} bookings processed successfully`),setTimeout(async()=>{await l()},2e3)}else throw new Error((m==null?void 0:m.error)||"Cleanup failed")}catch(m){console.error("Manual cleanup error:",m),Y.error("Manual cleanup failed: "+m.message)}finally{v(!1)}};y.useEffect(()=>{l();const u=setInterval(l,3e4);return()=>clearInterval(u)},[]);const c=t.stuck_bookings>0?{status:"critical",color:"destructive"}:t.automated_active?{status:"healthy",color:"default"}:{status:"warning",color:"secondary"},_=t.last_cleanup?new Date(t.last_cleanup).toLocaleString():"Never";return g?e.jsx(T,{className:"w-full",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(V,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading cleanup status..."})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Emergency Cleanup System Status"]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-destructive",children:t.stuck_bookings}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Stuck Bookings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(R,{variant:t.automated_active?"default":"destructive",children:t.automated_active?"Active":"Inactive"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Automated Cleanup"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:t.critical_alerts}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Critical Alerts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(R,{variant:c.color,children:c.status.toUpperCase()}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"System Health"})]})]})})]}),e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Emergency Actions"]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(q,{onClick:h,disabled:d,variant:t.stuck_bookings>0?"destructive":"default",className:"flex-1",children:d?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 animate-spin mr-2"}),"Running Cleanup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Run Manual Cleanup (",t.stuck_bookings," bookings)"]})}),e.jsxs(q,{onClick:l,variant:"outline",disabled:g,children:[e.jsx(V,{className:`h-4 w-4 mr-2 ${g?"animate-spin":""}`}),"Refresh Status"]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Last cleanup: ",_]})})]})]}),t.stuck_bookings>0&&e.jsx(T,{className:"border-destructive",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(W,{className:"h-5 w-5"}),e.jsxs("span",{className:"font-semibold",children:["CRITICAL: ",t.stuck_bookings," stuck bookings detected!"]})]}),e.jsx("p",{className:"text-sm mt-2",children:"The system has detected bookings that have been pending for more than 2 minutes. Run manual cleanup immediately to resolve these issues."})]})}),!t.automated_active&&e.jsx(T,{className:"border-yellow-500",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-700",children:[e.jsx(K,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"WARNING: Automated cleanup appears inactive"})]}),e.jsx("p",{className:"text-sm mt-2",children:"No cleanup has run in the last 5 minutes. Check GitHub Actions status and consider running manual cleanup."})]})}),t.stuck_bookings===0&&t.automated_active&&e.jsx(T,{className:"border-green-500",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx(O,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:"System Operating Normally"})]}),e.jsx("p",{className:"text-sm mt-2",children:"No stuck bookings detected and automated cleanup is running successfully."})]})})]})}const rt=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Test Suite & A/B Testing"}),e.jsx("p",{className:"text-muted-foreground",children:"Unified testing interface with automated scenarios, batch operations, and A/B experiments"})]}),e.jsxs(ce,{defaultValue:"diagnostics",className:"space-y-6",children:[e.jsxs(le,{className:"grid w-full grid-cols-7",children:[e.jsxs(H,{value:"diagnostics",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Provider Diagnostics"]}),e.jsxs(H,{value:"emergency",className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Emergency"]}),e.jsxs(H,{value:"health-monitor",className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Health Monitor"]}),e.jsxs(H,{value:"foundation",className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),"Foundation"]}),e.jsxs(H,{value:"credentials",className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Credentials"]}),e.jsxs(H,{value:"monitoring",className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Monitoring"]}),e.jsxs(H,{value:"ab-testing",className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"A/B Testing"]})]}),e.jsx(U,{value:"diagnostics",children:e.jsx(ms,{})}),e.jsx(U,{value:"emergency",children:e.jsx(gs,{})}),e.jsx(U,{value:"health-monitor",children:e.jsx(fs,{})}),e.jsx(U,{value:"foundation",children:e.jsx(xs,{})}),e.jsx(U,{value:"credentials",children:e.jsx(hs,{})}),e.jsx(U,{value:"monitoring",children:e.jsx(us,{})}),e.jsx(U,{value:"ab-testing",children:e.jsxs(T,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),"A/B Testing Dashboard"]})}),e.jsx(k,{children:e.jsx(He,{})})]})})]})]});export{rt as default};
